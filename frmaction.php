<?php
ob_start();
include "inc.php";
include "config/logincheck.php";
ini_set('post_max_size', '10M');
ini_set('upload_max_filesize', '10M');
if(trim($_REQUEST['action'])!='profilepermission'){
	?> 
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
// frmaction file
// invoice code
if($_POST['action']=='editinvoicemain' && trim($_POST['invoiceType'])!='' && trim($_POST['editId'])!=''){
	// && trim($_POST['totalVal'])!='' 
	// echo 'test';
	$editId=clean($_POST['editId']);

	$rs='';   
	$rs=GetPageRecord('*',_INVOICE_MASTER_,'id='.$editId); 
	$invmData=mysqli_fetch_array($rs); 
	$quotationId=$invmData['quotationId']; 

	$quotQuery="";
	$quotQuery=GetPageRecord('*',_QUOTATION_MASTER_,' id="'.$quotationId.'" and status=1 '); 
	$quotationData=mysqli_fetch_array($quotQuery);

	$queryId=$quotationData['queryId']; 

	$qrQuery='';   
	$qrQuery=GetPageRecord('*',_QUERY_MASTER_,'id='.$queryId); 
	$queryData=mysqli_fetch_array($qrQuery); 
	// $editdescription=clean($queryData['description']);   

	$rs=''; 
	$rs=GetPageRecord('*',_PAYMENT_REQUEST_MASTER_,'quotationId="'.$quotationId.'"'); 
	$prmData=mysqli_fetch_array($rs); 
	$paymentId = $prmData['id'];

	// $totalISOCost = $prmData['totalISOCost'];
    // $totalConsortiaCost = $prmData['totalConsortiaCost'];
    // $totalClientCommCost = $prmData['totalClientCommCost'];

    $amount = round(($prmData['totalClientCostWithMarkup']),2);
    $totalamount = round($prmData['totalClientCost'],2);

	$fileNo=makeQuotationId($quotationId);
	$tourId=clean(makeQueryTourId($queryId));
	$referNo=clean($queryData['referanceNumber']);


	// invoiceNo
	$glno=clean($_POST['glno']);
	// echo $amount=clean($_POST['totalVal']);
	if($prmData['gstType'] == 1){
		$cgst=round((round($prmData['totalServiceTaxCost'])/2),2);
		$stg=round((round($prmData['totalServiceTaxCost'])/2),2);
		$igst=0;
	}elseif($prmData['gstType'] == 2){
		$cgst=$cgst=0;
		$igst=round($prmData['totalServiceTaxCost'],2);
	}elseif($prmData['gstType'] == 3){
		$cgst=$cgst=$igst=0;
		$gstAMT=round($prmData['totalServiceTaxCost'],2);
	}
	$tcs=clean($prmData['tcsTax']);

	$invoiceType=clean($_POST['invoiceType']);
	$invoicedate=date("Y-m-d", strtotime(clean($_POST['invoicedate'])));
	$terms=addslashes($_POST['terms']);
	
	$queryDetails=clean($_POST['description']);
	$dueDate=date("Y-m-d", strtotime(clean($_POST['dueDate'])));
	$deliveryplace=clean($_POST['deliveryplace']);
	$beneficiaryName=clean($_POST['beneficiaryName']);
	$accountNumber=clean($_POST['accountNumber']);
	$bankName=clean($_POST['bankName']);
	$branchAddress=clean($_POST['branchAddress']);
	$branchIfsc=clean($_POST['branchIfsc']);
	$branchSwiftCode=clean($_POST['branchSwiftCode']);
	$accountType=clean($_POST['accountType']);
	$particularsubject=clean($_POST['particularsubject']);
	$hsnCode=clean($_POST['hsnCode']);
	$hsnCodeId=clean($_POST['hsnCodeId']);
	$invoiceFormat=clean($_POST['invoiceFormat']);
	$guestName=clean($_POST['guestName']);
	$paymentTerms=addslashes($_POST['paymentTerms']);
	$invoiceNotes=addslashes($_POST['invoiceNotes']);
 	
	$dateAdded=time();
	$where='deletestatus=0 and quotationId="'.$quotationId.'" and invoiceType="'.$invoiceType.'"';
	
	$namevalue ='invoiceType="'.$invoiceType.'",invoiceFormat="'.$invoiceFormat.'",amount="'.$amount.'",totalamount="'.$totalamount.'",fileNo="'.$fileNo.'",referNo="'.$referNo.'",tourId="'.$tourId.'",glno="'.$glno.'",invoicedate="'.$invoicedate.'",igst="'.$igst.'",cgst="'.$cgst.'",stg="'.$stg.'",gstAMT="'.$gstAMT.'",tcs="'.$tcs.'",queryDetails="'.$queryDetails.'",invoiceNotes="'.$invoiceNotes.'",terms="'.$terms.'",payment="'.$paymentTerms.'",deletestatus=0,beneficiaryName="'.$beneficiaryName.'",accountNumber="'.$accountNumber.'",bankName="'.$bankName.'",branchAddress="'.$branchAddress.'",branchIfsc="'.$branchIfsc.'",branchSwiftCode="'.$branchSwiftCode.'",accountType="'.$accountType.'",particularsubject="'.$particularsubject.'",hsnCode="'.$hsnCode.'",deliveryPlace="'.$deliveryplace.'",guestName="'.$guestName.'",dueDate="'.$dueDate.'"';
	updatelisting(_INVOICE_MASTER_,$namevalue,$where);

	if($invoiceFormat==2){
		$hotelSerialNo = $_POST['hotelSerialNo'];
		$transferSerialNo = $_POST['transferSerialNo'];
		$transportSerialNo = $_POST['transportSerialNo'];
		$entranceSerialNo = $_POST['entranceSerialNo'];
		$activitySerialNo = $_POST['activitySerialNo'];
		$ferrySerialNo = $_POST['ferrySerialNo'];
		$mealSerialNo = $_POST['mealSerialNo'];
		$extSerialNo = $_POST['extSerialNo'];
		$flightSerialNo = $_POST['flightSerialNo'];
		$trainSerialNo = $_POST['trainSerialNo'];
		$guideSerialNo = $_POST['guideSerialNo'];
		
		// Add or Update hotel Services
		if($hotelSerialNo>0){
			for($h=1; $h<$hotelSerialNo; $h++){

				$hotelsglroom = $_POST['hotelsglroom'.$h];
				$sglHsnCode = $_POST['sglHsnCode'.$h];
				$hoteldblroom = $_POST['hoteldblroom'.$h];
				$dblHsnCode = $_POST['dblHsnCode'.$h];
				$hoteltplroom = $_POST['hoteltplroom'.$h];
				$tplHsnCode = $_POST['tplHsnCode'.$h];
				$hoteltwinroom = $_POST['hoteltwinroom'.$h];
				$twinHsnCode = $_POST['twinHsnCode'.$h];
				$hotelebedroom = $_POST['hotelebedroom'.$h];
				$EBAHsnCode = $_POST['EBAHsnCode'.$h];
				$hoteleBCroom = $_POST['hoteleBCroom'.$h];
				$EBCHsnCode = $_POST['EBCHsnCode'.$h];
				$hoteleNBroom = $_POST['hoteleNBroom'.$h];
				$ENBHsnCode = $_POST['ENBHsnCode'.$h];
				$hoteleQuadroom = $_POST['hoteleQuadroom'.$h];
				$quadHsnCode = $_POST['quadHsnCode'.$h];
				$hoteleSixroom = $_POST['hoteleSixroom'.$h];
				$sixHsnCode = $_POST['sixHsnCode'.$h];
				$hoteleEightroom = $_POST['hoteleEightroom'.$h];
				$eightHsnCode = $_POST['eightHsnCode'.$h];
				$hoteleTenroom = $_POST['hoteleTenroom'.$h];
				$tenHsnCode = $_POST['tenHsnCode'.$h];
				
				$nameValueH = 'serviceType="hotel",serialNo="'.$h.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",sglParticular="'.$hotelsglroom.'",sglhsnId="'.$sglHsnCode.'",dblParticular="'.$hoteldblroom.'",dblhsnId="'.$dblHsnCode.'",tplParticular="'.$hoteltplroom.'",tplhsnId="'.$tplHsnCode.'",twinParticular="'.$hoteltwinroom.'",twinhsnId="'.$twinHsnCode.'",EBAParticular="'.$hotelebedroom.'",EBAhsnId="'.$EBAHsnCode.'",EBCParticular="'.$hoteleBCroom.'",EBChsnId="'.$EBCHsnCode.'",EBNParticular="'.$hoteleNBroom.'",EBNhsnId="'.$ENBHsnCode.'",quadParticular="'.$hoteleQuadroom.'",quadhsnId="'.$quadHsnCode.'",sixParticular="'.$hoteleSixroom.'",sixhsnId="'.$sixHsnCode.'",eightParticular="'.$hoteleEightroom.'",eighthsnId="'.$eightHsnCode.'",tenParticular="'.$hoteleTenroom.'",tenhsnId="'.$tenHsnCode.'"';

				$rsh = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$h.'" and serviceType="hotel" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
				if(mysqli_num_rows($rsh)>0){
					$whereH = 'serialNo="'.$h.'" and serviceType="hotel" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
					updatelisting('invoiceOtherDetailMaster',$nameValueH,$whereH);
				}else{
					addlisting('invoiceOtherDetailMaster',$nameValueH);
				}

			}
		}

		// Add or Update transfer Services
		if($transferSerialNo>0){
			for($t=1; $t<$transferSerialNo; $t++){

				$transferNameA = $_POST['transferNameA'.$t];
				$transferHsnCodeA = $_POST['transferHsnCodeA'.$t];
				$transferNameC = $_POST['transferNameC'.$t];
				$transferHsnCodeC = $_POST['transferHsnCodeC'.$t];
				$transferNameI = $_POST['transferNameI'.$t];
				$transferHsnCodeE = $_POST['transferHsnCodeE'.$t];
				
				
				$nameValuet = 'serviceType="transfer",serialNo="'.$t.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$transferNameA.'",adulthsnId="'.$transferHsnCodeA.'",childParticular="'.$transferNameC.'",infantParticular="'.$transferNameI.'",childhsnId="'.$transferHsnCodeC.'",infanthsnId="'.$transferHsnCodeE.'"';

				$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$t.'" and serviceType="transfer" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
				if(mysqli_num_rows($rst)>0){
					$wheret = 'serialNo="'.$t.'" and serviceType="transfer" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
					updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
				}else{
					addlisting('invoiceOtherDetailMaster',$nameValuet);
				}

			}
		}


		// Add or Update transport Services
		if($transportSerialNo>0){
			for($tt=1; $tt<$transportSerialNo; $tt++){

				$transportName = $_POST['transportName'.$tt];
				$tranportHsnCode = $_POST['tranportHsnCode'.$tt];
				
				$nameValuet = 'serviceType="transportation",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$transportName.'",adulthsnId="'.$tranportHsnCode.'"';

				$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="transportation" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
				if(mysqli_num_rows($rst)>0){
					$wheret = 'serialNo="'.$tt.'" and serviceType="transportation" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
					updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
				}else{
					addlisting('invoiceOtherDetailMaster',$nameValuet);
				}

			}
		}

			// Add or Update entrance Services
			if($entranceSerialNo>0){
				for($tt=1; $tt<$entranceSerialNo; $tt++){
	
					$entranceNameA = $_POST['entranceNameA'.$tt];
					$entranceHsnCodeA = $_POST['entranceHsnCodeA'.$tt];
					$entranceNameC = $_POST['entranceNameC'.$tt];
					$entranceHsnCodeC = $_POST['entranceHsnCodeC'.$tt];
					$entranceNameI = $_POST['entranceNameI'.$tt];
					$entranceHsnCodeE = $_POST['entranceHsnCodeE'.$tt];
					
					$nameValuet = 'serviceType="entrance",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$entranceNameA.'",adulthsnId="'.$entranceHsnCodeA.'",childParticular="'.$entranceNameC.'",childhsnId="'.$entranceHsnCodeC.'",infantParticular="'.$entranceNameI.'",infanthsnId="'.$entranceHsnCodeE.'"';
	
					$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="entrance" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
					if(mysqli_num_rows($rst)>0){
						$wheret = 'serialNo="'.$tt.'" and serviceType="entrance" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
						updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
					}else{
						addlisting('invoiceOtherDetailMaster',$nameValuet);
					}
	
				}
			}


				// Add or Update activity Services
				if($activitySerialNo>0){
					for($tt=1; $tt<$activitySerialNo; $tt++){
		
						$activityNameA = $_POST['activityNameA'.$tt];
						$activityHsnCodeA = $_POST['activityHsnCodeA'.$tt];
						$activityNameC = $_POST['activityNameC'.$tt];
						$activityHsnCodeC = $_POST['activityHsnCodeC'.$tt];
						$activityNameI = $_POST['activityNameI'.$tt];
						$activityHsnCodeE = $_POST['activityHsnCodeE'.$tt];
						

						$nameValuet = 'serviceType="activity",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$activityNameA.'",adulthsnId="'.$activityHsnCodeA.'",childParticular="'.$activityNameC.'",childhsnId="'.$activityHsnCodeC.'",infantParticular="'.$activityNameI.'",infanthsnId="'.$activityHsnCodeE.'"';
		
						$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="activity" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
						if(mysqli_num_rows($rst)>0){
							$wheret = 'serialNo="'.$tt.'" and serviceType="activity" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
							updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
						}else{
							addlisting('invoiceOtherDetailMaster',$nameValuet);
						}
		
					}
				}


					// Add or Update Ferry Services
					if($ferrySerialNo>0){
						for($tt=1; $tt<$ferrySerialNo; $tt++){
			
							$ferryNameA = $_POST['ferryNameA'.$tt];
							$ferryHsnCodeA = $_POST['ferryHsnCodeA'.$tt];
							$ferryNameC = $_POST['ferryNameC'.$tt];
							$ferryHsnCodeC = $_POST['ferryHsnCodeC'.$tt];
							$ferryNameI = $_POST['ferryNameI'.$tt];
							$ferryHsnCodeE = $_POST['ferryHsnCodeE'.$tt];
							
							$nameValuet = 'serviceType="ferry",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$ferryNameA.'",adulthsnId="'.$ferryHsnCodeA.'",childParticular="'.$ferryNameC.'",childhsnId="'.$ferryHsnCodeC.'",infantParticular="'.$ferryNameI.'",infanthsnId="'.$ferryHsnCodeE.'"';
			
							$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="ferry" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
							if(mysqli_num_rows($rst)>0){
								$wheret = 'serialNo="'.$tt.'" and serviceType="ferry" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
								updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
							}else{
								addlisting('invoiceOtherDetailMaster',$nameValuet);
							}
			
						}
					}

				// Add or Update restaurant Services
				if($mealSerialNo>0){
					for($tt=1; $tt<$mealSerialNo; $tt++){
		
						$mealPlanNameA = $_POST['mealPlanNameA'.$tt];
						$mealHsnCode = $_POST['mealHsnCode'.$tt];
						$mealPlanNameC = $_POST['mealPlanNameC'.$tt];
						$mealHsnCodeC = $_POST['mealHsnCodeC'.$tt];
						$mealPlanNameI = $_POST['mealPlanNameI'.$tt];
						$mealHsnCodeE = $_POST['mealHsnCodeE'.$tt];
						
						$nameValuet = 'serviceType="restaurant",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$mealPlanNameA.'",adulthsnId="'.$mealHsnCode.'",childParticular="'.$mealPlanNameC.'",childhsnId="'.$mealHsnCodeC.'",infantParticular="'.$mealPlanNameI.'",infanthsnId="'.$mealHsnCodeE.'"';
		
						$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="restaurant" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
						if(mysqli_num_rows($rst)>0){
							$wheret = 'serialNo="'.$tt.'" and serviceType="restaurant" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
							updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
						}else{
							addlisting('invoiceOtherDetailMaster',$nameValuet);
						}
		
					}
				}


				// Add or Update additional Services
				if($extSerialNo>0){
					for($tt=1; $tt<$extSerialNo; $tt++){
		
						$additionalNameA = $_POST['additionalNameA'.$tt];
						$extHsnCodeA = $_POST['extHsnCodeA'.$tt];
						$additionalNameC = $_POST['additionalNameC'.$tt];
						$extHsnCodeC = $_POST['extHsnCodeC'.$tt];
						$additionalNameI = $_POST['additionalNameI'.$tt];
						$extHsnCodeE = $_POST['extHsnCodeE'.$tt];
						
						$nameValuet = 'serviceType="additional",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$additionalNameA.'",adulthsnId="'.$extHsnCodeA.'",childParticular="'.$additionalNameC.'",childhsnId="'.$extHsnCodeC.'",infantParticular="'.$additionalNameI.'",infanthsnId="'.$extHsnCodeE.'"';
		
						$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="additional" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
						if(mysqli_num_rows($rst)>0){
							$wheret = 'serialNo="'.$tt.'" and serviceType="additional" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
							updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
						}else{
							addlisting('invoiceOtherDetailMaster',$nameValuet);
						}
		
					}
				}
				

				// Add or Update Flight Services
				if($flightSerialNo>0){
					for($tt=1; $tt<$flightSerialNo; $tt++){
		
						$flightNameA = $_POST['flightNameA'.$tt];
						$flightHsnCodeA = $_POST['flightHsnCodeA'.$tt];
						$flightNameC = $_POST['flightNameC'.$tt];
						$flightHsnCodeC = $_POST['flightHsnCodeC'.$tt];
						$flightNameI = $_POST['flightNameI'.$tt];
						$flightHsnCodeE = $_POST['flightHsnCodeE'.$tt];
						
						$nameValuet = 'serviceType="flight",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$flightNameA.'",adulthsnId="'.$flightHsnCodeA.'",childParticular="'.$flightNameC.'",childhsnId="'.$flightHsnCodeC.'",infantParticular="'.$flightNameI.'",infanthsnId="'.$flightHsnCodeE.'"';
		
						$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="flight" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
						if(mysqli_num_rows($rst)>0){
							$wheret = 'serialNo="'.$tt.'" and serviceType="flight" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
							updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
						}else{
							addlisting('invoiceOtherDetailMaster',$nameValuet);
						}
		
					}
				}

				// Add or Update Train Services
				if($trainSerialNo>0){
					for($tt=1; $tt<$trainSerialNo; $tt++){
		
						$traninNameA = $_POST['traninNameA'.$tt];
						$trainHsnCodeA = $_POST['trainHsnCodeA'.$tt];
						$traninNameC = $_POST['traninNameC'.$tt];
						$trainHsnCodeC = $_POST['trainHsnCodeC'.$tt];
						$traninNameI = $_POST['traninNameI'.$tt];
						$trainHsnCodeE = $_POST['trainHsnCodeE'.$tt];
						
						$nameValuet = 'serviceType="train",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$traninNameA.'",adulthsnId="'.$trainHsnCodeA.'",childParticular="'.$traninNameC.'",childhsnId="'.$trainHsnCodeC.'",infantParticular="'.$traninNameI.'",infanthsnId="'.$trainHsnCodeE.'"';
		
						$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="train" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
						if(mysqli_num_rows($rst)>0){
							$wheret = 'serialNo="'.$tt.'" and serviceType="train" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
							updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
						}else{
							addlisting('invoiceOtherDetailMaster',$nameValuet);
						}
		
					}
				}

				// Add or Update Guide Services
				if($guideSerialNo>0){
					for($tt=1; $tt<$guideSerialNo; $tt++){
		
						$guideName = $_POST['guideName'.$tt];
						$guideHsnCode = $_POST['guideHsnCode'.$tt];
						
						$nameValuet = 'serviceType="guide",serialNo="'.$tt.'",invoiceId="'.$editId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",adultParticular="'.$guideName.'",adulthsnId="'.$guideHsnCode.'"';
		
						$rst = GetPageRecord('*','invoiceOtherDetailMaster','serialNo="'.$tt.'" and serviceType="guide" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"');
						if(mysqli_num_rows($rst)>0){
							$wheret = 'serialNo="'.$tt.'" and serviceType="guide" and invoiceId="'.$editId.'" and quotationId="'.$quotationId.'" and queryId="'.$queryId.'"';
							updatelisting('invoiceOtherDetailMaster',$nameValuet,$wheret);
						}else{
							addlisting('invoiceOtherDetailMaster',$nameValuet);
						}
		
					}
				}

	}


	?>
	<script>
	parent.setupbox('showpage.crm?module=invoice&invoiceType=<?php echo $invoiceType ;?>&alt=1');
	</script>
	<?php
}



if(trim($_POST['action'])=='addcrmmasters' && trim($_POST['company'])!='' && trim($_POST['email'])!='' && trim($_POST['noofusers'])!='' && trim($_POST['serverspace'])!='' && trim($_POST['expirydate'])!='' && $_POST['editid']==''){
	$result =mysqli_query(db(),"select * from "._USER_MASTER_." where email='".trim($_POST['email'])."'")  or die(mysqli_error(db()));
	$number =mysqli_num_rows($result);
	if($number>0){ ?>
		<script>
		parent.alertbox('System Alert!','The email address you have entered is already registered. Please enter an other email address');
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		</script>
		<?php
		exit();
	}
	
	$savenew=clean($_POST['savenew']);
	$usercode=clean($_POST['usercode']);
	$company=clean($_POST['company']);
	$email=clean($_POST['email']);
	$password=clean($_POST['password']);
	$email=clean($_POST['email']);
	$phone=clean($_POST['phone']);
	$mobile=clean($_POST['mobile']);
	$street=clean($_POST['street']);
	$city=clean($_POST['city']);
	$state=clean($_POST['state']);
	$zip=clean($_POST['zip']);
	$country=clean($_POST['country']);
	$noofusers=clean($_POST['noofusers']);
	$serverspace=clean($_POST['serverspace']);
	$expirydate=clean($_POST['expirydate']);
	$timeformat=clean($_POST['timeformat']);
	$currency=clean($_POST['currency']);
	$timezone=clean($_POST['timezone']);
	$dateAdded=time();
	$expirydate=date("Y-m-d", strtotime($expirydate));
	$namevalue ='company="'.$company.'",email="'.$email.'",password="'.md5($password).'",phone="'.$phone.'",usercode="'.$usercode.'",mobile="'.$mobile.'",street="'.$street.'",city="'.$city.'",state="'.$state.'",zip="'.$zip.'",country="'.$country.'",noofusers="'.$noofusers.'",serverspace="'.$serverspace.'",expirydate="'.$expirydate.'",timeformat="'.$timeformat.'",currency="'.$currency.'",timezone="'.$timezone.'",addedBy="'.$_SESSION['userid'].'",parentId="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",firstName="'.$company.'",roleId="1",profileId="1",status=1,admin=1';
	$add = addlisting(_USER_MASTER_,$namevalue);
	if($add=='yes'){
		$select='superParentId,id';
		$where='email="'.$email.'"';
		$rs=GetPageRecord($select,_USER_MASTER_,$where);
		$userdetails=mysqli_fetch_array($rs);
		$accountId=20172017+$userdetails['id'];
		$namevalue ='superParentId="'.$userdetails['id'].'",accountId='.$accountId.'';
		$where='email="'.$email.'"';
		$update = updatelisting(_USER_MASTER_,$namevalue,$where);
		$select='*';
		$where='id!="" order by id asc';
		$rs=GetPageRecord($select,_MODULE_MASTER_,$where);
		while($modulelists=mysqli_fetch_array($rs)){
			if($modulelists['id']==31){
				$status=0;
			} else {
				$status=1;
			}
			$namevalue ='moduleName="'.$modulelists['moduleName'].'",parentId="'.$modulelists['id'].'",userId="'.$userdetails['id'].'",url="'.$modulelists['url'].'",status="'.$status.'",mainmenu="'.$modulelists['mainmenu'].'"';
			addlisting(_USER_MODULE_MASTER_,$namevalue);
		}
		///-----------------Adding In Logs---------------------
		generateLogs('crmmasters','add',$userdetails['id']);
		///-----------------Adding In Logs End---------------------
		if($savenew==1){
			?>
			<script>
			parent.window.location.href='setupsetting.crm?module=crmmasters&add=yes&alt=1';
			</script>
			<?php exit(); } else { ?>
			<script>
			parent.window.location.href='setupsetting.crm?module=crmmasters&view=yes&id=<?php echo encode($userdetails['id']); ?>&alt=1';
			</script>
			<?php
			exit();
		}
	}
}

if(trim($_POST['action'])=='addcrmmasters' && trim($_POST['company'])!='' && trim($_POST['email'])!='' && trim($_POST['noofusers'])!='' && trim($_POST['serverspace'])!='' && trim($_POST['expirydate'])!='' && $_POST['editid']!=''){
	$oldpassword=clean($_POST['oldpassword']);
	$savenew=clean($_POST['savenew']);
	$usercode=clean($_POST['usercode']);
	$company=clean($_POST['company']);
	$email=clean($_POST['email']);
	$password=clean($_POST['password']);
	$email=clean($_POST['email']);
	$phone=clean($_POST['phone']);
	$mobile=clean($_POST['mobile']);
	$street=clean($_POST['street']);
	$city=clean($_POST['city']);
	$state=clean($_POST['state']);
	$zip=clean($_POST['zip']);
	$country=clean($_POST['country']);
	$noofusers=clean($_POST['noofusers']);
	$serverspace=clean($_POST['serverspace']);
	$expirydate=clean($_POST['expirydate']);
	$timeformat=clean($_POST['timeformat']);
	$currency=clean($_POST['currency']);
	$timezone=clean($_POST['timezone']);
	$dateAdded=time();
	$expirydate=date("Y-m-d", strtotime($expirydate));
	if($oldpassword==$password){
		$password=$oldpassword;
	} else {
		$password=md5($password);
	}
	$namevalue ='company="'.$company.'",password="'.$password.'",phone="'.$phone.'",usercode="'.$usercode.'",mobile="'.$mobile.'",street="'.$street.'",city="'.$city.'",state="'.$state.'",zip="'.$zip.'",country="'.$country.'",noofusers="'.$noofusers.'",serverspace="'.$serverspace.'",expirydate="'.$expirydate.'",timeformat="'.$timeformat.'",currency="'.$currency.'",timezone="'.$timezone.'",modifyBy="'.$_SESSION['userid'].'",parentId="'.$_SESSION['userid'].'",modifyDate="'.$dateAdded.'",firstName="'.$company.'",roleId="1",profileId="1",status=1,admin=1';
	$where='id="'.decode($_POST['editid']).'"';
	$update = updatelisting(_USER_MASTER_,$namevalue,$where);
	if($update=='yes'){
		///-----------------Adding In Logs---------------------
		generateLogs('crmmasters','update',decode($_POST['editid']));
		///-----------------Adding In Logs End---------------------
		if($savenew==1){
			?>
			<script>
			//parent.window.location.href='setupsetting.crm?module=crmmasters&add=yes&alt=2';
			</script>
			<?php 
			exit(); 
		} else { 
			?>
			<script>
			parent.window.location.href='setupsetting.crm?module=crmmasters&view=yes&id=<?php echo $_POST['editid']; ?>&alt=2';
			</script>
			<?php
			exit();
		}
	}
}

if(trim($_REQUEST['activeinactiveuser'])!=''){
	$check_list=$_REQUEST['check_list'];
	if($check_list!=""){
 		for($i=0;$i<=count($check_list)-1;$i++)
		{
			$ansval=trim(decode($check_list[$i]));
			if(trim($ansval) != ''){
				if($_REQUEST['activeinactiveuser']==0){
					$status=1;
					generateLogs('crmmasters','activate',$ansval);
				}
				if($_REQUEST['activeinactiveuser']==1){
					$status=0;
					generateLogs('crmmasters','deactivate',$ansval);
				}
				//$namevalue ='status="'.$status.'" and superParentId='.$loginusersuperParentId.'';
				$namevalue ='status="'.$status.'"';
				$where='id="'.$ansval.'"';
				$update = updatelisting(_USER_MASTER_,$namevalue,$where);
			} 
		} 
	}
	?>
	<script>
	parent.setupbox('setupsetting.crm?activeinactiveuser=<?php echo $_POST['activeinactiveuser']; ?>&module=crmmasters&alt=<?php echo $status; ?>');
	</script>
	<?php
}
if(trim($_REQUEST['action'])=='changepermission' && trim($_REQUEST['userId'])!='' && trim($_REQUEST['moduleId'])!='' && trim($_REQUEST['btnid'])!=''){
	$userId=decode($_REQUEST['userId']);
	$moduleId=decode($_REQUEST['moduleId']);
	$btnid=$_REQUEST['btnid'];
	$select='status';
	$where='userId='.$userId.' and id='.$moduleId.'';
	$rs=GetPageRecord($select,_USER_MODULE_MASTER_,$where);
	$modedetails=mysqli_fetch_array($rs);
	if($modedetails['status']==1){
	$status=0; ?>
	<script>
	$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteroff");
	</script>
	<?php
	} else {
	$status=1; ?>
	<script>
	$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteron");
	</script>
	<?php
	}
	$namevalue ='status='.$status.'';
	$where='userId="'.$userId.'" and id="'.$moduleId.'"';
	$update = updatelisting(_USER_MODULE_MASTER_,$namevalue,$where);
}

if(trim($_POST['action'])=='addcrmusers' && trim($_POST['firstName'])!='' && trim($_POST['email'])!='' && trim($_POST['roleId'])!='' && $_POST['editid']==''){
	$result =mysqli_query(db(),"select * from "._USER_MASTER_." where email='".trim($_POST['email'])."'")  or die(mysqli_error(db()));
	$number =mysqli_num_rows($result);
	if($number>0)
	{
	?>
	<script>
	parent.alertbox('System Alert!','The email address you have entered is already registered. Please enter an other email address');
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
	exit();
	}
	$savenew=clean($_POST['savenew']);
	$firstName=clean($_POST['firstName']);
	$officeId=clean($_POST['officeId']);
	$usercode=clean($_POST['usercode']);
	$reportingManager=clean($_POST['reportingManager']);
	$lastName=clean($_POST['lastName']);
	$email=clean($_POST['email']);
	$password=clean($_POST['password']);
	$email=clean($_POST['email']);
	$phone=clean($_POST['phone']);
	$mobile=clean($_POST['mobile']);
	$street=clean($_POST['street']);
	$city=clean($_POST['city']);
	$state=clean($_POST['state']);
	$zip=clean($_POST['zip']);
	$roleId=clean($_POST['roleId']);
	$profileId=clean($_POST['profileId']);
	$country=clean($_POST['country']);
	$userType=clean($_POST['userType']);
	$timeformat=clean($_POST['timeformat']);
	$userLoginType=clean($_POST['userLoginType']);
	$companyId=clean($_POST['companyId']);
	$pin=clean($_POST['pin']);
	$departmentId=clean($_POST['departmentId']);
	$admin='0';
	$superParentId=$loginusersuperParentId;
	$dateAdded=time();
	$expirydate=date("Y-m-d", strtotime($expirydate));
	$destinationList.='';
	$check_list=$_REQUEST['destinationList'];
	if($check_list!=""){
		for($i=0;$i<=count($check_list)-1;$i++){
			$ansval=trim(($check_list[$i]));
			if(trim($ansval) != ''){
				$destinationList=$destinationList.$ansval.',';
			}
		}
	}
	$languagelist = implode(',',$_POST['languageKnown']);
	$namevalue ='firstName="'.$firstName.'",lastName="'.$lastName.'",officeId="'.$officeId.'",email="'.$email.'",password="'.md5($password).'",phone="'.$phone.'",usercode="'.$usercode.'",mobile="'.$mobile.'",street="'.$street.'",city="'.$city.'",state="'.$state.'",zip="'.$zip.'",country="'.$country.'",timeformat="'.$timeformat.'",addedBy="'.$_SESSION['userid'].'",parentId="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",roleId="'.$roleId.'",profileId="'.$profileId.'",departmentId="'.$departmentId.'",superParentId="'.$superParentId.'",userType="'.$userType.'",destinationList="'.$destinationList.'",companyId="'.$companyId.'",reportingManager="'.$reportingManager.'",userLoginType="'.$userLoginType.'",languagelist="'.$languagelist.'",status=1,pin="'.$pin.'"';
	$add = addlisting(_USER_MASTER_,$namevalue);
	if($add=='yes'){
		$select='superParentId,id';
		$where='email="'.$email.'"';
		$rs=GetPageRecord($select,_USER_MASTER_,$where);
		$userdetails=mysqli_fetch_array($rs);
		$accountId=20172017+$userdetails['id'];
		$namevalue ='accountId='.$accountId.'';
		$where='email="'.$email.'"';
		$update = updatelisting(_USER_MASTER_,$namevalue,$where);
		generateLogs('users','add',$userdetails['id']);
		if($savenew==1){
		?>
		<script>
		parent.window.location.href='setupsetting.crm?module=users&add=yes&alt=1';
		</script>
		<?php exit(); } else { ?>
		<script>
		parent.window.location.href='setupsetting.crm?module=users&view=yes&id=<?php echo encode($userdetails['id']); ?>&alt=1';
		</script>
		<?php
		exit();
		}
	}
}

if(trim($_REQUEST['useractiveinactiveuser'])!='' && trim($_REQUEST['action'])=='disableuser'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
if($_REQUEST['useractiveinactiveuser']==0){
$status=1;
generateLogs('users','activate',$ansval);
}
if($_REQUEST['useractiveinactiveuser']==1){
$status=0;
generateLogs('users','deactivate',$ansval);
}
//$namevalue ='status="'.$status.'" and superParentId='.$loginusersuperParentId.'';
$namevalue ='status="'.$status.'"';
$where='id="'.$ansval.'" and superParentId='.$loginusersuperParentId.'';
$update = updatelisting(_USER_MASTER_,$namevalue,$where);
} } }
?>
<script>
parent.setupbox('setupsetting.crm?useractiveinactiveuser=<?php echo $_POST['useractiveinactiveuser']; ?>&module=users&alt=<?php echo $status; ?>');
</script>
<?php
}
if(trim($_POST['action'])=='addcrmusers' && trim($_POST['firstName'])!='' && trim($_POST['email'])!='' && trim($_POST['roleId'])!='' && $_POST['editid']!='' && $_POST['idautoil']!=''){
	
	if($_REQUEST['idautoil']!=$_POST['email']){
		$result =mysqli_query(db(),"select * from "._USER_MASTER_." where email='".clean($_POST['email'])."'")  or die(mysqli_error(db()));
		$number =mysqli_num_rows($result);
		if($number>0)
		{ 
		?>
		<script>
		parent.alertbox('System Alert!','The email address you have entered is already registered. Please enter an other email address');
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		</script>
		<?php
		exit();
		}
	}
	$oldpassword=clean($_POST['oldpassword']);
	$savenew=clean($_POST['savenew']);
	$usercode=clean($_POST['usercode']);
	$officeId=clean($_POST['officeId']);
	$reportingManager=clean($_POST['reportingManager']);
	$firstName=clean($_POST['firstName']);
	$lastName=clean($_POST['lastName']);
	$email=clean($_POST['email']);
	$password=clean($_POST['password']);
	$email=clean($_POST['email']);
	$phone=clean($_POST['phone']);
	$mobile=clean($_POST['mobile']);
	$street=clean($_POST['street']);
	$city=clean($_POST['city']);
	$state=clean($_POST['state']);
	$zip=clean($_POST['zip']);
	$roleId=clean($_POST['roleId']);
	$profileId=clean($_POST['profileId']);
	$country=clean($_POST['country']);
	$timeformat=clean($_POST['timeformat']);
	$userType=clean($_POST['userType']);
	$companyId=clean($_POST['companyId']);
	$userLoginType=clean($_POST['userLoginType']);
	$pin=clean($_POST['pin']);
	$departmentId=clean($_POST['departmentId']);
	$admin='0';
	$superParentId=$loginusersuperParentId;
	$dateAdded=time();
	$expirydate=date("Y-m-d", strtotime($expirydate));
	if($oldpassword==$password){
		$password=$oldpassword;
	} else {
		$password=md5($password);
	}
	$destinationList.='';
	$check_list=$_REQUEST['destinationList'];
	if($check_list!=""){
		for($i=0;$i<=count($check_list)-1;$i++){
			$ansval=trim(($check_list[$i]));
			if(trim($ansval) != ''){
				$destinationList=$destinationList.$ansval.',';
			}
		}
	}
	$languagelist = implode(',',$_POST['languageKnown']);
	$namevalue ='firstName="'.$firstName.'",lastName="'.$lastName.'",officeId="'.$officeId.'",email="'.$email.'",password="'.$password.'",phone="'.$phone.'",mobile="'.$mobile.'",street="'.$street.'",city="'.$city.'",state="'.$state.'",zip="'.$zip.'",country="'.$country.'",usercode="'.$usercode.'",timeformat="'.$timeformat.'",modifyBy="'.$_SESSION['userid'].'",modifyDate="'.$dateAdded.'",roleId="'.$roleId.'",profileId="'.$profileId.'",userType="'.$userType.'",destinationList="'.$destinationList.'",companyId="'.$companyId.'",userLoginType="'.$userLoginType.'",reportingManager="'.$reportingManager.'",languagelist="'.$languagelist.'",departmentId="'.$departmentId.'",pin="'.$pin.'"';
	$where='id="'.decode($_POST['editid']).'" and superParentId='.$loginusersuperParentId.'';
	$update = updatelisting(_USER_MASTER_,$namevalue,$where);
	if($update=='yes'){
		generateLogs('users','update',decode($_POST['editid']));
		if($savenew==1){
			?>
			<script>
			parent.window.location.href='setupsetting.crm?module=users&add=yes&alt=2';
			</script>
			<?php exit(); } else { ?>
			<script>
			parent.window.location.href='setupsetting.crm?module=users&view=yes&id=<?php echo $_POST['editid']; ?>&alt=2';
			</script>
			<?php
			exit();
		}
	}
}
if(trim($_POST['action'])=='addprofile' && trim($_POST['profileName'])!='' && trim($_POST['profileclone'])!='' && trim($_POST['editid'])==''){
	$profileName=clean($_POST['profileName']);
	$profileclone=clean(decode($_POST['profileclone']));
	$profileDetails=clean($_POST['profileDetails']); 
	$adminDashboard=clean($_POST['adminDashboard']);
	$salesDashboard=clean($_POST['salesDashboard']);
	$operationsDashboard=clean($_POST['operationsDashboard']);
	$accountDashboard=clean($_POST['accountDashboard']);
	$agentOption=clean($_POST['agentOption']);
	$superParentId=$loginusersuperParentId;
	$dateAdded=time();
	$s=1;
	$namevalue ='profileName="'.$profileName.'",profileDetails="'.$profileDetails.'",addedBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",dateAdded="'.$dateAdded.'",adminDashboard="'.$adminDashboard.'",salesDashboard="'.$salesDashboard.'",operationsDashboard="'.$operationsDashboard.'",accountDashboard="'.$accountDashboard.'",agentOption="'.$agentOption.'"';
	$add = addlisting(_PROFILE_MASTER_,$namevalue);
	if($add=='yes'){
		$select='id';
		$where='userId="'.$loginusersuperParentId.'" and addedBy='.$_SESSION['userid'].' order by id desc';
		$rs=GetPageRecord($select,_PROFILE_MASTER_,$where);
		$userdetails=mysqli_fetch_array($rs);
		$select='*';
		$where='profileId = "'.$profileclone.'" order by id asc';
		$rs=GetPageRecord($select,_PERMISSION_MASTER_,$where);
		while($permissoinlists=mysqli_fetch_array($rs)){
			$namevalue ='profileId='.$userdetails['id'].',moduleId='.$permissoinlists['moduleId'].',view='.$permissoinlists['view'].',edit='.$permissoinlists['edit'].',import='.$permissoinlists['import'].',export='.$permissoinlists['export'].',dlt='.$permissoinlists['dlt'].',addentry='.$permissoinlists['addentry'].'';
			addlisting(_PERMISSION_MASTER_,$namevalue);
		}
		generateLogs('profile','add',$userdetails['id']);
		?>
		<script>
		parent.window.location.href='setupsetting.crm?module=profile&edit=yes&id=<?php echo encode($userdetails['id']); ?>&alt=1';
		</script>
		<?php
		exit();
	}
}
if(trim($_POST['action'])=='editprofile' && trim($_POST['profileName'])!='' && trim($_POST['editid'])!=''){
$profileName=clean($_POST['profileName']);
$editid=decode(clean($_POST['editid']));
$profileclone=clean(decode($_POST['profileclone']));
$profileDetails=clean($_POST['profileDetails']); 
$adminDashboard=clean($_POST['adminDashboard']);
$salesDashboard=clean($_POST['salesDashboard']);
$operationsDashboard=clean($_POST['operationsDashboard']);
$accountDashboard=clean($_POST['accountDashboard']);
$agentOption=clean($_POST['agentOption']);
$superParentId=$loginusersuperParentId;
$dateAdded=time();
$where='id="'.decode($_POST['editid']).'" and userId='.$loginusersuperParentId.'';
$namevalue ='profileName="'.$profileName.'",profileDetails="'.$profileDetails.'",modifyBy="'.$_SESSION['userid'].'",modifyDate="'.$dateAdded.'",adminDashboard="'.$adminDashboard.'",salesDashboard="'.$salesDashboard.'",operationsDashboard="'.$operationsDashboard.'",accountDashboard="'.$accountDashboard.'",agentOption="'.$agentOption.'"';
$update = updatelisting(_PROFILE_MASTER_,$namevalue,$where);
if($update=='yes'){
}
 generateLogs('profile','update',$editid);
  ?>
<script>
parent.window.location.href='setupsetting.crm?module=profile&edit=yes&id=<?php echo clean($_POST['editid']); ?>&alt=2';
</script>
<?php
 exit();
}
if(trim($_REQUEST['editid'])!='' && trim($_REQUEST['moduleId'])!='' && trim($_REQUEST['btnid'])!='' && trim($_REQUEST['action'])=='profilepermission' && trim($_REQUEST['pagepermission'])!=''){
$editid=decode($_REQUEST['editid']);
$moduleId=decode($_REQUEST['moduleId']);
$btnid=$_REQUEST['btnid'];
$pagepermission=$_REQUEST['pagepermission'];
$select=$pagepermission;
$where='profileId='.$editid.' and moduleId='.$moduleId.'';
$rs=GetPageRecord($select,_PERMISSION_MASTER_,$where);
$modedetails=mysqli_fetch_array($rs);
if($pagepermission=='view'){
if($modedetails['view']==1){
$namevalue ='view=0';
  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteroff");
</script>
<?php
} else {
$namevalue ='view=1';  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteron");
</script>
<?php
}
}
if($pagepermission=='addentry'){
if($modedetails['addentry']==1){
$namevalue ='addentry=0';
  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteroff");
</script>
<?php
} else {
$namevalue ='addentry=1';  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteron");
</script>
<?php
}
}
if($pagepermission=='edit'){
if($modedetails['edit']==1){
$namevalue ='edit=0';
  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteroff");
</script>
<?php
} else {
$namevalue ='edit=1';  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteron");
</script>
<?php
}}
if($pagepermission=='dlt'){
if($modedetails['dlt']==1){
$namevalue ='dlt=0';
 ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteroff");
</script>
<?php
} else {
$namevalue ='dlt=1';  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteron");
</script>
<?php
}
}
if($pagepermission=='import'){
if($modedetails['import']==1){
$namevalue ='import=0';
 ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteroff");
</script>
<?php
} else {
$namevalue ='import=1';  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteron");
</script>
<?php
} }
if($pagepermission=='export'){
if($modedetails['export']==1){
$namevalue ='export=0';
 ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteroff");
</script>
<?php
} else {
$namevalue ='export=1';  ?>
<script>
$("#<?php echo $btnid; ?>").attr("class", "switchouter switchouteron");
</script>
<?php
}
}
$where='profileId='.$editid.' and moduleId='.$moduleId.'';
$update = updatelisting(_PERMISSION_MASTER_,$namevalue,$where);
}
if(trim($_REQUEST['action'])=='deleteprofile' && trim($_REQUEST['did'])!=''){
$sql_del="update "._PROFILE_MASTER_." set deletestatus=1  where id='".decode($_GET['did'])."' and  userId=".$loginusersuperParentId." ";
mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
generateLogs('profile','delete',decode($_GET['did']));
//$sql_del="delete from "._PERMISSION_MASTER_."  where profileId='".decode($_GET['did'])."'";
//mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
?>
<script>
setupbox('setupsetting.crm?module=profile&alt=3');
</script>
<?php }
if(trim($_REQUEST['action'])=='deleterole' && trim($_REQUEST['did'])!=''){
$sql_del="update "._ROLE_MASTER_." set deletestatus=1 where id='".decode($_GET['did'])."' and  userId=".$loginusersuperParentId."";
mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
generateLogs('role','delete',decode($_GET['did']));
?>
<script>
setupbox('setupsetting.crm?module=role&alt=3');
</script>
<?php }
if(trim($_POST['action'])=='addrole' && trim($_POST['roleId'])!='' && trim($_POST['editid'])=='' && trim($_POST['name'])!=''){
$name=clean($_POST['name']);
$roleId=clean($_POST['roleId']);
$roleDetails=clean($_POST['roleDetails']);
$superParentId=$loginusersuperParentId;
$dateAdded=time();
$namevalue ='name="'.$name.'",roleDetails="'.$roleDetails.'",userId="'.$superParentId.'",parentId="'.$roleId.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
$add = addlisting(_ROLE_MASTER_,$namevalue);
$select='id';
$where='userId="'.$loginusersuperParentId.'" order by id desc';
$rs=GetPageRecord($select,_ROLE_MASTER_,$where);
$rolelsatid=mysqli_fetch_array($rs);
generateLogs('role','add',$rolelsatid['id']);
  ?>
<script>
parent.window.location.href='setupsetting.crm?module=role&alt=1';
</script>
<?php
 exit();
}
if(trim($_POST['action'])=='editrole' && trim($_POST['roleId'])!='' && trim($_POST['editid'])!='' && trim($_POST['name'])!=''){
$editid=decode($_REQUEST['editid']);
$name=clean($_POST['name']);
$roleId=clean($_POST['roleId']);
$roleDetails=clean($_POST['roleDetails']);
$superParentId=$loginusersuperParentId;
$dateAdded=time();
$where='id="'.decode($_POST['editid']).'" and userId='.$loginusersuperParentId.' and id!=1';
$namevalue ='name="'.$name.'",roleDetails="'.$roleDetails.'",parentId="'.$roleId.'",modifyBy="'.$_SESSION['userid'].'",modifyDate="'.$dateAdded.'"';
$update = updatelisting(_ROLE_MASTER_,$namevalue,$where);
generateLogs('role','update',$editid);
  ?>
<script>
parent.window.location.href='setupsetting.crm?module=role&alt=2';
</script>
<?php
 exit();
}
if(trim($_POST['action'])=='savepersonalsetting' && trim($_POST['firstName'])!=''){
$company=clean($_POST['company']);
$firstName=clean($_POST['firstName']);
$lastName=clean($_POST['lastName']);
$phone=clean($_POST['phone']);
$mobile=clean($_POST['mobile']);
$street=clean($_POST['street']);
$city=clean($_POST['city']);
$state=clean($_POST['state']);
$zip=clean($_POST['zip']);
$country=clean($_POST['country']);
$timeformat=clean($_POST['timeformat']);
$currency=clean($_POST['currency']);
$timezone=clean($_POST['timezone']);
$emailsignature=addslashes($_POST['emailsignature']);
$sessionTime=clean($_POST['sessionTime']);
$dateAdded=time();
$namevalue ='company="'.$company.'",phone="'.$phone.'",mobile="'.$mobile.'",street="'.$street.'",city="'.$city.'",state="'.$state.'",zip="'.$zip.'",country="'.$country.'",timeformat="'.$timeformat.'",currency="'.$currency.'",timezone="'.$timezone.'",modifyBy="'.$_SESSION['userid'].'",modifyDate="'.$dateAdded.'",firstName="'.$firstName.'",lastName="'.$lastName.'",emailsignature="'.$emailsignature.'",sessionTime="'.$sessionTime.'"';
$where='id="'.$_SESSION['userid'].'"';
$update = updatelisting(_USER_MASTER_,$namevalue,$where);
generateLogs('personalsetting','update',$_SESSION['userid']);
if($update=='yes'){
?>
<script>
parent.window.location.href='setupsetting.crm?module=personalsettings&alt=2';
</script>
<?php
 exit();
}
}
if(trim($_POST['action'])=='emailsetting' && trim($_POST['from_name'])!='' && trim($_POST['email'])!='' && trim($_POST['password'])!='' && trim($_POST['smtp_server'])!='' && trim($_POST['port'])!='' && trim($_POST['security_type'])!=''){
	
	$select='*';
	$where='id="'.$_POST['editId'].'"';
	$rs=GetPageRecord($select,_EMAIL_SETTING_MASTER_,$where);
	$emailsetting=mysqli_fetch_array($rs);
	$from_name=clean($_POST['from_name']);
	$email=clean($_POST['email']);
	$password=($_POST['password']);
	$oldps=($_POST['oldps']);
	$smtp_server=clean($_POST['smtp_server']);
	$port=clean($_POST['port']);
	$security_type=clean($_POST['security_type']);


	$imap_server=clean($_REQUEST['imap_server']);
	$imap_port=clean($_REQUEST['imap_port']);
	$imap_security_type=clean($_REQUEST['imap_security_type']);
	$imap_filter=clean($_REQUEST['imap_filter']);


	$isDefault=clean($_POST['isDefault']);
	$dateAdded=time();
	if($_REQUEST['editId']!=''){

		if($oldps==$password){
			$password=$oldps;
		} else {
			$password=encode($password);
		}

		$namevalue ='from_name="'.$from_name.'",email="'.$email.'",password="'.$password.'",smtp_server="'.$smtp_server.'",port="'.$port.'",security_type="'.$security_type.'",imap_server="'.$imap_server.'",imap_port="'.$imap_port.'",imap_security_type="'.$imap_security_type.'",imap_filter="'.$imap_filter.'",isDefault="'.$isDefault.'",modifyDate="'.$dateAdded.'"';
		$where='id="'.$_REQUEST['editId'].'"';
		$update = updatelisting(_EMAIL_SETTING_MASTER_,$namevalue,$where);
		$alt=2;
		generateLogs('emailsettings','update',$_SESSION['userid']);
	} else {
		$namevalue ='from_name="'.$from_name.'",email="'.$email.'",password="'.encode($password).'",smtp_server="'.$smtp_server.'",port="'.$port.'",security_type="'.$security_type.'",imap_server="'.$imap_server.'",imap_port="'.$imap_port.'",imap_security_type="'.$imap_security_type.'",imap_filter="'.$imap_filter.'",isDefault="'.$isDefault.'",dateAdded="'.$dateAdded.'",userId="'.$loginuserID.'"';
		addlisting(_EMAIL_SETTING_MASTER_,$namevalue);
		$alt=1;
		generateLogs('emailsettings','add',$_SESSION['userid']);
	}
	?>
	<script>
	parent.window.location.href='setupsetting.crm?module=emailsettings&alt=<?php echo $alt; ?>';
	</script>
	<?php
	exit();
}
if(trim($_POST['action'])=='smssetting' && trim($_POST['url'])!='' && trim($_POST['user_name'])!='' && trim($_POST['password'])!='' && trim($_POST['senderid'])!=''){
$select='*';
$where='userId="'.$loginusersuperParentId.'"';
$rs=GetPageRecord($select,_SMS_MASTER_,$where);
$emailsetting=mysqli_fetch_array($rs);
$url=clean($_POST['url']);
$user_name=clean($_POST['user_name']);
$password=clean($_POST['password']);
$senderid=clean($_POST['senderid']);
$dateAdded=time();
if($emailsetting['id']!=''){
$namevalue ='url="'.$url.'",user_name="'.$user_name.'",password="'.$password.'",senderid="'.$senderid.'",modifyDate="'.$dateAdded.'"';
$where='id="'.$emailsetting['id'].'"';
$update = updatelisting(_SMS_MASTER_,$namevalue,$where);
$alt=2;
generateLogs('smssettings','update',$loginusersuperParentId);
} else {
$namevalue ='url="'.$url.'",user_name="'.$user_name.'",password="'.$password.'",senderid="'.$senderid.'",userId="'.$loginusersuperParentId.'",dateAdded="'.$dateAdded.'"';
addlisting(_SMS_MASTER_,$namevalue);
$alt=1;
generateLogs('smssettings','add',$loginusersuperParentId);
}
?>
<script>
parent.window.location.href='setupsetting.crm?module=smssettings&alt=<?php echo $alt; ?>';
</script>
<?php
 exit();
}
if(trim($_POST['action'])=='profilepic' && $_FILES["changeprofilepic"]["name"]!=''){
  $destpath = "profilepic/";
$datef=time();
while(list($key,$value) = each($_FILES["changeprofilepic"]["name"])) {
if(!empty($value))
{
if (($_FILES["changeprofilepic"]["type"][$key] == "image/gif")
|| ($_FILES["changeprofilepic"]["type"][$key] == "image/jpeg")
|| ($_FILES["changeprofilepic"]["type"][$key] == "image/pjpeg")
|| ($_FILES["changeprofilepic"]["type"][$key] == "image/png"))
    {
$source = $_FILES["changeprofilepic"]["tmp_name"][$key] ;
$filename = $_FILES["changeprofilepic"]["name"][$key] ;
move_uploaded_file($source, $destpath . $datef . $filename) ;
//echo "Uploaded: " . $destpath . $filename . "<br/>" ;
//thumbnail creation start//
$tsrc="profilepic/thumb/".$datef."".$_FILES["changeprofilepic"]["name"][$key];   // Path where thumb nail image will be stored
//echo $tsrc;
/*if (!($_FILES["changeprofilepic"]["type"] =="image/jpeg" OR $_FILES["changeprofilepic"]["type"] =="image/png" OR $_FILES["changeprofilepic"]["type"]=="image/gif")){echo "Your uploaded file must be of JPG or GIF. Other file types are not allowed<BR>";
}*/
$n_width=300;          // Fix the width of the thumb nail images
$n_height=199;         // Fix the height of the thumb nail imaage
/////////////////////////////////////////////// Starting of GIF thumb nail creation///////////
$add=$destpath . $filename;
if($_FILES["changeprofilepic"]["type"][$key]=="image/gif"){
//echo "hello";
$im=ImageCreateFromGIF($add);
$width=ImageSx($im);              // Original picture width is stored
$height=ImageSy($im);                  // Original picture height is stored
$max_size = 100;
$ratio    = $im[0] / $im[1];
if ($ratio >= 1) {
    $width  = $max_size;
    $height = round($max_size / $ratio);
} else {
    $width  = round($max_size * $ratio);
    $height = $max_size;
}
$newimage=imagecreatetruecolor($n_width,$n_height);
imageCopyResized($newimage,$im,0,0,0,0,$n_width,$n_height,$width,$height);
if (function_exists("imagegif")) {
Header("Content-type: image/gif");
ImageGIF($newimage,$tsrc);
}
if (function_exists("imagejpeg")) {
Header("Content-type: image/jpeg");
ImageJPEG($newimage,$tsrc);
}
    }
//chmod("$tsrc",0777);
////////// end of gif file thumb nail creation//////////
$n_width=300;           // Fix the width of the thumb nail images
$n_height=199;         // Fix the height of the thumb nail imaage
////////////// starting of JPG thumb nail creation//////////
if($_FILES["changeprofilepic"]["type"][$key]=="image/jpeg"){
 $_FILES["changeprofilepic"]["name"][$key]."<br>";
$im=ImageCreateFromJPEG($add);
$width=ImageSx($im);              // Original picture width is stored
$height=ImageSy($im);             // Original picture height is stored
$max_size = 100;
$ratio    = $im[0] / $im[1];
if ($ratio >= 1) {
    $width  = $max_size;
    $height = round($max_size / $ratio);
} else {
    $width  = round($max_size * $ratio);
    $height = $max_size;
}
$newimage=imagecreatetruecolor($n_width,$n_height);
imageCopyResized($newimage,$im,0,0,0,0,$n_width,$n_height,$width,$height);
ImageJpeg($newimage,$tsrc);
//chmod("$tsrc",0777);
}
////////////////  End of png thumb nail creation //////////
if($_FILES["changeprofilepic"]["type"][$key]=="image/png"){
//echo "hello";
$im=ImageCreateFromPNG($add);
$width=ImageSx($im);              // Original picture width is stored
$height=ImageSy($im);                  // Original picture height is stored
$newimage=imagecreatetruecolor($n_width,$n_height);
imageCopyResized($newimage,$im,0,0,0,0,$n_width,$n_height,$width,$height);
if (function_exists("imagepng")) {
//Header("Content-type: image/png");
ImagePNG($newimage,$tsrc);
}
if (function_exists("imagejpeg")) {
//Header("Content-type: image/jpeg");
ImageJPEG($newimage,$tsrc);
}
    }
// thumbnail creation end---
    }
else{echo "error in upload";}
}
image_fix_orientation('profilepic/'.$datef.''.$_FILES["changeprofilepic"]["name"][$key].'');
generate_image_thumbnail('profilepic/'.$datef.''.$_FILES["changeprofilepic"]["name"][$key].'', 'profilepic/thumb/small'.$datef.''.$_FILES["changeprofilepic"]["name"][$key].'','48','48');
generate_image_thumbnail('profilepic/'.$datef.''.$_FILES["changeprofilepic"]["name"][$key].'', 'profilepic/'.$datef.''.$_FILES["changeprofilepic"]["name"][$key].'','200','200');
//$img = 'upload/'.$datef.''.$_FILES["changeprofilepic"]["name"][$key].'';
//resize($img);
//adjustPicOrientation($img);
unlink('profilepic/'.$loginuserprofilePhoto);
unlink('profilepic/thumb/small'.$loginuserprofilePhoto);
$file_name= $datef.$_FILES["changeprofilepic"]["name"][$key];
echo $sql_ins1="update "._USER_MASTER_." set  profilePhoto='$file_name' where id = '".$_SESSION['userid']."'";
$rs1=mysqli_query(db(),$sql_ins1) or die(mysqli_error(db()));
}
 ?>
 <script>
parent.window.location.href='setupsetting.crm?module=personalsettings&alt=2';
</script>
 <?php
 exit();
}
if(trim($_REQUEST['action'])=='sendtestmail'){
	include "config/mail.php";
	$select='*';
	$where='userId="'.$loginuserID.'"';
	$rs=GetPageRecord($select,_EMAIL_SETTING_MASTER_,$where);
	$emailsetting=mysqli_fetch_array($rs);
	$mailto='samay.dbox@gmail.com';
	$fromemail='samay.dbox@gmail.com';
	$mailsubject='Test Mail';
	$maildescription='This is a test mail for email settings.'.$emailsignature;
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription);
	if($exeMailresult!=true){
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	
		?> 
		<script>
		$("#mailsending").hide();
		</script>
		<div style="margin-bottom:25px; text-align:center; color:#009900; font-size:15px;">
			<textarea name="textarea" rows="20" class="gridfield" id="textarea" style="height:220px;"><?php echo nl2br($thankNotes).$clientquotation; ?></textarea>
			<img src="images/mailsendseccicon.png" /><br />
		Mail Sent Successfully</div>
		<table border="0" align="center" cellpadding="0" cellspacing="0">
			<tbody><tr>
				<td><input name="Cancel" type="button" class="whitembutton" id="Close" value="Close" onclick="alertspopupopenClose();$('#sendtestmailresult').hide();"></td>
			</tr>
		</tbody></table>
		<?php 
	}
	exit(); 
}



if(trim($_REQUEST['action'])=='changemodulename' && trim($_REQUEST['name'])!='' && trim($_REQUEST['moduleid'])!=''){
	$name=clean($_REQUEST['name']);
	$moduleid=clean(decode($_REQUEST['moduleid']));
	$dateAdded=time();
	if($name!=''){
		$namevalue ='moduleName="'.$name.'",modifyDate="'.$dateAdded.'",modifyBy="'.$_SESSION['userid'].'"';
		$where='id="'.$moduleid.'" and userId="'.$loginusersuperParentId.'"';
		$update = updatelisting(_USER_MODULE_MASTER_,$namevalue,$where);
		generateLogs('modules','update',$moduleid);
	}
}

if(trim($_POST['action'])=='addmailtemplate' && trim($_POST['subject'])!='' && trim($_POST['mailbody'])!='' && trim($_POST['editid'])==''){
	$subject=clean($_POST['subject']);
	$mailbody=clean($_POST['mailbody']);
	$isDefault=addslashes($_POST['isDefault']);
	
	$dateAdded=time();
	$namevalue ='subject="'.$subject.'",mailbody="'.$mailbody.'",isDefault="'.$isDefault.'",addedBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",dateAdded="'.$dateAdded.'"';
	$add = addlisting(_EMAIL_TEMPLATE_MASTER_,$namevalue);
	if($add=='yes'){
		$select='id';
		$where='userId="'.$loginusersuperParentId.'" order by id desc';
		$rs=GetPageRecord($select,_EMAIL_TEMPLATE_MASTER_,$where);
		$templateid=mysqli_fetch_array($rs);
		 generateLogs('emailtemplates','add',$templateid['id']);
		?>
		<script>
		parent.window.location.href='setupsetting.crm?module=emailtemplates&alt=1';
		</script>
		<?php
		exit();
	}
}

if(trim($_POST['action'])=='editemailtemplate' && trim($_POST['subject'])!='' && trim($_POST['mailbody'])!='' && trim($_POST['editid'])!=''){
	$editid=clean(decode($_REQUEST['editid']));
	$subject=clean($_POST['subject']);
	$mailbody=addslashes($_POST['mailbody']);
	$isDefault=addslashes($_POST['isDefault']);
	$dateAdded=time();
	$namevalue ='subject="'.$subject.'",mailbody="'.$mailbody.'",isDefault="'.$isDefault.'",modifyBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",modifyDate="'.$dateAdded.'"';
	$where='id="'.$editid.'" and userId="'.$loginusersuperParentId.'"';
	$update = updatelisting(_EMAIL_TEMPLATE_MASTER_,$namevalue,$where);
	if($update='yes'){
		 generateLogs('emailtemplates','update',$editid);
		?>
		<script>
		parent.window.location.href='setupsetting.crm?module=emailtemplates&alt=2';
		</script>
		<?php
		exit();
	}
}

if(trim($_REQUEST['action'])=='deleteemailtemplate' && trim($_REQUEST['did'])!=''){
	$sql_del="update "._EMAIL_TEMPLATE_MASTER_." set deletestatus=1 where id='".decode($_GET['did'])."' and userId=".$loginusersuperParentId." ";
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
	generateLogs('emailtemplates','delete',decode($_GET['did']));
	?>
	<script>
	setupbox('setupsetting.crm?module=emailtemplates&alt=3');
	</script>
	<?php 
}

if(trim($_POST['action'])=='addsmstemplate' && trim($_POST['smsbody'])!='' && trim($_POST['editid'])==''){
	$smsbody=clean($_POST['smsbody']);
	$dateAdded=time();
	$namevalue ='smsbody="'.$smsbody.'",addedBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",dateAdded="'.$dateAdded.'"';
	$add = addlisting(_SMS_TEMPLATE_MASTER_,$namevalue);
	if($add=='yes'){
		$select='id';
		$where='userId="'.$loginusersuperParentId.'" order by id desc';
		$rs=GetPageRecord($select,_SMS_TEMPLATE_MASTER_,$where);
		$templateid=mysqli_fetch_array($rs);
		generateLogs('smstemplates','add',$templateid['id']);
		?>
		<script>
		parent.window.location.href='setupsetting.crm?module=smstemplates&alt=1';
		</script>
		<?php
		exit();
	}
}

if(trim($_POST['action'])=='editsmstemplate' && trim($_POST['smsbody'])!='' && trim($_POST['editid'])!=''){
$editid=clean(decode($_REQUEST['editid']));
$smsbody=clean($_POST['smsbody']);
$dateAdded=time();
$namevalue ='smsbody="'.$smsbody.'",modifyBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",modifyDate="'.$dateAdded.'"';
$where='id="'.$editid.'" and userId="'.$loginusersuperParentId.'"';
$update = updatelisting(_SMS_TEMPLATE_MASTER_,$namevalue,$where);
if($update='yes'){
 generateLogs('smstemplates','update',$editid);
?>
<script>
parent.window.location.href='setupsetting.crm?module=smstemplates&alt=2';
</script>
<?php
exit();
}
}

if(trim($_REQUEST['action'])=='deletesmstemplate' && trim($_REQUEST['did'])!=''){
$sql_del="update "._SMS_TEMPLATE_MASTER_." set deletestatus=1  where id='".decode($_GET['did'])."' and  userId=".$loginusersuperParentId." ";
mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
 generateLogs('smstemplates','delete',decode($_GET['did']));
?>
<script>
setupbox('setupsetting.crm?module=smstemplates&alt=3');
</script>
<?php }



if(trim($_POST['action'])=='submitpost' && trim($_POST['postsubmitfield'])!=''){
	?>
	<script>
	parent.startloading();
	</script>
	 <?php
	$postsubmitfield=clean(strip_tags($_POST['postsubmitfield']));
	$parentId=clean($_POST['parentId']);
	$dateAdded=time();
	if($parentId==''){
	$parentId=0;
	}
	$namevalue ='postText="'.$postsubmitfield.'",parentId="'.$parentId.'",addedBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",dateAdded="'.$dateAdded.'"';
	$add = addlisting(_TIMELINE_MASTER_,$namevalue);
	if($add=='yes'){
	if(isset($_FILES['attachpostsubmit'])) {
	    if($_FILES['attachpostsubmit']['size'] < 20971520) {
			echo $ext = substr($_FILES['attachpostsubmit']['name'], strrpos($_FILES['attachpostsubmit']['name'], '.') + 1);
			if($ext=='jpg' || $ext=='jpeg' || $ext=='JPG' || $ext=='JPEG' || $ext=='png' || $ext=='PNG' || $ext=='GIF' || $ext=='gif' || $ext=='txt' || $ext=='psd' || $ext=='docx' || $ext=='doc' || $ext=='xlsx' || $ext=='xlsm' || $ext=='xls' || $ext=='pptx' || $ext=='pdf' || $ext=='PDF' || $ext=='ppt' || $ext=='zip'){
	$datef=time();
	$file_name=$_FILES['attachpostsubmit']['name'];
	$ext=getExtension($file_name);
	$file_name=str_replace(".","",substr($file_name, 0, strpos($file_name, '.')));
	$file_name2=str_replace(" ","",$file_name.'-'.$datef).'.'.$ext;
	copy($_FILES['attachpostsubmit']['tmp_name'],"dirfiles/".$file_name2);
	$finalefileName=$file_name2;
	$finalfileSize=$_FILES['attachpostsubmit']['size'];
	$finalefileExtension=$ext;
	$select='id';
	$where='userId="'.$loginusersuperParentId.'" order by id desc';
	$rs=GetPageRecord($select,_TIMELINE_MASTER_,$where);
	$lasttimelineid=mysqli_fetch_array($rs);
	$namevalue2 ='userId="'.$loginusersuperParentId.'",parentId="'.$lasttimelineid['id'].'",addedBy="'.$_SESSION['userid'].'",parentType="timeline",dateAdded="'.$dateAdded.'",fileName="'.$finalefileName.'",fileExtension="'.$finalefileExtension.'",fileSize="'.$finalfileSize.'"';
	$addpost = addlisting(_FILE_MASTER_,$namevalue2);
			}
	    }
	}
	$select='';
	$where='';
	$rs='';
	$select='id';
	$where='superParentId='.$loginusersuperParentId.' and id!="'.$_SESSION['userid'].'"';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	while($usermaster=mysqli_fetch_array($rs)){
	$namevalue2 ='userId="'.$loginusersuperParentId.'",parentId="'.$usermaster['id'].'",addedBy="'.$_SESSION['userid'].'",postType="post",dateAdded="'.$dateAdded.'"';
	$addpost = addlisting(_NOTIFICATION_MASTER_,$namevalue2);
	}
	?>
	<script>
	parent.loadtimelinefunc();
	</script>
	<?php
	exit();
	}
}

if(trim($_POST['action'])=='submitpostreply' && trim($_POST['parentId'])!='' && trim($_POST['postreplyfield'])!='' && trim($_POST['addby'])!=''){
 ?>
<script>
parent.startloading();
</script>
 <?php
$postsubmitfield=clean(strip_tags($_POST['postreplyfield']));
$parentId=clean($_POST['parentId']);
$addby=clean($_POST['addby']);
$dateAdded=time();
$namevalue ='postText="'.$postsubmitfield.'",parentId="'.$parentId.'",addedBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",dateAdded="'.$dateAdded.'"';
$add = addlisting(_TIMELINE_MASTER_,$namevalue);
if($add=='yes'){
if(isset($_FILES['attachpostsubmit'])) {
    if($_FILES['attachpostsubmit']['size'] < 20971520) {
		echo $ext = substr($_FILES['attachpostsubmit']['name'], strrpos($_FILES['attachpostsubmit']['name'], '.') + 1);
		if($ext=='jpg' || $ext=='jpeg' || $ext=='JPG' || $ext=='JPEG' || $ext=='png' || $ext=='PNG' || $ext=='GIF' || $ext=='gif' || $ext=='txt' || $ext=='psd' || $ext=='docx' || $ext=='doc' || $ext=='xlsx' || $ext=='xlsm' || $ext=='xls' || $ext=='pptx' || $ext=='pdf' || $ext=='PDF' || $ext=='ppt' || $ext=='zip'){
$datef=time();
$file_name=$_FILES['attachpostsubmit']['name'];
$ext=getExtension($file_name);
$file_name=str_replace(".","",substr($file_name, 0, strpos($file_name, '.')));
$file_name2=str_replace(" ","",$file_name.'-'.$datef).'.'.$ext;
copy($_FILES['attachpostsubmit']['tmp_name'],"dirfiles/".$file_name2);
$finalefileName=$file_name2;
$finalfileSize=$_FILES['attachpostsubmit']['size'];
$finalefileExtension=$ext;
$select='id';
$where='userId="'.$loginusersuperParentId.'" order by id desc';
$rs=GetPageRecord($select,_TIMELINE_MASTER_,$where);
$lasttimelineid=mysqli_fetch_array($rs);
$namevalue2 ='userId="'.$loginusersuperParentId.'",parentId="'.$lasttimelineid['id'].'",addedBy="'.$_SESSION['userid'].'",parentType="timeline",dateAdded="'.$dateAdded.'",fileName="'.$finalefileName.'",fileExtension="'.$finalefileExtension.'",fileSize="'.$finalfileSize.'"';
$addpost = addlisting(_FILE_MASTER_,$namevalue2);
		}
    }
}
if($addby!=$_SESSION['userid']){
$namevalue2 ='userId="'.$loginusersuperParentId.'",parentId="'.$parentId.'",addedBy="'.$_SESSION['userid'].'",postType="reply",dateAdded="'.$dateAdded.'",replyPostowner="'.$addby.'"';
$addpost = addlisting(_NOTIFICATION_MASTER_,$namevalue2);
}
?>
<script>
parent.loadpostreply(<?php echo $parentId; ?>);
</script>
<?php
exit();
}
}
if(trim($_REQUEST['action'])=='deletetimelinepost' && trim($_REQUEST['id'])!=''){
$id=decode($_GET['id']);
$sql_del="delete from "._TIMELINE_MASTER_."  where id='".$id."' and  userId=".$loginusersuperParentId." ";
mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
$sql_del="delete from "._TIMELINE_MASTER_."  where parentId='".$id."' and  userId=".$loginusersuperParentId." ";
mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
$select='fileName';
$where='userId="'.$loginusersuperParentId.'" and parentId='.$id.'';
$rs=GetPageRecord($select,_FILE_MASTER_,$where);
$filemaster=mysqli_fetch_array($rs);
$sql_del="delete from "._FILE_MASTER_."  where parentId='".$id."' and  userId=".$loginusersuperParentId." ";
mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
unlink('dirfiles/'.$filemaster['fileName']);
?>
<script>
loadtimelinefunc();
stoptloading();
</script>
<?php }
if(trim($_REQUEST['action'])=='addLeads' && $_REQUEST['assignTo']!='' && $_REQUEST['company']!='' && $_REQUEST['firstName']!='' && $_REQUEST['editid']==''){
$savenew=clean($_POST['savenew']);
$assignTo=clean(decode($_POST['assignTo']));
$company=clean($_POST['company']);
$firstName=clean($_POST['firstName']);
$lastName=clean($_POST['lastName']);
$title=clean($_POST['title']);
$email=clean($_POST['email']);
$phone=clean($_POST['phone']);
$fax=clean($_POST['fax']);
$mobile=clean($_POST['mobile']);
$website=clean($_POST['website']);
$leadsSource=clean($_POST['leadsSource']);
$leadsStatus=clean($_POST['leadsStatus']);
$industry=clean($_POST['industry']);
$employees=clean($_POST['employees']);
$annualRevenue=clean($_POST['annualRevenue']);
$rating=clean($_POST['rating']);
$skypeId=clean($_POST['skypeId']);
$secondaryEmail=clean($_POST['secondaryEmail']);
$twitter=clean($_POST['twitter']);
$street=clean($_POST['street']);
$city=clean($_POST['city']);
$state=clean($_POST['state']);
$zipCode=clean($_POST['zipCode']);
$discription=clean($_POST['discription']);
$sirName=clean($_POST['sirName']);
$employees=clean($_POST['employees']);
$country=clean($_POST['country']);
$dateAdded=time();
$namevalue ='assignTo="'.$assignTo.'",company="'.$company.'",firstName="'.$firstName.'",lastName="'.$lastName.'",title="'.$title.'",email="'.$email.'",phone="'.$phone.'",fax="'.$fax.'",mobile="'.$mobile.'",website="'.$website.'",leadsSource="'.$leadsSource.'",leadsStatus="'.$leadsStatus.'",industry="'.$industry.'",employees="'.$employees.'",annualRevenue="'.$annualRevenue.'",rating="'.$rating.'",skypeId="'.$skypeId.'",secondaryEmail="'.$secondaryEmail.'",twitter="'.$twitter.'",street="'.$street.'",city="'.$city.'",state="'.$state.'",zipCode="'.$zipCode.'",discription="'.$discription.'",country="'.$country.'",sirName="'.$sirName.'",dateAdded="'.$dateAdded.'",userId="'.$loginusersuperParentId.'",addedBy="'.$_SESSION['userid'].'"';
$add = addlisting(_LEADS_MASTER_,$namevalue);
if($add=='yes'){
$select='id';
$where='userId="'.$loginusersuperParentId.'" and addedBy='.$_SESSION['userid'].' order by id desc';
$rs=GetPageRecord($select,_LEADS_MASTER_,$where);
$leadlastid=mysqli_fetch_array($rs);
generateLogs('leads','add',$leadlastid['id']);
if($savenew==1){
?>
<script>
parent.window.location.href='showpage.crm?module=leads&add=yes&alt=1';
</script>
<?php exit(); } else { ?>
<script>
parent.window.location.href='showpage.crm?module=leads&view=yes&id=<?php echo encode($leadlastid['id']); ?>&alt=1';
</script>
<?php
 exit();
}
}
}
if(trim($_REQUEST['action'])=='editLeads' && $_REQUEST['assignTo']!='' && $_REQUEST['companyName']!='' && $_REQUEST['editid']!=''){

	// die("ttetteteette11111");
$savenew=clean($_POST['savenew']);
$assignTo=clean(decode($_POST['assignTo']));
$company=clean($_POST['companyName']);
$firstName=clean($_POST['firstName']);
$lastName=clean($_POST['lastName']);
$title=clean($_POST['title']);
$email=clean($_POST['email']);
$phone=clean($_POST['phone']);
$fax=clean($_POST['fax']);
$mobile=clean($_POST['mobile']);
$website=clean($_POST['website']);
$leadsSource=clean($_POST['leadsSource']);
$leadsStatus=clean($_POST['leadsStatus']);
$industry=clean($_POST['industry']);
$employees=clean($_POST['employees']);
$annualRevenue=clean($_POST['annualRevenue']);
$rating=clean($_POST['rating']);
$skypeId=clean($_POST['skypeId']);
$secondaryEmail=clean($_POST['secondaryEmail']);
$twitter=clean($_POST['twitter']);
$street=clean($_POST['street']);
$city=clean($_POST['city']);
$state=clean($_POST['state']);
$zipCode=clean($_POST['zipCode']);
$discription=clean($_POST['discription']);
$sirName=clean($_POST['sirName']);
$employees=clean($_POST['employees']);
$country=clean($_POST['country']);
$editid=decode($_POST['editid']);
$dateAdded=time();
$namevalue ='assignTo="'.$assignTo.'",company="'.$company.'",firstName="'.$firstName.'",lastName="'.$lastName.'",title="'.$title.'",email="'.$email.'",phone="'.$phone.'",fax="'.$fax.'",mobile="'.$mobile.'",website="'.$website.'",leadsSource="'.$leadsSource.'",leadsStatus="'.$leadsStatus.'",industry="'.$industry.'",employees="'.$employees.'",annualRevenue="'.$annualRevenue.'",rating="'.$rating.'",skypeId="'.$skypeId.'",secondaryEmail="'.$secondaryEmail.'",twitter="'.$twitter.'",street="'.$street.'",city="'.$city.'",state="'.$state.'",zipCode="'.$zipCode.'",discription="'.$discription.'",country="'.$country.'",sirName="'.$sirName.'",modifyDate="'.$dateAdded.'",modifyBy="'.$_SESSION['userid'].'"';
$where='id="'.$editid.'" and userId="'.$loginusersuperParentId.'"';
$update = updatelisting(_LEADS_MASTER_,$namevalue,$where);
if($update=='yes'){
generateLogs('leads','update',$editid);
if($savenew==1){
?>
<script>
parent.window.location.href='showpage.crm?module=leads&add=yes&alt=2';
</script>
<?php exit(); } else { ?>
<script>
parent.window.location.href='showpage.crm?module=leads&view=yes&id=<?php echo encode($editid); ?>&alt=2';
</script>
<?php
 exit();
}
}
}
if(trim($_REQUEST['action'])=='deleteleads'){
$check_list=$_REQUEST['check_list'];
 if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_LEADS_MASTER_,$namevalue,$where);
generateLogs('leads','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=leads&alt=3');
</script>
<?php
} 

//contactpCount islam 2222
if(trim($_POST['action'])=='editcorporate' && trim($_POST['name'])!='' && $_POST['editId']!=''){
		$companyTypeId=clean($_POST['companyTypeId']);

		$name=clean($_POST['name']);
		$type=clean($_POST['type']); 
		$consortiaId=clean($_POST['consortiaId']); 
		$ISOId=clean($_POST['ISOId']); 
		$commission=clean($_POST['commission']); 
		$commissionNameId=clean($_POST['commissionName']); 

		$name=clean($_POST['name']);

		$PANNumber=clean($_POST['PANNumber']);
		$TRNNumber=clean($_POST['TRNNumber']);

		$status=clean($_POST['status']);
		$contactPerson=clean($_POST['contactPerson']);
		$countryId=clean($_POST['countryId']);
		$stateId=clean($_POST['stateId']);
		$cityId=clean($_POST['cityId']);
		$assignTo=decode($_POST['assignTo']);
		$address1=clean($_POST['address1']);
		$address2=clean($_POST['address2']);
		$address3=clean($_POST['address3']);
		$editedityes=clean($_POST['editedityes']);
		$pinCode=clean($_POST['pinCode']);
		$savenew=clean($_POST['savenew']);
		$gstn=clean($_POST['gstn']);
		$agreementattachment2=$_POST['agreementattachment2'];
		$companyCategory=$_POST['companyCategory'];
		$paymentTerm=$_POST['paymentTerm'];
		$bussinessType=$_POST['bussinessType'];
		$OpsAssignTo=$_POST['OpsAssignTo'];
		$nationality=$_POST['nationality'];
		$tourType=$_POST['tourType'];
		$oldLogo=$_POST['oldLogo'];
		$marketType=$_POST['marketType'];
		$modifyBy='0';
		$dateAdded='0';

		if($_POST['agreement']==1 && empty($_FILES['agreementattachment']['name'])){
			?>
			<script>
				parent.alert('Please Attachment Agreement Files');
				parent.window.location.href='showpage.crm?module=corporate&add=yes';
				// exit();
				// parent.$('#pageloader').hide();
				// parent.$('#pageloading').hide();
			</script> 
			<?php 
		}else{
			if($editedityes=='1'){
				$modifyBy=$_SESSION['userid'];
				$dateAdded=time();
			}
			if($_POST['agreement']==1){
				$time=time();
				if(!empty($_FILES['agreementattachment']['name'])){
					$file_name=$time.str_replace(' ', '',$_FILES['agreementattachment']['name']);
					copy($_FILES['agreementattachment']['tmp_name'],"dirfiles/".$file_name);
				} else {
					$file_name=$agreementattachment2;
				}
			}
			if($_POST['destinationId']!=''){
				foreach($_POST['destinationId'] as $k1 => $v1){
					$multipro.= $_POST['destinationId'][$k1].',';
				} 
			}
			if(!empty($_FILES['companyLogo']['name'])){
				$companyLogo=time().str_replace(' ', '',$_FILES['companyLogo']['name']);
				copy($_FILES['companyLogo']['tmp_name'],"agentLogo/".$companyLogo);
			} else {
				$companyLogo=$oldLogo;
			}
		
			// duplicate code added here
			$rsr=GetPageRecord('*',_CORPORATE_MASTER_,'name="'.$name.'" and id!="'.decode($_POST['editId']).'"');
			// $editresult=mysqli_num_rows($rsr);
			if(mysqli_num_rows($rsr) > 0 ){
				?>
				<script>
				parent.alert('This Agent Already Exist!');
				parent.$('#pageloader').hide();
				parent.$('#pageloading').hide();
				</script> 
				<?php 
				
			}
			else{
		
				$namevalue ='companyTypeId="'.$companyTypeId.'",name="'.$name.'",PANNumber="'.$PANNumber.'",TRNNumber="'.$TRNNumber.'",paymentTerm="'.$paymentTerm.'",contactPerson="'.$contactPerson.'",status="'.$status.'",assignTo="'.$assignTo.'",modifyBy="'.$modifyBy.'",modifyDate="'.$dateAdded.'",agreement="'.$file_name.'",bussinessType="'.$bussinessType.'",companyCategory="'.$companyCategory.'",OpsAssignTo="'.$OpsAssignTo.'",nationality="'.$nationality.'",tourType="'.$tourType.'",companyLogo="'.$companyLogo.'",marketType="'.$marketType.'",type="'.$type.'",ISOId="'.$ISOId.'",cosortiaId="'.$consortiaId.'",commission="'.$commission.'",countryId="'.$countryId.'",commissionNameId="'.$commissionNameId.'"';
			$where='id="'.decode($_POST['editId']).'"';
			$update = updatelisting(_CORPORATE_MASTER_,$namevalue,$where);
		
		
		}

	
	if($update=='yes'){
		//-----------------------Add Contact Person---------------------------
		
		while($valuecont <= $_POST['contactpCount']){
			$contprson=trim($_POST["contactPerson".$valuecont]);
			$designationcontprson=trim($_POST["designation".$valuecont]);
			$phonecontprson=str_replace(' ', '', trim($_POST["phone".$valuecont]));
			$emailcontprson=trim($_POST["email".$valuecont]);
			// echo $valuecont;
			$Idcontprson=trim($_POST["contactPId".$valuecont]);
			$contactPmailId=trim($_POST["contactPmailId".$valuecont]);
			$countryCode=trim($_POST["countryCode".$valuecont]);
			$division=trim($_POST["division".$valuecont]);
			$primaryval=trim($_POST["primaryvalue"]);
			if($primaryval==$valuecont){
				$primaryvalue=1;
			} else {
				$primaryvalue=0;
			}
			if(trim($_POST["contactPId".$valuecont])!=''){
				$selectee='*';
				$whereee='id='.$Idcontprson.'';
				$rsee=GetPageRecord($selectee,'contactPersonMaster',$whereee);
				$countcont=mysqli_num_rows($rsee);
				if($countcont>0){
					while($upcpm=mysqli_fetch_array($rsee)){
						$allvaluecontactperson ='contactPerson="'.$contprson.'",corporateId="'.decode($_POST['editId']).'",designation="'.$designationcontprson.'",phone="'.encode($phonecontprson).'",email="'.encode($emailcontprson).'",countryCode="'.$countryCode.'",primaryvalue="'.$primaryvalue.'",division="'.$division.'"';
						$wherecontactperson='id='.$Idcontprson.'';
						$updatecontactperson = updatelisting('contactPersonMaster',$allvaluecontactperson,$wherecontactperson);
					}
				}
				// $selectmail='*';
				// $wheremail='id='.$contactPmailId.'';
				// $rsmaik=GetPageRecord($selectmail,_EMAIL_MASTER_,$wheremail);
				// $countcontmail=mysqli_num_rows($rsmaik);
				// if($countcontmail>0){
				// 	while($upcpmail=mysqli_fetch_array($rsmaik)){
				// 		$namevalueemail1 ='masterId="'.decode($_POST['editId']).'",email="'.$emailcontprson.'",emailType=1,sectionType="corporate",primaryvalue="'.$primaryvalue.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
				// 		$wheremail1='id='.$contactPmailId.'';
				// 		updatelisting(_EMAIL_MASTER_,$namevalueemail1,$wheremail1);
				// 	} 
				// }
			}else{
				 $allvaluecontactperson ='contactPerson="'.$contprson.'",corporateId="'.decode($_POST['editId']).'",designation="'.$designationcontprson.'",phone="'.encode($phonecontprson).'",email="'.encode($emailcontprson).'",countryCode="'.$countryCode.'",primaryvalue="'.$primaryvalue.'",division="'.$division.'"';
				$add = addlisting('contactPersonMaster',$allvaluecontactperson);
				//=================INSERT EMAIL MASTER AND PHONE MASTER=================== 
				// $namevalueemail1 ='masterId="'.decode($_POST['editId']).'",email="'.$emailcontprson.'",emailType=1,sectionType="corporate",primaryvalue="'.$primaryvalue.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
				// addlistinggetlastid(_EMAIL_MASTER_,$namevalueemail1);
				// $namevaluemobile1 ='masterId="'.decode($_POST['editId']).'",phoneNo="'.$phonecontprson.'",phoneType=1,sectionType="corporate",primaryvalue="'.$primaryvalue.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
				// addlistinggetlastid(_PHONE_MASTER_,$namevaluemobile1);
				//================================================================================ 
			}
			$valuecont++;
		}
		//==== ==================DELETE DATA============ ============================
		$delwhere='contactPerson=""';
		deleteRecord('contactPersonMaster',$delwhere); 
		//=================== =====================DELETE DATA======================= ========
		///-----------------Adding In Logs---------------------
		if($editedityes=='yes'){
			generateLogs('corporate','update',decode($_POST['editId']));
		} else {
			generateLogs('corporate','add',decode($_POST['editId']));
		}
		///-----------------Adding In Logs End---------------------
		if($savenew==1){
		?>
		<script>
		parent.window.location.href='showpage.crm?module=corporate&add=yes&alt=2';
		</script>
		<?php exit(); } else { ?>
		<script>
		parent.window.location.href='showpage.crm?module=corporate&view=yes&id=<?php echo $_POST['editId']; ?>&alt=2';
		</script>
		<?php
		 exit();
		}
}
	}

	
}

if(trim($_REQUEST['action'])=='corporatedelete'){
	$check_list=$_REQUEST['check_list'];
	if($check_list!=""){
		for($i=0;$i<=count($check_list)-1;$i++){
			$ansval=trim(decode($check_list[$i]));
			if(trim($ansval) != ''){
				$namevalue ='deletestatus="1"';
				$where='id="'.$ansval.'"';
				$update = updatelisting(_CORPORATE_MASTER_,$namevalue,$where);
				generateLogs('corporate','delete',$ansval);
			} 
		} 
	}
	?>
	<script>
	parent.setupbox('showpage.crm?module=corporate&alt=3');
	</script>
	<?php
}

if(trim($_REQUEST['action'])=='deleteCorporateContacts'){
	$contactId=$_REQUEST['contactId'];
	if($contactId>0){
		$namevalue ='deletestatus="1"';
		$where='id="'.$contactId.'"';
		$update = updatelisting('contactPersonMaster',$namevalue,$where);
		generateLogs('contactPersonMaster','delete',$contactId);
	} 
}

if($_REQUEST['action']=='attachdocument') {
//print_r($_REQUEST);
$docId=$_POST['docId'];
$editId=($_POST['editId']);
$sectionType=$_POST['sectionType'];
?>
<script>
parent.$('#pageloading').hide();
</script>
<?php
$time=time();
if(!empty($_FILES['uploaddocuments']['name'])){
$file_name=$time.'-'.$_FILES['uploaddocuments']['name'];
copy($_FILES['uploaddocuments']['tmp_name'],"dirfiles/".$file_name);
$allvaluephone ='fileName="'.$file_name.'",sectionType="'.$sectionType.'",masterId="'.$editId.'",docId="'.$docId.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'" ';
$add = addlisting(_DOCUMENT_ATTACHMENT_MASTER_,$allvaluephone);
}
?>
<script>
parent.$('#loaddoc<?php echo $docId;?>').load('loaddocumentfile.php?id=<?php echo $editId; ?>&sectionType=<?php echo $sectionType; ?>&docId=<?php echo $docId; ?>');
</script>
<?php
}
if($_REQUEST['action']=='adddocument' && $_REQUEST['sectionType']!=''  && $_REQUEST['masterId']!=''){
$masterId=decode($_POST['masterId']);
$docType=$_POST['docType'];
$documentNo=$_POST['documentNo'];
$countryId=$_POST['countryId'];
$issueDate=$_POST['issueDate'];
$expiryDate=$_POST['expiryDate'];
$issueDates = date('Y-m-d',strtotime($issueDate));
$expiryDates = date('Y-m-d',strtotime($expiryDate));
$sectionType=$_POST['sectionType'];
$allvaluephone ='masterId="'.$masterId.'",docType="'.$docType.'",documentNo="'.$documentNo.'",countryId="'.$countryId.'",issueDate="'.$issueDates.'",expiryDate="'.$expiryDates.'",sectionType="'.$sectionType.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.date('Y-m-d').'"';
$add = addlisting(_DOCUMENT_DETAILS_MASTER_,$allvaluephone);
?>
<script>
parent.$('#pageloading').hide();
parent.alertspopupopenClose();
parent.$('#loadalertbox').hide();
parent.loaddocumentfunc();
</script>
<?php
}
if($_REQUEST['action']=='editdocument' && $_REQUEST['sectionType']!=''  && $_REQUEST['masterId']!=''  && $_REQUEST['editId']!=''){
$masterId=decode($_POST['masterId']);
$docType=$_POST['docType'];
$documentNo=$_POST['documentNo'];
$countryId=$_POST['countryId'];
$issueDate=$_POST['issueDate'];
$expiryDate=$_POST['expiryDate'];
$issueDates = date('Y-m-d',strtotime($issueDate));
$expiryDates = date('Y-m-d',strtotime($expiryDate));
$sectionType=$_POST['sectionType'];
?>
<script>
</script>
<?php
$where='id="'.$_REQUEST['editId'].'"';
$namevalue='docType="'.$docType.'",documentNo="'.$documentNo.'",countryId="'.$countryId.'",issueDate="'.$issueDates.'",expiryDate="'.$expiryDates.'",modifyBy="'.$_SESSION['userid'].'",modifyDate="'.date('Y-m-d').'"';
$update = updatelisting(_DOCUMENT_DETAILS_MASTER_,$namevalue,$where);
?>
<script>
parent.$('#pageloading').hide();
parent.alertspopupopenClose();
parent.$('#loadalertbox').hide();
parent.loaddocumentfunc();
</script>
<?php
}
// add bnak details
if($_REQUEST['action']=='addbankdetail' && $_REQUEST['sectionType']!=''  && $_REQUEST['masterId']!=''){
if($_POST['primaryvalue']==1){
$where='masterId="'.$_REQUEST['masterId'].'"';
$namevalue='primaryvalue=0';
$update = updatelisting(_BANK_DETAILS_MASTER_,$namevalue,$where);
}
$masterId=decode($_POST['masterId']);
$bankName=$_POST['bankName'];
$beneficiary=$_POST['beneficiary'];
$branch=$_POST['branch'];
$accountNumber=$_POST['accountNumber'];
$IFSCCode=$_POST['IFSCCode'];
$phoneNumber=$_POST['phoneNumber'];
$address=$_POST['address'];
$email=$_POST['email'];
$swiftCode=$_POST['swiftCode'];
$primaryvalue=$_POST['primaryvalue'];
$sectionType=$_POST['sectionType'];
?>
<script>
parent.$('#pageloading').hide();
</script>
<?php
$allvaluephone ='masterId="'.$masterId.'",bankName="'.$bankName.'",beneficiary="'.$beneficiary.'",branch="'.$branch.'",accountNumber="'.$accountNumber.'",IFSCCode="'.$IFSCCode.'",address="'.$address.'",email="'.$email.'",swiftCode="'.$swiftCode.'",primaryvalue="'.$primaryvalue.'",phoneNumber="'.$phoneNumber.'",sectionType="'.$sectionType.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
$add = addlisting(_BANK_DETAILS_MASTER_,$allvaluephone);
?>
<script>
parent.loadbankdetailsfunc();
parent.alertspopupopenClose();
parent.$('#loaderbox').hide();
</script>
<?php
}
if($_REQUEST['action']=='editbankdetail' && $_REQUEST['sectionType']!=''  && $_REQUEST['masterId']!=''  && $_REQUEST['editId']!=''){
if($_POST['primaryvalue']==1){
$where='masterId="'.decode($_REQUEST['masterId']).'"';
$namevalue='primaryvalue=0';
$update = updatelisting(_BANK_DETAILS_MASTER_,$namevalue,$where);
}
$masterId=decode($_POST['masterId']);
$bankName=$_POST['bankName'];
$beneficiary=$_POST['beneficiary'];
$branch=$_POST['branch'];
$accountNumber=$_POST['accountNumber'];
$IFSCCode=$_POST['IFSCCode'];
$address=$_POST['address'];
$phoneNumber=$_POST['phoneNumber'];
$email=$_POST['email'];
$swiftCode=$_POST['swiftCode'];
$primaryvalue=$_POST['primaryvalue'];
$sectionType=$_POST['sectionType'];
?>
<script>
parent.$('#pageloading').hide();
</script>
<?php
$where='id="'.$_REQUEST['editId'].'"';
$namevalue='bankName="'.$bankName.'",beneficiary="'.$beneficiary.'",branch="'.$branch.'",accountNumber="'.$accountNumber.'",IFSCCode="'.$IFSCCode.'",phoneNumber="'.$phoneNumber.'",address="'.$address.'",email="'.$email.'",swiftCode="'.$swiftCode.'",primaryvalue="'.$primaryvalue.'",modifyBy="'.$_SESSION['userid'].'",modifyDate="'.time().'"';
$update = updatelisting(_BANK_DETAILS_MASTER_,$namevalue,$where);
?>
<script>
parent.loadbankdetailsfunc();
parent.alertspopupopenClose();
parent.$('#loaderbox').hide();
</script>
<?php
} 
if(trim($_POST['action'])=='editsuppliers' && trim($_POST['name'])!='' && $_POST['editId']!=''){
	$checkduplicate='';
	$valuecont=0;
	while($valuecont <= $_POST['contactpCount']){
		$contprson=trim($_POST["contactPerson".$valuecont]);
		$designationcontprson=trim($_POST["designation".$valuecont]);
		$phonecontprson=trim($_POST["phone".$valuecont]);
		$emailcontprson=trim($_POST["email".$valuecont]);
		$secondemailcontprson=trim($_POST["secondemail".$valuecont]);
		$Idcontprson=trim($_POST["contactPId".$valuecont]);
		$contactPmailId=trim($_POST["contactPmailId".$valuecont]);
		$countryCode=trim($_POST["countryCode".$valuecont]);
		$division=trim($_POST["division".$valuecont]);
		$primaryval=trim($_POST["primaryvalue"]);
		if($primaryval==$valuecont){
			$primaryvalue=1;
		} else {
			$primaryvalue=0;
		}
		 
		if($emailcontprson!=''){
			if($Idcontprson!=''){
				$divisionCount = 1;
				if($division==3){ 
					$divisionQuery="";
					$divisionQuery='email="'.encode($emailcontprson).'" and division=3 and id!="'.$Idcontprson.'"';
					$divisionRs=GetPageRecord('*','suppliercontactPersonMaster',$divisionQuery);
					$divisionCount = mysqli_num_rows($divisionRs);
				}  
				
				if($divisionCount<1 || $division!=3){
					$allvaluecontactperson ='contactPerson="'.$contprson.'",corporateId="'.decode($_POST['editId']).'",designation="'.$designationcontprson.'",
					phone="'.encode($phonecontprson).'",email="'.encode($emailcontprson).'",countryCode="'.$countryCode.'",primaryvalue="'.$primaryvalue.'",division="'.$division.'", email1="'.encode($secondemailcontprson).'"';
					$wherecontactperson='id="'.$Idcontprson.'"';
					$updatecontactperson = updatelisting('suppliercontactPersonMaster',$allvaluecontactperson,$wherecontactperson);
				 
				}else{ 
					?>	
					<script>alert('This email is already exist...');
					parent.$('#pageloader').hide();
					parent.$('#pageloading').hide();
					</script>
					<?php 
					exit(); 
				}
			}else{
				if($phonecontprson!='' && $emailcontprson!=''){
					$divisionCount = 1;
					if($division==3){ 
						$divisionQuery="";
						$divisionQuery='email="'.encode($emailcontprson).'" and division=3 ';
						$divisionRs=GetPageRecord('*','suppliercontactPersonMaster',$divisionQuery);
						$divisionCount = mysqli_num_rows($divisionRs);
					}  
					if($divisionCount<1 || $division!=3){ 
 						$allvaluecontactperson ='contactPerson="'.$contprson.'",corporateId="'.decode($_POST['editId']).'",designation="'.$designationcontprson.'",
						phone="'.encode($phonecontprson).'",email="'.encode($emailcontprson).'",countryCode="'.$countryCode.'",primaryvalue="'.$primaryvalue.'",division="'.$division.'",email1="'.encode($secondemailcontprson).'"';
						$add = addlisting('suppliercontactPersonMaster',$allvaluecontactperson);
 					}else{ ?>
						<script>alert('This email is already exist...');
						parent.$('#pageloader').hide();
						parent.$('#pageloading').hide();
						</script>
						<?php 
						exit(); 
					}
				}
			}
		}
		$valuecont++;
	}
 
	$locationMap=($_POST['locationMap']);
	$insuranceType=($_POST['insuranceType']);
	$passportType=($_POST['passportType']);
	$visaType=($_POST['visaType']);
	$otherType=($_POST['otherType']);
	$companyTypeId=clean($_POST['companyTypeId']);
	$airlinesType=clean($_POST['airlinesType']);
	$transferType=clean($_POST['transferType']);
	$ferryType=clean($_POST['ferryType']);
	
	$sightseeingType=clean($_POST['sightseeingType']);
	$activityType=clean($_POST['activityType']);
	$entranceType=clean($_POST['entranceType']);
	$trainType=clean($_POST['trainType']);
	$guideType=clean($_POST['guideType']);
	$supplierMainType=clean($_POST['supplierMainType']);
	$mealType=clean($_POST['mealType']);
	$supplierNumber=clean($_POST['supplierNumber']);
	$name=clean($_POST['name']);
	
	// new added code Alias Name
	$creditlimit=clean($_POST['creditlimit']);
	$aliasname=clean($_POST['aliasname']);
	$status=clean($_POST['status']);
	$contactPerson=clean($_POST['contactPerson']);
	$countryId=clean($_POST['countryId']);
	$stateId=clean($_POST['stateId']);
	$cityId=clean($_POST['cityId']);
	$assignTo=decode($_POST['assignTo']);
	$address1=clean($_POST['address1']);
	$address2=clean($_POST['address2']);
	$address3=clean($_POST['address3']);
	$editedityes=clean($_POST['editedityes']);
	$pinCode=clean($_POST['pinCode']);
	$savenew=clean($_POST['savenew']);
	$categoryId=clean($_POST['categoryId']);
	$cruiseType=clean($_POST['cruiseType']);
	$expensesType=clean($_POST['expensesType']);
	$gstn=clean($_POST['gstn']);
	$agreementattachment2=$_POST['agreementattachment2'];
	$paymentTerm=$_POST['paymentTerm'];
	$image = clean($_POST['image']);
	$modifyBy='0';
	$dateAdded='0';

	$destinationWise = $_POST['destinationWise'];
	$destCountryId = $_POST['destCountryId'];
	$selectedDestinations = $_POST['destinationId'];

	if ($destinationWise == 1 && $destCountryId > 0) {
	    $select = '*';
	    $where = 'deletestatus = 0 AND countryId = ' . $destCountryId . ' AND status = 1 ORDER BY name ASC';
	    $rs = GetPageRecord($select, _DESTINATION_MASTER_, $where);
	    while ($resListing = mysqli_fetch_array($rs)) {
	        $selectedDestinations[] = $resListing['id'];
	    }
	}elseif ($destinationWise == 2) {
	    $select = '*';
	    $where = 'deletestatus = 0 AND status = 1 ORDER BY name ASC';
	    $rs = GetPageRecord($select, _DESTINATION_MASTER_, $where);
	    while ($resListing = mysqli_fetch_array($rs)) {
	        $selectedDestinations[] = $resListing['id'];
	    }
	}

	$destinationId = implode(',', array_unique($selectedDestinations));


	if($editedityes=='1'){
		$modifyBy=$_SESSION['userid'];
		$dateAdded=time();
	}

	if($_POST['agreement']==1){
		$time=time();
		if(!empty($_FILES['agreementattachment']['name'])){
			$file_name=$time.$_FILES['agreementattachment']['name'];
			copy($_FILES['agreementattachment']['tmp_name'],"dirfiles/".$file_name);
		} else {
			$file_name=$agreementattachment2;
		}
	}

		$namevalue ='companyTypeId="'.$companyTypeId.'",name="'.$name.'",aliasname="'.$aliasname.'",creditDays="'.$creditlimit.'",contactPerson="'.$contactPerson.'",status="'.$status.'",image="'.$image.'",assignTo="'.$assignTo.'",modifyBy="'.$modifyBy.'",modifyDate="'.$dateAdded.'",agreement="'.$file_name.'",categoryId="'.$categoryId.'",locationMap="'.$locationMap.'",airlinesType="'.$airlinesType.'",transferType="'.$transferType.'",sightseeingType="'.$sightseeingType.'",supplierMainType="'.$supplierMainType.'",paymentTerm="'.$paymentTerm.'",cruiseType="'.$cruiseType.'",otherType="'.$otherType.'",expensesType="'.$expensesType.'",supplierNumber="'.$supplierNumber.'",mealType="'.$mealType.'",activityType="'.$activityType.'",entranceType="'.$entranceType.'",ferryType="'.$ferryType.'",insuranceType="'.$insuranceType.'",passportType="'.$passportType.'",visaType="'.$visaType.'",trainType="'.$trainType.'",guideType="'.$guideType.'",countryWise="'.$destCountryId.'",destinationWise="'.$destinationWise.'",destinationId="'.$destinationId.'",destinationlist="'.$destinationId.'"';
		$where='id="'.decode($_POST['editId']).'"';
		$update = updatelisting(_SUPPLIERS_MASTER_,$namevalue,$where);
 	if($update=='yes'){
		///-----------------Adding In Logs---------------------
		if($editedityes=='yes'){
			generateLogs('suppliers','update',decode($_POST['editId']));
		} else {
			generateLogs('suppliers','add',decode($_POST['editId']));
		}
		///-----------------Adding In Logs End---------------------
			if($_POST['quotationSupplier']==='yes'){
				?>
				<script>
				
				parent.window.location.href='showpage.crm?module=suppliers&view=yes&id=<?php echo $_POST['editId']; ?>&queryId=<?php echo $_POST['queryId'] ?>&quotationId=<?php echo $_POST['quotationId'] ?>&quotSupp=yes&alt=2';
				</script>
				<?php
				exit();
			}else{

		if($savenew==1){
			?>
			<script>
			parent.window.location.href='showpage.crm?module=suppliers&add=yes&alt=2';
			</script>
			<?php exit(); } else { ?>
			<script>
			parent.window.location.href='showpage.crm?module=suppliers&view=yes&id=<?php echo $_POST['editId']; ?>&alt=2';
			</script>
			<?php
			exit();
		}
	}
	}
}



if(trim($_REQUEST['action'])=='suppliersdelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_SUPPLIERS_MASTER_,$namevalue,$where);
generateLogs('suppliers','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=suppliers&alt=3');
</script>
<?php
}

// edit contacts
if(trim($_POST['action'])=='editcontacts' && trim($_POST['firstName'])!='' && $_POST['editId']!=''){

	// Personal Information designation
	$contactType=clean($_POST['contactType']);
	$corporateId=clean($_POST['corporateId']);
	// $designationname=clean($_POST['designationname']);
	$status=clean($_POST['status']);
	$gradeId=clean($_POST['gradeId']);
	$designationName=clean($_POST['designationName']);
	$nationality=clean($_POST['nationality']);
	$contacttitleId=clean($_POST['contacttitleId']);
	$firstName=clean($_POST['firstName']);
	$middleName=clean($_POST['middleName']);
	$lastName=clean($_POST['lastName']);
	$gender=clean($_POST['gender']);
	$birthDate=clean($_POST['birthDate']);
	
	$guestAge=clean($_POST['guestAge']);
	$leadpaxstatus=clean($_POST['leadpaxstatus']);

	$anniversaryDate=($_POST['anniversaryDate']);
	$birthPlace=clean($_POST['birthPlace']);
	// Address Information
	$countryId=clean($_POST['country']);
	$stateId=clean($_POST['loadstates']);
	$cityId=clean($_POST['loadcities']);
	$pinzip=clean($_POST['pinzip']);
	$addressInfo=clean($_POST['addressInfo']);
	// Family Information
	$familyCode=clean($_POST['familyCode']);
	$familyRelation=clean($_POST['familyRelation']);
	// Preferances
	$mealPreference=clean($_POST['mealPreference']);
	$physicalCondition=clean($_POST['physicalCondition']);
	$seatPreference=clean($_POST['seatPreference']);
	$accomodationPreference=clean($_POST['accomodationPreference']);
	// Other
	$marketType=clean($_POST['marketType']);
	$preholydaypacs = implode(',', $_POST['preholydaypacs']);  
	// $preholydaypac=clean($_POST['preholydaypac']);
	$mobilePin=$_POST['mobilePin'];
	$Newsletter=$_POST['Newsletter'];
	$CovidVaccin=$_POST['CovidVaccin'];
	$Remarks1=$_POST['Remarks1'];
	$Remarks2=$_POST['Remarks2'];
	$Remarks3=$_POST['Remarks3'];
	// Emergency Contact Details
	$emergencyName=clean($_POST['emergencyName']);
	$emergencyRelation=clean($_POST['emergencyRelation']);
	$emergencyContact=clean($_POST['emergencyContact']);
	// Social Medial
	$facebook=clean($_POST['facebook']);
	$twitter=clean($_POST['twitter']);
	$linkedIn=clean($_POST['linkedIn']);
	$Instagram=clean($_POST['Instagram']);
	$SkypeId=clean($_POST['SkypeId']);
	$MSNId=clean($_POST['MSNId']);

	$designationId=clean($_POST['designationId']);
	$assignTo=decode($_POST['assignTo']);

	// $tourType=clean($_POST['tourType']);
	// $countryId=clean($_POST['countryId']);
	// $stateId=clean($_POST['stateId']);
	// $cityId=clean($_POST['cityId']);
	
	$address1=clean($_POST['address1']);
	$address2=clean($_POST['address2']);
	$address3=clean($_POST['address3']);
	
	$pinCode=clean($_POST['pinzip']);
	
	$tourId=clean($_POST['tourId']);
	$QueryId2=clean($_POST['QueryId2']);
	$QueryId=$_POST['QueryId'];
	$ReferenceNo=$_POST['ReferenceNo'];
	$AgentName=$_POST['AgentName'];
	
	$savenew=clean($_POST['savenew']);
	$editedityes=clean($_POST['editedityes']);

	
	// die("testing 001");
	$anniversaryDate=date("Y-m-d", strtotime($anniversaryDate));
	$birthDate=date("Y-m-d", strtotime($birthDate));
	$modifyBy='0';
	$dateAdded='0';
	if($editedityes=='1'){
		$modifyBy=$_SESSION['userid'];
		$dateAdded=time();
	}
	
	decode($_POST['editId']);
	$rsr=GetPageRecord('*','emailMaster','email="'.$_POST["Email1"].'" and emailType="7" and masterId!="'.decode($_POST['editId']).'"');
	// $editresult=mysqli_num_rows($rsr);
	if(mysqli_num_rows($rsr) > 0 && $contactType!=3){
		
        ?>
        <script>
        parent.alert('Main Email ID Already Exist!');
		parent.$('#pageloader').hide();
		parent.$('#pageloading').hide();
        </script> 
        <?php 
		exit();
		
    }else{
	$namevalue ='contacttitleId="'.$contacttitleId.'",queryId2="'.$QueryId2.'",agentName="'.$AgentName.'",referenceNo="'.$ReferenceNo.'",queryId="'.$QueryId.'",tourId="'.$tourId.'",firstName="'.$firstName.'",middleName="'.$middleName.'",lastName="'.$lastName.'",gender="'.$gender.'", designation="'.$designationname.'",birthPlace="'.$birthPlace.'",birthDate="'.$birthDate.'",guestAge="'.$guestAge.'",leadpaxstatus="'.$leadpaxstatus.'",anniversaryDate="'.$anniversaryDate.'",marketType="'.$marketType.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",pinzip="'.$pinzip.'",assignTo="'.$assignTo.'",address1="'.$addressInfo.'",address2="'.$address2.'",address3="'.$address3.'",modifyBy="'.$modifyBy.'",modifyDate="'.$dateAdded.'",pinCode="'.$pinCode.'",facebook="'.$facebook.'",Instagram="'.$Instagram.'",twitter="'.$twitter.'",linkedIn="'.$linkedIn.'",SkypeId="'.$SkypeId.'",MSNId="'.$MSNId.'",nationality="'.$nationality.'",familyCode="'.$familyCode.'",tourType="'.$tourType.'",familyRelation="'.$familyRelation.'",mealPreference="'.$mealPreference.'",physicalCondition="'.$physicalCondition.'",holyDayPacId="'.$preholydaypacs.'",preAccomodationMaster="'.$accomodationPreference.'",seatPreference="'.$seatPreference.'",mobilePin="'.$mobilePin.'",contactType="'.$contactType.'",corporateId="'.$corporateId.'",gradeId="'.$gradeId.'",designationName="'.$designationName.'",CovidVaccin="'.$CovidVaccin.'",Newsletter="'.$Newsletter.'",emergencyName="'.$emergencyName.'",emergencyRelation="'.$emergencyRelation.'",emergencyContact="'.$emergencyContact.'",remark1="'.$Remarks1.'",remark2="'.$Remarks2.'",remark3="'.$Remarks3.'",status="'.$status.'"';
	$where='id="'.decode($_POST['editId']).'"';
	$update = updatelisting(_CONTACT_MASTER_,$namevalue,$where);
	// if($update=='yes'){

	// Contact Information
	
	//-----------------------Add Email---------------------------
	$E_cnt = 0;
	while($E_cnt <= $_POST['phonecount']){

    
		$email=clean($_POST["Email".$E_cnt]);
		$emailType=clean($_POST["EmailTypeId".$E_cnt]);
		$EID=clean($_POST["EID".$E_cnt]);

		$phone=clean($_POST["PhoneNo".$E_cnt]);
		$countryCode=clean($_POST["countryCode".$E_cnt]);

		$phoneType=clean($_POST["PhoneTypeId".$E_cnt]);
		$PID=clean($_POST["PID".$E_cnt]);
        
        if(strlen($phone)<5){
            $phone='None';    
        }

		if(trim($_POST["EID".$E_cnt])>0){
			$checkQuery = ' and id!="'.$EID.'"';
		}else{
			$checkQuery = ' ';
		}
		
		if($email!=''){
    		$where='email="'.$email.'" and sectionType="contacts" '.$checkQuery.' ';
    		if(checkduplicate(_EMAIL_MASTER_,$where) == 'yes' && $contactType!=3){ ?>
    			<script>
    			parent.alert('<?php echo $email; ?> Email is already exists');
    			</script>
    			<?php
    		}else{
    
    			$primaryval=clean($_POST["primaryValue".$E_cnt]);
    			if($primaryval>0 && isset($_POST["primaryValue".$E_cnt])){
    				$primaryvalue=1;
    			}else{
    				$primaryvalue=0;
    			}
    			
    			// added for updating
    			if(trim($_POST["EID".$E_cnt])>0){
    				$selectee='*';
    				$whereee='id="'.$EID.'"';
    				$rsee=GetPageRecord($selectee,_EMAIL_MASTER_,$whereee);
    				$countcont=mysqli_num_rows($rsee);
    				if($countcont>0){
    				$allvalueemail ='email="'.$email.'",emailType="'.$emailType.'",primaryvalue="'.$primaryvalue.'",sectionType="contacts",masterId="'.decode($_POST['editId']).'"';
    					$whereEmail='id='.$EID.'';
    					$updateEmail = updatelisting(_EMAIL_MASTER_,$allvalueemail,$whereEmail);
    				} 
    			}else{ 
    				if($email!=''){
    					$allvaluephone ='email="'.$email.'",emailType="'.$emailType.'",primaryvalue="'.$primaryvalue.'",sectionType="contacts",masterId="'.decode($_POST['editId']).'"';
    					$EID = addlistinggetlastid(_EMAIL_MASTER_,$allvaluephone);
    				}
    			   
    			}
			}
		
		}
					// add phone numbers
					if(clean($_POST["PID".$E_cnt])>0){
						$wherePh = ' id="'.$PID.'"';
						$rsPH=GetPageRecord('*',_PHONE_MASTER_,$wherePh);
						if($countcontph = mysqli_num_rows($rsPH) >0){
							$allvaluePhoneup =' phoneNo="'.$phone.'",countryCode="'.$countryCode.'",phoneType="'.$phoneType.'",primaryvalue="'.$primaryvalue.'",sectionType="contacts",masterId="'.decode($_POST['editId']).'",EID="'.$EID.'"';
							$wherePhoneNo = ' id="'.$PID.'"';
							$updatePhoneNo = updatelisting(_PHONE_MASTER_,$allvaluePhoneup,$wherePhoneNo);
						}
						// die("mfff");
					}else{
						if($phone!=''){
							$allvaluephone ='phoneNo="'.$phone.'",countryCode="'.$countryCode.'",phoneType="'.$phoneType.'",primaryvalue="'.$primaryvalue.'",sectionType="contacts",masterId="'.decode($_POST['editId']).'",EID="'.$EID.'"';
							$add = addlisting(_PHONE_MASTER_,$allvaluephone);
						}
					
					}
    			
    	

		

		$E_cnt++; 
	}
	//-----------------------Add Document Details---------------------------
	while($documentvalues <= $_POST['documentcount']) {
		$documentType=clean($_POST["documentType".$documentvalues]);
		$documentType1=clean($_POST["documentType1".$documentvalues]);
		$documentNumber=clean($_POST["documentNumber".$documentvalues]);
		$issueDate=date("Y-m-d", strtotime($_POST["issueDate".$documentvalues]));
		 $expiryDate=date("Y-m-d", strtotime($_POST["expiryDate".$documentvalues]));
		$issueCountry=clean($_POST["issueCountry".$documentvalues]);
		$documentId=clean($_POST["documentId".$documentvalues]);
		$uploadDocument=clean($_POST["uploadDocument".$documentvalues]);
		$documentRequired=clean($_POST["documentRequired".$documentvalues]);
		$documenttitle=clean($_POST["documenttitle".$documentvalues]);


		if($documentType1==2){
			$cntdate = date("Y-m-d");
			$expiryDatew=date("Y-m-d", strtotime($_POST["expiryDate1".$documentvalues]));
	
			$diffwww = abs(strtotime($expiryDatew) - strtotime($cntdate));

			$years = floor($diffwww / (365*60*60*24));
			$months = floor(($diffwww - $years * 365*60*60*24) / (30*60*60*24));
			$days = floor(($diffwww - $years * 365*60*60*24 - $months*30*60*60*24)/ (60*60*24));

				if($months<=7 && $years <=0){
					?>
					<script>
						parent.alert('<?php ?> Passport expiry date should be greater than 200 days from travel date.');
					</script>
					<?php
					exit();
				}
				
		}


		if(!empty($_FILES["uploadDocument".$documentvalues]['name'])){
			$uploadDocument=str_replace(' ', '',$_FILES["uploadDocument".$documentvalues]['name']);
			echo $uploadDocument=time().'-'.$uploadDocument;
			copy($_FILES["uploadDocument".$documentvalues]['tmp_name'],"dirfiles/".$uploadDocument);
		}else{
		
			$uploadDocument= $_REQUEST["uploadoldDocument".$documentvalues];
		}

		$emailprimaryValue=clean($_POST['emailprimaryValue']);
		if($emailprimaryValue==$documentvalues){
			$primaryvalue=1;
		} else {
			$primaryvalue=0;
		}

		// added for updating
		// $issueDate1 = date("Y-m-d", strtotime($issueDate));
		// $expirydate1 = date("Y-m-d", strtotime($expiryDate));
		if(trim($_POST["documentId".$documentvalues])!=''){
			$selectdoc='*';
			$wheredoc='id='.$documentId.'';
			$rsdoc=GetPageRecord($selectdoc,'documentMaster',$wheredoc);
			$countcontdoc=mysqli_num_rows($rsdoc);
			if($countcontdoc>0){
				while($documents=mysqli_fetch_array($rsdoc)){
					$allvaluedoc ='docType="'.$documentType.'",docRequired="'.$documentRequired.'",documentNo="'.$documentNumber.'",issueDate="'.$issueDate.'",expiryDate="'.$expiryDate.'",countryId="'.$issueCountry.'",documentAttachment="'.$uploadDocument.'",documentTitle="'.$documenttitle.'",sectionType="contacts",masterId="'.decode($_POST['editId']).'"';
					$wheredocument='id='.$documentId.'';
					$updatecontactperson = updatelisting('documentMaster',$allvaluedoc,$wheredocument);
				}
			}

		}else{
			// added for updating end
			if($documentType!=''){
				$allvaluephone ='docType="'.$documentType.'",docRequired="'.$documentRequired.'",documentNo="'.$documentNumber.'",issueDate="'.$issueDate.'",expiryDate="'.$expiryDate.'",countryId="'.$issueCountry.'",documentAttachment="'.$uploadDocument.'",documentTitle="'.$documenttitle.'",sectionType="contacts",masterId="'.decode($_POST['editId']).'"';
				$add = addlisting('documentMaster',$allvaluephone);
				
			}
		}
	   $documentvalues++; 
	}
	///-----------------Adding In Logs---------------------
	if($editedityes=='1'){
		generateLogs('contacts','update',decode($_POST['editId']));
	} else {
		generateLogs('contacts','add',decode($_POST['editId']));
	}
	///-----------------Adding In Logs End---------------------
	if($savenew==1){
		?>
		<script>
			parent.window.location.href='showpage.crm?module=contacts&add=yes&alt=2';
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
		</script>
		<?php exit(); 
	}elseif($contactType==3) { ?>
		<script>
			parent.window.location.href='showpage.crm?module=contacts&guestList=3&queryId=<?php echo encode($_POST['QueryId2']); ?>&queryTourId=<?php echo trim($_POST['tourId']); ?>&alt=2';
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
		</script>
	
		<?php
		exit();
	}else{
		?>
		<script>
		parent.window.location.href='showpage.crm?module=contacts&view=yes&id=<?php echo $_POST['editId']; ?>alt=2';
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		</script>
		<?php
	}
}
} 
// contacts end

if(trim($_REQUEST['action'])=='contactsdelete'){
	$check_list=$_REQUEST['check_list'];
	if($check_list!=""){
		for($i=0;$i<=count($check_list)-1;$i++){
			$ansval=trim(decode($check_list[$i]));
			if(trim($ansval) != ''){
				$namevalue ='deletestatus="1"';
				$where='id="'.$ansval.'"';
				$update = updatelisting(_CONTACT_MASTER_,$namevalue,$where);
				generateLogs('Contacts','delete',$ansval);
			}
		}
	}
	if($_REQUEST['contactType'] == 3) { ?>
		<script>
		parent.setupbox('showpage.crm?module=contacts&guestList=3&queryId=<?php echo encode($_REQUEST['QueryId2']);?>&alt=3'); 
		</script>
		<?php
	}else{ ?>
		<script>
		parent.setupbox('showpage.crm?module=contacts&alt=3'); 
		</script>
		<?php
	}
}


if(trim($_POST['action'])=='addquery'  && trim($_POST['subject'])!='' && (trim($_POST['moduleType']) == 3 || trim($_POST['moduleType']) == 4 || trim($_POST['moduleType']) == 1) && $_POST['editId']!='' ){
	// die("L");
	include "config/mail.php";
	$totalQueryCost=clean($_POST['totalQueryCost']);
	$queryType=clean($_POST['queryType']);
	$travelType=clean($_POST['travelType']);
	$paxType=clean($_POST['paxType']);
	$savenew=clean($_POST['savenew']);
	$saveSeries=clean($_POST['saveSeries']);
	$incomingqueryId=clean($_POST['incomingqueryId']);

	$clientType=clean($_POST['clientType']);
	$companyId=decode($_POST['companyId']); 
	$seasonType2=clean($_POST['seasonType']); 
	// $nationality=clean($_POST['nationId']);
	// $marketType=clean($_POST['marketId']);
	$marketType = getMaketTypeIdByClient($companyId,$clientType);
	$nationality = getNationalityIdByClient($companyId,$clientType);


	$editId=decode($_POST['editId']);
	$companyName=clean($_POST['companyName']);
	$mealPlanId=clean($_POST['mealPlanId']);
	$adult=clean($_POST['adult']);
	if(isset($_POST['destinationId'])){
		foreach($_POST['destinationId'] as $k1=>$v1){
			$destinationId .= $_POST['destinationId'][$k1].',';
		}
	}
	$destinationId = str_replace('Array','',$destinationId);

	$destCountryId=$_POST['destCountryId'];

	if(isset($_POST['destCountryId'])){
		foreach($_POST['destCountryId'] as $k1=>$v1){
			$countryId .= $_POST['destCountryId'][$k1].',';
		}
	}
	$countryId = str_replace('Array','',$countryId);

	
	$child=clean($_POST['child']);
	$queryPriority=clean($_POST['queryPriority']);
	$categoryId=clean($_POST['categoryId']);
	$officeBranch=clean($_POST['officeBranch']);
	$assignTo=decode($_POST['assignTo']);
	$assignTo3=decode($_POST['assignTo3']);
	$salesPersonId=decode($_POST['salesPersonId']);
	// die("tedddd0001");
	$description=addslashes($_POST['description']);
	$guest1=clean($_POST['guest1']);
	$guest2=clean($_POST['guest2']);
	$guest1a=clean($_POST['guest1']);
	$tat=clean($_POST['tat']);
	$tourType=clean($_POST['tourType']);
	$subTourType=clean($_POST['subTourType']);
	$hotelTypeId=clean($_POST['hotelTypeId']);
	$subject=clean($_POST['subject']);
	$budget=clean($_POST['budget']); 
	//new field add in query
	$seriesCode=clean($_POST['seriesCode']);
	$FDCode=clean($_POST['FDCode']);
	$packageSupplier=clean(decode($_POST['packagesupplierId']));
	$packageCode=clean($_POST['packageCode']);
	$subName=clean($_POST['subName']);
	$multiemails=clean($_POST['multiemails']);
	$rooms=clean($_POST['rooms']);
	$occupancyType=clean($_POST['occupancyType']);
	$hotelBudget=clean($_POST['hotelBudget']);
	$guest1=clean($_POST['agentb2cname']);
	$guest1phone=clean($_POST['agentb2cnumber']);
	$guest1email=($_POST['agentb2cmail']);
	$paymentMode=($_POST['paymentMode']);
	$hotelAccommodation=($_POST['hotelAccommodation']);
	$earlyCheckin=($_POST['earlyCheckin']);
	$hotelCategory=($_POST['hotelCategory']);
	$cabforLocal=($_POST['cabforLocal']);
	// $expectedSales=($_POST['expectedSales']);
	$closerDate=($_POST['closerDate']);
	$quotationYes=($_POST['quotationYes']);
	$closerDate=date("Y-m-d", strtotime($closerDate));
	$leadsource=($_POST['leadsource']);
	$campaign=($_POST['campaign']);
	$competitor=($_POST['competitor']);
	
	$subDestination=($_POST['subDestination']);
	$single=($_POST['single']);
	$double=($_POST['double']);
	$triple=($_POST['triple']);
	$infant = clean($_POST['infant']);
	$age1=clean($_POST['age1']);
	$age2=clean($_POST['age2']);
	$age3=clean($_POST['age3']);
	$referanceno=clean($_POST['referanceno']);
	$filecode=clean($_POST['filecode']);
	$attachitinerary=$_POST['attachitinerary'];
	$fromdestinationId=$_POST['fromdestinationId'];
	$servicePrice=$_POST['servicePrice'];
	$gstState=$_POST['gstState'];
	$addnewcontactmain=$_POST['addnewcontactmain'];
	$preferredLang=$_POST['preferredLang'];
	$groupName=$_POST['groupName'];
	$groupCode=clean($_POST['groupCode']);
	$nationality=clean($_POST['nationId']);
	$marketType=clean($_POST['marketId']);
	$sglRoom=clean($_POST['sglRoom']);
	$dblRoom=clean($_POST['dblRoom']);
	$tplRoom=clean($_POST['tplRoom']);
	$twinRoom=clean($_POST['twinRoom']);
	$cwbRoom=clean($_POST['cwbRoom']);
	$cnbRoom=clean($_POST['cnbRoom']);

	$calculationType=clean($_POST['calculationType']);
	$tourType=clean($_POST['tourType']);
	$currencyId=clean($_POST['currencyId']);
	$currencyId=clean($_POST['currencyId']);

	$extraNoofBed=clean($_POST['extraNoofBed']);
	$sixNoofBedRoom=clean($_POST['sixNoofBedRoom']);
	$eightNoofBedRoom=clean($_POST['eightNoofBedRoom']);
	$tenNoofBedRoom=clean($_POST['tenNoofBedRoom']);
	$teenNoofRoom=clean($_POST['teenNoofRoom']);
	$quadNoofRoom=clean($_POST['quadNoofRoom']);
	$onlyTFS=clean($_POST['onlyTFS']);
	$needFlight=clean($_POST['needFlight']);
	$visaRequired=clean($_POST['visaRequired']);
	$insuranceRequired=clean($_POST['insuranceRequired']);
	$passportRequired=clean($_POST['passportRequired']);

	$needTrain=clean($_POST['needTrain']);
	$needTransfer=clean($_POST['needTransfer']);

	$childAge=clean($_POST['childAge']);
	// echo "testingqqqq";	
	foreach($_POST['childAge'] as $key => $value){
		$childAge .= $_POST['childAge'][$key].',';
	}
	
	$dateAdded=time();
	if(isset($_FILES['attachmentFile']['name'])){
		$file_name=$_FILES['attachmentFile']['name'];
		$file_name=time().'-'.$file_name;
		copy($_FILES['attachmentFile']['tmp_name'],"dirfiles/".$file_name);
		$attachmentvar=" <br><br><a href='".$fullurl."download/".$file_name."' target='_blank'><strong>Download Attachment</strong></a>";
	}
	
	// client Details
	if($addnewcontactmain=='1'){
		$dateAddeded=time();
			if($clientType=='1'){
				$namevalue ='name="'.$guest1.'",addedBy='.$_SESSION['userid'].',dateAdded='.$dateAddeded.'';
				$lstaddid=addlistinggetlastid(_CORPORATE_MASTER_,$namevalue);
				$allvaluecontactperson ='contactPerson="'.$guest1.'",corporateId="'.$lstaddid.'",designation=3,phone="'.$guest1phone.'",email="'.$guest1email.'",primaryvalue=1';
				addlisting('contactPersonMaster',$allvaluecontactperson); 
			}
			if($clientType=='2'){
				$namevalue ='firstName="'.$guest1.'",addedBy='.$_SESSION['userid'].',dateAdded='.$dateAddeded.'';
				$lstaddid=addlistinggetlastid(_CONTACT_MASTER_,$namevalue);
				$allvaluephone ='phoneNo="'.$guest1phone.'",phoneType=1,primaryvalue=1,sectionType="contacts",masterId="'.$lstaddid.'"';
				addlisting(_PHONE_MASTER_,$allvaluephone);
				$allvaluephone ='email="'.$guest1email.'",emailType=7,primaryvalue=1,sectionType="contacts",masterId="'.$lstaddid.'"';
				addlisting(_EMAIL_MASTER_,$allvaluephone);
			}
			$companyId=$lstaddid;
	}
	
	//Childrens age details
	$childfinalage='';
	$check_listchilds=$_POST['childrensage'];
	if($check_listchilds!=""){
		for($i=0;$i<=count($check_listchilds)-1;$i++)
		{
			$valchild=trim($check_listchilds[$i]);
			if(trim($valchild) != ''){
				$childfinalage.=$valchild.',';
			} 
		} 
	}
	 
	//upload Photo
	if(isset($_FILES['uploadPhoto']['name'])){
		$uploadPhoto=str_replace(' ', '',$_FILES['uploadPhoto']['name']);
		$uploadPhoto=time().'-'.$uploadPhoto;
		copy($_FILES['uploadPhoto']['tmp_name'],"dirfiles/".$uploadPhoto);
	}
	
	// 1 Normal
	// 2 Series
	// 3 FD
	// 4 Package
	// 5 Duplicate Query
	// 6 Train Package
	// if query imported from series/packages than copy data
	// echo $_REQUEST['quotationId'];
	if(!empty($_REQUEST['quotationId']) && isset($_REQUEST['quotationId']) && $queryType>0){
		// $dayWise = 1;
		$quotSql="";
		$quotSql=GetPageRecord('*',_QUOTATION_MASTER_,'id="'.decode($_REQUEST['quotationId']).'"  ');  
		if(mysqli_num_rows($quotSql)>0 ){ 
			$quotationData=mysqli_fetch_array($quotSql);
			$dayWise = $quotationData['dayWise'];
			if($queryType == 4){ 
				$packageSupplier = $quotationData['packageSupplier']; 
				$calculationType = $quotationData['calculationType']; 
			}

			// $dayWise = 1;

			$dayWise=clean($_POST['dayWise']); 

			$fromDate=date("Y-m-d", strtotime($quotationData['fromDate'])); 
			$toDate=date("Y-m-d", strtotime($quotationData['toDate']));
			$objec=date_diff(date_create($fromDate),date_create($toDate));
			$t_night = $objec->format("%a"); 
			 
			// get the season and Season Year 
			$seasonYear = date('Y',strtotime($fromDate));
			if(strtotime($fromDate)>=strtotime($seasonYear.'-04-01') || strtotime($fromDate)<=strtotime($seasonYear.'-09-30')) {
				$seasonType=1;
			}else{
				$seasonType=2;
			} 
			

			//make displayId or queryId according to financial Year
			// Pakage id block
			if($_POST['moduleType']=='3'){
				$displayId=0;
			}elseif($_POST['moduleType']=='4'){
				$rsd=GetPageRecord('packageId,id',_QUERY_MASTER_,' deletestatus=0 and packageId>0 order by packageId desc ');
				if(mysqli_num_rows($rsd)>0){
					$package=mysqli_fetch_array($rsd);
					$packageId = $package['packageId'];
					
				}else{
					$packageId=0;
				}
				$newPackageId = $packageId+1;
			}else{
				// get the new displayId for this tourdate
			}

			// displayId and financial year should from current date.
			$queryDate=date('Y-m-d');
			$displayId = generateQueryId($queryDate);
			// get the right financial year
			$financeYear = getFinancialYear($queryDate);


			$rschk2="";
			$destinationId = "";
			$rschk2=GetPageRecord('*','newQuotationDays',' quotationId="'.$quotationData['id'].'" and deletestatus=0 and addstatus=0 order by srdate asc');  
			if( mysqli_num_rows($rschk2) > 0 ){
				while($packQueryData = mysqli_fetch_array($rschk2)){
					$destinationId .= $packQueryData['cityId'].',';
				}				
			} 
			// extraNoofBed
			// add new code goes here  calculationType currencyId
			
			 $namevalue ='companyId="'.$companyId.'",packageId="'.$newPackageId.'",countryId="'.$countryId.'",leadPaxName="'.addslashes($guest1a).'",deletestatus=0,queryDate="'.$queryDate.'",attachmentFile="'.$file_name.'",adult="'.$adult.'",destinationId="'.$destinationId.'",child="'.$child.'",infant="'.$infant.'",categoryId="'.$categoryId.'",mealPlanId="'.$mealPlanId.'",officeBranch="'.$officeBranch.'",assignTo="'.$assignTo.'",assignTo3="'.$assignTo3.'",salesPersonId="'.$salesPersonId.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",night="'.$t_night.'",tourType="'.$tourType.'",subTourType="'.$subTourType.'",hotelTypeId="'.$hotelTypeId.'",paxType="'.$paxType.'",queryType="'.$queryType.'",travelType="'.$travelType.'",subject="'.$subject.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",guest1="'.$guest1.'",guest2="'.$guest2.'",queryPriority="'.$queryPriority.'",clientType="'.$clientType.'",tat="'.$tat.'",queryTimer="'.time().'",rooms="'.$rooms.'",hotelBudget="'.$hotelBudget.'",guest1email="'.$guest1email.'",guest1phone="'.$guest1phone.'",paymentMode="'.$paymentMode.'",expectedSales="'.$budget.'",closerDate="'.$closerDate.'",leadsource="'.$leadsource.'",campaign="'.$campaign.'",competitor="'.$competitor.'",subDestination="'.$subDestination.'",age1="'.$age1.'",age2="'.$age2.'",age3="'.$age3.'",referanceno="'.$referanceno.'",filecode="'.$filecode.'",single="'.$single.'",doubleocp="'.$double.'",triple="'.$triple.'",childrensage="'.$childfinalage.'",servicePrice="'.$servicePrice.'",quotationYes="'.$quotationYes.'",fromdestinationId="'.$fromdestinationId.'",queryOrder="'.time().'",tatDate="'.date('Y-m-d H:i:s', strtotime("+".$tat." min")).'",tatNumber=0,queryStatus="10",hotelAccommodation="'.$hotelAccommodation.'",earlyCheckin="'.$earlyCheckin.'",hotelCategory="'.$hotelCategory.'",cabforLocal="'.$cabforLocal.'",displayId="'.$displayId.'",mailId="'.$_REQUEST['mailId'].'",gstState="'.$gstState.'",uploadPhoto="'.$uploadPhoto.'",dayWise="'.$dayWise.'",seasonType="'.$seasonType.'",seasonYear="'.$seasonYear.'",additionalInfo="'.addslashes($_POST['additionalInfo']).'",groupName="'.addslashes($_POST['groupName']).'",groupCode="'.addslashes($_POST['groupCode']).'",preferredLang="'.addslashes($_POST['preferredLang']).'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",twinRoom="'.$twinRoom.'",nationality="'.$nationality.'",marketType="'.$marketType.'",cwbRoom="'.$cwbRoom.'",cnbRoom="'.$cnbRoom.'",extraNoofBed="'.$extraNoofBed.'",vehicleId="'.addslashes($_POST['vehicleId']).'",departureDest="'.addslashes($_POST['departureDest']).'",salesassignTo="'.addslashes($_POST['salesassignTo']).'",seriesCode="'.$seriesCode.'",FDCode="'.$FDCode.'",packageSupplier="'.$packageSupplier.'",packageCode="'.$packageCode.'",subName="'.$subName.'",sixNoofBedRoom="'.$sixNoofBedRoom.'",eightNoofBedRoom="'.$eightNoofBedRoom.'",tenNoofBedRoom="'.$tenNoofBedRoom.'",teenNoofRoom="'.$teenNoofRoom.'",quadNoofRoom="'.$quadNoofRoom.'",childAge="'.$childAge.'",moduleType=1,onlyTFS="'.$onlyTFS.'",needFlight="'.$needFlight.'",needVisa="'.$visaRequired.'",needInsurance="'.$insuranceRequired.'",needPassport="'.$passportRequired.'",needTrain="'.$needTrain.'",needTransfer="'.$needTransfer.'",financeYear="'.$financeYear.'",calculationType="'.$calculationType.'",currencyId="'.$baseCurrencyId.'",expire_date="'.$expire_date.'"';

			// die("oooo123");
			$lastQueryId = addlistinggetlastid(_QUERY_MASTER_,$namevalue);
			$statusId=10;
			$notes="Created";
			
			// Copy the packageQueryDays Data to new 
			$rschk2="";
			$rschk2=GetPageRecord('*','newQuotationDays',' quotationId="'.$quotationData['id'].'" and addstatus=0 order by srdate asc');  
			if( mysqli_num_rows($rschk2) > 0 ){
				$day =1;   
				while($packQueryData = mysqli_fetch_array($rschk2)){
					$date = date('Y-m-d', strtotime($packQueryData['srdate']));
					
					$namevalue ='lastdeleted=1,cityId="'.$packQueryData['cityId'].'",srdate="'.$date.'",srn="'.$day.'",queryId="'.$lastQueryId.'",packageId="'.$lastQueryId.'"';
					$lastId = addlistinggetlastid('packageQueryDays',$namevalue); 
					$day++;
				}				
			} 
			$editId = $lastQueryId;
			
		
			//Duplicate subseries to new quotation with new query
			if($quotationData['isFD']==1){
				$FDID = $quotationData['id']; 
			}
			$queryId = $quotationData['queryId']; 
			$quotationId = $quotationData['id'];
			
			$rsp1="";
			$rsp1=GetPageRecord('quotationNo',_QUOTATION_MASTER_,' queryId="'.$lastQueryId.'" order by quotationNo desc');
			$quotationNo=mysqli_fetch_array($rsp1);
			if($quotationNo['quotationNo']!=''){
				//this is greater than first
				$letterAscii = ord($quotationNo['quotationNo']);
				$letterAscii++;
				$quotationNo = chr($letterAscii);
			}else{
				$quotationNo = "A";
			}

			$q_token = mt_rand(10000000, 99999999); 

			$namevalue='clientType="'.$clientType.'",queryId="'.$lastQueryId.'",companyId="'.$companyId.'",quotationSubject="'.$quotationData['quotationSubject'].'",travelDate="'.$quotationData['travelDate'].'",queryDate="'.$quotationData['queryDate'].'",fromDate="'.$quotationData['fromDate'].'",toDate="'.$quotationData['toDate'].'",officeBranch="'.$quotationData['officeBranch'].'",destinationId="'.$quotationData['destinationId'].'",adult="'.$adult.'",child="'.$child.'",night="'.$quotationData['night'].'",rooms="'.$quotationData['rooms'].'",infant="'.$infant.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",twinRoom="'.$twinRoom.'",childwithNoofBed="'.$cwbRoom.'",childwithoutNoofBed="'.$cnbRoom.'",extraNoofBed="'.$extraNoofBed.'",totalpax="'.$totalpax.'",departureDestinationId="'.$quotationData['departureDestinationId'].'",guest1="'.$guest1.'",categoryId="'.$quotationData['categoryId'].'",modifyBy="'.$_SESSION['userid'].'",markup="'.$quotationData['markup'].'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'",modifyDate="'.$quotationData['modifyDate'].'",deletestatus="'.$quotationData['deletestatus'].'",quotationId="'.$quotationData['id'].'",starRating="'.$quotationData['starRating'].'",totalAmount="'.$quotationData['totalAmount'].'",totalClientCost="'.$quotationData['totalClientCost'].'",markupType="'.$quotationData['markupType'].'",serviceTax="'.$quotationData['serviceTax'].'",tcs="'.$quotationData['tcs'].'",finalQuotationType="'.$quotationData['finalQuotationType'].'",currencyId="'.$quotationData['currencyId'].'",queryType="'.$queryType.'",travelType="'.$travelType.'",cost2person="'.$quotationData['cost2person'].'",image="'.$quotationData['image'].'",flightCostType="'.$quotationData['flightCostType'].'",quotationType="'.$quotationData['quotationType'].'",hotCategory="'.$quotationData['hotCategory'].'",hotelType="'.$quotationData['hotelType'].'",otherLocation="'.$quotationData['otherLocation'].'",otherLocationCost="'.$quotationData['otherLocationCost'].'",isOtherLocation="'.$quotationData['isOtherLocation'].'",inclusion="'.addslashes($quotationData['inclusion']).'",exclusion="'.addslashes($quotationData['exclusion']).'",isInc_exc="'.$quotationData['isInc_exc'].'",quotationNo="'.$quotationNo.'",generateNo="'.$quotationData['generateNo'].'",finalcategory="'.$quotationData['finalcategory'].'",dayroe="'.$quotationData['dayroe'].'",isSer_Mark="'.$quotationData['isSer_Mark'].'",lostStatus="'.$quotationData['lostStatus'].'",isAddExp="'.$quotationData['isAddExp'].'",overviewText="'.addslashes($quotationData['overviewText']).'",highlightsText="'.addslashes($quotationData['highlightsText']).'",tncText="'.addslashes($quotationData['tncText']).'",specialText="'.addslashes($quotationData['specialText']).'",proposalType="'.$quotationData['proposalType'].'",isTransport="'.$quotationData['isTransport'].'",isUni_Mark="'.$quotationData['isUni_Mark'].'",isPaymentRequest="'.$quotationData['isPaymentRequest'].'",departureDate="'.$quotationData['departureDate'].'",asOnDate="'.$quotationData['asOnDate'].'",voucherNumber="'.$quotationData['voucherNumber'].'",voucherReferanceNumber="'.$quotationData['voucherReferanceNumber'].'",voucherDate="'.$quotationData['voucherDate'].'",isSupp_TRR="'.$quotationData['isSupp_TRR'].'",discount="'.$quotationData['discount'].'",discountType="'.$quotationData['discountType'].'",costType="'.$quotationData['costType'].'",languageId="'.$quotationData['languageId'].'",deletestatusDuplicate="'.$quotationData['deletestatusDuplicate'].'",subName="'.clean($_POST['subName']).'",isSeries=0,isFD=0,issueDate="'.$quotationData['issueDate'].'",q_token="'.encode($q_token).'",onlyTFS="'.$quotationData['onlyTFS'].'",insuranceRequired="'.$quotationData['insuranceRequired'].'",visaRequired="'.$quotationData['visaRequired'].'",passportRequired="'.$quotationData['passportRequired'].'",flightRequired="'.$quotationData['flightRequired'].'",calculationType="'.$quotationData['calculationType'].'",slabAndRoomType="'.$quotationData['slabAndRoomType'].'",gstType="'.$quotationData['gstType'].'",packageSupplier="'.$quotationData['packageSupplier'].'",sixNoofBedRoom="'.$sixNoofBedRoom.'",eightNoofBedRoom="'.$eightNoofBedRoom.'",tenNoofBedRoom="'.$tenNoofBedRoom.'",teenNoofRoom="'.$teenNoofRoom.'",quadNoofRoom="'.$quadNoofRoom.'",transferRequired="'.$quotationData['transferRequired'].'",trainRequired="'.$quotationData['trainRequired'].'",dayWise="'.$quotationData['dayWise'].'",FDID="'.$FDID.'"';
				$lastQuotationId = addlistinggetlastid(_QUOTATION_MASTER_,$namevalue);
			
				// duplicate pax slab lists
				$totalPaxRange = ($quotationData['adult']+$quotationData['child']);
				$totalPaxRangeN = ($adult+$child);
				$b='';
				$b=GetPageRecord('*','totalPaxSlab',' quotationId="'.$quotationId.'" and '.$totalPaxRange.' BETWEEN fromRange and toRange');
				if(mysqli_num_rows($b)>0){
					while($slabData=mysqli_fetch_array($b)){
						
						$addHotel = '';
						if($queryType==4){
						$DF_SGL = round($sglRoom);
						$DF_DBL = round($dblRoom*2);
						$DF_TWN = round($twinRoom*2);
						$DF_TPL = round($tplRoom*3);
						$DF_QUAD = round($quadNoofRoom*4);
						$DF_SIX = round($sixNoofBedRoom*6);
						$DF_EIGHT = round($eightNoofBedRoom*8);
						$DF_TEN = round($tenNoofBedRoom*10);
						$DF_ABED = round($extraNoofBed);
						$DF_CBED = round($cwbRoom+$cnbRoom+$teenNoofRoom);
						$DF_INF = round($infant);
						$discount_INF = round($infant);
						}else{
							$DF_SGL = round($slabData['DF_SGL']);
							$DF_DBL = round($slabData['DF_DBL']);
							$DF_TWN = round($slabData['DF_TWN']);
							$DF_TPL = round($slabData['DF_TPL']);
							$DF_QUAD = round($slabData['DF_QUAD']);
							$DF_SIX = round($slabData['DF_SIX']);
							$DF_EIGHT = round($slabData['DF_EIGHT']);
							$DF_TEN = round($slabData['DF_TEN']);
							$DF_ABED = round($slabData['DF_ABED']);
							$DF_CBED = round($slabData['DF_CBED']);
							$DF_INF = round($slabData['DF_INF']);
							$discount_INF = round($slabData['discount_INF']);
						}
						$modevalue= 'quotationId="'.$lastQuotationId.'", fromRange="'.$totalPaxRangeN.'", toRange="'.$totalPaxRangeN.'", localEscort="'.$slabData['localEscort'].'", foreignEscort="'.$slabData['foreignEscort'].'", dividingFactor="'.$totalPaxRangeN.'", status=1, dateAdded="'.$slabData['dateAdded'].'", modifyDate="'.$slabData['modifyDate'].'", modifyBy="'.$slabData['modifyBy'].'",dividingFactorC="'.$slabData['dividingFactorC'].'", DF_SGL="'.$DF_SGL.'", DF_DBL="'.$DF_DBL.'", DF_TWN="'.$DF_TWN .'", DF_TPL="'.$DF_TPL.'", DF_QUAD="'.$DF_QUAD.'", DF_SIX="'.$DF_SIX.'", DF_EIGHT="'.$DF_EIGHT.'", DF_TEN="'.$DF_TEN.'", DF_ABED="'.$DF_ABED.'", DF_CBED="'.$DF_CBED.'",discount_INF="'.$discount_INF.'",DF_INF="'.$DF_INF.'",adult="'.$adult.'",child="'.$child.'",infant="'.$infant.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",twinRoom="'.$twinRoom.'",tplRoom="'.$tplRoom.'",quadNoofRoom="'.$quadNoofRoom.'",sixNoofBedRoom="'.$sixNoofBedRoom.'",eightNoofBedRoom="'.$eightNoofBedRoom.'",tenNoofBedRoom="'.$tenNoofBedRoom.'",teenNoofRoom="'.$teenNoofRoom.'",extraNoofBed="'.$extraNoofBed.'",childwithNoofBed="'.$cwbRoom.'",childwithoutNoofBed="'.$cnbRoom.'"';
						$slabId = addlistinggetlastid('totalPaxSlab',$modevalue);

						$esQ="";
						$esQ=GetPageRecord('*','quotationFOCRates',' slabId="'.$slabData['id'].'" and quotationId="'.$slabData['quotationId'].'"');
						if(mysqli_num_rows($esQ) > 0){
							while($escortData=mysqli_fetch_array($esQ)){
								$focRatesQuery = '';  
								$focRatesQuery ='quotationId="'.$lastQuotationId.'",slabId="'.$slabId.'",sglNORoom="'.$escortData['sglNORoom'].'",dblNORoom="'.$escortData['dblNORoom'].'",tplNORoom="'.$escortData['tplNORoom'].'",focType="'.$escortData['focType'].'",hotelCost="'.$escortData['hotelCost'].'",guideCost="'.$escortData['guideCost'].'",activityCost="'.$escortData['activityCost'].'",entranceCost="'.$escortData['entranceCost'].'",transferCost="'.$escortData['transferCost'].'",trainCost="'.$escortData['trainCost'].'",flightCost="'.$escortData['flightCost'].'",restaurantCost="'.$escortData['restaurantCost'].'",otherCost="'.$escortData['otherCost'].'",hotelCalType="'.$escortData['hotelCalType'].'",guideCalType="'.$escortData['guideCalType'].'",activityCalType="'.$escortData['activityCalType'].'",entranceCalType="'.$escortData['entranceCalType'].'",transferCalType="'.$escortData['transferCalType'].'",trainCalType="'.$escortData['trainCalType'].'",flightCalType="'.$escortData['flightCalType'].'",restaurantCalType="'.$escortData['restaurantCalType'].'",otherCalType="'.$escortData['otherCalType'].'"';
								$focRateId = addlistinggetlastid('quotationFOCRates',$focRatesQuery);
							} 
						}
					}
				}
				
				
				$rs=GetPageRecord('*','newQuotationDays',' quotationId="'.$quotationId.'" and addstatus=0 order by srdate asc');
				while($QueryDaysData=mysqli_fetch_array($rs)){
			
					$adddays='';
					$srDaysDate  = date('Y-m-d', strtotime($QueryDaysData['srdate']));
					$namevalue =' queryId="'.$lastQueryId.'",cityId="'.$QueryDaysData['cityId'].'",quotationId="'.$lastQuotationId.'",srdate="'.$srDaysDate.'",title="'.$QueryDaysData['title'].'",description="'.$QueryDaysData['description'].'"';
					$adddays = addlistinggetlastid('newQuotationDays',$namevalue);
			 
					$b=GetPageRecord('*',_QUOTATION_HOTEL_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and supplierId in ( select serviceId from quotationItinerary where serviceType="hotel" order by serviceId asc ) and (isGuestType=1 or isLocalEscort=1 or isForeignEscort=1) and isRoomSupplement=0 and isHotelSupplement=0 order by id asc');

					while($HotelRes=mysqli_fetch_array($b)) {
						if($HotelRes['isEarlyCheckin']==1){
							// only for Early Arrival date change
							$srDaysDate = date('Y-m-d', strtotime("-1 day", strtotime($fromDate)));
						}

						if($queryType != 4){ $packageSupplier = $HotelRes['supplierMasterId']; }
						$namevalue ='';
						$addHotel ='';
						$namevalue ='hotelName="'.$HotelRes['hotelName'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",checkin="'.$HotelRes['checkin'].'",checkout="'.$HotelRes['checkout'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",destinationId="'.$HotelRes['destinationId'].'",categoryId="'.$HotelRes['categoryId'].'",hotelTypeId="'.$HotelRes['hotelTypeId'].'",roomTariffId="'.$HotelRes['roomTariffId'].'",currencyId="'.$HotelRes['currencyId'].'",currencyValue="'.$HotelRes['currencyValue'].'",supplierId="'.$HotelRes['supplierId'].'",supplierMasterId="'.$packageSupplier.'",mealPlan="'.$HotelRes['mealPlan'].'",night="'.$HotelRes['night'].'",status="'.$HotelRes['status'].'",address="'.$HotelRes['address'].'",roomprice="'.$HotelRes['roomprice'].'",noofrooms="'.$HotelRes['noofrooms'].'",roomType="'.$HotelRes['roomType'].'",tariffType="'.$HotelRes['tariffType'].'",quotTotalNight="'.$HotelRes['quotTotalNight'].'",hotelQuotatoinType="'.$HotelRes['hotelQuotatoinType'].'",singleoccupancy="'.$HotelRes['singleoccupancy'].'",doubleoccupancy="'.$HotelRes['doubleoccupancy'].'",tripleoccupancy="'.$HotelRes['tripleoccupancy'].'",twinoccupancy="'.$HotelRes['twinoccupancy'].'",childwithbed="'.$HotelRes['childwithbed'].'",childwithoutbed="'.$HotelRes['childwithoutbed'].'",lunch="'.$HotelRes['lunch'].'",dinner="'.$HotelRes['dinner'].'",extraadult="'.$HotelRes['extraadult'].'",taxType="'.$HotelRes['taxType'].'",markupType="'.$HotelRes['markupType'].'",sglMarkup="'.$HotelRes['sglMarkup'].'",dblMarkup="'.$HotelRes['dblMarkup'].'",twinMarkup="'.$HotelRes['twinMarkup'].'",tplMarkup="'.$HotelRes['tplMarkup'].'",cwbMarkup="'.$HotelRes['cwbMarkup'].'",quadMarkup="'.$HotelRes['quadMarkup'].'",sixMarkup="'.$HotelRes['sixMarkup'].'",eightMarkup="'.$HotelRes['eightMarkup'].'",tenMarkup="'.$HotelRes['tenMarkup'].'",teenMarkup="'.$HotelRes['teenMarkup'].'",cnbMarkup="'.$HotelRes['cnbMarkup'].'",exMarkup="'.$HotelRes['exMarkup'].'",mealMarkup="'.$HotelRes['mealMarkup'].'",singleNoofRoom="'.$sglRoom.'",doubleNoofRoom="'.$dblRoom.'",tripleNoofRoom="'.$tplRoom.'",twinNoofRoom="'.$twinRoom.'",childwithNoofBed="'.$cwbRoom.'",childwithoutNoofBed="'.$cnbRoom.'",extraNoofBed="'.$extraNoofBed.'",paymentMode="'.$HotelRes['paymentMode'].'",agentCode="'.$HotelRes['agentCode'].'",fileNo="'.$HotelRes['fileNo'].'",confirmation="'.$HotelRes['confirmation'].'",arrivalBy="'.$HotelRes['arrivalBy'].'",departureBy="'.$HotelRes['departureBy'].'",specialRequest="'.$HotelRes['specialRequest'].'",remark="'.$HotelRes['remark'].'",tourManager="'.$HotelRes['tourManager'].'",harrivalon="'.$HotelRes['harrivalon'].'",hfrom="'.$HotelRes['hfrom'].'",hbyfrom="'.$HotelRes['hbyfrom'].'",hatfrom="'.$HotelRes['hatfrom'].'",hdepartureon="'.$HotelRes['hdepartureon'].'",hto="'.$HotelRes['hto'].'",hbyto="'.$HotelRes['hbyto'].'",hatto="'.$HotelRes['hatto'].'",supplementCostAdded="'.$HotelRes['supplementCostAdded'].'",isHotelSupplement="'.$HotelRes['isHotelSupplement'].'",isRoomSupplement="'.$HotelRes['isRoomSupplement'].'",rand_color="'.$HotelRes['rand_color'].'",hotelQuoteId="'.$HotelRes['hotelQuoteId'].'",breakfast="'.$HotelRes['breakfast'].'",extraBed="'.$HotelRes['extraBed'].'",roomGST="'.$HotelRes['roomGST'].'",mealGST="'.$HotelRes['mealGST'].'",TAC="'.$HotelRes['TAC'].'",complimentaryLunch="'.$HotelRes['complimentaryLunch'].'",complimentaryDinner="'.$HotelRes['complimentaryDinner'].'",complimentaryBreakfast="'.$HotelRes['complimentaryBreakfast'].'",isChildBreakfast="'.$HotelRes['isChildBreakfast'].'",isChildLunch="'.$HotelRes['isChildLunch'].'",isChildDinner="'.$HotelRes['isChildDinner'].'",startDayDate="'.$HotelRes['startDayDate'].'",endDayDate="'.$HotelRes['endDayDate'].'",escortHotelStatus="'.$HotelRes['escortHotelStatus'].'",escortType="'.$HotelRes['escortType'].'",isGuestType="'.$HotelRes['isGuestType'].'",isLocalEscort="'.$HotelRes['isLocalEscort'].'",isForeignEscort="'.$HotelRes['isForeignEscort'].'",isEarlyCheckin="'.$HotelRes['isEarlyCheckin'].'"';

						$addHotel = addlistinggetlastid(_QUOTATION_HOTEL_MASTER_,$namevalue);

						$check_h=GetPageRecord('*','quotationItinerary',' queryId="'.$HotelRes['queryId'].'" and dayId="'.$adddays.'" and quotationId="'.$lastQuotationId.'" and serviceId="'.$HotelRes['supplierId'].'"');
						if(mysqli_num_rows($check_h)==0){
							$namevalue ='';
							$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$HotelRes['supplierId'].'",quotationId="'.$lastQuotationId.'",serviceType="hotel",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
							addlistinggetlastid('quotationItinerary',$namevalue);
						}

						// supplement
						$hotelSuppQuery=GetPageRecord('*',_QUOTATION_HOTEL_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and hotelQuoteId="'.$HotelRes['id'].'" and (isRoomSupplement=1 or isHotelSupplement=1) order by id asc');
						while($hotelSuppD=mysqli_fetch_array($hotelSuppQuery)){
							if($queryType != 4){ $packageSupplier = $hotelSuppD['supplierMasterId']; }
							$namevalue ='';
							$namevalue ='hotelName="'.$hotelSuppD['hotelName'].'",fromDate="'.$hotelSuppD['fromDate'].'",toDate="'.$hotelSuppD['toDate'].'",checkin="'.$hotelSuppD['checkin'].'",checkout="'.$hotelSuppD['checkout'].'",queryId="'.$hotelSuppD['queryId'].'",quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",destinationId="'.$hotelSuppD['destinationId'].'",categoryId="'.$hotelSuppD['categoryId'].'",roomTariffId="'.$hotelSuppD['roomTariffId'].'",currencyId="'.$hotelSuppD['currencyId'].'",currencyValue="'.$hotelSuppD['currencyValue'].'",supplierId="'.$hotelSuppD['supplierId'].'",supplierMasterId="'.$packageSupplier.'",mealPlan="'.$hotelSuppD['mealPlan'].'",night="'.$hotelSuppD['night'].'",status="'.$hotelSuppD['status'].'",address="'.$hotelSuppD['address'].'",roomprice="'.$hotelSuppD['roomprice'].'",noofrooms="'.$hotelSuppD['noofrooms'].'",roomType="'.$hotelSuppD['roomType'].'",tariffType="'.$hotelSuppD['tariffType'].'",quotTotalNight="'.$hotelSuppD['quotTotalNight'].'",hotelQuotatoinType="'.$hotelSuppD['hotelQuotatoinType'].'",singleoccupancy="'.$hotelSuppD['singleoccupancy'].'",doubleoccupancy="'.$hotelSuppD['doubleoccupancy'].'",twinoccupancy="'.$hotelSuppD['twinoccupancy'].'",tripleoccupancy="'.$hotelSuppD['tripleoccupancy'].'",quadoccupancy="'.$hotelSuppD['quadoccupancy'].'",childwithbed="'.$hotelSuppD['childwithbed'].'",childwithoutbed="'.$hotelSuppD['childwithoutbed'].'",lunch="'.$hotelSuppD['lunch'].'",dinner="'.$hotelSuppD['dinner'].'",extraadult="'.$hotelSuppD['extraadult'].'",paymentMode="'.$hotelSuppD['paymentMode'].'",agentCode="'.$hotelSuppD['agentCode'].'",fileNo="'.$hotelSuppD['fileNo'].'",confirmation="'.$hotelSuppD['confirmation'].'",arrivalBy="'.$hotelSuppD['arrivalBy'].'",departureBy="'.$hotelSuppD['departureBy'].'",specialRequest="'.$hotelSuppD['specialRequest'].'", taxType="'.$hotelSuppD['taxType'].'",markupType="'.$hotelSuppD['markupType'].'",sglMarkup="'.$hotelSuppD['sglMarkup'].'",dblMarkup="'.$hotelSuppD['dblMarkup'].'",twinMarkup="'.$hotelSuppD['twinMarkup'].'",tplMarkup="'.$hotelSuppD['tplMarkup'].'",cwbMarkup="'.$hotelSuppD['cwbMarkup'].'",quadMarkup="'.$hotelSuppD['quadMarkup'].'",sixMarkup="'.$hotelSuppD['sixMarkup'].'",eightMarkup="'.$hotelSuppD['eightMarkup'].'",tenMarkup="'.$hotelSuppD['tenMarkup'].'",teenMarkup="'.$hotelSuppD['teenMarkup'].'",cnbMarkup="'.$hotelSuppD['cnbMarkup'].'",exMarkup="'.$hotelSuppD['exMarkup'].'",mealMarkup="'.$hotelSuppD['mealMarkup'].'",remark="'.$hotelSuppD['remark'].'",tourManager="'.$hotelSuppD['tourManager'].'",supplementCostAdded="'.$hotelSuppD['supplementCostAdded'].'",isHotelSupplement="'.$hotelSuppD['isHotelSupplement'].'",isRoomSupplement="'.$hotelSuppD['isRoomSupplement'].'",rand_color="'.$hotelSuppD['rand_color'].'",hotelQuoteId="'.$addHotel.'",breakfast="'.$hotelSuppD['breakfast'].'",extraBed="'.$hotelSuppD['extraBed'].'",roomGST="'.$hotelSuppD['roomGST'].'",mealGST="'.$hotelSuppD['mealGST'].'",TAC="'.$hotelSuppD['TAC'].'",complimentaryLunch="'.$hotelSuppD['complimentaryLunch'].'",complimentaryDinner="'.$hotelSuppD['complimentaryDinner'].'",complimentaryBreakfast="'.$hotelSuppD['complimentaryBreakfast'].'",startDayDate="'.$hotelSuppD['startDayDate'].'",endDayDate="'.$hotelSuppD['endDayDate'].'",singleNoofRoom="'.$hotelSuppD['singleNoofRoom'].'",doubleNoofRoom="'.$hotelSuppD['doubleNoofRoom'].'",twinNoofRoom="'.$hotelSuppD['twinNoofRoom'].'",tripleNoofRoom="'.$hotelSuppD['tripleNoofRoom'].'",extraNoofBed="'.$hotelSuppD['extraNoofBed'].'",childwithNoofBed="'.$hotelSuppD['childwithNoofBed'].'",childwithoutNoofBed="'.$hotelSuppD['childwithoutNoofBed'].'",isGuestType="'.$hotelSuppD['isGuestType'].'",isLocalEscort="'.$hotelSuppD['isLocalEscort'].'",isForeignEscort="'.$hotelSuppD['isForeignEscort'].'",isEarlyCheckin="'.$hotelSuppD['isEarlyCheckin'].'",sixBedRoom="'.$hotelSuppD['sixBedRoom'].'",eightBedRoom="'.$hotelSuppD['eightBedRoom'].'",tenBedRoom="'.$hotelSuppD['tenBedRoom'].'",quadRoom="'.$hotelSuppD['quadRoom'].'",teenRoom="'.$hotelSuppD['teenRoom'].'",childBreakfast="'.$hotelSuppD['childBreakfast'].'",childDinner="'.$hotelSuppD['childDinner'].'",childLunch="'.$hotelSuppD['childLunch'].'",sixNoofBedRoom="'.$hotelSuppD['sixNoofBedRoom'].'",eightNoofBedRoom="'.$hotelSuppD['eightNoofBedRoom'].'",tenNoofBedRoom="'.$hotelSuppD['tenNoofBedRoom'].'",quadNoofRoom="'.$hotelSuppD['quadNoofRoom'].'",teenNoofRoom="'.$hotelSuppD['teenNoofRoom'].'",isChildBreakfast="'.$hotelSuppD['isChildBreakfast'].'",isChildLunch="'.$hotelSuppD['isChildLunch'].'",isChildDinner="'.$hotelSuppD['isChildDinner'].'"';
							$addSuppId = addlistinggetlastid(_QUOTATION_HOTEL_MASTER_,$namevalue);

							 $check_h=GetPageRecord('*','quotationItinerary',' queryId="'.$QueryDaysData['queryId'].'" and dayId="'.$adddays.'" and quotationId="'.$lastQuotationId.'" and serviceId="'.$hotelSuppD['supplierId'].'"');
							if(mysqli_num_rows($check_h)==0 && $hotelSuppD['isHotelSupplement'] == 1){
								$namevalue ='';
								$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$hotelSuppD['supplierId'].'",quotationId="'.$lastQuotationId.'",serviceType="hotel",startDate="'.$hotelSuppD['fromDate'].'",endDate="'.$hotelSuppD['fromDate'].'"';
								addlistinggetlastid('quotationItinerary',$namevalue);
							}

						} 
			
					}
			
					$b='';
					$b=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in ( select serviceId from quotationItinerary where serviceType="transfer" or serviceType="transportation" order by serviceId asc ) order by id asc');
					if(mysqli_num_rows($b)>0){
						while($quotTransferData=mysqli_fetch_array($b)){
						
							$bb2='';
							$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1');
							$paxSlabData2=mysqli_fetch_array($bb2);
							$totalPaxId = $paxSlabData2['id']; 

							if($queryType != 4){ $packageSupplier = $quotTransferData['supplierId']; }
							$transQuoteId = '';
							$transfernamevalue ='fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",destinationId="'.$quotTransferData['destinationId'].'",transferNameId="'.$quotTransferData['transferNameId'].'",supplierId="'.$packageSupplier.'",tariffId="'.$quotTransferData['tariffId'].'",vehicleId="'.$quotTransferData['vehicleId'].'",vehicleModelId="'.$quotTransferData['vehicleModelId'].'",currencyId="'.$quotTransferData['currencyId'].'",currencyValue="'.$quotTransferData['currencyValue'].'",transferToId="'.$quotTransferData['transferToId'].'",transferFromId="'.$quotTransferData['transferFromId'].'",transferType="'.$quotTransferData['transferType'].'",adultCost="'.$quotTransferData['adultCost'].'",childCost="'.$quotTransferData['childCost'].'",infantCost="'.$quotTransferData['infantCost'].'",detail="'.$quotTransferData['detail'].'",vehicleCost="'.$quotTransferData['vehicleCost'].'",transferQuotatoinType="'.$quotTransferData['transferQuotatoinType'].'",dmcId="'.$quotTransferData['dmcId'].'",pickupFrom="'.$quotTransferData['pickupFrom'].'",pickupTime="'.$quotTransferData['pickupTime'].'",duration="'.$quotTransferData['duration'].'",vehicleMaxPax="'.$quotTransferData['vehicleMaxPax'].'",adMarkup="'.$quotTransferData['adMarkup'].'",chMarkup="'.$quotTransferData['chMarkup'].'",vehMarkup="'.$quotTransferData['vehMarkup'].'",remark="'.$quotTransferData['remark'].'",confirmation="'.$quotTransferData['confirmation'].'",tourManager="'.$quotTransferData['tourManager'].'",driverId="'.$quotTransferData['driverId'].'",vehicleType="'.$quotTransferData['vehicleType'].'",parkingFee="'.$quotTransferData['parkingFee'].'",representativeEntryFee="'.$quotTransferData['representativeEntryFee'].'",assistance="'.$quotTransferData['assistance'].'",guideAllowance="'.$quotTransferData['guideAllowance'].'",interStateAndToll="'.$quotTransferData['interStateAndToll'].'",miscellaneous="'.$quotTransferData['miscellaneous'].'",transferName="'.$quotTransferData['transferName'].'",noOfDays="'.$quotTransferData['noOfDays'].'",dayId="'.$adddays.'",serviceType="'.$quotTransferData['serviceType'].'",costType="'.$quotTransferData['costType'].'",distance="'.$quotTransferData['distance'].'",noOfVehicles="'.$quotTransferData['noOfVehicles'].'",markupType="'.$quotTransferData['markupType'].'",markupCost="'.$quotTransferData['markupCost'].'",taxType="'.$quotTransferData['taxType'].'",gstTax="'.$quotTransferData['gstTax'].'",totalPax="'.$totalPaxId.'",startDay="'.$quotTransferData['startDay'].'",endDay="'.$quotTransferData['endDay'].'",isGuestType="'.$quotTransferData['isGuestType'].'"';
			
							$transQuoteId = addlistinggetlastid(_QUOTATION_TRANSFER_MASTER_,$transfernamevalue);
							
							$c1="";
							$c1=GetPageRecord('*','quotationTransferTimelineDetails','transferQuoteId="'.$quotTransferData['id'].'" and quotationId="'.$quotTransferData['quotationId'].'"');
							if(mysqli_num_rows($c1)>0){
								$transferTimelineData=mysqli_fetch_array($c1);
								if($queryType != 4){ $packageSupplier = $transferTimelineData['supplierId']; }							$namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",supplierId="'.$packageSupplier.'",transferQuoteId="'.$transQuoteId.'",arrivalFrom="'.$transferTimelineData['arrivalFrom'].'",trainName="'.$transferTimelineData['trainName'].'",trainNumber="'.$transferTimelineData['trainNumber'].'",flightName="'.$transferTimelineData['flightName'].'",flightNumber="'.$transferTimelineData['flightNumber'].'",vehicleName="'.$transferTimelineData['vehicleName'].'",airportName="'.$transferTimelineData['airportName'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'",VehicleModel="'.$transferTimelineData['VehicleModel'].'",arrivalTime="'.$transferTimelineData['arrivalTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",mode="'.$transferTimelineData['mode'].'",pickupTime="'.$transferTimelineData['pickupTime'].'"';
								$hotelSupHot = addlistinggetlastid('quotationTransferTimelineDetails',$namevalue); 
							}
			
							$namevalue ='';
							$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$transQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="'.$quotTransferData['serviceType'].'",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
							addlistinggetlastid('quotationItinerary',$namevalue);
			
						}
					}
			

					$b="";
					$b=GetPageRecord('*','quotationGuideMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="guide" order by serviceId asc) and isGuestType=1 order by id asc');
					while($quotGuideData=mysqli_fetch_array($b)){

						$bb2='';
						$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1');
						$paxSlabData2=mysqli_fetch_array($bb2);
						$totalPaxId = $paxSlabData2['id']; 

						if($queryType != 4){ $packageSupplier = $quotGuideData['supplierId']; }
						$guideQuoteId =''; 
						$transfernamevalue ='guideId="'.$quotGuideData['guideId'].'",isGuestType="'.$quotGuideData['isGuestType'].'",slabId="'.$totalPaxId.'",price="'.$quotGuideData['price'].'",guideName="'.$quotGuideData['guideName'].'",queryId="'.$lastQueryId.'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",supplierId="'.$packageSupplier.'",tariffId="'.$quotGuideData['tariffId'].'",quotationId="'.$lastQuotationId.'",srn="'.$quotGuideData['srn'].'",destinationId="'.$quotGuideData['destinationId'].'",rules="'.$quotGuideData['rules'].'",category="'.$quotGuideData['category'].'",subcategory="'.$quotGuideData['subcategory'].'",totalDays="'.$quotGuideData['totalDays'].'",perDaycost="'.$quotGuideData['perDaycost'].'",serviceType="'.$quotGuideData['serviceType'].'",currencyId="'.$quotGuideData['currencyId'].'",currencyValue="'.$quotGuideData['currencyValue'].'",isSelectedFinal="'.$quotGuideData['isSelectedFinal'].'",paxRange="'.$quotGuideData['paxRange'].'",markupType="'.$quotGuideData['markupType'].'",markupCost="'.$quotGuideData['markupCost'].'",taxType="'.$quotGuideData['taxType'].'",gstTax="'.$quotGuideData['gstTax'].'",dayId="'.$adddays.'"';
			
						$guideQuoteId = addlistinggetlastid('quotationGuideMaster',$transfernamevalue);

						$bSupp=GetPageRecord('*','quotationGuideMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'"  and guideQuoteId="'.$quotGuideData['id'].'" and isSupplement=1 order by id asc');
						while($transferSuppRes=mysqli_fetch_array($bSupp)){
							if($queryType != 4){ $packageSupplier = $transferSuppRes['supplierId']; }

							$suppGuidevalue ='guideId="'.$transferSuppRes['guideId'].'",slabId="'.$totalPaxId.'",price="'.$transferSuppRes['price'].'",guideName="'.$transferSuppRes['guideName'].'",queryId="'.$lastQueryId.'",fromDate="'.$quotGuideData['fromDate'].'",toDate="'.$quotGuideData['toDate'].'",supplierId="'.$packageSupplier.'",tariffId="'.$transferSuppRes['tariffId'].'",quotationId="'.$lastQuotationId.'",srn="'.$transferSuppRes['srn'].'",destinationId="'.$transferSuppRes['destinationId'].'",rules="'.$transferSuppRes['rules'].'",category="'.$transferSuppRes['category'].'",subcategory="'.$transferSuppRes['subcategory'].'",totalDays="'.$transferSuppRes['totalDays'].'",perDaycost="'.$transferSuppRes['perDaycost'].'",serviceType="'.$transferSuppRes['serviceType'].'",currencyId="'.$transferSuppRes['currencyId'].'",currencyValue="'.$transferSuppRes['currencyValue'].'",guideQuoteId="'.$guideQuoteId.'",isGuestType="'.$transferSuppRes['isGuestType'].'",isSupplement="'.$transferSuppRes['isSupplement'].'",isSelectedFinal="'.$transferSuppRes['isSelectedFinal'].'",paxRange="'.$transferSuppRes['paxRange'].'",dayType="'.$transferSuppRes['dayType'].'",markupType="'.$transferSuppRes['markupType'].'",markupCost="'.$transferSuppRes['markupCost'].'",taxType="'.$transferSuppRes['taxType'].'",gstTax="'.$transferSuppRes['gstTax'].'",dayId="'.$adddays.'"';
				
							$addSuppHotel = addlistinggetlastid('quotationGuideMaster',$suppGuidevalue);
						}
			
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$guideQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="guide",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
			
					}
			
					$b="";
					$b=GetPageRecord('*',_QUOTATION_OTHER_ACTIVITY_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="activity" order by serviceId asc) order by id asc');
					while($quotActivityData=mysqli_fetch_array($b)){
						if($queryType != 4){ $packageSupplier = $quotActivityData['supplierId']; }
						if($queryType==4){
							$adultPax = $adult;
							$childPax = $child;
							$infantPax = $infant;
						}else{
							$adultPax = $quotActivityData['adultPax'];
							$childPax = $quotActivityData['childPax'];
							$infantPax = $quotActivityData['infantPax'];
						}
						$activityQuoteId = '';
						$transfernamevalue ='otherActivityName="'.$quotActivityData['otherActivityName'].'",dateotherActivity="'.$quotActivityData['dateotherActivity'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",adultCost="'.$quotActivityData['adultCost'].'",supplierId="'.$packageSupplier.'",tariffId="'.$quotActivityData['tariffId'].'",childCost="'.$quotActivityData['childCost'].'",infantCost="'.$quotActivityData['infantCost'].'",transferType="'.$quotActivityData['transferType'].'",vehicleId="'.$quotActivityData['vehicleId'].'",vehicleCost="'.$quotActivityData['vehicleCost'].'",noOfVehicles="'.$quotActivityData['noOfVehicles'].'",repCost="'.$quotActivityData['repCost'].'",ticketAdultCost="'.$quotActivityData['ticketAdultCost'].'",ticketchildCost="'.$quotActivityData['ticketchildCost'].'",ticketinfantCost="'.$quotActivityData['ticketinfantCost'].'",groupCost="'.$quotActivityData['groupCost'].'",otherActivityCity="'.$quotActivityData['otherActivityCity'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",activityCost="'.$quotActivityData['activityCost'].'",maxpax="'.$quotActivityData['maxpax'].'",perPaxCost="'.$quotActivityData['perPaxCost'].'",quotationOtherActivitymaster="'.$quotActivityData['quotationOtherActivitymaster'].'",currencyId="'.$quotActivityData['currencyId'].'",currencyValue="'.$quotActivityData['currencyValue'].'",markupType="'.$quotActivityData['markupType'].'",markupCost="'.$quotActivityData['markupCost'].'",taxType="'.$quotActivityData['taxType'].'",gstTax="'.$quotActivityData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
						$activityQuoteId = addlistinggetlastid(_QUOTATION_OTHER_ACTIVITY_MASTER_,$transfernamevalue);
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$activityQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="activity",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
						
						$c1="";
						$c1=GetPageRecord('*','quotationActivityTimelineDetails','  hotelQuoteId="'.$quotActivityData['id'].'"');  
						if(mysqli_num_rows($c1)>0){
							$transferTimelineData=mysqli_fetch_array($c1); 
							if($queryType != 4){ $packageSupplier = $transferTimelineData['supplierId']; }
							$namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",hotelQuoteId="'.$activityQuoteId.'",supplierId="'.$packageSupplier.'",startTime="'.$transferTimelineData['startTime'].'",endTime="'.$transferTimelineData['endTime'].'"';
							$entraceTimeId = addlistinggetlastid('quotationActivityTimelineDetails',$namevalue);
			
						} 
					}

					$b="";
					$b=GetPageRecord('*','quotationEnrouteMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="enroute" order by serviceId asc) order by id asc');
					while($quotEnrouteData=mysqli_fetch_array($b)){

						if($queryType==4){
							$adultPax = $adult;
							$childPax = $child;
							$infantPax = $infant;
						}else{
							$adultPax = $quotEnrouteData['adultPax'];
							$childPax = $quotEnrouteData['childPax'];
							$infantPax = $quotEnrouteData['infantPax'];
						}
			
						$enrQuoteId ='';
						$transfernamevalue ='enrouteId="'.$quotEnrouteData['enrouteId'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",adultCost="'.$quotEnrouteData['adultCost'].'",childCost="'.$quotEnrouteData['childCost'].'",infantCost="'.$quotEnrouteData['infantCost'].'",destinationId="'.$quotEnrouteData['destinationId'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",dayId="'.$adddays.'",currencyId="'.$quotEnrouteData['currencyId'].'",currencyValue="'.$quotEnrouteData['currencyValue'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
						$enrQuoteId = addlistinggetlastid('quotationEnrouteMaster',$transfernamevalue);
			
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$enrQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="enroute",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
						
					}
			
			
			
					$b="";
					$b=GetPageRecord('*','quotationEntranceMaster','quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="entrance" order by serviceId asc) order by id asc');
					while($quotEntranceData=mysqli_fetch_array($b)){
						if($queryType != 4){ $packageSupplier = $quotEntranceData['supplierId']; }

						if($queryType==4){
							$adultPax = $adult;
							$childPax = $child;
							$infantPax = $infant;
						}else{
							$adultPax = $quotEntranceData['adultPax'];
							$childPax = $quotEntranceData['childPax'];
							$infantPax = $quotEntranceData['infantPax'];
						}

						$entQuoteId = ''; 
						$transfernamevalue ='entranceNameId="'.$quotEntranceData['entranceNameId'].'",quotationId="'.$lastQuotationId.'",destinationId="'.$quotEntranceData['destinationId'].'",dmcId="'.$quotEntranceData['dmcId'].'",vehicleId="'.$quotEntranceData['vehicleId'].'",supplierId="'.$packageSupplier.'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",ticketAdultCost="'.$quotEntranceData['ticketAdultCost'].'",ticketchildCost="'.$quotEntranceData['ticketchildCost'].'",ticketinfantCost="'.$quotEntranceData['ticketinfantCost'].'",entranceType="'.$quotEntranceData['entranceType'].'",adultCost="'.$quotEntranceData['adultCost'].'",childCost="'.$quotEntranceData['childCost'].'",infantCost="'.$quotEntranceData['infantCost'].'",detail="'.$quotEntranceData['detail'].'",vehicleCost="'.$quotEntranceData['vehicleCost'].'",noOfVehicles="'.$quotEntranceData['noOfVehicles'].'",currencyId="'.$quotEntranceData['currencyId'].'",currencyValue="'.$quotEntranceData['currencyValue'].'",entranceQuotatoinType="'.$quotEntranceData['entranceQuotatoinType'].'",pickupTime="'.$quotEntranceData['pickupTime'].'",pickupFrom="'.$quotEntranceData['pickupFrom'].'",duration="'.$quotEntranceData['duration'].'",vehicleMaxPax="'.$quotEntranceData['vehicleMaxPax'].'",adMarkup="'.$quotEntranceData['adMarkup'].'",chMarkup="'.$quotEntranceData['chMarkup'].'",remark="'.$quotEntranceData['remark'].'",confirmation="'.$quotEntranceData['confirmation'].'",tourManager="'.$quotEntranceData['tourManager'].'",transferType="'.$quotEntranceData['transferType'].'",guideCost="'.$quotEntranceData['guideCost'].'",queryId="'.$lastQueryId.'",markupType="'.$quotEntranceData['markupType'].'",markupCost="'.$quotEntranceData['markupCost'].'",taxType="'.$quotEntranceData['taxType'].'",gstTax="'.$quotEntranceData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
						$entQuoteId = addlistinggetlastid('quotationEntranceMaster',$transfernamevalue);
			
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$entQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="entrance",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
						
						$c1="";
						$c1=GetPageRecord('*','quotationEntranceTimelineDetails','  hotelQuoteId="'.$quotEntranceData['id'].'"');  
						if(mysqli_num_rows($c1)>0){
							$transferTimelineData=mysqli_fetch_array($c1);
							
							if($queryType != 4){ $packageSupplier = $transferTimelineData['supplierId']; }

							$namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",hotelQuoteId="'.$entQuoteId.'",supplierId="'.$supplierId.'",startTime="'.$transferTimelineData['startTime'].'",endTime="'.$transferTimelineData['endTime'].'",pickupTime="'.$transferTimelineData['pickupTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'"';
							$entraceTimeId = addlistinggetlastid('quotationEntranceTimelineDetails',$namevalue);
			
						}
					}
			
					// Quotation Ferry 
						$b=GetPageRecord('*','quotationFerryMaster','quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="ferry" order by serviceId asc) order by id asc');
						while($ferryTranfer=mysqli_fetch_array($b)){
							if($queryType != 4){ $packageSupplier = $ferryTranfer['supplierId']; }

							if($queryType==4){
								$adultPax = $adult;
								$childPax = $child;
								$infantPax = $infant;
							}else{
								$adultPax = $ferryTranfer['adultPax'];
								$childPax = $ferryTranfer['childPax'];
								$infantPax = $ferryTranfer['infantPax'];
							}

							$endFerryId= '';
							
								$ferrynamevalue ='ferryNameId="'.$ferryTranfer['ferryNameId'].'",serviceid="'.$ferryTranfer['serviceid'].'",quotationId="'.$lastQuotationId.'",destinationId="'.$ferryTranfer['destinationId'].'",todestination="'.$ferryTranfer['todestination'].'",supplierId="'.$packageSupplier.'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",ferryClass="'.$ferryTranfer['ferryClass'].'",adultCost="'.$ferryTranfer['adultCost'].'",childCost="'.$ferryTranfer['childCost'].'",infantCost="'.$ferryTranfer['infantCost'].'",ferryCost="'.$ferryTranfer['ferryCost'].'",processingfee="'.$ferryTranfer['processingfee'].'",miscCost="'.$ferryTranfer['miscCost'].'",currencyId="'.$ferryTranfer['currencyId'].'",currencyValue="'.$ferryTranfer['currencyValue'].'",pickupTime="'.$ferryTranfer['pickupTime'].'",dropTime="'.$ferryTranfer['dropTime'].'",remark="'.$ferryTranfer['remark'].'",rateId="'.$ferryTranfer['rateId'].'",timeId="'.$ferryTranfer['timeId'].'",queryId="'.$lastQueryId.'",markupType="'.$ferryTranfer['markupType'].'",markupCost="'.$ferryTranfer['markupCost'].'",taxType="'.$ferryTranfer['taxType'].'",gstTax="'.$ferryTranfer['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
								$endFerryId = addlistinggetlastid('quotationFerryMaster',$ferrynamevalue);

								$namevalue ='';
								$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$endFerryId.'",quotationId="'.$lastQuotationId.'",serviceType="ferry",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
								addlistinggetlastid('quotationItinerary',$namevalue);
							
						}
	
						$b="";
						$b=GetPageRecord('*',_QUOTATION_INBOUND_MEAL_PLAN_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="mealplan" order by serviceId asc) order by id asc');
						while($quotMealPlanData=mysqli_fetch_array($b)){
							if($queryType != 4){ $packageSupplier = $quotMealPlanData['supplierId']; }
							if($queryType==4){
								$adultPax = $adult;
								$childPax = $child;
								$infantPax = $infant;
							}else{
								$adultPax = $quotMealPlanData['adultPax'];
								$childPax = $quotMealPlanData['childPax'];
								$infantPax = $quotMealPlanData['infantPax'];
							}
							$mealQuoteId = ''; 
							$transfernamevalue ='mealPlanName="'.$quotMealPlanData['mealPlanName'].'",mealPlanNameId="'.$quotMealPlanData['mealPlanNameId'].'",quotationId="'.$lastQuotationId.'",dateMealPlan="'.$quotMealPlanData['dateMealPlan'].'",supplierId="'.$packageSupplier.'",adultCost="'.$quotMealPlanData['adultCost'].'",childCost="'.$quotMealPlanData['childCost'].'",infantCost="'.$quotMealPlanData['infantCost'].'",groupCost="'.$quotMealPlanData['groupCost'].'",mealPlanCity="'.$quotMealPlanData['mealPlanCity'].'",mealType="'.$quotMealPlanData['mealType'].'",destinationId="'.$quotMealPlanData['destinationId'].'",fromDate="'.$srDaysDate.'",currencyId="'.$quotMealPlanData['currencyId'].'",currencyValue="'.$quotMealPlanData['currencyValue'].'",toDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",markupType="'.$quotMealPlanData['markupType'].'",markupCost="'.$quotMealPlanData['markupCost'].'",taxType="'.$quotMealPlanData['taxType'].'",gstTax="'.$quotMealPlanData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"'; 
							$mealQuoteId = addlistinggetlastid(_QUOTATION_INBOUND_MEAL_PLAN_MASTER_,$transfernamevalue);
							
							$namevalue ='';
							$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$mealQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="mealplan",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
							addlistinggetlastid('quotationItinerary',$namevalue);
				
						}
				
				
					$b="";
					$b=GetPageRecord('*',_QUOTATION_FLIGHT_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and isFlightTaken="" and id in (select serviceId from quotationItinerary where serviceType="flight" order by serviceId asc) order by id asc');
					while($quotFlightData=mysqli_fetch_array($b)){
						if($queryType != 4){ $packageSupplier = $quotFlightData['supplierId']; }
						if($queryType==4){
							$adultPax = $adult;
							$childPax = $child;
							$infantPax = $infant;
						}else{
							$adultPax = $quotFlightData['adultPax'];
							$childPax = $quotFlightData['childPax'];
							$infantPax = $quotFlightData['infantPax'];
						}
						$flightQuoteId = '';
						$transfernamevalue ='fromDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",toDate="'.$srDaysDate.'",adultCost="'.$quotFlightData['adultCost'].'",childCost="'.$quotFlightData['childCost'].'",infantCost="'.$quotFlightData['infantCost'].'",supplierId="'.$packageSupplier.'",flightId="'.$quotFlightData['flightId'].'",arrivalTo="'.$quotFlightData['arrivalTo'].'",departureFrom="'.$quotFlightData['departureFrom'].'",departureDate="'.$quotFlightData['departureDate'].'",arrivalDate="'.$quotFlightData['arrivalDate'].'",departureTime="'.$quotFlightData['departureTime'].'",arrivalTime="'.$quotFlightData['arrivalTime'].'",destinationId="'.$quotFlightData['destinationId'].'",flightNumber="'.$quotFlightData['flightNumber'].'",flightClass="'.$quotFlightData['flightClass'].'",markupType="'.$quotFlightData['markupType'].'",markupCost="'.$quotFlightData['markupCost'].'",taxType="'.$quotFlightData['taxType'].'",gstTax="'.$quotFlightData['gstTax'].'",dayId="'.$adddays.'",currencyId="'.$quotFlightData['currencyId'].'",currencyValue="'.$quotFlightData['currencyValue'].'",isGuestType="'.$quotFlightData['isGuestType'].'",adult="'.$quotFlightData['adult'].'",child="'.$quotFlightData['child'].'",infant="'.$quotFlightData['infant'].'",isLocalEscort="'.$quotFlightData['isLocalEscort'].'",isForeignEscort="'.$quotFlightData['isForeignEscort'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
						$flightQuoteId = addlistinggetlastid(_QUOTATION_FLIGHT_MASTER_,$transfernamevalue);
			
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$flightQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="flight",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
			
					}
			
					$b="";
					$b=GetPageRecord('*',_QUOTATION_TRAINS_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="train" order by serviceId asc) order by id asc');
					while($quotTrainData=mysqli_fetch_array($b)){
						if($queryType != 4){ $packageSupplier = $quotFlightData['supplierId']; }
						if($queryType==4){
							$adultPax = $adult;
							$childPax = $child;
							$infantPax = $infant;
						}else{
							$adultPax = $quotTrainData['adultPax'];
							$childPax = $quotTrainData['childPax'];
							$infantPax = $quotTrainData['infantPax'];
						}
						$trainQuoteId = '';
						$transfernamevalue ='fromDate="'.$srDaysDate.'",quotationId="'.$lastQuotationId.'",toDate="'.$srDaysDate.'",adultCost="'.$quotTrainData['adultCost'].'",childCost="'.$quotTrainData['childCost'].'",infantCost="'.$quotTrainData['infantCost'].'",supplierId="'.$packageSupplier.'",trainId="'.$quotTrainData['trainId'].'",arrivalTo="'.$quotTrainData['arrivalTo'].'",departureFrom="'.$quotTrainData['departureFrom'].'",departureDate="'.$quotTrainData['departureDate'].'",arrivalDate="'.$quotTrainData['arrivalDate'].'",departureTime="'.$quotTrainData['departureTime'].'",arrivalTime="'.$quotTrainData['arrivalTime'].'",journeyType="'.$quotTrainData['journeyType'].'",destinationId="'.$quotTrainData['destinationId'].'",trainNumber="'.$quotTrainData['trainNumber'].'",trainClass="'.$quotTrainData['trainClass'].'",queryId="'.$lastQueryId.'",markupType="'.$quotTrainData['markupType'].'",markupCost="'.$quotTrainData['markupCost'].'",taxType="'.$quotTrainData['taxType'].'",gstTax="'.$quotTrainData['gstTax'].'",dayId="'.$adddays.'",currencyId="'.$quotTrainData['currencyId'].'",currencyValue="'.$quotTrainData['currencyValue'].'",isGuestType="'.$quotTrainData['isGuestType'].'",isLocalEscort="'.$quotTrainData['isLocalEscort'].'",isForeignEscort="'.$quotTrainData['isForeignEscort'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
						$trainQuoteId = addlistinggetlastid(_QUOTATION_TRAINS_MASTER_,$transfernamevalue);
			
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$trainQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="train",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
					}
			
			
					$b='';
					$b=GetPageRecord('*',_QUOTATION_EXTRA_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="additional" order by serviceId asc) order by id asc');
					if(mysqli_num_rows($b)>0){
			
						while($quotExtraData=mysqli_fetch_array($b)){
							if($queryType != 4){ $packageSupplier = $quotFlightData['supplierId']; }
							if($queryType==4){
								$adultPax = $adult;
								$childPax = $child;
								$infantPax = $infant;
							}else{
								$adultPax = $quotExtraData['adultPax'];
								$childPax = $quotExtraData['childPax'];
								$infantPax = $quotExtraData['infantPax'];
							}
							$extraQuoteId = '';
							$transfernamevalue ='name="'.$quotExtraData['name'].'",dateExtra="'.$quotExtraData['dateExtra'].'",queryId="'.$lastQueryId.'",supplierId="'.$packageSupplier.'",adultCost="'.$quotExtraData['adultCost'].'",childCost="'.$quotExtraData['childCost'].'",infantCost="'.$quotExtraData['infantCost'].'",groupCost="'.$quotExtraData['groupCost'].'",destinationId="'.$quotExtraData['destinationId'].'",quotationId="'.$lastQuotationId.'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",currencyId="'.$quotExtraData['currencyId'].'",currencyValue="'.$quotExtraData['currencyValue'].'",additionalId="'.$quotExtraData['additionalId'].'",markupType="'.$quotExtraData['markupType'].'",markupCost="'.$quotExtraData['markupCost'].'",taxType="'.$quotExtraData['taxType'].'",gstTax="'.$quotExtraData['gstTax'].'",costType="'.$quotExtraData['costType'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",dayId="'.$adddays.'"';
							$extraQuoteId = addlistinggetlastid(_QUOTATION_EXTRA_MASTER_,$transfernamevalue);
			
			
							$namevalue ='';
							$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$extraQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="additional",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
							addlistinggetlastid('quotationItinerary',$namevalue);
			
						}
					}
					
				}
				
				if($quotationData['flightRequired']==2){
					$b="";
					$b=GetPageRecord('*',_QUOTATION_FLIGHT_MASTER_,' quotationId="'.$quotationId.'" and dayId="0" and isFlightTaken="yes" and id in (select serviceId from quotationItinerary where serviceType="flight" order by serviceId asc) order by id asc');
					while($quotFlightData=mysqli_fetch_array($b)){
						if($queryType != 4){ $packageSupplier = $quotFlightData['supplierId']; }

						if($queryType==4){
							$adultPax = $adult;
							$childPax = $child;
							$infantPax = $infant;
						}else{
							$adultPax = $quotFlightData['adultPax'];
							$childPax = $quotFlightData['childPax'];
							$infantPax = $quotFlightData['infantPax'];
						}

						$flightQuoteId = '';
						$transfernamevalue ='fromDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",toDate="'.$srDaysDate.'",adultCost="'.$quotFlightData['adultCost'].'",childCost="'.$quotFlightData['childCost'].'",infantCost="'.$quotFlightData['infantCost'].'",flightId="'.$quotFlightData['flightId'].'",arrivalTo="'.$quotFlightData['arrivalTo'].'",departureFrom="'.$quotFlightData['departureFrom'].'",departureDate="'.$quotFlightData['departureDate'].'",arrivalDate="'.$quotFlightData['arrivalDate'].'",departureTime="'.$quotFlightData['departureTime'].'",arrivalTime="'.$quotFlightData['arrivalTime'].'",destinationId="'.$quotFlightData['destinationId'].'",flightNumber="'.$quotFlightData['flightNumber'].'",flightClass="'.$quotFlightData['flightClass'].'",markupType="'.$quotFlightData['markupType'].'",markupCost="'.$quotFlightData['markupCost'].'",taxType="'.$quotFlightData['taxType'].'",gstTax="'.$quotFlightData['gstTax'].'",currencyId="'.$quotFlightData['currencyId'].'",currencyValue="'.$quotFlightData['currencyValue'].'",isGuestType="'.$quotFlightData['isGuestType'].'",adult="'.$quotFlightData['adult'].'",child="'.$quotFlightData['child'].'",infant="'.$quotFlightData['infant'].'",isLocalEscort="'.$quotFlightData['isLocalEscort'].'",isForeignEscort="'.$quotFlightData['isForeignEscort'].'",isFlightTaken="'.$quotFlightData['isFlightTaken'].'",totalAdultCost="'.$quotFlightData['totalAdultCost'].'",adultTax="'.$quotFlightData['adultTax'].'",totalChildCost="'.$quotFlightData['totalChildCost'].'",childTax="'.$quotFlightData['childTax'].'",totalInfantCost="'.$quotFlightData['totalInfantCost'].'",infantTax="'.$quotFlightData['infantTax'].'",cancellationPolicy="'.$quotFlightData['cancellationPolicy'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",supplierId="'.$quotFlightData['supplierId'].'"';
						$flightQuoteId = addlistinggetlastid(_QUOTATION_FLIGHT_MASTER_,$transfernamevalue);
			
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$flightQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="flight",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
			
					}
				}

				$b='';
			$b=GetPageRecord('*',_QUOTATION_VISA_MASTER_,' quotationId="'.$quotationId.'" and id in (select serviceId from quotationItinerary where serviceType="visa" order by serviceId asc) order by id asc');

			if(mysqli_num_rows($b)>0 && $quotationData['visaRequired']==2){

				while($visaQuotData=mysqli_fetch_array($b)){
					$lastId = ''; 

					if($queryType==4){
						$adultPax = $adult;
						$childPax = $child;
						$infantPax = $infant;
					}else{
						$adultPax = $visaQuotData['adultPax'];
						$childPax = $visaQuotData['childPax'];
						$infantPax = $visaQuotData['infantPax'];
					}

					$visanamevalue ='fromDate="'.$visaQuotData['fromDate'].'",quotationId="'.$lastQuotationId.'",toDate="'.$visaQuotData['toDate'].'",adultCost="'.$visaQuotData['adultCost'].'",childCost="'.$visaQuotData['childCost'].'",infantCost="'.$visaQuotData['infantCost'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",serviceid="'.$visaQuotData['serviceid'].'",name="'.$visaQuotData['name'].'",rateId="'.$visaQuotData['rateId'].'",visaTypeId="'.$visaQuotData['visaTypeId'].'",supplierId="'.$visaQuotData['supplierId'].'",startDate="'.$visaQuotData['startDate'].'",currencyId="'.$visaQuotData['currencyId'].'",currencyValue="'.$visaQuotData['currencyValue'].'",gstTax="'.$visaQuotData['gstTax'].'",queryId="'.$lastQueryId.'",markupType="'.$visaQuotData['markupType'].'",processingFee="'.$visaQuotData['processingFee'].'",vfsCharges="'.$visaQuotData['vfsCharges'].'",embassyFee="'.$visaQuotData['embassyFee'].'",status="'.$visaQuotData['status'].'",deletestatus="'.$visaQuotData['deletestatus'].'",visaDate="'.$visaQuotData['visaDate'].'",visaCountryId="'.$visaQuotData['visaCountryId'].'",visaValidity="'.$visaQuotData['visaValidity'].'",entryType="'.$visaQuotData['entryType'].'"';

					$lastId = addlistinggetlastid(_QUOTATION_VISA_MASTER_,$visanamevalue);  
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$lastId.'",quotationId="'.$lastQuotationId.'",serviceType="visa",startDate="'.$visaQuotData['fromDate'].'",endDate="'.$visaQuotData['fromDate'].'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
				}
			}

			 
			$b='';
			$b=GetPageRecord('*',_QUOTATION_INSURANCE_MASTER_,' quotationId="'.$quotationId.'" and id in (select serviceId from quotationItinerary where serviceType="insurance" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0 && $quotationData['insuranceRequired']==2){

				while($insQuotData=mysqli_fetch_array($b)){
					if($queryType==4){
						$adultPax = $adult;
						$childPax = $child;
						$infantPax = $infant;
					}else{
						$adultPax = $insQuotData['adultPax'];
						$childPax = $insQuotData['childPax'];
						$infantPax = $insQuotData['infantPax'];
					}
					$lastId = ''; 
					$insnamevalue ='fromDate="'.$insQuotData['fromDate'].'",quotationId="'.$lastQuotationId.'",toDate="'.$insQuotData['toDate'].'",adultCost="'.$insQuotData['adultCost'].'",childCost="'.$insQuotData['childCost'].'",infantCost="'.$insQuotData['infantCost'].'",serviceid="'.$insQuotData['serviceid'].'",name="'.$insQuotData['name'].'",rateId="'.$insQuotData['rateId'].'",insuranceTypeId="'.$insQuotData['insuranceTypeId'].'",supplierId="'.$insQuotData['supplierId'].'",startDate="'.$insQuotData['startDate'].'",currencyId="'.$insQuotData['currencyId'].'",currencyValue="'.$insQuotData['currencyValue'].'",gstTax="'.$insQuotData['gstTax'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",queryId="'.$lastQueryId.'",markupType="'.$insQuotData['markupType'].'",processingFee="'.$insQuotData['processingFee'].'",status="'.$insQuotData['status'].'",deletestatus="'.$insQuotData['deletestatus'].'",insuranceStartDate="'.$insQuotData['insuranceStartDate'].'",insuranceEndDate="'.$insQuotData['insuranceEndDate'].'",countryId="'.$insQuotData['countryId'].'"';

					$lastId = addlistinggetlastid(_QUOTATION_INSURANCE_MASTER_,$insnamevalue);  
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$lastId.'",quotationId="'.$lastQuotationId.'",serviceType="insurance",startDate="'.$insQuotData['fromDate'].'",endDate="'.$insQuotData['fromDate'].'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
				}

			}
					
				if($quotationData['transferRequired']==2){
					$b='';
					$b=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' quotationId="'.$quotationId.'" and dayId="0" and isTransferTaken="yes" and id in ( select serviceId from quotationItinerary where serviceType="transfer" or serviceType="transportation" order by serviceId asc ) order by id asc');
					if(mysqli_num_rows($b)>0){
						while($quotTransferData=mysqli_fetch_array($b)){
						
							$bb2='';
							$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1');
							$paxSlabData2=mysqli_fetch_array($bb2);
							$totalPaxId = $paxSlabData2['id']; 

							if($queryType != 4){ $packageSupplier = $quotTransferData['supplierId']; }
							$transQuoteId = '';
							$transfernamevalue ='fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",destinationId="'.$quotTransferData['destinationId'].'",transferNameId="'.$quotTransferData['transferNameId'].'",supplierId="'.$packageSupplier.'",tariffId="'.$quotTransferData['tariffId'].'",vehicleId="'.$quotTransferData['vehicleId'].'",vehicleModelId="'.$quotTransferData['vehicleModelId'].'",currencyId="'.$quotTransferData['currencyId'].'",currencyValue="'.$quotTransferData['currencyValue'].'",transferToId="'.$quotTransferData['transferToId'].'",transferFromId="'.$quotTransferData['transferFromId'].'",transferType="'.$quotTransferData['transferType'].'",adultCost="'.$quotTransferData['adultCost'].'",childCost="'.$quotTransferData['childCost'].'",infantCost="'.$quotTransferData['infantCost'].'",detail="'.$quotTransferData['detail'].'",vehicleCost="'.$quotTransferData['vehicleCost'].'",transferQuotatoinType="'.$quotTransferData['transferQuotatoinType'].'",dmcId="'.$quotTransferData['dmcId'].'",pickupFrom="'.$quotTransferData['pickupFrom'].'",pickupTime="'.$quotTransferData['pickupTime'].'",duration="'.$quotTransferData['duration'].'",vehicleMaxPax="'.$quotTransferData['vehicleMaxPax'].'",adMarkup="'.$quotTransferData['adMarkup'].'",chMarkup="'.$quotTransferData['chMarkup'].'",vehMarkup="'.$quotTransferData['vehMarkup'].'",remark="'.$quotTransferData['remark'].'",confirmation="'.$quotTransferData['confirmation'].'",tourManager="'.$quotTransferData['tourManager'].'",driverId="'.$quotTransferData['driverId'].'",vehicleType="'.$quotTransferData['vehicleType'].'",parkingFee="'.$quotTransferData['parkingFee'].'",representativeEntryFee="'.$quotTransferData['representativeEntryFee'].'",assistance="'.$quotTransferData['assistance'].'",guideAllowance="'.$quotTransferData['guideAllowance'].'",interStateAndToll="'.$quotTransferData['interStateAndToll'].'",miscellaneous="'.$quotTransferData['miscellaneous'].'",transferName="'.$quotTransferData['transferName'].'",noOfDays="'.$quotTransferData['noOfDays'].'",serviceType="'.$quotTransferData['serviceType'].'",costType="'.$quotTransferData['costType'].'",distance="'.$quotTransferData['distance'].'",noOfVehicles="'.$quotTransferData['noOfVehicles'].'",markupType="'.$quotTransferData['markupType'].'",markupCost="'.$quotTransferData['markupCost'].'",taxType="'.$quotTransferData['taxType'].'",gstTax="'.$quotTransferData['gstTax'].'",totalPax="'.$totalPaxId.'",startDay="'.$quotTransferData['startDay'].'",endDay="'.$quotTransferData['endDay'].'",isGuestType="'.$quotTransferData['isGuestType'].'",isTransferTaken="'.$quotTransferData['isTransferTaken'].'"';
			
							$transQuoteId = addlistinggetlastid(_QUOTATION_TRANSFER_MASTER_,$transfernamevalue);
							
							$c1="";
							$c1=GetPageRecord('*','quotationTransferTimelineDetails','transferQuoteId="'.$quotTransferData['id'].'" and quotationId="'.$quotTransferData['quotationId'].'"');
							if(mysqli_num_rows($c1)>0){
								$transferTimelineData=mysqli_fetch_array($c1);
								if($queryType != 4){ $packageSupplier = $transferTimelineData['supplierId']; }							$namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",supplierId="'.$packageSupplier.'",transferQuoteId="'.$transQuoteId.'",arrivalFrom="'.$transferTimelineData['arrivalFrom'].'",trainName="'.$transferTimelineData['trainName'].'",trainNumber="'.$transferTimelineData['trainNumber'].'",flightName="'.$transferTimelineData['flightName'].'",flightNumber="'.$transferTimelineData['flightNumber'].'",vehicleName="'.$transferTimelineData['vehicleName'].'",airportName="'.$transferTimelineData['airportName'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'",VehicleModel="'.$transferTimelineData['VehicleModel'].'",arrivalTime="'.$transferTimelineData['arrivalTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",mode="'.$transferTimelineData['mode'].'",pickupTime="'.$transferTimelineData['pickupTime'].'"';
								$hotelSupHot = addlistinggetlastid('quotationTransferTimelineDetails',$namevalue); 
							}
			
							$namevalue ='';
							$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$transQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="'.$quotTransferData['serviceType'].'",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
							addlistinggetlastid('quotationItinerary',$namevalue);
			
						}
					}
				}

				$b='';
				$b=GetPageRecord('*','quotationServiceMarkup',' quotationId="'.$quotationId.'" order by id asc');
				if(mysqli_num_rows($b)>0){
					$transferRes=mysqli_fetch_array($b);
					$addHotel = '';
					$modevalue = ' markupCost="'.$transferRes['markupCost'].'", curren="'.$transferRes['curren'].'", quotationId="'.$lastQuotationId.'", package="'.$transferRes['package'].'", hotel="'.$transferRes['hotel'].'", guide="'.$transferRes['guide'].'", activity="'.$transferRes['activity'].'", entrance="'.$transferRes['entrance'].'", transfer="'.$transferRes['transfer'].'", train="'.$transferRes['train'].'",flight="'.$transferRes['flight'].'", restaurant="'.$transferRes['restaurant'].'",ferry="'.$transferRes['ferry'].'",visa="'.$transferRes['visa'].'",passport="'.$transferRes['passport'].'",insurance="'.$transferRes['insurance'].'",other="'.$transferRes['other'].'",packageMarkupType="'.$transferRes['packageMarkupType'].'",hotelMarkupType="'.$transferRes['hotelMarkupType'].'",guideMarkupType="'.$transferRes['guideMarkupType'].'",activityMarkupType="'.$transferRes['activityMarkupType'].'",entranceMarkupType="'.$transferRes['entranceMarkupType'].'",transferMarkupType="'.$transferRes['transferMarkupType'].'",trainMarkupType="'.$transferRes['trainMarkupType'].'",flightMarkupType="'.$transferRes['flightMarkupType'].'",restaurantMarkupType="'.$transferRes['restaurantMarkupType'].'",ferryMarkupType="'.$transferRes['ferryMarkupType'].'",visaMarkupType="'.$transferRes['visaMarkupType'].'",passportMarkupType="'.$transferRes['passportMarkupType'].'",insuranceMarkupType="'.$transferRes['insuranceMarkupType'].'",otherMarkupType="'.$transferRes['otherMarkupType'].'", status="'.$transferRes['status'].'"';
					$markup = addlistinggetlastid('quotationServiceMarkup',$modevalue);
				}

				$getPackageRateQuery="";
				$getPackageRateQuery=GetPageRecord('*','packageWiseRateMaster',' quotationId="'.$quotationId.'"');
				if(mysqli_num_rows($getPackageRateQuery) > 0){
				    while($transferRes=mysqli_fetch_array($getPackageRateQuery)){ 
						if($queryType==4){
							$adultPax = $adult;
							$childPax = $child;
							$infantPax = $infant;
						}else{
							$adultPax = $transferRes['adultPax'];
							$childPax = $transferRes['ChildPax'];
							$infantPax = $transferRes['infantPax'];
						}
					$addHotel = '';
					$modevalue = 'queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",singleCost="'.$transferRes['singleCost'].'",doubleCost="'.$transferRes['doubleCost'].'",tripleCost="'.$transferRes['tripleCost'].'",twinCost="'.$transferRes['twinCost'].'",quadCost="'.$transferRes['quadCost'].'",sixBedCost="'.$transferRes['sixBedCost'].'",eightBedCost="'.$transferRes['eightBedCost'].'",tenBedCost="'.$transferRes['tenBedCost'].'",teenBedCost="'.$transferRes['teenBedCost'].'",extraBedACost="'.$transferRes['extraBedACost'].'",childwithbedCost="'.$transferRes['childwithbedCost'].'",childwithoutbedCost="'.$transferRes['childwithoutbedCost'].'",infantBedCost="'.$transferRes['infantBedCost'].'",guideA="'.$transferRes['guideA'].'",activityA="'.$transferRes['activityA'].'",entranceA="'.$transferRes['entranceA'].'",enrouteA="'.$transferRes['enrouteA'].'",transferA="'.$transferRes['transferA'].'",trainA="'.$transferRes['trainA'].'",flightA="'.$transferRes['flightA'].'",restaurantA="'.$transferRes['restaurantA'].'",otherA="'.$transferRes['otherA'].'",guideC="'.$transferRes['guideC'].'",activityC="'.$transferRes['activityC'].'",entranceC="'.$transferRes['entranceC'].'",enrouteC="'.$transferRes['enrouteC'].'",transferC="'.$transferRes['transferC'].'",trainC="'.$transferRes['trainC'].'",flightC="'.$transferRes['flightC'].'",restaurantC="'.$transferRes['restaurantC'].'",otherC="'.$transferRes['otherC'].'",supplierId="'.$transferRes['supplierId'].'",currencyId="'.$transferRes['currencyId'].'",currencyValue="'.$transferRes['currencyValue'].'",singleBasis="'.$transferRes['singleBasis'].'",doubleBasis="'.$transferRes['doubleBasis'].'",tripleBasis="'.$transferRes['tripleBasis'].'",twinBasis="'.$transferRes['twinBasis'].'",quadBasis="'.$transferRes['quadBasis'].'",sixBedBasis="'.$transferRes['sixBedBasis'].'",eightBedBasis="'.$transferRes['eightBedBasis'].'",tenBedBasis="'.$transferRes['tenBedBasis'].'",teenBedBasis="'.$transferRes['teenBedBasis'].'",extraBedABasis="'.$transferRes['extraBedABasis'].'",childwithbedBasis="'.$transferRes['childwithbedBasis'].'",childwithoutbedBasis="'.$transferRes['childwithoutbedBasis'].'",infantBedBasis="'.$transferRes['infantBedBasis'].'",loopNum="'.$transferRes['loopNum'].'",hotelTypeId="'.$transferRes['hotelTypeId'].'",hotelCategoryId="'.$transferRes['hotelCategoryId'].'",gstTax="'.$transferRes['gstTax'].'",serviceTax="'.$transferRes['serviceTax'].'",serviceType="'.$transferRes['serviceType'].'",serviceName="'.$transferRes['serviceName'].'",markupType="'.$transferRes['markupType'].'",markupValue="'.$transferRes['markupValue'].'",costTypeId="'.$transferRes['costTypeId'].'",adultPax="'.$adultPax.'",adultCost="'.$transferRes['adultCost'].'",ChildCost="'.$transferRes['ChildCost'].'",ChildPax="'.$childPax.'",infantCost="'.$transferRes['infantCost'].'",infantPax="'.$infantPax.'",groupCost="'.$transferRes['groupCost'].'",ROE="'.$transferRes['ROE'].'"';
					$addHotel = addlistinggetlastid('packageWiseRateMaster',$modevalue);
					}
				} 

				
				$c12=GetPageRecord('*','quotationAdditionalMaster',' quotationId="'.$quotationId.'" order by id asc');
				if( mysqli_num_rows($c12) > 0){
					
					updatelisting(_QUOTATION_MASTER_,' isAddExp="1"','id="'.$lastQuotationId.'"');
					while($quotAdditionalData=mysqli_fetch_array($c12)){
						
						$namevalue ='additionalId="'.$quotAdditionalData['additionalId'].'",adultCost="'.round($quotAdditionalData['adultCost']).'",childCost="'.round($quotAdditionalData['childCost']).'",infantCost="'.round($quotAdditionalData['infantCost']).'",quotationId="'.$lastQuotationId.'",serviceType="'.($quotAdditionalData['serviceType']).'",destinationId="'.($quotAdditionalData['destinationId']).'"';
						addlistinggetlastid('quotationAdditionalMaster',$namevalue);
						
					}
				}
				
			} 				
	}else{ 
		if($_POST['totalrooms']>0 || $queryType==3){ // fixed departure should be added without rooms
			if($destinationId!='' || $queryType==13){
			// get the fromDate and toDate and total Nights travelType
				$frs1=GetPageRecord('min(srdate) as fromDate, max(srdate) as toDate, count(id) as night ','packageQueryDays',' queryId='.$editId.' ');
				$QueryDateData=mysqli_fetch_array($frs1);
				$fromDate = $QueryDateData['fromDate'];
				$toDate = $QueryDateData['toDate'];
				$t_night = $QueryDateData['night']-1;
				  
				// get the season and Season Year
				$dayWise=$_POST['dayWise'];
				$seasonYear = date('Y',strtotime($fromDate));
				if (strtotime($fromDate)>=strtotime($seasonYear.'-04-01') || strtotime($fromDate)<=strtotime($seasonYear.'-09-30')) {
					$seasonType=1;
				}else{
					$seasonType=2;
				} 

				//make displayId or queryId according to financial Year
				// Pakage id block
				if($_POST['moduleType']=='3'){
					$displayId=0;
				}elseif($_POST['moduleType']=='4'){
					$rsd=GetPageRecord('packageId,id',_QUERY_MASTER_,' deletestatus=0 and packageId>0 order by packageId desc ');
					if(mysqli_num_rows($rsd)>0){
						$package=mysqli_fetch_array($rsd);
						$packageId = $package['packageId'];
					}else{
						$packageId=0;
					}
					$newPackageId = $packageId+1;
				}else{
					// get the new displayId for this tourdate
				}

				// displayId and financial year should from current date.
				$queryDate=date('Y-m-d');
				$displayId = generateQueryId($queryDate);
				// get the right financial year
				$financeYear = getFinancialYear($queryDate);
				 if($queryType==13){
					$adult = $_POST['serviceAdult'];
					$child = $_POST['serviceChild'];
					$infant = $_POST['serviceInfant'];
					$fromDate = date('Y-m-d',strtotime('now'));
					$toDate = date('Y-m-d',strtotime('now'));
				 }
			 
				// add new code goes here fromDate
					$namevalue ='companyId="'.$companyId.'",leadPaxName="'.addslashes($guest1a).'",deletestatus=0,queryDate="'.$queryDate.'",attachmentFile="'.$file_name.'",adult="'.$adult.'",destinationId="'.$destinationId.'",countryId="'.$countryId.'",child="'.$child.'",infant="'.$infant.'",categoryId="'.$categoryId.'",mealPlanId="'.$mealPlanId.'",officeBranch="'.$officeBranch.'",assignTo="'.$assignTo.'",salesPersonId="'.$salesPersonId.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",night="'.$t_night.'",tourType="'.$tourType.'",subTourType="'.$subTourType.'",hotelTypeId="'.$hotelTypeId.'",queryType="'.$queryType.'",travelType="'.$travelType.'",paxType="'.$paxType.'",subject="'.$subject.'",expectedSales="'.$budget.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",guest1="'.$guest1.'",guest2="'.$guest2.'",queryPriority="'.$queryPriority.'",clientType="'.$clientType.'",tat="'.$tat.'",queryTimer="'.time().'",rooms="'.$rooms.'",hotelBudget="'.$hotelBudget.'",guest1email="'.$guest1email.'",guest1phone="'.$guest1phone.'",paymentMode="'.$paymentMode.'",closerDate="'.$closerDate.'",leadsource="'.$leadsource.'",campaign="'.$campaign.'",competitor="'.$competitor.'",subDestination="'.$subDestination.'",age1="'.$age1.'",age2="'.$age2.'",age3="'.$age3.'",referanceno="'.$referanceno.'",filecode="'.$filecode.'",single="'.$single.'",doubleocp="'.$double.'",triple="'.$triple.'",childrensage="'.$childfinalage.'",servicePrice="'.$servicePrice.'",quotationYes="'.$quotationYes.'",fromdestinationId="'.$fromdestinationId.'",queryOrder="'.time().'",tatDate="'.date('Y-m-d H:i:s', strtotime("+".$tat." min")).'",tatNumber=0,queryStatus="10",hotelAccommodation="'.$hotelAccommodation.'",earlyCheckin="'.$earlyCheckin.'",hotelCategory="'.$hotelCategory.'",cabforLocal="'.$cabforLocal.'",displayId="'.$displayId.'",mailId="'.$_REQUEST['mailId'].'",gstState="'.$gstState.'",uploadPhoto="'.$uploadPhoto.'",dayWise="'.$dayWise.'",seasonType="'.$seasonType2.'",seasonYear="'.$seasonYear.'",additionalInfo="'.addslashes($_POST['additionalInfo']).'",groupName="'.addslashes($_POST['groupName']).'",groupCode="'.addslashes($_POST['groupCode']).'",preferredLang="'.addslashes($_POST['preferredLang']).'",nationality="'.addslashes($_POST['nationality']).'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",twinRoom="'.$twinRoom.'",cwbRoom="'.$cwbRoom.'",cnbRoom="'.$cnbRoom.'",extraNoofBed="'.$extraNoofBed.'",vehicleId="'.addslashes($_POST['vehicleId']).'",departureDest="'.addslashes($_POST['departureDest']).'",salesassignTo="'.addslashes($_POST['salesassignTo']).'",seriesCode="'.$seriesCode.'",FDCode="'.$FDCode.'",packageSupplier="'.$packageSupplier.'",packageCode="'.$packageCode.'",nationality="'.$nationality.'",marketType="'.$marketType.'",subName="'.$subName.'",moduleType="'.addslashes($_POST['moduleType']).'",sixNoofBedRoom="'.$sixNoofBedRoom.'",eightNoofBedRoom="'.$eightNoofBedRoom.'",tenNoofBedRoom="'.$tenNoofBedRoom.'",teenNoofRoom="'.$teenNoofRoom.'",quadNoofRoom="'.$quadNoofRoom.'",childAge="'.$childAge.'",onlyTFS="'.$onlyTFS.'",needVisa="'.$visaRequired.'",needFlight="'.$needFlight.'",needInsurance="'.$insuranceRequired.'",needPassport="'.$passportRequired.'",needTrain="'.$needTrain.'",needTransfer="'.$needTransfer.'",financeYear="'.$financeYear.'",calculationType="'.$calculationType.'",expire_date="'.$expire_date.'",packageId="'.$newPackageId.'"'; 
					$where='id="'.$editId.'"';
				// die("oooo124");
					$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);
					$statusId=10;
					$notes="Created";


			}else{
				?>
				<script>
				alert('Please select Destination');
				</script>
				<?php
				exit();
				return false;
			}
		}else{
			?>
			<script>
			alert('Please select Room');
			</script>
			<?php
			exit();
			return false;
		}

		if($queryType==13){

			$serviceAdult = $_POST['serviceAdult'];
			$serviceChild = $_POST['serviceChild'];
			$serviceInfant = $_POST['serviceInfant'];

			if($needFlight==2){
				$countFlightNum = $_POST['countNumFlight'];

				for($x=1; $x<=$countFlightNum; $x++){
					$flightDate = date('Y-m-d',strtotime($_POST['flightDate'.$x]));
					$flightDestination = $_POST['flightDestination'.$x];
					$flightToDestination = $_POST['flightToDestination'.$x];

					$nameValue = 'queryId="'.$editId.'",fromDate="'.$flightDate.'",flightQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",fromDestination="'.$flightDestination.'",toDestination="'.$flightToDestination.'",queryType="'.$queryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needFlight="'.$needFlight.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					addlisting('flightQueryMaster',$nameValue);

				}
			}

			if($visaRequired==2){ 
				$countNumVisa = $_POST['countNumVisa']; 
				for($x=1; $x<=$countNumVisa; $x++){
					$visaDate = date('Y-m-d',strtotime($_POST['visaDate'.$x]));
					$visaDestination = $_POST['visaDestination'.$x];
					$visaNameId = $_POST['visaNameId'.$x];
					$visaTypeId = $_POST['visaTypeId'.$x];
					$visaValidity = $_POST['visaValidity'.$x];
					$entryType = $_POST['entryType'.$x];
					
					$nameValue = 'queryId="'.$editId.'",fromDate="'.$visaDate.'",visaQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",destinationId="'.$visaDestination.'",visaTypeId="'.$visaTypeId.'",visaNameId="'.$visaNameId.'",queryType="'.$queryType.'",visaValidity="'.$visaValidity.'",entryType="'.$entryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needVisa="'.$visaRequired.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					addlisting('visaQueryMaster',$nameValue);

				}
			}

			// Insurance service code
			if($insuranceRequired==2){
						
				$countNumInsurance = $_POST['countNumInsurance'];

				for($x=1; $x<=$countNumInsurance; $x++){
					$insuranceFromDate = date('Y-m-d',strtotime($_POST['insuranceFromDate'.$x]));
					$insuranceToDate = date('Y-m-d',strtotime($_POST['insuranceToDate'.$x]));
					$insuranceTypeId = $_POST['insuranceTypeId'.$x];
					$insuranceDestination = $_POST['insuranceDestination'.$x];
					
					$nameValue = 'queryId="'.$editId.'",fromDate="'.$insuranceFromDate.'",toDate="'.$insuranceToDate.'",insuranceQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",destinationId="'.$insuranceDestination.'",insuranceTypeId="'.$insuranceTypeId.'",queryType="'.$queryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needInsurance="'.$insuranceRequired.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					addlisting('insuranceQueryMaster',$nameValue);

				}
			}

			
			// Train service code
			if($needTrain==2){
						
				$countNumInsurance = $_POST['countNumTrain'];

				for($x=1; $x<=$countNumInsurance; $x++){
					$trainDate = date('Y-m-d',strtotime($_POST['trainDate'.$x]));
					$trainDestination =$_POST['trainDestination'.$x];
					$trainToDestination = $_POST['trainToDestination'.$x];
				
					$nameValue = 'queryId="'.$editId.'",fromDate="'.$trainDate.'",trainQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",fromDestination="'.$trainDestination.'",toDestination="'.$trainToDestination.'",queryType="'.$queryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needTrain="'.$needTrain.'",status=1,deletestatus=0,multipleNo="'.$x.'"';

					addlisting('trainQueryMaster',$nameValue);

				}
			}

			// Transfer Service Code
			if($needTransfer==2){
						
				$countNumTransfer = $_POST['countNumTransfer'];

				for($x=1; $x<=$countNumTransfer; $x++){
					$transferDate = date('Y-m-d',strtotime($_POST['transferDate'.$x]));
					$transferDestination = $_POST['transferDestination'.$x];
					$transferTypeId = $_POST['transferTypeId'.$x];
					$transferNameId = $_POST['transferNameId'.$x];
					
					$nameValue = 'queryId="'.$editId.'",fromDate="'.$transferDate.'",transferNameId="'.$transferNameId.'",transferQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",destinationId="'.$transferDestination.'",transferTypeId="'.$transferTypeId.'",queryType="'.$queryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needTransfer="'.$needTransfer.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					addlisting('transferQueryMaster',$nameValue);

				}
			}

			// create Quotation for multiple services

			$rsquery = GetPageRecord('*',_QUERY_MASTER_,'id="'.$editId.'"');
			$queryData = mysqli_fetch_assoc($rsquery);

			$quotationNo = "A";
			$q_token = mt_rand(10000000, 99999999);

			$namevalue='clientType="'.$queryData['clientType'].'",queryId="'.$queryData['id'].'",companyId="'.$queryData['companyId'].'",quotationSubject="'.addslashes($queryData['subject']).'",travelDate="'.$queryData['travelDate'].'",queryDate="'.$queryData['queryDate'].'",fromDate="'.$queryData['fromDate'].'",toDate="'.$queryData['toDate'].'",destinationId="'.$queryData['destinationId'].'",adult="'.$queryData['adult'].'",child="'.$queryData['child'].'",night="'.$queryData['night'].'",rooms="'.$queryData['rooms'].'",infant="'.$queryData['infant'].'",sglRoom="'.$queryData['sglRoom'].'",dblRoom="'.$queryData['dblRoom'].'",tplRoom="'.$queryData['tplRoom'].'",twinRoom="'.$queryData['twinRoom'].'",childwithNoofBed="'.$queryData['cwbRoom'].'",childwithoutNoofBed="'.$queryData['cnbRoom'].'",extraNoofBed="'.$queryData['extraNoofBed'].'",sixNoofBedRoom="'.$queryData['sixNoofBedRoom'].'",eightNoofBedRoom="'.$queryData['eightNoofBedRoom'].'",tenNoofBedRoom="'.$queryData['tenNoofBedRoom'].'",quadNoofRoom="'.$queryData['quadNoofRoom'].'",teenNoofRoom="'.$queryData['teenNoofRoom'].'",guest1="'.$queryData['guest1'].'",modifyBy="'.$_SESSION['userid'].'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'",modifyDate="'.$queryData['modifyDate'].'",quotationId="'.$queryData['id'].'",queryType="'.$queryType.'",travelType="'.$queryData['travelType'].'",trainRequired="'.$queryData['needTrain'].'",transferRequired="'.$queryData['needTransfer'].'",quotationNo="'.$quotationNo.'",subName="'.clean($_POST['subName']).'",isSeries=0,isFD=0,q_token="'.encode($q_token).'",onlyTFS="'.($queryData['onlyTFS']).'",visaRequired="'.$queryData['needVisa'].'",insuranceRequired="'.$queryData['needInsurance'].'",passportRequired="'.$queryData['needPassport'].'",flightRequired="'.$queryData['needFlight'].'",calculationType="'.$queryData['calculationType'].'",status=2,isTourEx=0,deletestatus=0';

			$lastMultiQuotationId = addlistinggetlastid(_QUOTATION_MASTER_,$namevalue);
			if($lastMultiQuotationId>0){
				
				$queryUpdate = updatelisting(_QUERY_MASTER_,'queryStatus="5"','id="'.$queryData['id'].'"');
				if($queryUpdate=='yes'){
					if($needFlight==2){
					updatelisting('flightQueryMaster','quotationId="'.$lastMultiQuotationId.'"','queryId="'.$queryData['id'].'"');
					}  if($visaRequired==2){
					updatelisting('visaQueryMaster','quotationId="'.$lastMultiQuotationId.'"','queryId="'.$queryData['id'].'"');
					} if($insuranceRequired==2){
					updatelisting('insuranceQueryMaster','quotationId="'.$lastMultiQuotationId.'"','queryId="'.$queryData['id'].'"');
					} if($needTrain==2){
					updatelisting('trainQueryMaster','quotationId="'.$lastMultiQuotationId.'"','queryId="'.$queryData['id'].'"');
					}  if($needTransfer==2){
					updatelisting('transferQueryMaster','quotationId="'.$lastMultiQuotationId.'"','queryId="'.$queryData['id'].'"');
					}
				}
			}

		}

	}
	
	$rsc="";
	$rsc=GetPageRecord('*',_QUERY_MASTER_,'id="'.$editId.'"');
	$resultquery=mysqli_fetch_array($rsc); 


	//COMMON
	$addedBy=$_SESSION['userid'];
	$dateAdded=time();
	//add created history
	$namevaluehistory ='queryId="'.$editId.'",statusId="'.$statusId.'",notes="'.$notes.'",addedBy="'.$addedBy.'",dateAdded="'.$dateAdded.'"';
	$addhistory = addlisting('queryHistoryMaster',$namevaluehistory);
 
	if($update=='yes' || $lastQueryId > 0){
	
		$namevalue ='convertQuery='.$editId.'';
		$where='id="'.decode($incomingqueryId).'"';
		$update = updatelisting('mailSectionMaster',$namevalue,$where);
		
		$rs="";
		$rs=GetPageRecord('name',_TOUR_TYPE_MASTER_,'id="'.$tourType.'"');
		$resultpagestourtype=mysqli_fetch_array($rs);
		$tourtypename=$resultpagestourtype['name']; 
		
		$downloadLink='';
		$queryHtml='';
		$rs=GetPageRecord('*','packageQueryDays',' queryId='.$editId.' order by srdate asc');
		$srn = 0;
		while($resListing=mysqli_fetch_array($rs)){
			$multipleDestinationMail.="<tr>
			<td width='100' align='center' bgcolor='#FFFFFF'>".++$srn."</td>";
			if($resultquery['dayWise'] != 2){
				$multipleDestinationMail.="<td width='100' align='center' bgcolor='#FFFFFF'>".date('d-m-Y',strtotime($resListing['srdate']))."</td>";
			}
			$multipleDestinationMail.="<td width='100' align='center' bgcolor='#FFFFFF'>".getDestination($resListing['cityId'])."</td>
			</tr>";
		}
		if($_REQUEST['attachitinerary']==1){
		   $queryHtml.="<img src='".$fullurl."client_read_mail.php?queryId=".$editId."' width='0' height='0'><div style='margin:20px 0px; border:1px #CCCCCC solid; width:795px !important;'>
			<div style='margin-bottom:10px; font-size:16px; padding:10px;'>Query Id  <strong>#".makeQueryId($resultquery['id'])."</strong></div>
			<table width='100%' border='1' cellpadding='6' cellspacing='0' bordercolor='#CCCCCC'>
				<tr>
					<td width='182' bgcolor='#666666' align='center' style='color:#FFFFFF;'>Query Generated Date</td>
						<td width='420' bgcolor='#666666' style='color:#FFFFFF;'>Subject</td>
					<td width='101' align='center' bgcolor='#666666' style='color:#FFFFFF;'>Adult</td>
					<td width='102' align='center' bgcolor='#666666' style='color:#FFFFFF;'>Child</td>
					<td width='101' align='center' bgcolor='#666666' style='color:#FFFFFF;'>Infant</td>
				</tr>
				<tr>
					<td width='182' align='center'>".showdate(date('Y-m-d'))."</td>
					<td width='420'>".$subject."</td>
					<td width='101' align='center'>".$adult."</td>
					<td width='102' align='center'>".$child."</td>
					<td width='101' align='center'>".$infant."</td>
				</tr>
				<tr>
					<td colspan='6' align='left' bgcolor='#666666' style='color:#FFFFFF;'>Destinations</td>
				</tr>
				<tr>
					<td colspan='6' align='left'><table width='100%' border='1' cellpadding='0' cellspacing='0' bordercolor='#999999'>
						<tr>
							<td width='100' align='center' bgcolor='#999999' style='color:#FFFFFF;'><span class='gridlable'>S.N.</span></td>";
							if($resultquery['dayWise'] != 2){
								$queryHtml.="<td width='100' align='center' bgcolor='#999999' style='color:#FFFFFF;'><span class='gridlable'>Date<span class='redmind'></span></span></td>";
							}
							$queryHtml.="<td width='100' align='center' bgcolor='#999999' style='color:#FFFFFF;'><span class='gridlable'>Destination<span class='redmind'></span> </span></td>
						</tr>".$multipleDestinationMail."
					</table></td>
				</tr>
			</table> 
		</div>
		";
		} 
		$wheretem = 'isDefault="1"';
		$rsEMAIL=GetPageRecord('*',_EMAIL_TEMPLATE_MASTER_,$wheretem);
		$resltthankmsg=mysqli_fetch_array($rsEMAIL);
		$thankyouMSG = $resltthankmsg['mailbody'];
		$querythanksmsg= $thankyouMSG;
 

		// $querythanksmsg='Dear Sir/Mam<br><br>Greeting from <strong>'.$clientnameglobal.'</strong>.<br><br>While replying to this query, please dont change the subject line.<br><br>';
		$optionquery.=$queryHtml.$queryHtml2.$description.'<br><br>'.$downloadLink;
		$rs=GetPageRecord('emailsignature',_USER_MASTER_,'id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"');
		$LoginUserDetails=mysqli_fetch_array($rs);
		$description=addslashes($querythanksmsg.$optionquery.$attachmentvar);
		$description2=str_replace('client_read_mail.php','',$description);
		$subject='#'.makeQueryId($resultquery['id']).' '.$subject;

		$namevalue ='subject="'.$subject.'",description="'.$description2.'",attachmentFile="'.$attachmentvar.'",adddate="'.date('Y-m-d H:i:s').'",multiemails="'.$multiemails.'",deletestatus=1,queryid="'.$editId.'",qmailId=1';
		$adds = addlisting(_QUERYMAILS_MASTER_,$namevalue);
		
		if($_REQUEST['moduleType']==2 ){ ?>
			<script>
			parent.window.location.href='showpage.crm?module=series&alt=1';
			</script>
			<?php exit(); 
		} 
		if($_REQUEST['moduleType']==3){ ?>
			<script>
			parent.window.location.href='showpage.crm?module=fixdeparture&alt=1';
			</script>
			<?php exit(); 
		}
		if($_REQUEST['moduleType']==4){ ?>
			<script>
			parent.window.location.href='showpage.crm?module=package&alt=1';
			</script>
			<?php exit(); 
		}
		if($_REQUEST['queryType']==13 || $_REQUEST['queryType']==4 || $_REQUEST['queryType']==3){ ?>
			<script>
			parent.window.location.href='showpage.crm?module=query&daterange=<?php echo date('01-m-Y')."+-+".date('d-m-Y'); ?>';
			</script>
			<?php exit(); 
		}else{ ?>
			<script> 
			parent.alertspopupopen('action=sentcreatequerymail&QueryId=<?php echo $editId; ?>&attachitinerary=1&savenew=<?php if($savenew==1){ echo 1; } else{ echo 0; } ?>','852px','auto');
			</script>
			<?php
		
		} 
	}
}
 
if(trim($_POST['action'])=='editquery' && ( trim($_POST['companyId'])!=''  && trim($_POST['assignTo'])!='' || trim($_POST['moduleType'])==3  || trim($_POST['moduleType'])==4 ) && trim($_POST['subject'])!='' && $_POST['editId']!='' && $_POST['queryedityes']=='yes'){
	error_reporting(0);
	include "config/mail.php";
	$totalQueryCost=clean($_POST['totalQueryCost']);
	$queryType=clean($_POST['queryType']);
	$travelType=clean($_POST['travelType']);
	$paxType=clean($_POST['paxType']);
	$savenew=clean($_POST['savenew']);

	$clientType=clean($_POST['clientType']);
	$companyId=decode($_POST['companyId']); 
	// $nationality=clean($_POST['nationId']);
	// $marketType=clean($_POST['marketId']);
	$marketType = getMaketTypeIdByClient($companyId,$clientType);
	$nationality = getNationalityIdByClient($companyId,$clientType);


	$editId=decode($_POST['editId']);
	$companyName=clean($_POST['companyName']);
	$adult=clean($_POST['adult']);
	$destinationId=$_POST['destinationId'];
	
	if(isset($_POST['destinationId'])){
		foreach($_POST['destinationId'] as $k1=>$v1){
			$destinationId .= $_POST['destinationId'][$k1].',';
		}
	}
	$destinationId = str_replace('Array','',$destinationId);
	$child=clean($_POST['child']);
	$infant=clean($_POST['infant']);
	$queryPriority=clean($_POST['queryPriority']);
	$categoryId=clean($_POST['categoryId']);
	$mealPlanId=clean($_POST['mealPlanId']);
	$officeBranch=clean($_POST['officeBranch']);
	$assignTo=decode($_POST['assignTo']);
	$assignTo3=decode($_POST['assignTo3']);
	$salesPersonId=decode($_POST['salesPersonId']);
	$description=clean($_POST['description']);
	$budget=clean($_POST['budget']); //edit query here
	$guest1=clean($_POST['guest1']);
	$guest2=clean($_POST['guest2']);
	$tourType=clean($_POST['tourType']);
	$subTourType=clean($_POST['subTourType']);
	$hotelTypeId=clean($_POST['hotelTypeId']);
	$subject=clean($_POST['subject']);
	$seriesCode=clean($_POST['seriesCode']);
	$FDCode=clean($_POST['FDCode']);
	$packageSupplier=clean(decode($_POST['packagesupplierId']));
	$packageCode=clean($_POST['packageCode']);
	$subName=clean($_POST['subName']);
	$multiemails=clean($_POST['multiemails']);
	$occupancyType=clean($_POST['occupancyType']);
	$rooms=clean($_POST['rooms']);
	$hotelAccommodation=($_POST['hotelAccommodation']);
	$needFlight=($_POST['needFlight']);
	$earlyCheckin=($_POST['earlyCheckin']);
	$hotelCategory=($_POST['hotelCategory']);
	$cabforLocal=($_POST['cabforLocal']);
	$hotelBudget=clean($_POST['hotelBudget']);
	$quotationYes=clean($_POST['quotationYes']);
	$guest1phone=clean($_POST['guest1phone']);
	$guest1email=($_POST['guest1email']);
	$paymentMode=($_POST['paymentMode']);
	// $expectedSales=($_POST['expectedSales']);
	$closerDate=($_POST['closerDate']);
	$closerDate=date("Y-m-d", strtotime($closerDate));
	$leadsource=($_POST['leadsource']);
	$campaign=($_POST['campaign']);
	$competitor=($_POST['competitor']);
	$subDestination=($_POST['subDestination']);
	$single=($_POST['single']);
	$double=($_POST['double']);
	$triple=($_POST['triple']);
	$cwbRoom=clean($_POST['cwbRoom']);
	$age1=clean($_POST['age1']);
	$guest1a=clean($_POST['guest1']);
	$age2=clean($_POST['age2']);
	$age3=clean($_POST['age3']); 
	$referanceno=clean($_POST['referanceno']);
	$servicePrice=$_POST['servicePrice'];
	$fromdestinationId=$_POST['fromdestinationId'];
	$filecode=clean($_POST['filecode']);
	$dateAdded=time();
	$guest1=clean($_POST['agentb2cname']);
	$guest1phone=clean($_POST['agentb2cnumber']);
	$guest1email=($_POST['agentb2cmail']);
	$gstState=clean($_POST['gstState']);
	$dayWise=clean($_POST['dayWise']);
	$preferredLang=$_POST['preferredLang'];
	$groupName=$_POST['groupName'];
	$groupCode=clean($_POST['groupCode']);
	$calculationType=clean($_POST['calculationType']);
	$currencyId=clean($_POST['currencyId']);
	$sixNoofBedRoom=clean($_POST['sixNoofBedRoom']);
	$eightNoofBedRoom=clean($_POST['eightNoofBedRoom']);
	$tenNoofBedRoom=clean($_POST['tenNoofBedRoom']);
	$teenNoofRoom=clean($_POST['teenNoofRoom']);
	$quadNoofRoom=clean($_POST['quadNoofRoom']);
	$onlyTFS=clean($_POST['onlyTFS']);
	$visaRequired=clean($_POST['visaRequired']);
	$insuranceRequired=clean($_POST['insuranceRequired']);
	$passportRequired=clean($_POST['passportRequired']);
	$needTrain=clean($_POST['needTrain']);
	$needTransfer=clean($_POST['needTransfer']);



	$tat=clean($_POST['tat']);
	$expire_date=date('Y-m-d',strtotime($_POST['expire_date']));
	if($queryType==13){
			$adult = $_POST['serviceAdult'];
			$child = $_POST['serviceChild'];
			$infant = $_POST['serviceInfant'];
	}

	foreach($_POST['childAge'] as $key => $value){
		$childAge .= $_POST['childAge'][$key].',';
	}
	// $destinationId = str_replace('Array','',$destinationId);
	if(isset($_FILES['attachmentFile']['name'])){
		$file_name=str_replace(' ', '', $_FILES['attachmentFile']['name']);
		$file_name=time().'-'.$file_name;
		copy($_FILES['attachmentFile']['tmp_name'],"dirfiles/".$file_name);
		$attachmentvar=" <br><br><a href='".$fullurl."download/".$file_name."' target='_blank'><strong>Download Attachment</strong></a>";
	}
	$uploadPhoto='';
	if(isset($_FILES['uploadPhoto']['name'])){
		$uploadPhoto=str_replace(' ', '', $_FILES['uploadPhoto']['name']);
		$uploadPhoto=time().'-'.$uploadPhoto;
		copy($_FILES['uploadPhoto']['tmp_name'],"dirfiles/".$uploadPhoto);
	}
	if($_POST['oldimg']!=''){
		$uploadPhoto=addslashes($_POST['oldimg']);
	}
 	$namevalue ='companyId="'.$companyId.'",leadPaxName="'.addslashes($guest1a).'",deletestatus=0,adult="'.$adult.'",child="'.$child.'",infant="'.$infant.'",categoryId="'.$categoryId.'",mealPlanId="'.$mealPlanId.'",officeBranch="'.$officeBranch.'",assignTo="'.$assignTo.'",assignTo3="'.$assignTo3.'",paxType="'.$paxType.'",description="'.$description.'",tourType="'.$tourType.'",subTourType="'.$subTourType.'",hotelTypeId="'.$hotelTypeId.'",subject="'.$subject.'",modifyBy="'.$_SESSION['userid'].'",modifyDate="'.$dateAdded.'",guest1="'.$guest1.'",guest2="'.$guest2.'",queryPriority="'.$queryPriority.'",clientType="'.$clientType.'",rooms="'.$rooms.'",hotelBudget="'.$hotelBudget.'",guest1phone="'.$guest1phone.'",guest1email="'.$guest1email.'",paymentMode="'.$paymentMode.'",queryTimer="'.time().'",closerDate="'.$closerDate.'",leadsource="'.$leadsource.'",campaign="'.$campaign.'",competitor="'.$competitor.'",subDestination="'.$subDestination.'",age1="'.$age1.'",age2="'.$age2.'",age3="'.$age3.'",filecode="'.$filecode.'",referanceno="'.$referanceno.'",single="'.$single.'",doubleocp="'.$double.'",quotationYes="'.$quotationYes.'",triple="'.$triple.'",servicePrice="'.$servicePrice.'",queryOrder="'.time().'",tatDate="'.date('Y-m-d H:i:s', strtotime("+".$tat." min")).'",hotelAccommodation="'.$hotelAccommodation.'",needFlight="'.$needFlight.'",earlyCheckin="'.$earlyCheckin.'",hotelCategory="'.$hotelCategory.'",cabforLocal="'.$cabforLocal.'",gstState="'.$gstState.'",uploadPhoto="'.$uploadPhoto.'",queryType="'.$queryType.'",travelType="'.$travelType.'",additionalInfo="'.addslashes($_POST['additionalInfo']).'",groupName="'.addslashes($_POST['groupName']).'",groupCode="'.addslashes($_POST['groupCode']).'",preferredLang="'.addslashes($_POST['preferredLang']).'",nationality="'.$nationality.'",marketType="'.$marketType.'",sglRoom="'.addslashes($_POST['sglRoom']).'",dblRoom="'.addslashes($_POST['dblRoom']).'",tplRoom="'.addslashes($_POST['tplRoom']).'",twinRoom="'.addslashes($_POST['twinRoom']).'",cwbRoom="'.addslashes($_POST['cwbRoom']).'",cnbRoom="'.addslashes($_POST['cnbRoom']).'",extraNoofBed="'.addslashes($_POST['extraNoofBed']).'",vehicleId="'.addslashes($_POST['vehicleId']).'",departureDest="'.addslashes($_POST['departureDest']).'",salesassignTo="'.addslashes($_POST['salesassignTo']).'",seriesCode="'.$seriesCode.'",FDCode="'.$FDCode.'",packageSupplier="'.$packageSupplier.'",packageCode="'.$packageCode.'",subName="'.$subName.'",expectedSales="'.$budget.'",moduleType="'.addslashes($_POST['moduleType']).'",sixNoofBedRoom="'.$sixNoofBedRoom.'",eightNoofBedRoom="'.$eightNoofBedRoom.'",tenNoofBedRoom="'.$tenNoofBedRoom.'",teenNoofRoom="'.$teenNoofRoom.'",quadNoofRoom="'.$quadNoofRoom.'",childAge="'.$childAge.'",onlyTFS="'.$onlyTFS.'",needVisa="'.$visaRequired.'",needInsurance="'.$insuranceRequired.'",needPassport="'.$passportRequired.'",needTrain="'.$needTrain.'",needTransfer="'.$needTransfer.'",calculationType="'.$calculationType.'",expire_date="'.$expire_date.'"';
	//  die("oooo125");
	$where='id='.$editId.'';
	$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);
	if($update=='yes'){

	if($queryType==13){

		$serviceAdult = $_POST['serviceAdult'];
		$serviceChild = $_POST['serviceChild'];
		$serviceInfant = $_POST['serviceInfant'];

			if($needFlight==2){
				$countNumFlight = $_POST['countNumFlight'];
				for($x=1; $x<=$countNumFlight; $x++){

					$fromDate = date('Y-m-d',strtotime($_POST['flightDate'.$x]));
					$flightDestination = $_POST['flightDestination'.$x];
					$flightToDestination = $_POST['flightToDestination'.$x];
					$flightEditId = $_POST['flightEditId'.$x];

					if($flightEditId!=''){
					$nameValue = 'fromDate="'.$fromDate.'",fromDestination="'.$flightDestination.'",toDestination="'.$flightToDestination.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needFlight="'.$needFlight.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					$where = 'id="'.$flightEditId.'" and queryId="'.$editId.'"';
					updatelisting('flightQueryMaster',$nameValue,$where);
					}else{

					$nameValue = 'queryId="'.$editId.'",fromDate="'.$fromDate.'",flightQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",fromDestination="'.$flightDestination.'",toDestination="'.$flightToDestination.'",queryType="'.$queryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needFlight="'.$needFlight.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					addlisting('flightQueryMaster',$nameValue);
					}
					

				}
			}

			// Visa Services code
			if($visaRequired==2){
			
				$countNumVisa = $_POST['countNumVisa'];
	
				for($x=1; $x<=$countNumVisa; $x++){
					$visaDate = date('Y-m-d',strtotime($_POST['visaDate'.$x]));
					$visaDestination = $_POST['visaDestination'.$x];
					$visaNameId = $_POST['visaNameId'.$x];
					$visaTypeId = $_POST['visaTypeId'.$x];
					$visaValidity = $_POST['visaValidity'.$x];
					$entryType = $_POST['entryType'.$x];
					$visaEditId = $_POST['visaEditId'.$x];
					
					if($visaEditId!=''){

					$nameValue = 'fromDate="'.$visaDate.'",destinationId="'.$visaDestination.'",visaTypeId="'.$visaTypeId.'",visaNameId="'.$visaNameId.'",visaValidity="'.$visaValidity.'",entryType="'.$entryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needVisa="'.$visaRequired.'",status=1,deletestatus=0,multipleNo="'.$x.'"';

					$where = 'id="'.$visaEditId.'" and queryId="'.$editId.'"';
					updatelisting('visaQueryMaster',$nameValue,$where);
					}else{
					$nameValue = 'queryId="'.$editId.'",fromDate="'.$visaDate.'",visaQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",destinationId="'.$visaDestination.'",visaTypeId="'.$visaTypeId.'",visaNameId="'.$visaNameId.'",queryType="'.$queryType.'",visaValidity="'.$visaValidity.'",entryType="'.$entryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needVisa="'.$visaRequired.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					addlisting('visaQueryMaster',$nameValue);
					}
	
				}
				}

				// Insurance Service Code
				if($insuranceRequired==2){
					
					$countNumInsurance = $_POST['countNumInsurance'];
	
				for($x=1; $x<=$countNumInsurance; $x++){
					$insuranceFromDate = date('Y-m-d',strtotime($_POST['insuranceFromDate'.$x]));
					$insuranceToDate = date('Y-m-d',strtotime($_POST['insuranceToDate'.$x]));
					$insuranceTypeId = $_POST['insuranceTypeId'.$x];
					$insuranceDestination = $_POST['insuranceDestination'.$x];
					$insuranceEditId = $_POST['insuranceEditId'.$x];
					
					if($insuranceEditId!=''){
					$nameValue = 'fromDate="'.$insuranceFromDate.'",toDate="'.$insuranceToDate.'",destinationId="'.$insuranceDestination.'",insuranceTypeId="'.$insuranceTypeId.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needInsurance="'.$insuranceRequired.'",status=1,deletestatus=0,multipleNo="'.$x.'"';

					$where = 'id="'.$insuranceEditId.'" and queryId="'.$editId.'"';
					updatelisting('insuranceQueryMaster',$nameValue,$where);

					}else{
					$nameValue = 'queryId="'.$editId.'",fromDate="'.$insuranceFromDate.'",toDate="'.$insuranceToDate.'",insuranceQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",destinationId="'.$insuranceDestination.'",insuranceTypeId="'.$insuranceTypeId.'",queryType="'.$queryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needInsurance="'.$insuranceRequired.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					addlisting('insuranceQueryMaster',$nameValue);
					}

				}
				}

				// Train Service Code
				if($needTrain==2){
					
					$countNumInsurance = $_POST['countNumTrain'];
	
				for($x=1; $x<=$countNumInsurance; $x++){
					$trainDate = date('Y-m-d',strtotime($_POST['trainDate'.$x]));
					$trainDestination = $_POST['trainDestination'.$x];
					$trainToDestination = $_POST['trainToDestination'.$x];
					$trainEditId = $_POST['trainEditId'.$x];

					if($trainEditId!=''){
					$nameValue = 'fromDate="'.$trainDate.'",fromDestination="'.$trainDestination.'",toDestination="'.$trainToDestination.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needTrain="'.$needTrain.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					$where = 'id="'.$flightEditId.'" and queryId="'.$editId.'"';
					updatelisting('trainQueryMaster',$nameValue,$where);

					}else{

					$nameValue = 'queryId="'.$editId.'",fromDate="'.$trainDate.'",trainQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",fromDestination="'.$trainDestination.'",toDestination="'.$trainToDestination.'",queryType="'.$queryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needTrain="'.$needTrain.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
	
					addlisting('trainQueryMaster',$nameValue);
				}
				}
				}

				// Transfer Service Code
				if($needTransfer==2){
					
					$countNumTransfer = $_POST['countNumTransfer'];
	
				for($x=1; $x<=$countNumTransfer; $x++){
					$transferDate = date('Y-m-d',strtotime($_POST['transferDate'.$x]));
					$transferDestination = $_POST['transferDestination'.$x];
					$transferTypeId = $_POST['transferTypeId'.$x];
					$transferNameId = $_POST['transferNameId'.$x];
					$trnasferEditId = $_POST['trnasferEditId'.$x];

					if($trnasferEditId!=''){
					$nameValue = 'fromDate="'.$transferDate.'",transferNameId="'.$transferNameId.'",destinationId="'.$transferDestination.'",transferTypeId="'.$transferTypeId.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needTransfer="'.$needTransfer.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					
					$where = 'id="'.$trnasferEditId.'" and queryId="'.$editId.'"';
					updatelisting('transferQueryMaster',$nameValue,$where);

					}else{

					$nameValue = 'queryId="'.$editId.'",fromDate="'.$transferDate.'",transferNameId="'.$transferNameId.'",transferQueryDate="'.date('Y-m-d H:i:s',strtotime('now')).'",destinationId="'.$transferDestination.'",transferTypeId="'.$transferTypeId.'",queryType="'.$queryType.'",adult="'.$serviceAdult.'",child="'.$serviceChild.'",infant="'.$serviceInfant.'",needTransfer="'.$needTransfer.'",status=1,deletestatus=0,multipleNo="'.$x.'"';
					addlisting('transferQueryMaster',$nameValue);
					}
				}
			}
			
					
		}


	?>
	<script>
	parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo encode($editId); ?>&daterange=<?php echo date('01-m-Y')."+-+".date('d-m-Y'); ?>');
	</script>
	<?php
	}
} 


if($_REQUEST['sendaddquerytoemail']=='1' && trim($_REQUEST['queryid'])!='' && trim($_REQUEST['attachitinerary'])!=''){
	include "config/mail.php";
	$editId = $_REQUEST['queryid'];
	$attachitinerary=$_REQUEST['attachitinerary'];
	$savenew=$_REQUEST['savenew'];

	// UPDATE THE FIRST MAIL WITH MARK AS UNDELETED
	$update = updatelisting(_QUERYMAILS_MASTER_,'deletestatus=0','queryid="'.$editId.'"');

	$rs=GetPageRecord('servicePrice,assignTo,clientType,companyId,tourType,dayWise,subject,displayId',_QUERY_MASTER_,'  id="'.$editId.'"  ');
	$resultpages=mysqli_fetch_array($rs);

	$servicePrice=$resultpages['servicePrice'];
	$assignTo=$resultpages['assignTo'];
	$clientType=$resultpages['clientType'];
	$companyId=$resultpages['companyId'];

	$rs=GetPageRecord('emailsignature',_USER_MASTER_,'id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"');
	$LoginUserDetails=mysqli_fetch_array($rs);

	$mailsubject='#'.makeQueryId($resultpages['id']).' '.$resultpages['subject'];

	$rs=GetPageRecord('queryemail',_QUERY_MAILS_SECTION_MASTER_,'id=1');
	$resultpageemail=mysqli_fetch_array($rs);

	$rs=GetPageRecord('email',_USER_MASTER_,'id="'.$assignTo.'"');
	$resultpageassignemailOppsperson=mysqli_fetch_array($rs);

	$assignTo_opspersonEmail = '';
	if($resultpageassignemailOppsperson['email']!=''){
		$assignTo_opspersonEmail = $resultpageassignemailOppsperson['email'].',';
	}

	$corporatesalesperson='';
	if($clientType==1){
		$rs=GetPageRecord('assignTo',_CORPORATE_MASTER_,'id="'.$companyId.'"');
		$resultpageassignemail=mysqli_fetch_array($rs);

		$rs=GetPageRecord('email',_USER_MASTER_,'id="'.$resultpageassignemail['assignTo'].'"');
		$resultpageassignemail2=mysqli_fetch_array($rs);
		$corporatesalesperson=$resultpageassignemail2['email'].',';
	}

	//=======================================================
	$rsdes=GetPageRecord('description,id,multiemails',_QUERYMAILS_MASTER_,'queryid="'.$editId.'"');
	$getDesc=mysqli_fetch_array($rsdes);
	$description4=$getDesc['description'].'<img src="'.$fullurl.'readmail.php?id='.$getDesc['id'].'" width="0"  style="opacity: 0; filter: alpha(opacity=0);"  >';
	//=======================================================

	if($clientType==1){
		$mailto_client=(getPrimaryEmail($companyId,'corporate'));
	}
	if($clientType==2){
		$mailto_client=getPrimaryEmail($companyId,'contacts');
	}
	if($clientType==1){
		$mailtoMulti=getMultiPrimaryEmail($companyId,'corporate');
	}
	if($clientType==2){
		$mailtoMulti=getMultiPrimaryEmail($companyId,'contacts');
	}
	if($mailtoMulti!=''){
		$multiemails=$mailtoMulti.','.$getDesc['multiemails'];
	} else {
		$multiemails='';
	}

	if($resultpageemail['queryemail']!=''){
		$mailto_team = $resultpageemail['queryemail'];
		$queryemail = $resultpageemail['queryemail'].',';
	}else{
		$mailto_team = $corporatesalesperson;
		$queryemail = $corporatesalesperson.',';
	}

	$fromemail='';
	$ccmail_team=$corporatesalesperson.$assignTo_opspersonEmail.$multiemails;
	$ccmail_client=$assignTo_opspersonEmail.$queryemail.$multiemails;
	// CC EMAILS HERE
	
	if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
	    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
	}

	$maildescription=stripslashes($getDesc['description']).stripslashes($emailsignature);
	// $maildescription4=stripslashes($description4).stripslashes($LoginUserDetails['emailsignature']);
  	 
	// echo send_template_mail($fromemail,$mailto_team,$mailsubject,$maildescription,$ccmail_team);
	echo send_template_mail($fromemail,$mailto_client,$mailsubject,$maildescription,$ccmail_client);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.setupbox('showpage.crm?module=query<?php if($savenew == 1){ ?>&add=yes<?php }?>&daterange=<?php echo date('01-m-Y')."+-+".date('d-m-Y'); ?>');
	</script>
	<?php
	exit();
}

// add agent from query here 
if($_REQUEST['action']=='addagentfromQuery' && $_POST['companyName']!='' && $_POST['businessType']!=2){

	
	$businessType = $_POST['businessType'];
	$companyName = $_POST['companyName'];
	$copmanyType = $_POST['copmanyType'];
	$salesPerson = $_POST['salesPerson'];
	$operationPerson = $_POST['operationPerson'];
	$marketType = $_POST['marketType'];
	$nationality = $_POST['nationality'];
	$companyCategory = $_POST['categoryid'];
	$tourType = $_POST['tourType'];
	$division = $_POST['division'];
	$contactPerson = $_POST['contactPerson'];
	$designation = $_POST['designation'];
	$countryCode = $_POST['countryCode'];
	$phonecontprson = $_POST['phone'];
	$emailcontprson = $_POST['email'];

	$countryId=($_POST['countryId2']);
	$stateId=clean($_POST['stateId2']);
	$cityId=clean($_POST['cityId2']);
	$address=clean($_POST['address1']);
	$pinCode=clean($_POST['pinCode']);



	$addTo = $_POST['addTo'];
	$dateAdded= date('Y-m-d');
	$addedBy=$_SESSION['userid'];
	
	// agent duplicate code 
	$rsr=GetPageRecord('*','contactPersonMaster','email="'.encode($emailcontprson).'" ');
	// $editresult=mysqli_num_rows($rsr);
	if(mysqli_num_rows($rsr) > 0 ){
		// echo "This is a agent testing222";
		// exit();
        ?>
        <script>
        parent.alert('This Agent Already Exist!');
		parent.$('#pageloader').hide();
		parent.$('#pageloading').hide();
        </script> 
        <?php 
		exit();
		
    }else{

	$nameValue ='companyTypeId="'.$copmanyType.'",name="'.$companyName.'",contactPerson="'.$contactPerson.'",status="1",assignTo="'.$salesPerson.'",addedBy="'.$addedBy.'",dateAdded="'.$dateAdded.'",bussinessType="'.$businessType.'",companyCategory="'.$companyCategory.'",OpsAssignTo="'.$operationPerson.'",nationality="'.$nationality.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address1="'.$address.'",pinCode="'.$pinCode.'",tourType="'.$tourType.'",marketType="'.$marketType.'"';
	
	$add = addlistinggetlastid(_CORPORATE_MASTER_,$nameValue);

	
		$allvaluecontactperson ='contactPerson="'.$contactPerson.'",corporateId="'.$add.'",designation="'.$designation.'",phone="'.encode($phonecontprson).'",email="'.encode($emailcontprson).'",countryCode="'.$countryCode.'",primaryvalue="1",division="'.$division.'"';
		$add = addlisting('contactPersonMaster',$allvaluecontactperson);

		if($addTo==="meetings"){
			?>
		<script>
		parent.window.location.href='showpage.crm?module=meetings&add=yes';
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
	</script>

	<?php
		}else if($addTo==="calls"){
			?>
			<script>
			parent.window.location.href='showpage.crm?module=calls&add=yes';
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
		</script>
	
		<?php
		}else if($addTo==="tasks"){
			?>
			<script>
			parent.window.location.href='showpage.crm?module=tasks&add=yes';
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
		</script>
	
		<?php
		}else{
	?>
		<script>
		parent.window.location.href='showpage.crm?module=query&add=yes';
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
	</script>

	<?php
	}
}
	
} 
// Add B2C From Query 
if($_REQUEST['action']=='addClientfromQuery' && $_POST['businessType']=='2'){

	$nationality = $_POST['nationality'];
	$marketType = $_POST['marketType'];
	$salesPerson = $_POST['salesPerson'];
	$contacttitleId = $_POST['contacttitleId'];
	$firstName = $_POST['firstName'];
	$middleName = $_POST['middleName'];
	$lastName = $_POST['lastName'];
	$gender = $_POST['gender'];
	$birthDate1 = $_POST['birthDate'];
	$countryId = $_POST['country'];
	$stateId = $_POST['loadstates'];
	$cityId = $_POST['loadcities'];
	$pinzip = $_POST['pinzip'];
	$addressInfo = $_POST['addressInfo'];
	$PhoneTypeId = $_POST['PhoneTypeId'];
	$PhoneNo = $_POST['PhoneNo'];
	$countryCode1 = $_POST['countryCode'];
	$EmailTypeId = $_POST['EmailTypeId'];
	$Email = $_POST['Email'];
	$businessType = $_POST['businessType'];
	$countryCode = $_POST['countryCode'];
	$addTo = $_POST['addTo'];
	// $dateAdded = time();
	$birthDate = date("Y-m-d",strtotime($birthDate1));
	$dateAdded= date('Y-m-d');
	$addedBy=$_SESSION['userid'];
	// B2C duplicate code 
	$rsr=GetPageRecord('*','emailMaster','email="'.$Email.'" and emailType="7"');
	// $editresult=mysqli_num_rows($rsr);
	if(mysqli_num_rows($rsr) > 0 ){
		// echo "This is a B2C testing222";
		// exit();
        ?>
        <script>
        parent.alert('This B2C Already Exist!');
		parent.$('#pageloader').hide();
		parent.$('#pageloading').hide();
        </script> 
        <?php 
		exit();
		
    }else{
	$namevalue ='contacttitleId="'.$contacttitleId.'",firstName="'.$firstName.'",middleName="'.$middleName.'",lastName="'.$lastName.'",gender="'.$gender.'",birthDate="'.$birthDate.'",marketType="'.$marketType.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",pinzip="'.$pinzip.'",assignTo="'.$salesPerson.'",addressInfo="'.$addressInfo.'",addedBy="'.$addedBy.'",dateAdded="'.$dateAdded.'",pinCode="'.$pinCode.'",nationality="'.$nationality.'",tourType="'.$tourType.'",status=1,mobilePin="'.$mobilePin.'",contactType="'.$businessType.'",corporateId="'.$corporateId.'",designationName="'.$designationName.'"';
	$add = addlistinggetlastid(_CONTACT_MASTER_,$namevalue);


	$nameEmail = 'email="'.$Email.'",emailType="'.$EmailTypeId.'",primaryvalue="1",masterId="'.$add.'",sectionType="contacts",dateAdded="'.$dateAdded.'",deletestatus="0"';
	$eid = addlistinggetlastid(_EMAIL_MASTER_,$nameEmail);

	$namePhone = 'phoneNo="'.$PhoneNo.'",countryCode="'.$countryCode1.'",phoneType="'.$PhoneTypeId.'",primaryvalue="1",masterId="'.$add.'",sectionType="contacts",dateAdded="'.$dateAdded.'",EID="'.$eid.'",deletestatus="0"';

	addlisting(_PHONE_MASTER_,$namePhone);


	// $nameEmail = 'email="'.$Email.'",emailType="'.$EmailTypeId.'",phone="'.$PhoneNo.'",phoneType="'.$PhoneTypeId.'",primaryvalue="1",masterId="'.$add.'",sectionType="contacts",dateAdded="'.$dateAdded.'",deletestatus="0"';
	// addlisting('EmailandPhoneMaster',$nameEmail);

	
	if($addTo==="meetings"){
		?>
	<script>
	parent.window.location.href='showpage.crm?module=meetings&add=yes';
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
</script>

<?php
	}else if($addTo==="calls"){
		?>
		<script>
		parent.window.location.href='showpage.crm?module=calls&add=yes';
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
	</script>

	<?php
	}else if($addTo==="tasks"){
		?>
		<script>
		parent.window.location.href='showpage.crm?module=tasks&add=yes';
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
	</script>

	<?php
	}else{
?>
	<script>
	parent.window.location.href='showpage.crm?module=query&add=yes';
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
</script>

<?php
}
	}
}


if(trim($_POST['action'])=='adddocket'  && trim($_POST['opsPersonId'])!='' && trim($_POST['leadPaxName'])!='' && $_POST['editId']!='' ){
	include "config/mail.php";

	$savenew = clean($_POST['savenew']);
	$paxType = clean($_POST['paxType']);
	$quotationYes = clean($_POST['quotationYes']);
	$moduleType = clean($_POST['moduleType']);
	$attachitinerary = clean($_POST['attachitinerary']);
	$dayWise = clean($_POST['dayWise']);
	$editId = decode($_POST['editId']);
	$mailId = clean($_POST['mailId']);
 
	$clientType = clean($_POST['clientType']);
	$companyName = clean($_POST['companyName']);
	$companyId = decode($_POST['companyId']); 

	$opsPersonName = clean($_POST['opsPersonName']);
	$opsPersonId = decode($_POST['opsPersonId']);
	$salesassignTo = clean($_POST['salesassignTo']);
	$contactPName = clean($_POST['contactPName']);
	$guest1phone = clean($_POST['agentb2cnumber']);
	$agentDivision = clean($_POST['agentDivision']);
	$agentDesignation = clean($_POST['agentDesignation']);
	$guest1email = clean($_POST['agentb2cmail']);
	$marketType = clean($_POST['marketId']);
	$nationality = clean($_POST['nationId']);
	$leadPaxName = clean($_POST['leadPaxName']);
	$subject = clean($_POST['subject']);
	$adult = clean($_POST['adult']);
	$child = clean($_POST['child']);
	$infant = clean($_POST['infant']);
	$sglRoom = clean($_POST['sglRoom']);
	$dblRoom = clean($_POST['dblRoom']);
	$tplRoom = clean($_POST['tplRoom']);
	$twinRoom = clean($_POST['twinRoom']);
	$extraBedC = clean($_POST['extraBedC']);
	$extraBedA = clean($_POST['extraBedA']);
	$tourType = clean($_POST['tourType']);
	$language = clean($_POST['language']);
	$hotelCategory = clean($_POST['hotelCategory']);
	$mealPlanId = clean($_POST['mealPlanId']);
	$multiemails = clean($_POST['multiemails']);
	$additionalInfo = clean($_POST['additionalInfo']);
	$dateAdded=time();
	$queryDate2 = date('Y-m-d',strtotime($_POST['queryDate2']));

	$dockSerQuery='';
	$dockSerQuery=GetPageRecord('min(startDate) as fromDate, max(endDate) as toDate','docketServiceItinerary',' queryId='.$editId.' ');
	if(mysqli_num_rows($dockSerQuery)>0){
		$docketServiceData=mysqli_fetch_array($dockSerQuery);
		$fromDate2 = $docketServiceData['fromDate'];
		$toDate2 = $docketServiceData['toDate'];
		$objec=date_diff(date_create($fromDate2),date_create($toDate2));
		$night2 = $objec->format("%a");
	}else{
		$fromDate2 = date('Y-m-d');
		$toDate2 = date('Y-m-d');
		$objec=date_diff(date_create($fromDate2),date_create($toDate2));
		$night2 = $objec->format("%a");

	}

	//make displayId or queryId
	$rsd=GetPageRecord('displayId',_QUERY_MASTER_,' 1 and moduleType=5 and deletestatus=0 order by displayId desc ');
	$display=mysqli_fetch_array($rsd);
	$displayId = $display['displayId']+1;


	// get the season and Season Year
	$seasonYear = date('Y',strtotime($fromDate2));
	if (strtotime($fromDate2)>=strtotime($seasonYear.'-04-01') || strtotime($fromDate)<=strtotime($seasonYear.'-09-30')){
		$seasonType=1;
	}else{
		$seasonType=2;
	} 

	if(isset($_FILES['attachmentFile']['name'])){
		$file_name=$_FILES['attachmentFile']['name'];
		$file_name=time().'-'.$file_name;
		copy($_FILES['attachmentFile']['tmp_name'],"dirfiles/".$file_name);
		$attachmentvar=" <br><br><a href='".$fullurl."download/".$file_name."' target='_blank'><strong>Download Attachment</strong></a>";
	}

	$uploadPhoto='';
	if(isset($_FILES['uploadPhoto']['name'])){
		$uploadPhoto=str_replace(' ', '', $_FILES['uploadPhoto']['name']);
		$uploadPhoto=time().'-'.$uploadPhoto;
		copy($_FILES['uploadPhoto']['tmp_name'],"dirfiles/".$uploadPhoto);
	}
	// client Details
	if($_POST['addnewcontactmain'] == 1){
		// new agent or b2c here 
		if($clientType=='2'){
			$namevalue ='firstName="'.$companyName.'",assignTo="'.$salesassignTo.'",addedBy='.$_SESSION['userid'].',dateAdded='.$dateAdded.'';
			$lstaddid=addlistinggetlastid(_CONTACT_MASTER_,$namevalue);
			$allvaluephone ='phoneNo="'.$guest1phone.'",phoneType=1,primaryvalue=1,sectionType="contacts",masterId="'.$lstaddid.'"';
			addlisting(_PHONE_MASTER_,$allvaluephone);
			$allvaluephone ='email="'.$guest1email.'",emailType=7,primaryvalue=1,sectionType="contacts",masterId="'.$lstaddid.'"';
			addlisting(_EMAIL_MASTER_,$allvaluephone);
		}else{
			$namevalue ='name="'.$companyName.'",OpsAssignTo="'.$opsPersonId.'",assignTo="'.$salesassignTo.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",bussinessType="'.$clientType.'"';
			$lstaddid=addlistinggetlastid(_CORPORATE_MASTER_,$namevalue);
			
			$allvaluecontactperson ='contactPerson="'.$contactPName.'",corporateId="'.$lstaddid.'",designation="'.($agentDivision).'",phone="'.encode($guest1phone).'",email="'.encode($guest1email).'",division="'.($agentDivision).'",primaryvalue=1';
			addlisting('contactPersonMaster',$allvaluecontactperson);
		}
		$companyId=$lstaddid;

	}

	// queryDate
	$namevalue ='paxType="'.$paxType.'",quotationYes="'.$quotationYes.'",moduleType="'.$moduleType.'",dayWise="'.$dayWise.'",fromDate="'.$fromDate2.'",toDate="'.$toDate2.'",night="'.$night2.'",queryDate="'.$queryDate2.'",clientType="'.$clientType.'",companyId="'.$companyId.'",assignTo="'.$opsPersonId.'",salesassignTo="'.$salesassignTo.'",agentDivision="'.$agentDivision.'",agentDesignation="'.$agentDesignation.'",marketType="'.$marketType.'",nationality="'.$nationality.'",leadPaxName="'.$leadPaxName.'",subject="'.$subject.'",adult="'.$adult.'",child="'.$child.'",infant="'.$infant.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",twinRoom="'.$twinRoom.'",extraBedA="'.$extraBedA.'",extraBedC="'.$extraBedC.'",tourType="'.$tourType.'",deletestatus=0,preferredLang="'.$language.'",hotelCategory="'.$hotelCategory.'",mealPlanId="'.$mealPlanId.'",displayId="'.$displayId.'",multiemails="'.$multiemails.'",additionalInfo="'.$additionalInfo.'"';
	$where='id='.$editId.'';
	$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);

	$statusId=10;
	$notes="Created";
 
	
	$rsc="";
	$rsc=GetPageRecord('*',_QUERY_MASTER_,'id="'.$editId.'"');
	$resultquery=mysqli_fetch_array($rsc); 

	//COMMON
	$addedBy=$_SESSION['userid'];
	$dateAdded=time();
	//add created history
	$namevaluehistory ='queryId="'.$editId.'",statusId="'.$statusId.'",notes="'.$notes.'",addedBy="'.$addedBy.'",dateAdded="'.$dateAdded.'"';
	$addhistory = addlisting('queryHistoryMaster',$namevaluehistory);
 
	if($update=='yes'){
	
		$namevalue ='convertQuery='.$editId.'';
		$where='id="'.decode($incomingqueryId).'"';
		updatelisting('mailSectionMaster',$namevalue,$where);
	
		$downloadLink='';
		$queryHtml='';
		$rs=GetPageRecord('*','packageQueryDays',' queryId='.$editId.' order by srdate asc');
		$srn = 0;
		while($resListing=mysqli_fetch_array($rs)){
			$multipleDestinationMail.="<tr>
			<td width='100' align='center' bgcolor='#FFFFFF'>".++$srn."</td>
			<td width='100' align='center' bgcolor='#FFFFFF'>".date('d-m-Y',strtotime($resListing['srdate']))."</td>
			<td width='100' align='center' bgcolor='#FFFFFF'>".getDestination($resListing['cityId'])."</td>
			</tr>";
		}
		if($_REQUEST['attachitinerary']==1){

		   $queryHtml.="<img src='".$fullurl."client_read_mail.php?queryId=".$editId."' width='0' height='0'><div style='margin:20px 0px; border:1px #CCCCCC solid; width:795px !important;'>
			<div style='margin-bottom:10px; font-size:16px; padding:10px;'>Query Id  <strong>#".makeQueryId($resultquery['id'])."</strong></div>
			<table width='100%' border='1' cellpadding='6' cellspacing='0' bordercolor='#CCCCCC'>
				<tr>
					<td width='182' bgcolor='#666666' align='center' style='color:#FFFFFF;'>Query Generated Date</td>
						<td width='420' bgcolor='#666666' style='color:#FFFFFF;'>Subject</td>
					<td width='101' align='center' bgcolor='#666666' style='color:#FFFFFF;'>Adult</td>
					<td width='102' align='center' bgcolor='#666666' style='color:#FFFFFF;'>Child</td>
					<td width='101' align='center' bgcolor='#666666' style='color:#FFFFFF;'>Infant</td>
				</tr>
				<tr>
					<td width='182' align='center'>".showdate(date('Y-m-d'))."</td>
					<td width='420'>".$subject."</td>
					<td width='101' align='center'>".$adult."</td>
					<td width='102' align='center'>".$child."</td>
					<td width='101' align='center'>".$infant."</td>
				</tr>
				<tr>
					<td colspan='6' align='left' bgcolor='#666666' style='color:#FFFFFF;'>Destinations</td>
				</tr>
				<tr>
					<td colspan='6' align='left'><table width='100%' border='1' cellpadding='0' cellspacing='0' bordercolor='#999999'>
						<tr>
							<td width='100' align='center' bgcolor='#999999' style='color:#FFFFFF;'><span class='gridlable'>S.N.</span></td>
							<td width='100' align='center' bgcolor='#999999' style='color:#FFFFFF;'><span class='gridlable'>Date<span class='redmind'></span></span></td>
							<td width='100' align='center' bgcolor='#999999' style='color:#FFFFFF;'><span class='gridlable'>Destination<span class='redmind'></span> </span></td>
						</tr>".$multipleDestinationMail."
					</table></td>
				</tr>
			</table> 
		</div>
		";
		}
 
		$wheretem = 'isDefault="1"';
		$rsEMAIL=GetPageRecord('*',_EMAIL_TEMPLATE_MASTER_,$wheretem);
		$resltthankmsg=mysqli_fetch_array($rsEMAIL);
		$thankyouMSG = $resltthankmsg['mailbody'];
		$querythanksmsg= $thankyouMSG;

		// $querythanksmsg='Dear Sir/Mam<br><br>Greeting from <strong>'.$clientnameglobal.'</strong>.<br><br>While replying to this query, please dont change the subject line.<br><br>';
		$optionquery.=$queryHtml.$queryHtml2.$description.'<br><br>'.$downloadLink;
		$rs=GetPageRecord('emailsignature',_USER_MASTER_,'id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"');
		$LoginUserDetails=mysqli_fetch_array($rs);
		$description=addslashes($querythanksmsg.$optionquery.$attachmentvar);
		$description2=str_replace('client_read_mail.php','',$description);
		$subject='#'.makeQueryId($resultquery['id']).' '.$subject;
		$namevalue ='subject="'.$subject.'",description="'.$description2.'",attachmentFile="'.$attachmentvar.'",adddate="'.date('Y-m-d H:i:s').'",multiemails="'.$multiemails.'",queryid="'.$editId.'",qmailId=1';
		$adds = addlisting(_QUERYMAILS_MASTER_,$namevalue);
		
		?>
		<script> 
			parent.setupbox('showpage.crm?module=docket&add=yes&id=<?php echo encode($editId); ?>'); 
		</script>
		<?php
	}
}

if(trim($_POST['action'])=='editdocket' && trim($_POST['opsPersonId'])!='' && trim($_POST['leadPaxName'])!='' && $_POST['editId']!='' ){
	error_reporting(0);
	include "config/mail.php";
	$savenew = clean($_POST['savenew']);
	$paxType = clean($_POST['paxType']);
	$quotationYes = clean($_POST['quotationYes']);
	$moduleType = clean($_POST['moduleType']);
	$attachitinerary = clean($_POST['attachitinerary']);
	$dayWise = clean($_POST['dayWise']);
	$editId = decode($_POST['editId']);
	$mailId = clean($_POST['mailId']);
	$clientType = clean($_POST['clientType']);
	$companyName = clean($_POST['companyName']);
	$companyId = decode($_POST['companyId']); 

	$opsPersonName = clean($_POST['opsPersonName']);
	$opsPersonId = decode($_POST['opsPersonId']);
	$salesassignTo = clean($_POST['salesassignTo']);
	$contactPName = clean($_POST['contactPName']);
	$guest1phone = clean($_POST['agentb2cnumber']);
	$agentDivision = clean($_POST['agentDivision']);
	$agentDesignation = clean($_POST['agentDesignation']);
	$guest1email = clean($_POST['agentb2cmail']);
	$marketType = clean($_POST['marketId']);
	$nationality = clean($_POST['nationId']);
	$leadPaxName = clean($_POST['leadPaxName']);
	$subject = clean($_POST['subject']);
	$adult = clean($_POST['adult']);
	$child = clean($_POST['child']);
	$infant = clean($_POST['infant']);
	$sglRoom = clean($_POST['sglRoom']);
	$dblRoom = clean($_POST['dblRoom']);
	$tplRoom = clean($_POST['tplRoom']);
	$twinRoom = clean($_POST['twinRoom']);
	$extraBedC = clean($_POST['extraBedC']);
	$extraBedA = clean($_POST['extraBedA']);
	$tourType = clean($_POST['tourType']);
	$language = clean($_POST['language']);
	$hotelCategory = clean($_POST['hotelCategory']);
	$mealPlanId = clean($_POST['mealPlanId']);
	$multiemails = clean($_POST['multiemails']);
	$additionalInfo = clean($_POST['additionalInfo']);
	$queryDate2 = date('Y-m-d',strtotime($_POST['queryDate2']));
	$dateAdded=time();

	$dockSerQuery='';
	$dockSerQuery=GetPageRecord('min(startDate) as fromDate, max(endDate) as toDate','docketServiceItinerary',' queryId='.$editId.' ');
	$docketServiceData=mysqli_fetch_array($dockSerQuery);
	$fromDate2 = $docketServiceData['fromDate'];
	$toDate2 = $docketServiceData['toDate'];
	$objec=date_diff(date_create($fromDate2),date_create($toDate2));
	$night2 = $objec->format("%a");

	// get the season and Season Year
	$seasonYear = date('Y',strtotime($fromDate2));
	if (strtotime($fromDate2)>=strtotime($seasonYear.'-04-01') || strtotime($fromDate)<=strtotime($seasonYear.'-09-30')) {
		$seasonType=1;
	}else{
		$seasonType=2;
	} 

	if(isset($_FILES['attachmentFile']['name'])){
		$file_name=$_FILES['attachmentFile']['name'];
		$file_name=time().'-'.$file_name;
		copy($_FILES['attachmentFile']['tmp_name'],"dirfiles/".$file_name);
		$attachmentvar=" <br><br><a href='".$fullurl."download/".$file_name."' target='_blank'><strong>Download Attachment</strong></a>";
	}

	$uploadPhoto='';
	if(isset($_FILES['uploadPhoto']['name'])){
		$uploadPhoto=str_replace(' ', '', $_FILES['uploadPhoto']['name']);
		$uploadPhoto=time().'-'.$uploadPhoto;
		copy($_FILES['uploadPhoto']['tmp_name'],"dirfiles/".$uploadPhoto);
	}
	// client Details
	if($_POST['addnewcontactmain'] == 1){
		// new agent or b2c here 
		if($clientType=='2'){
			$namevalue ='firstName="'.$companyName.'",assignTo="'.$salesassignTo.'",addedBy='.$_SESSION['userid'].',dateAdded='.$dateAdded.'';
			$lstaddid=addlistinggetlastid(_CONTACT_MASTER_,$namevalue);
			$allvaluephone ='phoneNo="'.$guest1phone.'",phoneType=1,primaryvalue=1,sectionType="contacts",masterId="'.$lstaddid.'"';
			addlisting(_PHONE_MASTER_,$allvaluephone);
			$allvaluephone ='email="'.$guest1email.'",emailType=7,primaryvalue=1,sectionType="contacts",masterId="'.$lstaddid.'"';
			addlisting(_EMAIL_MASTER_,$allvaluephone);
		}else{
			$namevalue ='name="'.$companyName.'",OpsAssignTo="'.$opsPersonId.'",assignTo="'.$salesassignTo.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",bussinessType="'.$clientType.'"';
			$lstaddid=addlistinggetlastid(_CORPORATE_MASTER_,$namevalue);
			$allvaluecontactperson ='contactPerson="'.$contactPName.'",corporateId="'.$lstaddid.'",designation="'.($agentDivision).'",phone="'.encode($guest1phone).'",email="'.encode($guest1email).'",division="'.($agentDivision).'",primaryvalue=1';
			addlisting('contactPersonMaster',$allvaluecontactperson);
		}
		$companyId=$lstaddid;

	}
	$namevalue ='paxType="'.$paxType.'",quotationYes="'.$quotationYes.'",moduleType="'.$moduleType.'",dayWise="'.$dayWise.'",fromDate="'.$fromDate2.'",toDate="'.$toDate2.'",night="'.$night2.'",queryDate="'.$queryDate2.'",clientType="'.$clientType.'",companyId="'.$companyId.'",assignTo="'.$opsPersonId.'",salesassignTo="'.$salesassignTo.'",agentDivision="'.$agentDivision.'",agentDesignation="'.$agentDesignation.'",marketType="'.$marketType.'",nationality="'.$nationality.'",leadPaxName="'.$leadPaxName.'",subject="'.$subject.'",adult="'.$adult.'",child="'.$child.'",infant="'.$infant.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",twinRoom="'.$twinRoom.'",extraBedA="'.$extraBedA.'",extraBedC="'.$extraBedC.'",tourType="'.$tourType.'",preferredLang="'.$language.'",hotelCategory="'.$hotelCategory.'",mealPlanId="'.$mealPlanId.'",multiemails="'.$multiemails.'",additionalInfo="'.$additionalInfo.'"';
	$where='id='.$editId.'';
	$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);
	if($update=='yes'){
		?>
		<script>
		parent.setupbox('showpage.crm?module=docket&add=yes&id=<?php echo encode($editId); ?>');
		</script>
		<?php
	}
} 


if(trim($_REQUEST['action'])=='querydelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);
generateLogs('query','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=query&alt=3');
</script>
<?php
}

if(trim($_POST['action'])=='queryreply' && trim($_POST['companyId'])!='' && trim($_POST['assignTo'])!='' && trim($_POST['queryreplyid'])!='' && trim($_POST['description'])!=''){ 
	include "config/mail.php"; 
	$totalQueryCost=($_POST['totalQueryCost']); 
	$assignTo=($_POST['assignTo']); 
	$queryreplyid=decode($_POST['queryreplyid']); 
	$emailTemplateId=($_POST['emailTemplateId']);
	$companyId=($_POST['companyId']);
	$description=addslashes($_POST['description']);
	$descriptionPdf=($_POST['descriptionPdf']);
	$documentattachement=addslashes($_POST['documentattachement']);
	$multiemails=($_POST['multiemails']);
	$clientType=($_POST['clientType']);
	// $isAttachement=$_POST['isAttachement'];
	// $voucherURL=$_POST['voucherURL'];
	$queryStatus=2;
	$dateAdded=time();
	if($documentattachement!=''){
		$documentattachement=$documentattachement;
	} else {
		$documentattachement='';
	}
	$attachmentvar=$attachmentName="";
	if(isset($_FILES['attachmentFile']['name']) && !empty($_FILES['attachmentFile']['name'])){

		$file_name=$_FILES['attachmentFile']['name'];
		$ext=getExtension($file_name);
		$file_name=str_replace(".","",substr($file_name, 0, strpos($file_name, '.')));
		$file_name2=str_replace(" ","",$file_name.'-'.$datef).'.'.$ext;
		copy($_FILES['attachmentFile']['tmp_name'],"dirfiles/".$file_name2);
		$attachmentName = $file_name2;
		$attachmentvar=" <br><br><a href='".$fullurl."download/".$attachmentName."' target='_blank'><strong>Download Attachment</strong></a>";
	}
	$select='emailsignature,reportingManager';
	$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	$LoginUserDetails=mysqli_fetch_array($rs);
	$reportingPEmail = '';
	if($LoginUserDetails['reportingManager']>0){
		$reportingPEmail = getUserEmailById($LoginUserDetails['reportingManager']).',';
	}

	$quotationId=$_POST['attachitinerary'];
	$servicePrice=$_POST['servicePrice'];
	$getQuotationINT='';
	$queryHtml='';
	$downloadLink='';
	$select23='*';
	$where23='id='.$queryreplyid.''; ;
	$rs23=GetPageRecord($select23,_QUERY_MASTER_,$where23);
	$querytatdata=mysqli_fetch_array($rs23);
	if($querytatdata['queryStatus']==10 || $querytatdata['queryStatus']==1){
	 updatelisting(_QUERY_MASTER_,'queryStatus=2,queryRevertDate="'.date('Y-m-d').'"','id='.$queryreplyid.'');
	}
	$qNight=$querytatdata['night'];
	$where='id='.$queryreplyid.'';
	$namevalue ='queryTimer="0000-00-00 00:00:00",servicePrice="'.$servicePrice.'",tatDate="'.date('Y-m-d H:i:s', strtotime("+".$querytatdata['tat']." min")).'",tatNumber=0';
	$update = updatelisting(_QUERY_MASTER_,$namevalue,$where); 

	// $emailsignature = '<br><br>'.stripslashes($LoginUserDetails['emailsignature']);
	if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
	    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
	}else{
		$emailsignature = stripslashes($LoginUserDetails['emailsignature']);
	}

	if($quotationId!='' && $quotationId!='1'){
		$rsps=GetPageRecord('proposalType',_QUOTATION_MASTER_,'id="'.$quotationId.'" order by quotationNo asc');
		$quotationData=mysqli_fetch_array($rsps);
		$quotationIdName = makeQuotationId($quotationData['id']);
		// $downloadLink='<a style="text-decoration: none;" href="'.$fullurl.'tcpdf/examples/getpdf.php?packagename='.$quotationIdName.'&download=1&savetoserver=1&pageurl='.$fullurl.'inboundpackagehtml_0'.$quotationData['proposalType'].'.php?id='.encode($quotationId).'"><div style="font-size: 16px; padding: 14px 60px; background-color: #45b558; color: #fff;display: inline-block; margin-bottom: 20px; text-decoration: none; border-radius: 4px;">Download Itinerary</div></a>';
	}

	if($_REQUEST['isAttachement'] == 1 && $_REQUEST['voucherURL']!=''){

		$downloadLink='<a href="'.$fullurl.'tcpdf/examples/genratevoucher.php?packagename=Client-Voucher-'.$displayId.' &download=1&savetoserver=1&pageurl='.$fullurl.'loadcreatevoucher_both_html.php?string='.trim($_REQUEST['voucherURL']).'"><div style="font-size: 14px;padding: 10px;background-color: #45b558;color: #fff;display: inline-block;margin-bottom: 20px;border-radius: 1px;width: 150px;text-align: center;">Download Voucher</div></a>';
	}

	if($_REQUEST['isAttachement'] == 1 && $_REQUEST['voucherURLString']!='' && $_REQUEST['allVoucher']==''){

		$downloadLink='<a style="font-size: 14px;padding: 10px;background-color: #45b558;color: #fff;display: inline-block;margin-bottom: 20px;border-radius: 1px;width: 200px;text-align: center;" href="'.$fullurl.'tcpdf/examples/genratevoucher.php?packagename=Client-Voucher-'.$displayId.'&download=1&savetoserver=1&pageurl='.$fullurl.'loadcreatevoucher_client_html4.php?urlString='.trim($_REQUEST['voucherURLString']).'&allVoucher='.trim($_REQUEST['allVoucher']).'">Download Voucher</a>';
	}

	if($_REQUEST['isAttachement'] == 1 && $_REQUEST['voucherURLString']!='' && $_REQUEST['allVoucher']=='yes'){

		$downloadLink='<a style="font-size: 14px;padding: 10px;background-color: #45b558;color: #fff;display: inline-block;margin-bottom: 20px;border-radius: 1px;width: 200px;text-align: center;" href="'.$fullurl.'tcpdf/examples/genratevoucher.php?packagename=Client-Voucher-'.$displayId.'&download=1&savetoserver=1&pageurl='.$fullurl.'loadcreatevoucher_client_html4.php?urlAllString='.trim($_REQUEST['voucherURLString']).'">Download Voucher</a>';
	}

	if(trim($_POST['scheduledAmount'])=='yes'){

		$downloadLink='<a href="'.$fullurl.'tcpdf/examples/genratevoucher.php?download=1&savetoserver=1&pageurl='.$fullurl.'scheduledPaymentReceipt.php?agentPaymentId='.$_REQUEST['agentPaymentId'].'&quotationId='.encode($quotationId).'&queryId='.encode($querytatdata['id']);'"><div style="font-size: 14px;padding: 10px;background-color: #45b558;color: #fff;display: inline-block;margin-bottom: 20px;border-radius: 1px;width: 150px;text-align: center;">Download Receipt</div></a>';
	}
 	
	$rs='';
	$rs=GetPageRecord('email',_USER_MASTER_,'id='.$assignTo.'');
	$resultpageassignemailOppsperson=mysqli_fetch_array($rs);
	$corporatesalesperson='';
	if($clientType==1){
		$rs='';
		$rs=GetPageRecord('*',_CORPORATE_MASTER_,'id='.$companyId.'');
		$resultpageassignemail=mysqli_fetch_array($rs);
		$rs='';
		$rs=GetPageRecord('*',_USER_MASTER_,'id='.$resultpageassignemail['assignTo'].'');
		$resultpageassignemail=mysqli_fetch_array($rs);
		$corporatesalesperson=$resultpageassignemail['email'].',';
	}
 	// add to query mail section client tab
	// if($emailTemplateId!='' && $emailTemplateId>0){
	  	//  $description="<img src='".$fullurl."client_read_mail.php?queryId=".$queryreplyid."' width='0' height='0'>".$description.$attachmentvar.'<br><br>'.$documentattachement;
	  	$description=$description.$attachmentvar.'<br><br>'.$documentattachement;
	// }
	$description2=str_replace('client_read_mail.php','',$description);
	$subject='#'.makeQueryId($querytatdata['id']).' '.$querytatdata['subject'];

	$description2 = $description2.'<br />'.$descriptionPdf;

	// $attachmentvar this variable inserted here
	$description2 = $description2.'<br />'.$downloadLink.'<br>'.$emailsignature."<br><img src='".$fullurl."client_read_mail.php?queryId=".$queryreplyid."' width='0' height='0'>";
	$namevalue ='subject="'.$subject.'",description="'.addslashes($description2).'",attachmentFile="'.$file_name.'",adddate="'.date('Y-m-d H:i:s').'",multiemails="'.$multiemails.'",queryid="'.$queryreplyid.'",queryStatus="'.$queryStatus.'"';
	$adds = addlistinggetlastid(_QUERYMAILS_MASTER_,$namevalue);
	$rs='';
	$rs=GetPageRecord('*',_QUERY_MAILS_SECTION_MASTER_,'id=1');
	$resultpageemail=mysqli_fetch_array($rs);

	if($clientType==1){
		$mailto=getPrimaryEmail($companyId,'corporate');
	}
	if($clientType==2){
		$mailto=getPrimaryEmail($companyId,'contacts');
	}
	if($clientType==1){
		$mailtoMulti=getMultiPrimaryEmail($companyId,'corporate');
	}
	if($clientType==2){
		$mailtoMulti=getMultiPrimaryEmail($companyId,'contacts');
	}
	if($multiemails!=''){
		$multiemails=','.$multiemails;
	}else{
		$multiemails='';
	}

	$ccmail=$resultpageemail['queryemail'].','.$corporatesalesperson.''.$reportingPEmail.''.$resultpageassignemailOppsperson['email'].''.$multiemails.','.$mailtoMulti;
	$fromemail='';
	$mailto=$mailto;
	$mailsubject=$subject;
	$maildescription=stripslashes($description2);
	$maildescription=$maildescription.'<img src="'.$fullurl.'readmail.php?id='.$adds.'" width="0"  style="opacity: 0; filter: alpha(opacity=0);">';
	
	// $exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail,$attachmentName);
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail,$attachmentName);
	if($exeMailresult!=true){
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	
		?> 
		
		<script>
		parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo $_POST['queryreplyid']; ?>');
		</script>
		<?php
	}
}


// change status from quotation



if($_REQUEST['action']=='changeStatusId' && $_REQUEST['status']!=''){


	// die("L");

	$queryStatus = $_REQUEST['status'];



	$editId = $_REQUEST['editId'];



	$editId = $_REQUEST['statusId'];



	$queryclosedetails = urldecode($_REQUEST['queryclosedetails']);



	$followupdate = $_REQUEST['followupdate'];



	$followupdate1 = date('Y-m-d', strtotime($followupdate));



	$endtime = $_REQUEST['endtime'];

	$wherest = ' 1 and id="'.$_REQUEST['editId'].'" ';



	$namevalue = '';

   if($queryStatus==4){

	   $namevalue = 'queryStatus="'.$queryStatus.'",queryCloseDate="'.date('Y-m-d').'",queryCloseDetails="'.$queryclosedetails.'"';

   		$update = updatelisting('queryMaster',$namevalue,$wherest);

   }

//    TMS BOOKING 

   if($queryStatus==11){



	// TMS Add
	$whererrr='queryId="'.$editId.'"';  
	$addnewyes = checkduplicate('tmsBooking',$whererrr); 
	if($addnewyes=='yes'){

		
		$wherestee='queryId="'.$editId.'"';
		// $wherest = 'queryId="'.$_REQUEST['editId'].'"';

		// die("U");
		$namevalue = 'queryStatus="'.$queryStatus.'",tmsDetails="'.$queryclosedetails.'",domesticE="'.$_REQUEST['domesticE'].'",domesticS="'.$_REQUEST['domesticS'].'",internationF="'.$_REQUEST['internationF'].'",internationC="'.$_REQUEST['internationC'].'",carB="'.$_REQUEST['carB'].'",hacH="'.$_REQUEST['hacH'].'",domesticH="'.$_REQUEST['domesticH'].'",flightT="'.$_REQUEST['flightT'].'",trainT="'.$_REQUEST['trainT'].'",grp="'.$_REQUEST['grp'].'",pab="'.$_REQUEST['pab'].'",BookingId="'.$_REQUEST['BookingId'].'"';

		$updater = updatelisting('tmsBooking',$namevalue,$wherestee);

	}else{ 
	
		
		// die("A");

		$namevalue = 'queryId="'.$editId.'",queryStatus="'.$queryStatus.'",tmsDetails="'.$queryclosedetails.'",domesticE="'.$_REQUEST['domesticE'].'",domesticS="'.$_REQUEST['domesticS'].'",internationF="'.$_REQUEST['internationF'].'",internationC="'.$_REQUEST['internationC'].'",carB="'.$_REQUEST['carB'].'",hacH="'.$_REQUEST['hacH'].'",domesticH="'.$_REQUEST['domesticH'].'",flightT="'.$_REQUEST['flightT'].'",trainT="'.$_REQUEST['trainT'].'",grp="'.$_REQUEST['grp'].'",pab="'.$_REQUEST['pab'].'",BookingId="'.$_REQUEST['BookingId'].'"';
		
		$adds = addlisting('tmsBooking',$namevalue); 

	}



	// domesticE,domesticS,internationF,internationC,carB,hacH,domesticH,flightT,trainT,grp,pab,BookingId

	$namevalue = 'queryStatus="'.$queryStatus.'",queryCloseDate="'.date('Y-m-d').'",queryCloseDetails="'.$queryclosedetails.'"';

		$update = updatelisting('queryMaster',$namevalue,$wherest);


		
	}

   if($queryStatus==6){

	   $namevalue = 'queryStatus="'.$queryStatus.'",optionSentDate="'.date('Y-m-d').'",queryCloseDetails="'.$queryclosedetails.'"';

	   $update = updatelisting('queryMaster',$namevalue,$wherest);

   } 

   if($queryStatus==7){

	   $namevalue = 'queryStatus="'.$queryStatus.'",followupdate="'.$followupdate1.'",queryCloseDetails="'.$queryclosedetails.'"';

	   $update = updatelisting('queryMaster',$namevalue,$wherest);

   }  

   if($update == 'yes'){

		?> 

		<script> 

		parent.window.location.href='showpage.crm?module=query&view=yes&id=<?php echo encode($editId); ?>&b2bquotation=1';

		parent.$('#pageloading').hide();

		parent.$('#pageloader').hide();

		</script>

		<?php

   }else{

		?> 

		<script> 

		parent.alert('The status of the query could not be changed.');

		parent.$('#pageloading').hide();

		parent.$('#pageloader').hide();

		</script>

		<?php

   }

   



}

if(trim($_POST['changestausidqueryid'])!='' && trim($_POST['changequerystatus'])!=''){
	$changestausidqueryid=decode($_POST['changestausidqueryid']);
	$queryStatus=$_POST['changequerystatus'];
	$queryclosedetails=clean($_POST['queryclosedetails']);
	$followupdate=date("Y-m-d", strtotime($_POST['followupdate']));
	$endtime=$_POST['endtime'];
	$dateAdded=time();
	$where='id='.$changestausidqueryid.'';
	$select='*';
	$id=$changestausidqueryid;
	$where='id='.$id.'';
	$rs=GetPageRecord($select,_QUERY_MASTER_,$where);
	$resultpagestatus=mysqli_fetch_array($rs);
	$assignTo=$resultpagestatus['assignTo'];
	$namevalue ='queryStatus='.$queryStatus.',queryCloseDetails="'.$queryclosedetails.'",queryCloseDate="'.date('Y-m-d').'",followupdate="'.$followupdate.'",followuptime="'.$endtime.'"';
	$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);
	$newdatetime=strtotime($followupdate.' '.strtoupper($endtime));
	$newdatetime=date('Y-m-d H:i:s',$newdatetime);
	$select1='*';
	$where1='serviceId='.$changestausidqueryid.' order by id asc ';
	$rs1=GetPageRecord($select1,_TO_DO_TIMELINE_,$where1);
	$count = mysqli_num_rows($rs1);
	if($count > 0){
		$wherex='serviceId='.$changestausidqueryid.' and serviceType="Follow-up" ';
		$re ='toDoDate="'.$followupdate.'",toDotime="'.$endtime.'",dateTime="'.$newdatetime.'" ';
		$update = updatelisting(_TO_DO_TIMELINE_,$re,$wherex);
	}else{
		$re ='serviceId="'.$changestausidqueryid.'",serviceType="Follow-up",toDoDate="'.$followupdate.'",toDotime="'.$endtime.'",assignto="'.$assignTo.'",dateTime="'.$newdatetime.'" ';
	     addlistinggetlastid(_TO_DO_TIMELINE_,$re);
	}
	include "config/mail.php";
	$select='*';
	$id=$changestausidqueryid;
	$where='id='.$id.'';
	$rs=GetPageRecord($select,_QUERY_MASTER_,$where);
	$resultpage=mysqli_fetch_array($rs);
	if($resultpage['clientType']==2){
		$select2='*';
		$where2='id='.$resultpage['companyId'].'';
		$rs2=GetPageRecord($select2,_CONTACT_MASTER_,$where2);
		$contantnamemain=mysqli_fetch_array($rs2);
		$clientnemdisplay = $contantnamemain['firstName'].' '.$contantnamemain['lastName'];
		$clientnem = $contantnamemain['firstName'].' '.$contantnamemain['lastName'];
		$getphone =  getPrimaryPhone($resultpage['companyId'],'contacts');
		$getemail =  getPrimaryEmail($resultpage['companyId'],'contacts');
	}
	if($resultpage['clientType']==1){
		$select2='*';
		$where2='id='.$resultpage['companyId'].'';
		$rs2=GetPageRecord($select2,_CORPORATE_MASTER_,$where2);
		$contantnamemain=mysqli_fetch_array($rs2);
		$clientnemdisplay = $contantnamemain['contactPerson'];
		$clientnem = getCorporateCompany($editcompanyId);
		$getemail = getPrimaryEmail($resultpage['companyId'],"corporate");
		$getphone = getPrimaryPhone($resultpage['companyId'],"corporate");
	}
	if($resultpage['queryStatus']==1){ '<div class="assignquery">Assigned</div>'; $list_id='4e463bf6b0'; } 
	if($resultpage['queryStatus']==10){ '<div class="assignquery">Created</div>'; $list_id='def158a3e6'; } 
	if($resultpage['queryStatus']==6){ '<div class="assignquery">Options&nbsp;Sent</div>'; $list_id='b09914105b';  }
	if($resultpage['queryStatus']==7){ '<div class="assignquery">Follow-up</div>'; $list_id='89a790fe49'; } 
	if($resultpage['queryStatus']==2){ '<div class="revertquery">Reverted</div>';  $list_id='3038454095'; } 
	if($resultpage['queryStatus']==3){ '<div class="wonquery">Confirmed</div>'; $list_id='6b195b2b00'; } 
	if($resultpage['queryStatus']==4){ '<div class="lossquery">Lost</div>'; $list_id='2f513eb084'; } 
	if($resultpage['queryStatus']==5){ '<div class="closequery">Time Limit Booking</div>';  $list_id='7ca430f7f0'; }  
	if($resultpage['queryStatus']==0){ '<div class="assignquery">Assigned</div>';   $list_id='4e463bf6b0'; }
	if($resultpagestatus['queryStatus']!=$queryStatus){
		$email = ''.$getemail.'';
		$status = 'subscribed'; // "subscribed" or "unsubscribed" or "cleaned" or "pending"
		$api_key = 'f766b68a4ff1b82b215fc3586a871c47-us17'; // where to get it read above
		$merge_fields = array('FNAME' => ''.$clientnemdisplay.'','LNAME' => '','ADDRESS' => 'delhi','PHONE' => ''.$getphone.'');
		$tags = 'query';
		rudr_mailchimp_subscriber_status($email, $status, $list_id, $api_key, $merge_fields, $tags);
	}
	$list_id='';
	if($resultpagestatus['queryStatus']==1){ '<div class="assignquery">Assigned</div>'; $list_id='4e463bf6b0'; } 
	if($resultpagestatus['queryStatus']==10){ '<div class="assignquery">Created</div>'; $list_id='def158a3e6'; } 
	if($resultpagestatus['queryStatus']==6){ '<div class="assignquery">Options&nbsp;Sent</div>'; $list_id='b09914105b';  }
	if($resultpagestatus['queryStatus']==7){ '<div class="assignquery">Follow-up</div>'; $list_id='89a790fe49'; } 
	if($resultpagestatus['queryStatus']==2){ '<div class="revertquery">Reverted</div>';  $list_id='3038454095'; } 
	if($resultpagestatus['queryStatus']==3){ '<div class="wonquery">Confirmed</div>'; $list_id='6b195b2b00'; } 
	if($resultpagestatus['queryStatus']==4){ '<div class="lossquery">Lost</div>'; $list_id='2f513eb084'; } 
	if($resultpagestatus['queryStatus']==5){ '<div class="closequery">Time Limit Booking</div>';  $list_id='7ca430f7f0'; }  
	if($resultpagestatus['queryStatus']==0){ '<div class="assignquery">Assigned</div>';   $list_id='4e463bf6b0'; }
	if($resultpagestatus['queryStatus']!=$queryStatus){
		$email = ''.$getemail.'';
		$status = 'pending'; // "subscribed" or "unsubscribed" or "cleaned" or "pending"
		$api_key = 'f766b68a4ff1b82b215fc3586a871c47-us17'; // where to get it read above
		$merge_fields = array('FNAME' => ''.$clientnemdisplay.'','LNAME' => '','ADDRESS' => 'delhi','PHONE' => ''.$getphone.'');
		$tags = 'query';
		rudr_mailchimp_subscriber_status($email, $status, $list_id, $api_key, $merge_fields, $tags);
	}
	?>
	<script>
	parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo $_POST['changestausidqueryid']; ?>');
	</script>
	<?php
}


if(trim($_REQUEST['action'])=='addfollowupagentpayment'){
$queryid=clean($_POST['queryid']);
$followuptdate=clean($_POST['followupagentpaymentdate']);
$followuptime=clean($_POST['followupagentpaymenttime']);
$old_date=clean($_POST['old_date']);
$old_time=clean($_POST['old_time']);
$selecttodoassign='*';
$wheretodoassign='id='.$queryid.'';
$rstodoassign=GetPageRecord($selecttodoassign,_QUERY_MASTER_,$wheretodoassign);
$resultpagetodoassign=mysqli_fetch_array($rstodoassign);
$assignTo=$resultpagetodoassign['assignTo'];
$select1='*';
$where1='serviceId='.$queryid.' and serviceType="Agent Payment Follow-up" and toDoDate="'.$old_date.'" and toDotime="'.$old_time.'" order by id desc ';
$rs1=GetPageRecord($select1,_TO_DO_TIMELINE_,$where1);
$row = mysqli_fetch_array($rs1);
$numberss = mysqli_num_rows($rs1);
$newdatetime=strtotime($followuptdate.' '.strtoupper($followuptime));
$newdatetime=date('Y-m-d H:i:s',$newdatetime);
if($numberss>0){
		$wherex1='id='.$row['id'].'  ';
		$re1 ='toDoDate="'.$followuptdate.'",toDotime="'.$followuptime.'",dateTime="'.$newdatetime.'" ';
		$update1 = updatelisting(_TO_DO_TIMELINE_,$re1,$wherex1);
   }else{
	$reeh ='serviceId="'.$queryid.'",serviceType="Agent Payment Follow-up",toDoDate="'.$followuptdate.'",toDotime="'.$followuptime.'",assignto="'.$assignTo.'",dateTime="'.$newdatetime.'" ';
	$lastide = addlistinggetlastid(_TO_DO_TIMELINE_,$reeh);
	}
$wherex='queryId='.$queryid.'  ';
$re ='follow_upDate="'.$followuptdate.'",follow_upTime="'.$followuptime.'" ';
$update = updatelisting(_DMC_PAYMENT_REQUEST_,$re,$wherex);
$select='*';
$where='queryid='.$queryid.'';
$rs=GetPageRecord($select,_PAYMENT_REQUEST_MASTER_,$where);
$count = mysqli_num_rows($rs);
if($count > 0){
$resultpaymentpage=mysqli_fetch_array($rs);
$lastid = $resultpaymentpage['id'];
}
?>
<script>
parent.window.location.href='showpage.crm?module=paymentrequest&view=yes&id=<?php echo encode($lastid); ?>&dmc=1';
</script>
<?php
exit();
}
if(trim($_REQUEST['action'])=='addfollowupclientpayment'){
$queryid=clean($_POST['queryid']);
$clientId=clean($_POST['clientId']);
$followuptdate=clean($_POST['followupagentpaymentdate']);
$followuptime=clean($_POST['followupagentpaymenttime']);
$old_date=clean($_POST['old_date']);
$old_time=clean($_POST['old_time']);
$selecttodoassign='*';
$wheretodoassign='id='.$queryid.'';
$rstodoassign=GetPageRecord($selecttodoassign,_QUERY_MASTER_,$wheretodoassign);
$resultpagetodoassign=mysqli_fetch_array($rstodoassign);
$assignTo=$resultpagetodoassign['assignTo'];
$select1='*';
$where1='serviceId='.$queryid.' and serviceType="Supplier Payment Follow-up" and toDoDate="'.$old_date.'" and toDotime="'.$old_time.'" order by id desc ';
$rs1=GetPageRecord($select1,_TO_DO_TIMELINE_,$where1);
$row = mysqli_fetch_array($rs1);
$numberss = mysqli_num_rows($rs1);
$newdatetime=strtotime($followuptdate.' '.strtoupper($followuptime));
$newdatetime=date('Y-m-d H:i:s',$newdatetime);
if($numberss>0){
		$wherex1='id='.$row['id'].'  ';
		$re1 ='toDoDate="'.$followuptdate.'",toDotime="'.$followuptime.'",dateTime="'.$newdatetime.'" ';
		$update1 = updatelisting(_TO_DO_TIMELINE_,$re1,$wherex1);
   }else{
	$reeh ='serviceId="'.$queryid.'",serviceType="Supplier Payment Follow-up",toDoDate="'.$followuptdate.'",toDotime="'.$followuptime.'",assignto="'.$assignTo.'",dateTime="'.$newdatetime.'" ';
	$lastide = addlistinggetlastid(_TO_DO_TIMELINE_,$reeh);
	}
$wherex='id='.$clientId.' ';
$re ='follow_upDate="'.$followuptdate.'",follow_upTime="'.$followuptime.'" ';
$update = updatelisting(_PAYMENT_SUPPLIER_LIST_MASTER_,$re,$wherex);
$select='*';
$where='queryid='.$queryid.'';
$rs=GetPageRecord($select,_PAYMENT_REQUEST_MASTER_,$where);
$count = mysqli_num_rows($rs);
if($count > 0){
$resultpaymentpage=mysqli_fetch_array($rs);
$lastid = $resultpaymentpage['id'];
}
?>
<script>
parent.window.location.href='showpage.crm?module=paymentrequest&view=yes&id=<?php echo encode($lastid); ?>&queryId=<?php echo $queryid; ?>';
</script>
<?php
exit();
}

if(trim($_POST['changestausidqueryid'])!='' && trim($_POST['changequerystatus2cancel'])!=''){
	$changestausidqueryid=decode($_POST['changestausidqueryid']);
	$queryStatus=$_POST['changequerystatus2cancel'];
	$queryCloseDetails=($_POST['queryCloseDetails']);
	$dateAdded=time();
	if($queryStatus!='nocancel'){

		$where='id='.$changestausidqueryid.'';
		$namevalue ='queryStatus='.$queryStatus.',queryCloseDetails="'.$queryCloseDetails.'",queryCloseDate="'.date('Y-m-d').'"';
		$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);
		include "config/mail.php";
		$select1='*';
		$where1='id='.$changestausidqueryid.'';
		$rs1=GetPageRecord($select1,_QUERY_MASTER_,$where1);
		$editresultQuery=mysqli_fetch_array($rs1);
		$select='';
		$where='';
		$rs='';
		$select='email';
		$where='id='.$editresultQuery['assignTo'].'';
		$rs=GetPageRecord($select,_USER_MASTER_,$where);
		$resultpageassignemail=mysqli_fetch_array($rs);
		$select='';
		$where='';
		$rs='';
		$select='*';
		$where='id=1';
		$rs=GetPageRecord($select,_QUERY_MAILS_SECTION_MASTER_,$where);
		$resultpageemail=mysqli_fetch_array($rs);
		$ccmail=$resultpageassignemail['email'].','.$resultpageemail['queryemail'];
		$fromemail='';
		$select='emailsignature';
		$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
		$rs=GetPageRecord($select,_USER_MASTER_,$where);
		$LoginUserDetails=mysqli_fetch_array($rs);

		if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
			$emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
		}

		$description='<strong>#'.makeQueryId($editresultQuery['id']).' Query Canceled</strong>'.'<br><br>Note: '.$queryCloseDetails.'<br><br>'.stripslashes($emailsignature);
		$emailsubject='#'.makeQueryId($editresultQuery['id']).' '.$editresultQuery['subject'].'';
		$mailsubject=$emailsubject;
		$maildescription=$description;
		$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);

		if($exeMailresult!=true){
			?>
			<script>
			alert('Mail not sent, Please check your configration');
			</script>
			<?php
		}else{
			?>
			<script>
				parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo $_POST['changestausidqueryid']; ?>');
			</script>
			<?php
		}
		exit();
	}
}
if(trim($_GET['action'])=='changequerymailstatus' && trim($_GET['id'])!=''){
	$where='id='.$_GET['id'].'';
	$namevalue ='status=0';
	$update = updatelisting(_QUERYMAILS_MASTER_,$namevalue,$where);
} 

if($_REQUEST['addpaymentrequest']=='1' && trim($_REQUEST['quotationId'])!=''){
	// add payment request 
	$quotationId = trim($_REQUEST['quotationId']);

	$quotQury='';
	$quotQury=GetPageRecord('*',_QUOTATION_MASTER_,' id='.$quotationId.' order by id asc');
	$quotationData=mysqli_fetch_array($quotQury);

	$prmQury='';
	$prmQury=GetPageRecord('*',_PAYMENT_REQUEST_MASTER_,' quotationId='.$quotationId.' order by id asc');

	if(mysqli_num_rows($prmQury) > 0){
		$prmData=mysqli_fetch_array($prmQury);
		$lastid = $prmData['id'];

	}else{

		$dateAdded=time();
		$totalCompanyCost = $quotationData['totalCompanyCost'];
		$totalClientCost = round($quotationData['totalQuotCost'],2);
		$totalClientCostWithMarkup = trim($quotationData['totalCompanyCost']+$quotationData['totalMarkupCost']);
		$totalMarkupCost = $quotationData['totalMarkupCost'];
		$totalISOCost = $quotationData['totalISOCost'];
		$totalConsortiaCost = $quotationData['totalConsortiaCost'];
		$totalClientCommCost = $quotationData['totalClientCommCost'];
		$totalDiscountCost = $quotationData['totalDiscountCost'];
		$totalServiceTaxCost = $quotationData['totalServiceTaxCost'];
		$totalTCSCost = $quotationData['totalTCSCost'];
		$sglBasisCost = $quotationData['sglBasisCost'];
		$dblBasisCost = $quotationData['dblBasisCost'];
		$twinCost = $quotationData['twinCost'];
		$tplBasisCost = $quotationData['tplBasisCost'];
		$extraAdultCost = $quotationData['extraAdultCost'];
		$CWBCost = $quotationData['CWBCost'];
		$CNBCost = $quotationData['CNBCost'];

		$currencyId = $quotationData['currencyId'];
		$serviceTax = $quotationData['serviceTax'];
		$gstType = $quotationData['gstType'];
		$tcsTax = $quotationData['tcs'];
		$commissionType = $quotationData['commissionType'];
		$ISOCommission = $quotationData['ISOCommission'];
		$ConsortiaCommission = $quotationData['ConsortiaCommission'];
		$ClientCommission = $quotationData['ClientCommission'];
		$discountType = $quotationData['discountType'];
		$discount = $quotationData['discount']; 

		// Original cost store into this table after final 
		$namevalue ='totalCompanyCost = "'.$totalCompanyCost.'", totalClientCost = "'.$totalClientCost.'", totalClientCostWithMarkup = "'.$totalClientCostWithMarkup.'", totalMarkupCost = "'.$totalMarkupCost.'", totalISOCost = "'.$totalISOCost.'", totalConsortiaCost = "'.$totalConsortiaCost.'", totalClientCommCost = "'.$totalClientCommCost.'", totalDiscountCost = "'.$totalDiscountCost.'", totalServiceTaxCost = "'.$totalServiceTaxCost.'", totalTCSCost = "'.$totalTCSCost.'", sglBasisCost = "'.$sglBasisCost.'", dblBasisCost = "'.$dblBasisCost.'", twinCost = "'.$twinCost.'", tplBasisCost = "'.$tplBasisCost.'", extraAdultCost = "'.$extraAdultCost.'", CWBCost = "'.$CWBCost.'", CNBCost = "'.$CNBCost.'", currencyId = "'.$currencyId.'", serviceTax = "'.$serviceTax.'",gstType = "'.$gstType.'", tcsTax = "'.$tcsTax.'", commissionType = "'.$commissionType.'", ISOCommission = "'.$ISOCommission.'", ConsortiaCommission = "'.$ConsortiaCommission.'", ClientCommission = "'.$ClientCommission.'", discountType = "'.$discountType.'", discount = "'.$discount.'", queryid="'.trim($quotationData['queryId']).'",quotationId="'.$quotationId.'",deletestatus=0,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
		$lastid = addlistinggetlastid(_PAYMENT_REQUEST_MASTER_,$namevalue);
	} 
	?>
	<script>
	window.location="showpage.crm?module=paymentrequest&view=yes&id=<?php echo encode($lastid); ?>";
 	</script>
 	<?php
	exit();
}


if($_POST['action']=='addspliertopaymentlist' && trim($_POST['supplierId'])!='' && trim($_POST['paymentId'])!=''){
	if(trim($_POST['suppliertoalcost'])>'0' && trim($_POST['companytoalcost'])>'0'){ } else {?>
	<script>
	parent.$('#pageloading').hide();
	alert('Client and Company cost should be more then zero');
	</script>
	<?php
	exit();
	}
	$supplierId=clean($_POST['supplierId']);
	$paymentId=clean($_POST['paymentId']);
	$suppliernorooms=clean($_POST['suppliernorooms']);
	$companynorooms=clean($_POST['companynorooms']);
	$suppliernonight=clean($_POST['suppliernonight']);
	$supplierpernight=clean($_POST['supplierpernight']);
	$suppliertotalcost=clean($_POST['suppliertotalcost']);
	$suppliercgst=clean($_POST['suppliercgst']);
	$suppliersgst=clean($_POST['suppliersgst']);
	$supplierigst=clean($_POST['supplierigst']);
	$selfId=clean($_POST['selfId']);
	$supplierstateId=clean($_POST['supplierstateId']);
	$companystateId=clean($_POST['companystateId']);
	$suppliertoalcost=clean($_POST['suppliertoalcost']);
	$companynonight=clean($_POST['companynonight']);
	$companypernight=clean($_POST['companypernight']);
	$companytotalcost=clean($_POST['companytotalcost']);
	$companycgst=clean($_POST['companycgst']);
	$companysgst=clean($_POST['companysgst']);
	$companyigst=clean($_POST['companyigst']);
	$companytoalcost=clean($_POST['companytoalcost']);
	$paymentmode=clean($_POST['paymentmode']);
	$paymentdate=clean($_POST['paymentdate']);
	$supplierAmount=clean($_POST['supplierAmount']);
	$paymentreminderdate=clean($_POST['paymentreminderdate']);
	$fromDate=clean($_POST['fromDate']);
	$toDate=clean($_POST['toDate']);
	$companyTypeId=clean($_POST['companyTypeId']);
	$suppliername=clean($_POST['suppliername']);
	$compsuppliername=clean($_POST['compsuppliername']);
	$toDate=date("Y-m-d", strtotime($toDate));
	$fromDate=date("Y-m-d", strtotime($fromDate));
	$paymentdate=date("Y-m-d", strtotime($paymentdate));
	$paymentreminderdate=date("Y-m-d", strtotime($paymentreminderdate));
	$commissionable=clean($_POST['commissionable']);
	if(isset($_FILES['supplierInvoice']['name'])){
	$file_name=str_replace(' ', '', $_FILES['supplierInvoice']['name']);
	$file_name=time().'-'.$file_name;
	copy($_FILES['supplierInvoice']['tmp_name'],"dirfiles/".$file_name);
	}
	$dateAdded=time();
	$namevalue ='supplierId="'.$supplierId.'",paymentId="'.$paymentId.'",toDate="'.$toDate.'",fromDate="'.$fromDate.'",suppliernonight="'.$suppliernonight.'",suppliertotalcost="'.$suppliertotalcost.'",supplierpernight="'.$supplierpernight.'",suppliercgst="'.$suppliercgst.'",suppliersgst="'.$suppliersgst.'",supplierigst="'.$supplierigst.'",suppliertoalcost="'.$suppliertoalcost.'",companynonight="'.$companynonight.'",companypernight="'.$companypernight.'",companytotalcost="'.$companytotalcost.'",companycgst="'.$companycgst.'",companysgst="'.$companysgst.'",companyigst="'.$companyigst.'",companytoalcost="'.$companytoalcost.'",paymentmode="'.$paymentmode.'",paymentdate="'.$paymentdate.'",paymentreminderdate="'.$paymentreminderdate.'",commissionable="'.$commissionable.'",supplierAmount="'.$supplierAmount.'",supplierInvoice="'.$file_name.'",dateAdded="'.time().'",addedBy="'.$_SESSION['userid'].'",companynorooms="'.$companynorooms.'",suppliernorooms="'.$suppliernorooms.'",selfId="'.$selfId.'",supplierstateId="'.$supplierstateId.'",companystateId="'.$companystateId.'",companyTypeId="'.$companyTypeId.'",suppliername="'.$suppliername.'",compsuppliername="'.$compsuppliername.'"';
	$lastid = addlistinggetlastid(_PAYMENT_SUPPLIER_LIST_MASTER_,$namevalue);
	$select4='';
	$where4='';
	$rs4='';
	$select4='*';
	$where4='id="'.$paymentId.'"';
	$rs4=GetPageRecord($select4,_PAYMENT_REQUEST_MASTER_,$where4);
	$resultmainmail=mysqli_fetch_array($rs4);
	$queryid = $resultmainmail['queryid'];
	$select41='';
	$where41='';
	$rs41='';
	$select41='*';
	$where41='id="'.$queryid.'"';
	$rs41=GetPageRecord($select41,_QUERY_MASTER_,$where41);
	$resultmainmail1=mysqli_fetch_array($rs41);
	$tourType = $resultmainmail1['tourType'];
	if($supplierigst>'0')
	{
		echo "igst".$gst = $supplierigst;
	}else
	{
		echo "cgst+sgst".$gst = $suppliercgst+$suppliersgst;
	}
	$fromDate2=date("Y-m-d");
	$paxType='2';
	$currencyId='1';
	$pax = $suppliernorooms+$suppliernonight;
	// $totalamnt = $suppliernonight*$supplierpernight;
	// $subtotal = $totalamnt*$supplierigst;
	$namevalue ='fromDate="'.$fromDate2.'",tourType="'.$tourType.'",rooms="'.$suppliernorooms.'",nights="'.$suppliernonight.'",gstTypeId="'.$gst.'",gst="'.$gst.'",cgst="'.$suppliercgst.'",sgst="'.$suppliersgst.'",igst="'.$supplierigst.'",paxType="'.$paxType.'",pax="'.$pax.'",currencyId="'.$currencyId.'",rate="'.$supplierpernight.'",subtotal="'.$suppliertoalcost.'",queryId="'.$queryid.'",paymentId="'.$paymentId.'",paymentSupplierListId="'.$lastid.'" ';
	$lastidd = addlistinggetlastid(_DMC_PAYMENT_REQUEST_,$namevalue);
	//
	 ?>
	<script>
	parent.setupbox('showpage.crm?module=paymentrequest&view=yes&id=<?php echo encode($paymentId); ?>');
	</script>
	 <?php
}

if($_POST['action']=='savenewaddspliertopaymentlist'  && trim($_POST['savepaymentId'])!=''){
	include "config/mail.php";
	$where='id='.$_POST['savepaymentId'].'';
	$namevalue ='deletestatus=0';
	$update = updatelisting(_PAYMENT_REQUEST_MASTER_,$namevalue,$where);
	$select4='';
	$where4='';
	$rs4='';
	$select4='*';
	$where4='id=1';
	$rs4=GetPageRecord($select4,_VOUCHER_SETTING_MASTER_,$where4);
	$resultmainmail=mysqli_fetch_array($rs4);
	$select='';
	$where='';
	$rs='';
	$select='*';
	$where=' deletestatus=0 and id='.$_REQUEST['samepaymentqueryid'].'';
	$rs=GetPageRecord($select,_QUERY_MASTER_,$where);
	while($resListing=mysqli_fetch_array($rs)){
		$fromemail='';
		$mailto=$resultmainmail['paymentEmailid'];
		$ccmail=$resultmainmail['groupEmailId'];
		$_REQUEST['savepaymentId'];
		$maildescription=file_get_contents(''.$fullurl.'loadpaymentsupplierlist.php?paymentId='.$_REQUEST['savepaymentId'].'');
		$mailsubject='Payment Request Submited For Query - #'.makeQueryId($resListing['id']).'';
		$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);

		if($exeMailresult!=true){
			?>
			<script>
			alert('Mail not sent, Please check your configration');
			</script>
			<?php
		}else{
			?>
			<script>
			parent.setupbox('showpage.crm?module=paymentrequest');
			</script>
			<?php 
		}
	}
}

if($_REQUEST['addItinerary']=='1' && trim($_REQUEST['QueryId'])!=''){
	$result =mysqli_query(db(),"select * from "._QUERY_MASTER_." where id='".trim(ltrim($_REQUEST['QueryId'], '0'))."'")  or die(mysqli_error(db()));
	$number =mysqli_num_rows($result);
	if($number==0){  ?>
		<script>
		parent.$('#pageloader').hide();
		parent.$('#pageloading').hide();
		parent.$('#addpaymentreqesmsg').show();
		parent.$('#addpaymentreqesmsg').html('Query ID not foud.');
		</script>
		<?php
		exit();
	} ?>
	<script>
	parent.setupbox('showpage.crm?module=itinerary&view=yes&id=<?php echo encode(trim($_REQUEST['QueryId'])); ?>');
	</script>
	<?php
}

if($_REQUEST['addQuotation']=='1' && trim($_REQUEST['QueryId'])!=''){
	$result =mysqli_query(db(),"select * from "._QUERY_MASTER_." where id='".trim(ltrim($_REQUEST['QueryId'], '0'))."'")  or die(mysqli_error(db()));
	$number =mysqli_num_rows($result);
	if($number==0)
	{  ?>
		<script>
		parent.$('#pageloader').hide();
		parent.$('#pageloading').hide();
		parent.$('#addpaymentreqesmsg').show();
		parent.$('#addpaymentreqesmsg').html('Query ID not foud.');
		</script>
		<?php
		exit();
	} ?>
	<script>
	parent.setupbox('showpage.crm?module=quotations&view=yes&id=<?php echo encode(trim($_REQUEST['QueryId'])); ?>');
	</script>
	<?php
}

if($_REQUEST['addinvoice']=='1' && trim($_REQUEST['quotationId'])!=''){

	$result = mysqli_query(db(),"select * from quotationMaster where id='".trim($_REQUEST['quotationId'])."'")  or die(mysqli_error(db()));
   	$number = mysqli_num_rows($result);
   	$quotationData = mysqli_fetch_array($result);
   	$queryId = $quotationData['queryId'];
   	$totalamount = round($quotationData['totalQuotCost']);
    
   	if($number==0) {  ?>
	   <script>
		   parent.$('#addpaymentreqesmsg').show();
		   parent.$('#addpaymentreqesmsg').html('Quotation ID not found.');
	   </script>
	   <?php
	   exit();
   	}

	$result =mysqli_query(db(),"select * from "._INVOICE_MASTER_." where quotationId='".trim($_REQUEST['quotationId'])."' and invoiceType='".$_REQUEST['invoiceType']."' and deletestatus=0 ")  or die( mysqli_error(db()));
	$number =mysqli_num_rows($result);
   	if($number>0) { ?>
	   <script>
	   parent.$('#addpaymentreqesmsg').show();
	   parent.$('#addpaymentreqesmsg').html('Invoice already genrated.');
	   </script>
	   <?php
	   exit();
   	}

   	// taxInvSq
   	$taxInvSq = generateInvoiceId($queryId,1);

	$dateAdded=time();
	$namevalue ='quotationId="'.trim($_REQUEST['quotationId']).'",taxInvSq="'.$taxInvSq.'",queryId="'.trim($queryId).'",totalamount="'.$totalamount.'",deletestatus=0,invoiceType=1,invoiceFormat=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",invoicedate="'.date('Y-m-d').'",dueDate="'.date('Y-m-d').'"';
	$lastid = addlistinggetlastid(_INVOICE_MASTER_,$namevalue);


	// proformaInvSq
   	$proformaInvSq = generateInvoiceId($queryId,2);
	$namevalue ='quotationId="'.trim($_REQUEST['quotationId']).'",proformaInvSq="'.$proformaInvSq.'",queryId="'.trim($queryId).'",totalamount="'.$totalamount.'",deletestatus=0,invoiceType=2,invoiceFormat=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",invoicedate="'.date('Y-m-d').'",dueDate="'.date('Y-m-d').'"';
   	$lastid = addlistinggetlastid(_INVOICE_MASTER_,$namevalue);

   if(!empty($_FILES['uploadinvoicedoc']['name'])){
	   $file_name=time().'-'.str_replace(' ', '', $_FILES['uploadinvoicedoc']['name']);
	   copy($_FILES['uploadinvoicedoc']['tmp_name'],"dirfiles/".$file_name);
	   $where='quotationId="'.trim($_REQUEST['quotationId']).'"';
	   $namevalue ='docName="'.$file_name.'",deletestatus=0,invoicedate="'.date('Y-m-d').'"';
	   updatelisting(_INVOICE_MASTER_,$namevalue,$where);
	   ?>
	   <script>
	   parent.setupbox('showpage.crm?module=invoice');
	   </script>
	   <?php
	   exit();
   	}	
   	?>
   	<script>
   	parent.setupbox('showpage.crm?module=invoice&add=yes&id=<?php echo encode($lastid); ?>&invoiceType=<?php echo $_REQUEST['invoiceType']; ?>');
   	</script>
   	<?php
   	exit();
}

 
if($_POST['action']=='saveinvoice' && trim($_POST['queryId'])!='' && trim($_POST['totalamount'])!='' && trim($_POST['invoiceType'])!='' && trim($_POST['editId'])!=''){
	$editId=clean($_POST['editId']);
	$invoiceType=clean($_POST['invoiceType']); 
	$quotationId=clean($_POST['quotationId']);
	$fromDate=clean($_POST['fromDate']);
	$invoicedate=date("Y-m-d", strtotime($fromDate));
	$totalamount=clean($_POST['totalamount']);
	$igst=clean($_POST['igst']);
	$cgst=clean($_POST['cgst']);
	$stg=clean($_POST['stg']);
	$queryDetails=clean($_POST['description']);
	$totalamountIGST+$totalamountCGST+$totalamountSTG=0;
	// if($igst!=''){
	// $totalamountIGST = ($igst / 100) * $totalamount;
	// }
	// if($cgst!=''){
	// $totalamountCGST = ($cgst / 100) * $totalamount;
	// }
	// if($stg!=''){
	// $totalamountSTG = ($stg / 100) * $totalamount;
	// }
	$totalamount=$totalamountIGST+$totalamountCGST+$totalamountSTG+$totalamount;
	$dateAdded=time();
	$where='id='.$editId.'';
	$namevalue ='invoiceType="'.$invoiceType.'",queryId="'.$queryId.'",totalamount="'.$totalamount.'",invoicedate="'.$fromDate.'",amount="'.$amount.'",invoicedate="'.$invoicedate.'",igst="'.$igst.'",cgst="'.$cgst.'",stg="'.$stg.'",queryDetails="'.$queryDetails.'",deletestatus=0';
	updatelisting(_INVOICE_MASTER_,$namevalue,$where);
	?>
	<script>
	parent.setupbox('showpage.crm?module=invoice&alt=1');
	</script>
	<?php
}

if(trim($_REQUEST['action'])=='invoicedelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_INVOICE_MASTER_,$namevalue,$where);
generateLogs('invoice','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=invoice&alt=3');
</script>
<?php
}
if(trim($_REQUEST['action'])=='paymentdelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_PAYMENT_REQUEST_MASTER_,$namevalue,$where);
generateLogs('paymentrequest','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=paymentrequest&alt=3');
</script>
<?php
}
if($_POST['sendinvoicetoemail']=='1' && $_POST['sendemailinvoiceid']!='' && isset($_POST['emailsender'])){
	include "config/mail.php";
	$emailsender=$_POST['emailsender'];
	$invoiceid=$_POST['sendemailinvoiceid'];
	$emailsubject=clean($_POST['emailsubject']);
	$emaildescription=nl2br(clean($_POST['emaildescription']));
	$attfilename=$_POST['attfile'];
	if($_REQUEST['attachinvoice']!=''){
		$invoiceattache='<a style="text-decoration: none;" href="'.$fullurl.'dirfiles/'.$_REQUEST['attachinvoice'].'"><div style="font-size: 16px; padding: 14px 60px; background-color: #45b558; color: #fff;display: inline-block;    margin-bottom: 20px; text-decoration: none; border-radius: 4px;">Download Invoice</div></a>';
		$invoiceattach='Please find attached invoice<br>';
	} else {
		$invoiceattache='<a style="text-decoration: none;" href="'.$fullurl.'tcpdf/examples/getInvoicepdf.php?pageurl='.$fullurl.'invoicepdf.php?id='.encode($invoiceid).'"><div style="font-size: 16px; padding: 14px 60px; background-color: #45b558; color: #fff;display: inline-block;    margin-bottom: 20px; text-decoration: none; border-radius: 4px;">Download Invoice</div></a>';
		$invoiceattach='Please find attached invoice<br>';
	}
	$select='emailsignature';
	$where='id="'.$_SESSION['userid'].'"';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	$LoginUserDetails=mysqli_fetch_array($rs);

	if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
	    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
	}

	$select='';
	$where='';
	$rs='';
	$select='*';
	$where='id=1';
	$rs=GetPageRecord($select,_QUERY_MAILS_SECTION_MASTER_,$where);
	$resultpageemail=mysqli_fetch_array($rs);
	$description=$invoiceattach.'<br>'.$emaildescription.'<br><br>'.$invoiceattache.'<br><br>'.stripslashes($emailsignature);
	$ccmail=$resultpageemail['queryemail'];
	$fromemail='';
	$mailto=$emailsender;
	$mailsubject=$emailsubject;
	$maildescription=$description;
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail,$attfilename,$attfilename);
	if($exeMailresult!=true){
		
		?>
		<script>
		parent.alert('Mail not sent, Please check your configration');
		parent.location.reload(); 
		</script>
		<?php
	}else{
	
		?>
		<script>
		parent.$('#sendmailfrm').hide();
		parent.$('#sendmailaction').show();
		parent.$('#loaderbox').hide();
		parent.$('#pageloading').hide();
		</script>
		<?php 
	} 
}
if($_REQUEST['addvoucher']=='1' && trim($_REQUEST['QueryId'])!=''){
$result =mysqli_query(db(),"select * from "._VOUCHER_MASTER_." where queryId='".trim(ltrim($_REQUEST['QueryId'], '0'))."' and deletestatus!=1")  or die(mysqli_error(db()));
$number =mysqli_num_rows($result);
if($number!=0)
{
exit();
}
$wheredel='queryId='.trim($_REQUEST['QueryId']).'';
deleteRecord(_VOUCHER_LIST_MASTER_,$wheredel);
$wheredel='queryId='.trim($_REQUEST['QueryId']).'';
deleteRecord(_VOUCHER_MASTER_,$wheredel);
$dateAdded=time();
$namevalue ='queryId="'.trim($_REQUEST['QueryId']).'",deletestatus=0,addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
$voucherlastid = addlistinggetlastid(_VOUCHER_MASTER_,$namevalue);
 ?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.setupbox('showpage.crm?module=voucher&add=yes&id=<?php echo encode($voucherlastid); ?>');
</script>
 <?php
exit();
}

if($_POST['voucherId']!='' && $_POST['updatevoucherlist']=='1'){
$thisid='0';
$select2='*';
$where2='voucherId='.clean($_POST['voucherId']).' order by id desc';
$rs2=GetPageRecord($select2,_VOUCHER_LIST_MASTER_,$where2);
while($listofsuppliers=mysqli_fetch_array($rs2)){
$updateId = $listofsuppliers['id'];
$ansvalfinal='';
$check_list=$_REQUEST['check_listaminities'.$updateId.''];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim($check_list[$i]);
if(trim($ansval) != ''){
$ansvalfinal.=$ansval.',';
} } }
$namevalue ='suppliernonight="'.$_POST['suppliernonight'.$updateId.''].'",suppliertotalcost="'.$_POST['suppliertotalcost'.$updateId.''].'",supplierserviceid="'.$_POST['supplierserviceid'.$updateId.''].'",specialrequest="'.$_POST['specialrequest'.$updateId.''].'",amenitiesList="'.$ansvalfinal.'",roomType="'.$_POST['roomType'.$updateId.''].'",suppliercgst="'.$_POST['suppliercgst'.$updateId.''].'",suppliersgst="'.$_POST['suppliersgst'.$updateId.''].'",supplierigst="'.$_POST['supplierigst'.$updateId.''].'",suppliertoalcost="'.$_POST['suppliertoalcost'.$updateId.''].'",dmcHotel="'.$_POST['dmcHotel'.$updateId.''].'",showCost="'.$_POST['showCost'].'"';
$where='voucherId="'.$_REQUEST['voucherId'].'" and id='.$updateId.'';
$update = updatelisting(_VOUCHER_LIST_MASTER_,$namevalue,$where);
}
$ansvalfinal='';
$check_list=$_REQUEST['check_listaminities'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim($check_list[$i]);
if(trim($ansval) != ''){
$ansvalfinal.=$ansval.',';
} } }
$where='id='.clean($_POST['voucherId']).'';
$namevalue ='deletestatus=0,amenitiesList="'.$ansvalfinal.'",emailsent="'.$_POST['sendmail'].'",specialrequest="'.clean($_POST['specialrequest']).'"';
$voucherlastid = updatelisting(_VOUCHER_MASTER_,$namevalue,$where);
if($_POST['sendmail']==1){
$select1='*';
$where1='id='.$_POST['voucherId'].'';
$rs1=GetPageRecord($select1,_VOUCHER_MASTER_,$where1);
$voucherids=mysqli_fetch_array($rs1);
$select1='*';
$where1='id='.$voucherids['queryId'].'';
$rs1=GetPageRecord($select1,_QUERY_MASTER_,$where1);
$editresultQuery=mysqli_fetch_array($rs1);
$select='';
$where='';
$rs='';
$select='email';
$where='id='.$editresultQuery['assignTo'].'';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$resultpageassignemail=mysqli_fetch_array($rs);
$select='';
$where='';
$rs='';
$select='*';
$where='id=1';
$rs=GetPageRecord($select,_QUERY_MAILS_SECTION_MASTER_,$where);
$resultpageemail=mysqli_fetch_array($rs);
$vid=$_POST['voucherId'];
$invoiceattach=file_get_contents(''.$fullurl.'send-voucher.php?id='.encode($vid).'&send=1');
$select='emailsignature';
$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$LoginUserDetails=mysqli_fetch_array($rs);

if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
}

$description=$invoiceattach.'<br>'.$emaildescription.'<br><br>'.stripslashes($emailsignature);
include "config/mail.php";
$fromemail='';
if($editresultQuery['clientType']==1){
//$mailto=getPrimaryEmail($editresultQuery['companyId'],'corporate');
}
if($editresultQuery['clientType']==2){
//$mailto=getPrimaryEmail($editresultQuery['companyId'],'contacts');
}
if($editresultQuery['clientType']==1){
$mailto=getPrimaryEmail($editresultQuery['companyId'],'corporate');
}
if($editresultQuery['clientType']==2){
$mailto=getPrimaryEmail($editresultQuery['companyId'],'contacts');
}
if($editresultQuery['clientType']==1){
$mailtoMulti=getMultiPrimaryEmail($editresultQuery['companyId'],'corporate');
}
if($editresultQuery['clientType']==2){
$mailtoMulti=getMultiPrimaryEmail($editresultQuery['companyId'],'contacts');
}
$ccmail=$resultpageassignemail['email'].','.$resultpageemail['queryemail'].','.$mailtoMulti;
$mailsubject='Booking No. '.makeInvoiceId($vid).'';
$maildescription=$description;
$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
	if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	
		?>
		<script>
		parent.setupbox('showpage.crm?module=voucher&alt=1');
		</script>
		<?php
	}
 }

}
if($_POST['sendvouchertoemail']=='1' && $_POST['sendemailvoucherid']!=''){
include "config/mail.php";
$emailsender=$_POST['emailsender'];
$vid=$_POST['vid'];
$invoiceid=$_POST['sendemailinvoiceid'];
$emailsubject=clean($_POST['emailsubject']);
$emaildescription=nl2br(clean($_POST['emaildescription']));
$attfilename=$_POST['attfile'];
$voucherType=$_POST['voucherType'];
// $invoiceattach=file_get_contents(''.$fullurl.'send-voucher.php?id='.encode($vid).'&send=1');
if($voucherType==1){
$invoiceattach='<a style="text-decoration: none;" href="'.$fullurl.'genrateDOMPdf
.php?pageurl='.$fullurl.'/download-agentvoucher.php?id='.encode($vid).'&download=1"><div style="font-size: 16px; padding: 14px 60px; background-color: #45b558; color: #fff;display: inline-block;    margin-bottom: 20px; text-decoration: none; border-radius: 4px;">Download Voucher</div></a>';
}
if($voucherType==2){
$invoiceattach='<a style="text-decoration: none;" href="'.$fullurl.'genrateDOMPdf
.php?pageurl='.$fullurl.'/download-hotelvoucher.php?id='.encode($vid).'&download=1"><div style="font-size: 16px; padding: 14px 60px; background-color: #45b558; color: #fff;display: inline-block;    margin-bottom: 20px; text-decoration: none; border-radius: 4px;">Download Voucher</div></a>';
}
$select='emailsignature';
$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$LoginUserDetails=mysqli_fetch_array($rs);

if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
}

$select='';
$where='';
$rs='';
$select='*';
$where='id=1';
$rs=GetPageRecord($select,_QUERY_MAILS_SECTION_MASTER_,$where);
$resultpageemail=mysqli_fetch_array($rs);
$description=$invoiceattach.'<br>'.$emaildescription.'<br><br><strong>'.$emailsubject.'</strong><br><br>'.stripslashes($emailsignature);
$select1='*';
$where1='id='.$_POST['vid'].'';
$rs1=GetPageRecord($select1,_VOUCHER_MASTER_,$where1);
$voucherids=mysqli_fetch_array($rs1);
$select1='*';
$where1='id='.$voucherids['queryId'].'';
$rs1=GetPageRecord($select1,_QUERY_MASTER_,$where1);
$editresultQuery=mysqli_fetch_array($rs1);
$select='';
$where='';
$rs='';
$select='email';
$where='id='.$editresultQuery['assignTo'].'';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$resultpageassignemail=mysqli_fetch_array($rs);
$select='';
$where='';
$rs='';
$select='*';
$where='id=1';
$rs=GetPageRecord($select,_QUERY_MAILS_SECTION_MASTER_,$where);
$resultpageemail=mysqli_fetch_array($rs);
if($emailsender!=''){
$emailsender=','.$emailsender;
}
$ccmail=$resultpageassignemail['email'].','.$resultpageemail['queryemail'].$emailsender;
$emailsubject='#'.$editresultQuery['queryId'].' '.$editresultQuery['subject'].'';
$fromemail='';
if($editresultQuery['clientType']==1){
 $mailto=getPrimaryEmail($editresultQuery['companyId'],'corporate');
}
if($editresultQuery['clientType']==2){
 $mailto=getPrimaryEmail($editresultQuery['companyId'],'contacts');
}
$mailsubject=$emailsubject;
$maildescription=$description;
//send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
 $ccmail=$ccmail;
$fromemail='';
 $mailto=$mailto;
 if($mailto==''){
	 $mailto=$emailsender;
 }
$mailsubject=$emailsubject;
 $maildescription=$description;
$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail,$attfilename,$attfilename);
if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	

		$where='id='.clean($_POST['vid']).'';
		$namevalue ='emailsent=1';
		updatelisting(_VOUCHER_MASTER_,$namevalue,$where);
		?>
		<script>
		parent.$('#sendmailfrm').hide();
		parent.$('#sendmailaction').show();
		parent.$('#loaderbox').hide();
		parent.$('#pageloading').hide();
		</script>
		<?php 
	}
}
if($_POST['sendhotelvouchertoemail']=='1' && $_POST['sendemailvoucherid']!=''){
include "config/mail.php";
$emailsender=$_POST['emailsender'];
$vid=$_POST['vid'];
$invoiceid=$_POST['sendemailinvoiceid'];
$emailsubject=clean($_POST['emailsubject']);
$emaildescription=nl2br(clean($_POST['emaildescription']));
$attfilename=$_POST['attfile'];
$voucherType=$_POST['voucherType'];
$id = ($vid).'&hotelId='.($_POST['hotelId']);
$invoiceattach='<a style="text-decoration: none;" href="'.$fullurl.'genrateDOMPdf
.php?pageurl='.$fullurl.'/download-hotelvoucher.php?id='.encode($id).'&download=1"><div style="font-size: 16px; padding: 14px 60px; background-color: #45b558; color: #fff;display: inline-block;    margin-bottom: 20px; text-decoration: none; border-radius: 4px;">Download Voucher</div></a>';
$selecthotel='';
$wherehotel='';
$rshotel='';
$selecthotel='*';
$wherehotel='id="'.$_POST['hotelId'].'"';
$rshotel=GetPageRecord($selecthotel,_PACKAGE_BUILDER_HOTEL_MASTER_,$wherehotel);
$hotelemail=mysqli_fetch_array($rshotel);
$mailto=$hotelemail['supplierEmail'];
$select='emailsignature';
$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$LoginUserDetails=mysqli_fetch_array($rs);

if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
}

$select='';
$where='';
$rs='';
$select='*';
$where='id=1';
$rs=GetPageRecord($select,_QUERY_MAILS_SECTION_MASTER_,$where);
$resultpageemail=mysqli_fetch_array($rs);


$description=$invoiceattach.'<br>'.$emaildescription.'<br><br><strong>'.$emailsubject.'</strong><br><br>'.stripslashes($emailsignature);
$select1='*';
$where1='id='.$_POST['vid'].'';
$rs1=GetPageRecord($select1,_VOUCHER_MASTER_,$where1);
$voucherids=mysqli_fetch_array($rs1);
$select1='*';
$where1='id='.$voucherids['queryId'].'';
$rs1=GetPageRecord($select1,_QUERY_MASTER_,$where1);
$editresultQuery=mysqli_fetch_array($rs1);
$select='';
$where='';
$rs='';
$select='email';
$where='id='.$editresultQuery['assignTo'].'';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$resultpageassignemail=mysqli_fetch_array($rs);
$select='';
$where='';
$rs='';
$select='*';
$where='id=1';
$rs=GetPageRecord($select,_QUERY_MAILS_SECTION_MASTER_,$where);
$resultpageemail=mysqli_fetch_array($rs);
if($emailsender!=''){
$emailsender=','.$emailsender;
}
$ccmail=$resultpageassignemail['email'].','.$resultpageemail['queryemail'].$emailsender;
$emailsubject='#'.$editresultQuery['queryId'].' '.$editresultQuery['subject'].'';
$fromemail='';
$mailsubject=$emailsubject;
$maildescription=$description;
//send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
 $ccmail=$ccmail;
$fromemail='';
 $mailto=$mailto;
 if($mailto==''){
	 $mailto=$emailsender;
 }
$mailsubject=$emailsubject;
 $maildescription=$description;
$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail,$attfilename,$attfilename);
if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	

		$where='id='.clean($_POST['vid']).'';
		$namevalue ='emailsent=1';
		updatelisting(_VOUCHER_MASTER_,$namevalue,$where);
		?>
		<script>
		parent.$('#sendmailfrm').hide();
		parent.$('#sendmailaction').show();
		parent.$('#loaderbox').hide();
		parent.$('#pageloading').hide();
		</script>
<?php }

}
if(trim($_REQUEST['action'])=='voucherdelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_VOUCHER_MASTER_,$namevalue,$where);
generateLogs('paymentrequest','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=voucher&alt=3');
</script>
<?php
}
if($_POST['addpaymenttopaymentrequest']=='1' && $_POST['paymentrid']!='' && $_POST['paymentType']!='' && $_POST['amount']!=''){
	include "config/mail.php";
	$paymentrid=clean($_POST['paymentrid']);
	$amount=$_POST['amount'];
	$details=clean($_POST['details']);
	$paymentType=clean($_POST['paymentType']);
	$pendingamountrest=clean($_POST['pendingamountrest']);
	$queryId=clean($_POST['queryId']);
	$supplierId=clean($_POST['supplierId']);
	$paymentBy=clean($_POST['paymentBy']);
	$attachemntname='';
	if(isset($_FILES['attachmentFile']['name'])){
	$file_name=$_FILES['attachmentFile']['name'];
	$file_name=time().'-'.$file_name;
	copy($_FILES['attachmentFile']['tmp_name'],"dirfiles/".$file_name);
	$attachemntname='<a href="'.$fullurl.'dirfiles/'.$file_name.'">Download</a>';
	}
	$dateAdded=time();
	$namevalue ='paymentType="'.$paymentType.'",amount="'.$amount.'",paymentRequestId="'.$paymentrid.'",attachmentFile="'.$file_name.'",details="'.$details.'",paymentBy="'.$paymentBy.'",supplierId="'.$supplierId.'",dateAdded="'.time().'",addedBy="'.$_SESSION['userid'].'"';
	$lastid = addlistinggetlastid(_PAYMENT_LIST_MASTER_,$namevalue);
	if($paymentType==1){
	$paymenttitle='Full Payment';
	}
	if($paymentType==2){
	$paymenttitle='Partial Payment';
	}
	if($paymentType==3){
	$paymenttitle='On Credit';
	}
	$select5='';
	$where5='';
	$rs5='';
	$select5='*';
	$where5='id='.$queryId.'';
	$rs5=GetPageRecord($select5,_QUERY_MASTER_,$where5);
	$getqueryid=mysqli_fetch_array($rs5);
	$companyId=$getqueryid['companyId'];
	$clientType=$getqueryid['clientType'];
	$select='';
	$where='';
	$rs='';
	$select='email';
	$where='id='.$getqueryid['assignTo'].'';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	$resultpageassignemail=mysqli_fetch_array($rs);
	$select='';
	$where='';
	$rs='';
	$select='*';
	$where='queryid='.$getqueryid['id'].'';
	$rs=GetPageRecord($select,_QUERYMAILS_MASTER_,$where);
	$getmultimails=mysqli_fetch_array($rs);
	$select4='';
	$where4='';
	$rs4='';
	$select4='*';
	$where4='id=1';
	$rs4=GetPageRecord($select4,_VOUCHER_SETTING_MASTER_,$where4);
	$resultmainmail=mysqli_fetch_array($rs4);
	$fromemail='';
	$mailto=$resultmainmail['paymentEmailid'];
	$ccmail=$resultmainmail['groupEmailId'].','.$getmultimails['multiemails'].','.$resultpageassignemail['email'].','.$vouchermailto;
	if($paymentType==3){
	$mailsubject=''.$amount.' Payment '.$paymenttitle.' For Query - #'.makeQueryId($getqueryid['id']).'';
	} else {
	$mailsubject=''.$paymenttitle.' '.$amount.' Sent For Query - #'.makeQueryId($getqueryid['id']).'';
	}
	$maildescription='
	Payment Type: <b>'.$paymenttitle.'</b><br><br>
	Payment Amount: <b>'.$amount.'</b><br><br>
	Description: <b>'.$details.'</b><br><br>
	Attachment: <b>'.$attachemntname.'</b><br><br><br>
	<br><div style="color: #a1a1a1; font-size: 12px;">Note: This is auto generated mail by travCRM.</div>';
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
	if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	
		?>
		<script>
		parent.setupbox('showpage.crm?module=paymentrequest&view=yes&id=<?php echo encode($paymentrid); ?>&paymentdone=1');
		</script>
		<?php
	}
exit();
}
if($_POST['addQueryFlight']=='1' && $_POST['LastQueryId']!='' && $_POST['departureDestination']!='' && $_POST['departureDate']!='' && $_POST['arrivalDestination']!='' && $_POST['arrivalDate']!=''){
	$LastQueryId=clean($_POST['LastQueryId']);
	$departureDestination=$_POST['departureDestination'];
	$departureDate=date('Y-m-d',strtotime($_POST['departureDate']));
	$departureTime=clean($_POST['departureTime']);
	$arrivalDestination=clean($_POST['arrivalDestination']);
	$arrivalDate=date('Y-m-d',strtotime($_POST['arrivalDate']));
	$arrivalTime=clean($_POST['arrivalTime']);
	$dateAdded=time();
	$namevalue ='queryId="'.$LastQueryId.'",departureDestination="'.$departureDestination.'",departureDate="'.$departureDate.'",departureTime="'.$departureTime.'",arrivalDestination="'.$arrivalDestination.'",arrivalDate="'.$arrivalDate.'",arrivalTime="'.$arrivalTime.'"';
	$lastid = addlistinggetlastid(_QUERY_FLIGHT_MASTER_,$namevalue);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.alertspopupopenClose();
	parent.loadflightdetailsfunc();
	</script>
	<?php
	exit();
}

if($_POST['addComplaint']=='1' && trim($_POST['queryIdcomp'])!=''  && trim($_POST['subject'])!='' && trim($_POST['compcompanyId'])!='' && trim($_POST['descriptioncomp'])!='' && trim($_POST['compname'])!=''  && trim($_POST['complaintDate'])!='' && trim($_POST['supplierIdcomp'])!='0'){
	$queryIdcomp=clean($_POST['queryIdcomp']);
	$descriptioncomp=($_POST['descriptioncomp']);
	$compcompanyId=clean($_POST['compcompanyId']);
	$supplierIdcomp=clean($_POST['supplierIdcomp']);
	$complaintDate=clean($_POST['complaintDate']);
	$subject=clean($_POST['subject']);
	$status=clean($_POST['status']);
	$complaintDate=date("Y-m-d", strtotime($complaintDate));
	$dateAdded=time();
	$namevalue ='queryId="'.$queryIdcomp.'",companyId="'.$compcompanyId.'",supplierId="'.$supplierIdcomp.'",subject="'.$subject.'",status="'.$status.'",complaintDate="'.$complaintDate.'",description="'.$descriptioncomp.'",dateAdded="'.time().'",addedBy="'.$_SESSION['userid'].'"';
	$lastid = addlistinggetlastid(_COMPLAINT_MASTER_,$namevalue);
	?>
	<script>
	parent.setupbox('showpage.crm?module=complaintmanagement&alt=1');
	</script>
	<?php
	exit();
}


if(trim($_REQUEST['action'])=='complaintdelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_COMPLAINT_MASTER_,$namevalue,$where);
generateLogs('complaint','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=complaintmanagement&alt=3');
</script>
<?php
}

if($_POST['compremarkdetails']!='' && trim($_POST['compId'])!=''  && trim($_POST['status'])!=''){
$compId=clean($_POST['compId']);
$compremarkdetails=clean($_POST['compremarkdetails']);
$status=clean($_POST['status']);
$complaintDate=date("Y-m-d", strtotime($complaintDate));
$dateAdded=time();
$complaintDate=date('Y-m-d');
$namevalue ='complaintId="'.$compId.'",status="'.$status.'",complaintDate="'.$complaintDate.'",description="'.$compremarkdetails.'",dateAdded="'.time().'",addedBy="'.$_SESSION['userid'].'"';
$lastid = addlistinggetlastid(_COMPLAINT_REMARK_MASTER_,$namevalue);
$namevalue ='status="'.$status.'"';
$where='id="'.$compId.'"';
$update = updatelisting(_COMPLAINT_MASTER_,$namevalue,$where);
 ?>
<script>
parent.setupbox('showpage.crm?module=complaintmanagement&view=yes&id=<?php echo encode($compId); ?>&alt=1');
</script>
 <?php
 exit();
} 

if(trim($_POST['action'])=='addquotations'  && trim($_POST['adult'])!=''   && $_POST['totalpax']!=''){
	//$companyId=decode($_POST['companyId']);
	$queryId=($_POST['queryId']);
	//$companyName=clean($_POST['companyName']);
	$adult=clean($_POST['adult']);
	$child=clean($_POST['child']);
	$infant=clean($_POST['infant']);
	$totalpax=clean($_POST['totalpax']);
	$destinationId=clean($_POST['destinationId']);
	$departureDestinationId=clean($_POST['departureDestinationId']);
	$guest1=clean($_POST['guest1']);
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
	$toDate=date("Y-m-d", strtotime($_POST['toDate']));
	$night=clean($_POST['night']);
	$dateAdded=time();
	$where='id="'.$_POST['queryId'].'"';
	$namevalue ='deletestatus=0,adult="'.$adult.'",destinationId="'.$destinationId.'",child="'.$child.'",infant="'.$infant.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",night="'.$night.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",guest1="'.$guest1.'",departureDestinationId="'.$departureDestinationId.'",totalpax="'.$totalpax.'",queryId="'.$queryId.'"';
	$update = updatelisting(_QUOTATION_MASTER_,$namevalue,$where);
	?>
	<script>
	// parent.setupbox('showpage.crm?module=quotations&view=yes&id=<?php echo encode($_POST['queryId']); ?>');
	</script>
	<?php
	exit();
} 
if(trim($_POST['action'])=='addEntranceQuotation'  && trim($_POST['fromDate3'])!=''  && trim($_POST['entranceNameId'])!='' && trim($_POST['currencyId2'])!='' && trim($_POST['queryId'])!=''){
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate3']));
	$entranceNameId=addslashes($_POST['entranceNameId']);
	$ticketAdultCost=addslashes($_POST['ticketAdultCost']);
	$ticketchildCost=addslashes($_POST['ticketchildCost']);
	$ticketinfantCost=addslashes($_POST['ticketinfantCost']);
	$destinationId=addslashes($_POST['destinationId2']);
	$queryId=addslashes($_POST['queryId']);
	$supplierId=addslashes($_POST['supplierId']);
	$adMarkup=addslashes($_POST['adMarkup']);
	$chMarkup=addslashes($_POST['chMarkup']);
	$status=addslashes($_POST['status']);
	$currencyId=addslashes($_POST['currencyId2']);
	$dateAdded=time();
	 $namevalue ='fromDate="'.$fromDate.'",destinationId="'.$destinationId.'",entranceNameId="'.$entranceNameId.'",currencyId="'.$currencyId.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adMarkup="'.$adMarkup.'",chMarkup="'.$chMarkup.'",supplierId="'.$supplierId.'"';
	 //&&
	if(trim($_POST['entranceQuotationId'])!=''){
		$where='id="'.$_POST['entranceQuotationId'].'" and queryId='.$_REQUEST['queryId'].'';
		$update = updatelisting(_QUOTATION_ENTRANCE_MASTER_,$namevalue,$where);
	}else{
		$lastid = addlistinggetlastid(_QUOTATION_ENTRANCE_MASTER_,$namevalue);
	}
	?>
	<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.functionloadsaveentrance('');
		parent.alertspopupopenClose();
	</script>
	<?php
	exit();
} 
if(trim($_POST['action'])=='adddmcpaymentrequest'  && trim($_POST['fromDate'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])==''){
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
	$tourType=addslashes($_POST['tourType']);
	$description=addslashes($_POST['description']);
	$gstTypeId=addslashes($_POST['gstTypeId']);
	$gst=addslashes($_POST['gst']);
	$paxType=addslashes($_POST['paxType']);
	$pax=addslashes($_POST['pax']);
	$currencyId=addslashes($_POST['currencyId']);
	$rate=addslashes($_POST['rate']);
	$subtotal=addslashes($_POST['subtotal']);
	$queryId=addslashes($_POST['queryId']);
	$referenceNo=addslashes($_POST['referenceNo']);
	$namevalue ='fromDate="'.$fromDate.'",tourType="'.$tourType.'",description="'.$description.'",gstTypeId="'.$gstTypeId.'",gst="'.$gst.'",paxType="'.$paxType.'",pax="'.$pax.'",currencyId="'.$currencyId.'",rate="'.$rate.'",subtotal="'.$subtotal.'",queryId="'.$queryId.'",referenceNo="'.$referenceNo.'"';
	$lastid = addlistinggetlastid(_DMC_PAYMENT_REQUEST_,$namevalue);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.loadPaymentRequestdmc('');
	parent.alertspopupopenClose();
	</script>
	<?php
	exit();
}

if(trim($_POST['action'])=='addREMpaymentrequest'  && trim($_POST['fromDate3'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])==''){
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate3']));
	$tourType=addslashes($_POST['tourType2']);
	$description=addslashes($_POST['description']);
	$gstTypeId=addslashes($_POST['gstTypeId']);
	$gst=addslashes($_POST['gst']);
	$paxType=addslashes($_POST['paxType2']);
	$pax=addslashes($_POST['pax2']);
	$currencyId=addslashes($_POST['currencyId2']);
	$rate=addslashes($_POST['rate2']);
	$subtotal=addslashes($_POST['subtotal2']);
	$queryId=addslashes($_POST['queryId']);
	$referenceNo=addslashes($_POST['referenceNo']);
	$remcharges=addslashes($_POST['remcharges']);
	$namevalue ='fromDate="'.$fromDate.'",tourType="'.$tourType.'",description="'.$description.'",gstTypeId="'.$gstTypeId.'",gst="'.$gst.'",paxType="'.$paxType.'",pax="'.$pax.'",currencyId="'.$currencyId.'",rate="'.$rate.'",subtotal="'.$subtotal.'",queryId="'.$queryId.'",referenceNo="'.$referenceNo.'",remcharges="'.$remcharges.'"';
	$lastid = addlistinggetlastid(_REM_PAYMENT_REQUEST_,$namevalue);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.loadPaymentRequestdmc('');
	parent.alertspopupopenClose();
	</script>
	<?php
	exit();
}
if(trim($_POST['action'])=='addsupplementarypaymentrequest'  && trim($_POST['fromDate3'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])==''){
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate3']));
	$tourType=addslashes($_POST['tourType2']);
	$description=addslashes($_POST['description']);
	$gstTypeId=addslashes($_POST['gstTypeId2']);
	$gst=addslashes($_POST['gst']);
	$paxType=addslashes($_POST['paxType2']);
	$pax=addslashes($_POST['pax2']);
	$currencyId=addslashes($_POST['currencyId2']);
	$rate=addslashes($_POST['rate2']);
	$subtotal=addslashes($_POST['subtotal2']);
	$queryId=addslashes($_POST['queryId']);
	$referenceNo=addslashes($_POST['referenceNo']);
	$namevalue ='fromDate="'.$fromDate.'",tourType="'.$tourType.'",description="'.$description.'",gstTypeId="'.$gstTypeId.'",gst="'.$gst.'",paxType="'.$paxType.'",pax="'.$pax.'",currencyId="'.$currencyId.'",rate="'.$rate.'",subtotal="'.$subtotal.'",queryId="'.$queryId.'",referenceNo="'.$referenceNo.'"';
	$lastid = addlistinggetlastid(_SUP_PAYMENT_REQUEST_,$namevalue);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.loadPaymentRequestdmc('');
	parent.alertspopupopenClose();
	</script>
	<?php
	exit();
}
// ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if(trim($_POST['action'])=='adddmcpaymentrequest'  && trim($_POST['fromDate3'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])==''){
	  // echo "<pre>";
	  // print_r($_POST);
	  // echo "</pre>";
	  // die();
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate3']));
	$tourType=addslashes($_POST['tourType2']);
	$description=addslashes($_POST['description']);
	$gstTypeId=addslashes($_POST['gstTypeId2']);
	$gst=addslashes($_POST['gst']);
	$paxType=addslashes($_POST['paxType2']);
	$pax=addslashes($_POST['pax2']);
	$currencyId=addslashes($_POST['currencyId2']);
	$rate=addslashes($_POST['rate2']);
	$subtotal=addslashes($_POST['subtotal2']);
	$queryId=addslashes($_POST['queryId']);
	$referenceNo=addslashes($_POST['referenceNo']);
	$namevalue ='fromDate="'.$fromDate.'",tourType="'.$tourType.'",description="'.$description.'",gstTypeId="'.$gstTypeId.'",gst="'.$gst.'",paxType="'.$paxType.'",pax="'.$pax.'",currencyId="'.$currencyId.'",rate="'.$rate.'",subtotal="'.$subtotal.'",queryId="'.$queryId.'",referenceNo="'.$referenceNo.'"';
	$lastid = addlistinggetlastid(_DMC_PAYMENT_REQUEST_,$namevalue);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.loadPaymentRequestdmc('');
	parent.alertspopupopenClose();
	</script>
	<?php
	exit();
}
 if(trim($_POST['action'])=='adddmcpaymentrequest'  && trim($_POST['fromDate'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])!=''){
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$tourType=addslashes($_POST['tourType']);
$description=addslashes($_POST['description']);
$gstTypeId=addslashes($_POST['gstTypeId']);
$gst=addslashes($_POST['gst']);
$paxType=addslashes($_POST['paxType']);
$pax=addslashes($_POST['pax']);
$currencyId=addslashes($_POST['currencyId']);
$rate=addslashes($_POST['rate']);
$subtotal=addslashes($_POST['subtotal']);
$queryId=addslashes($_POST['queryId']);
$referenceNo=addslashes($_POST['referenceNo']);
$namevalue ='fromDate="'.$fromDate.'",tourType="'.$tourType.'",description="'.$description.'",gstTypeId="'.$gstTypeId.'",gst="'.$gst.'",paxType="'.$paxType.'",pax="'.$pax.'",currencyId="'.$currencyId.'",rate="'.$rate.'",subtotal="'.$subtotal.'",queryId="'.$queryId.'",referenceNo="'.$referenceNo.'"';
   $where='id="'.$_POST['editid'].'" and queryId='.$_REQUEST['queryId'].'';
$update = updatelisting(_DMC_PAYMENT_REQUEST_,$namevalue,$where);
?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.loadPaymentRequestdmc('');
parent.alertspopupopenClose();
</script>
<?php
exit();
}
 if(trim($_POST['action'])=='editmcpaymentrequest'  && trim($_POST['fromDate'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])!='' && trim($_POST['paymentSupplierListId'])!=''){
// echo "<pre>";
// print_r($_POST);
// echo "</pre>";
// die();
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$tourType=addslashes($_POST['tourType']);
$description=addslashes($_POST['description']);
$gstTypeId=addslashes($_POST['gstTypeId']);
$gst=addslashes($_POST['gst']);
$nights=addslashes($_POST['nights']);
$rooms=addslashes($_POST['rooms']);
$currencyId=addslashes($_POST['currencyId']);
$rate=addslashes($_POST['rate']);
$subtotal=addslashes($_POST['subtotal']);
$queryId=addslashes($_POST['queryId']);
$referenceNo=addslashes($_POST['referenceNo']);
$paymentSupplierListId=addslashes($_POST['paymentSupplierListId']);
// die();
$namevalue ='fromDate="'.$fromDate.'",tourType="'.$tourType.'",gst="'.$gst.'",rooms="'.$rooms.'",nights="'.$nights.'",currencyId="'.$currencyId.'",rate="'.$rate.'",subtotal="'.$subtotal.'",queryId="'.$queryId.'",referenceNo="'.$referenceNo.'",editStatus=1';
   $where='id="'.$_POST['editid'].'" and queryId='.$_REQUEST['queryId'].'';
$update = updatelisting(_DMC_PAYMENT_REQUEST_,$namevalue,$where);
?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.loadPaymentRequestdmc('');
parent.alertspopupopenClose();
</script>
<?php
exit();
}
if(trim($_POST['action'])=='addNotes'  && trim($_POST['notesDescription'])!='' && trim($_POST['queryId2'])!=''){
$notesDescription=clean($_POST['notesDescription']);
$queryId=addslashes($_POST['queryId2']);
$dateAdded=time();
$namevalue ='notesDescription="'.$notesDescription.'",queryId="'.$queryId.'",dateAdded="'.$dateAdded.'",userId="'.$_SESSION['userid'].'"';
$lastid = addlistinggetlastid(_NOTES_MASTER_,$namevalue);
?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.loadquerynotes('');
parent.alertspopupopenClose();
</script>
<?php
exit();
} 
// deleted some unused actions from here
if($_POST['senditinerarytoemail']=='1' && $_POST['sendemailitineraryid']!='' && $_POST['emailsender']!=''){
include "config/mail.php";
$emailsender=$_POST['emailsender'];
$invoiceid=$_POST['sendemailitineraryid'];
$emailsubject=clean($_POST['emailsubject']);
$emaildescription=nl2br(clean($_POST['emaildescription']));
$invoiceattach=file_get_contents(''.$fullurl.'itinerarypdf.php?id='.encode($invoiceid).'&send=1');
$select='emailsignature';
$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$LoginUserDetails=mysqli_fetch_array($rs);

if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
}

$select='';
$where='';
$rs='';
$select='*';
$where='id=1';
$rs=GetPageRecord($select,_QUERY_MAILS_SECTION_MASTER_,$where);
$resultpageemail=mysqli_fetch_array($rs);
$description=$invoiceattach.'<br>'.$emaildescription.'<br><br>'.stripslashes($emailsignature);
$ccmail=$resultpageemail['queryemail'];
$fromemail='';
$mailto=$emailsender;
$mailsubject=$emailsubject;
$maildescription=$description;
$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	

		?>
		<script>
		parent.$('#sendmailfrm').hide();
		parent.$('#sendmailaction').show();
		parent.$('#loaderbox').hide();
		parent.$('#pageloading').hide();
		</script>
<?php }
}





// Office branches address code started 

if($_POST['action']=='addOfficeAddress'){

	// $editid= $_POST['editid'];
	if($_POST['editid']!=''){
		$editid= $_POST['editid'];
		$countryId=($_POST['countryId2']);
		$name=($_POST['name']);
		$stateId=clean($_POST['stateId2']);
		$cityId=clean($_POST['cityId2']);
		$address=clean($_POST['address1']);
		$pinCode=clean($_POST['pinCode']);
		$gstn=clean($_POST['gstn']);
		$primaryAddress=clean($_POST['primaryAddress']);
		$addressType=clean($_POST['addressType']);
		
		// set a default
		if($primaryAddress==1){
			$primaryAddress=1;
			$where='1'; 
			$namevalue ='primaryAddress="0"';
			$update = updatelisting('officeBranches',$namevalue,$where); 
		}
		else{
		$primaryAddress=0;	
		}

		$namevalue ='name="'.$name.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address="'.$address.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",primaryAddress="'.$primaryAddress.'",addressType="'.$addressType.'"';
		$where='id="'.$editid.'"';
		$update = updatelisting('officeBranches',$namevalue,$where);
	}else{
		$countryId=($_POST['countryId2']);
		$name=($_POST['name']);
		$stateId=clean($_POST['stateId2']);
		$cityId=clean($_POST['cityId2']);
		$address=clean($_POST['address1']);
		$pinCode=clean($_POST['pinCode']);
		$gstn=clean($_POST['gstn']);
		$primaryAddress=clean($_POST['primaryAddress']);
		$addressType=clean($_POST['addressType']);
		// set a default
		if($primaryAddress==1){
			$primaryAddress=1;
			$where='1'; 
			$namevalue ='primaryAddress="0"';
			$update = updatelisting('officeBranches',$namevalue,$where); 
		}
		else{
		$primaryAddress=0;	
		}
		  $namevalue ='name="'.$name.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address="'.$address.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",status="1",primaryAddress="'.$primaryAddress.'"';
		  $lastid = addlisting('officeBranches',$namevalue);
		 
		
	}
	
	 ?>
	<script>
	// parent.loadaddress('0');
	// parent.$('#pageloading').hide();
	// parent.$('#pageloader').hide();
	// parent.alertspopupopenClose();
	// <script>
	parent.window.location.href='setupsetting.crm?module=companymastersettings&add=yes&configuration=1&alt=2';
	// </script>
	</script>
	 <?php
	 exit();
	}
//Office branches address code ended 






if($_POST['action']=='addsupaddress' && $_POST['supid']!='' && $_POST['countryId2']!='' && $_POST['editid']=='' && $_POST['addressType']!=''){
$supid=clean($_POST['supid']);

$countryId=($_POST['countryId2']);
$stateId=clean($_POST['stateId2']);
$cityId=clean($_POST['cityId2']);
$address=clean($_POST['address1']);
$pinCode=clean($_POST['pinCode']);
$gstn=clean($_POST['gstn']);
$primaryAddress=clean($_POST['primaryAddress']);
$addressType=clean($_POST['addressType']);
 if($primaryAddress==1){
 $where='addressParent="'.$_POST['supid'].'"';
 $namevalue ='primaryAddress=0';
 $update = updatelisting(_ADDRESS_MASTER_,$namevalue,$where);
 }
  $namevalue ='addressParent="'.$supid.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address="'.$address.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",addressType="'.$addressType.'",primaryAddress="'.$primaryAddress.'"';
$lastid = addlistinggetlastid('addressMaster',$namevalue);
 if($primaryAddress==1){
if($_POST['addressType']=='invoicesetting'){
$namevalue ='address="'.$address.'"';
$where='id="'.$_POST['supid'].'"';
} else {
$namevalue ='countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address1="'.$address.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'"';
$where='id="'.$_POST['supid'].'"';
}
if($_POST['addressType']=='supplier'){
$update = updatelisting(_SUPPLIERS_MASTER_,$namevalue,$where);
}
if($_POST['addressType']=='corporate'){
$update = updatelisting(_CORPORATE_MASTER_,$namevalue,$where);
}
if($_POST['addressType']=='invoicesetting'){
$update = updatelisting(_INVOICE_SETTING_MASTER_,$namevalue,$where);
}
}
 ?>
<script>
parent.loadaddress('0');
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.alertspopupopenClose();
</script>
 <?php
 exit();
}
if($_POST['action']=='addsupaddress' && $_POST['supid']!='' && $_POST['countryId2']!='' && $_POST['editid']!=''){
$editid=clean($_POST['editid']);
$supid=clean($_POST['supid']);
$countryId=($_POST['countryId2']);
$stateId=clean($_POST['stateId2']);
$cityId=clean($_POST['cityId2']);
$address=clean($_POST['address1']);
$pinCode=clean($_POST['pinCode']);
$gstn=clean($_POST['gstn']);
$primaryAddress=clean($_POST['primaryAddress']);
$addressType=clean($_POST['addressType']);
 if($primaryAddress==1){
 $where='addressParent="'.$_POST['supid'].'"';
 $namevalue ='primaryAddress=0';
$update = updatelisting(_ADDRESS_MASTER_,$namevalue,$where);
 }
$namevalue ='addressParent="'.$supid.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address="'.$address.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",primaryAddress="'.$primaryAddress.'",addressType="'.$addressType.'"';
$where='id="'.$editid.'" and addressParent='.$supid.'';
$update = updatelisting(_ADDRESS_MASTER_,$namevalue,$where);
 if($primaryAddress==1){
 if($_POST['addressType']=='invoicesetting'){
$namevalue ='address="'.$address.'"';
$where='id="'.$_POST['supid'].'"';
} else {
$namevalue ='countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address1="'.$address.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'"';
}
$where='id="'.$_POST['supid'].'"';
 if($_POST['addressType']=='supplier'){
$update = updatelisting(_SUPPLIERS_MASTER_,$namevalue,$where);
}
 if($_POST['addressType']=='corporate'){
$update = updatelisting(_CORPORATE_MASTER_,$namevalue,$where);
}
if($_POST['addressType']=='invoicesetting'){
$update = updatelisting(_INVOICE_SETTING_MASTER_,$namevalue,$where);
}
}
 ?>
<script>
parent.loadaddress('0');
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.alertspopupopenClose();
</script>
 <?php
 exit();
} 
if(trim($_POST['action'])=='addcheckin'  && trim($_POST['fromDate'])!='' && trim($_POST['checkInTime'])!='' && trim($_POST['supplierName'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])==''){
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$tourType=addslashes($_POST['tourType2']);
$supplierName=addslashes($_POST['supplierName']);
$contactPerson=addslashes($_POST['contactPerson']);
$email=addslashes($_POST['email']);
$mobile=addslashes($_POST['mobile']);
$checkInTime=addslashes($_POST['checkInTime']);
$remark=addslashes($_POST['remark']);
$statusId=addslashes($_POST['statusId']);
$queryId=addslashes($_POST['queryId']);
$file_name='';
if(isset($_FILES['attachment']['name'])){
$file_name=time().'-'.str_replace(' ','-',$_FILES['attachment']['name']);
copy($_FILES['attachment']['tmp_name'],"dirfiles/".$file_name);
}
$traveltime=$fromDate.' '.$checkInTime;
$traveltime = date('Y-m-d H:i:s', strtotime($traveltime));
$selecttodoassign='*';
$wheretodoassign='id='.$queryId.'';
$rstodoassign=GetPageRecord($selecttodoassign,_QUERY_MASTER_,$wheretodoassign);
$resultpagetodoassign=mysqli_fetch_array($rstodoassign);
$assignTo=$resultpagetodoassign['assignTo'];
$newdatetime=strtotime($fromDate.' '.strtoupper($checkInTime));
$newdatetime=date('Y-m-d H:i:s',$newdatetime);
$re ='serviceId="'.$queryId.'",serviceType="Check-List",toDoDate="'.$fromDate.'",toDotime="'.$checkInTime.'",assignto="'.$assignTo.'",dateTime="'.$newdatetime.'" ';
     addlistinggetlastid(_TO_DO_TIMELINE_,$re);
$namevalue ='followupDateTime="'.$traveltime.'",serviceType="'.$tourType.'",supplierName="'.$supplierName.'",contactPerson="'.$contactPerson.'",email="'.$email.'",mobile="'.$mobile.'",remark="'.$remark.'",statusId="'.$statusId.'",attachment="'.$file_name.'",dateAdded="'.time().'",queryId="'.$queryId.'",follow_upDate="'.$fromDate.'",follow_upTime="'.$checkInTime.'"';
$lastid = addlistinggetlastid(_CHECK_LIST_MASTER_,$namevalue);
?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.loadchecklistfun();
</script>
<?php
exit();
}
 if(trim($_POST['action'])=='addcheckin'  && trim($_POST['fromDate'])!='' && trim($_POST['checkInTime'])!='' && trim($_POST['supplierName'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])!=''){
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$tourType=addslashes($_POST['tourType2']);
$supplierName=addslashes($_POST['supplierName']);
$contactPerson=addslashes($_POST['contactPerson']);
$email=addslashes($_POST['email']);
$mobile=addslashes($_POST['mobile']);
$checkInTime=addslashes($_POST['checkInTime']);
$remark=addslashes($_POST['remark']);
$statusId=addslashes($_POST['statusId']);
$queryId=addslashes($_POST['queryId']);
$file_name='';
if(isset($_FILES['attachment']['name'])){
$file_name=time().'-'.str_replace(' ','-',$_FILES['attachment']['name']);
copy($_FILES['attachment']['tmp_name'],"dirfiles/".$file_name);
} else {
$file_name=$_POST['attachment2'];
}
$traveltime=$fromDate.' '.$checkInTime;
$traveltime = date('Y-m-d H:i:s', strtotime($traveltime));
$select1='*';
$where1='serviceId='.$queryId.' and serviceType="Check-List" order by id asc ';
$rs1=GetPageRecord($select1,_TO_DO_TIMELINE_,$where1);
$count = mysqli_num_rows($rs1);
$rss = mysqli_fetch_array($rs1);
$newdatetime=strtotime($rss['toDoDate'].' '.strtoupper($rss['toDotime']));
$newdatetime=date('Y-m-d H:i:s',$newdatetime);
if($count > 0){
 $wherex='serviceId='.$rss['serviceId'].' and serviceType="Check-List" and toDoDate="'.$rss['toDoDate'].'" and toDotime="'.addslashes($rss['toDotime']).'" and dateTime="'.$newdatetime.'" ';
$re ='toDoDate="'.$fromDate.'",toDotime="'.$checkInTime.'" ';
$update = updatelisting(_TO_DO_TIMELINE_,$re,$wherex);
}
$namevalue ='followupDateTime="'.$traveltime.'",serviceType="'.$tourType.'",supplierName="'.$supplierName.'",contactPerson="'.$contactPerson.'",email="'.$email.'",mobile="'.$mobile.'",remark="'.$remark.'",statusId="'.$statusId.'",attachment="'.$file_name.'"';
$where='id="'.$_POST['editid'].'" and queryId="'.$queryId.'"';
$update = updatelisting(_CHECK_LIST_MASTER_,$namevalue,$where);
?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.loadchecklistfun();
</script>
<?php
exit();
}
if(trim($_POST['action'])=='addleads' && trim($_POST['companyId'])!='' && trim($_POST['adult'])!='' && trim($_POST['assignTo'])!='' && trim($_POST['subject'])!='' && $_POST['editId']!=''){
$savenew=clean($_POST['savenew']);
$companyId=decode($_POST['companyId']);
$editId=decode($_POST['editId']);
$companyName=clean($_POST['companyName']);
$adult=clean($_POST['adult']);
$destinationId=clean($_POST['destinationId']);
$child=clean($_POST['child']);
$queryPriority=clean($_POST['queryPriority']);
$categoryId=clean($_POST['categoryId']);
$officeBranch=clean($_POST['officeBranch']);
$assignTo=decode($_POST['assignTo']);
$description=clean($_POST['description']);
$guest1=clean($_POST['guest1']);
$guest2=clean($_POST['guest2']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$toDate=date("Y-m-d", strtotime($_POST['toDate']));
$night=clean($_POST['night']);
$tat=clean($_POST['tat']);
$tourType=clean($_POST['tourType']);
$subject=clean($_POST['subject']);
$multiemails=clean($_POST['multiemails']);
$clientType=clean($_POST['clientType']);
$rooms=clean($_POST['rooms']);
$occupancyType=clean($_POST['occupancyType']);
$hotelBudget=clean($_POST['hotelBudget']);
$guest1phone=clean($_POST['guest1phone']);
$guest1email=($_POST['guest1email']);
$paymentMode=($_POST['paymentMode']);
$dateAdded=time();
if(isset($_FILES['attachmentFile']['name'])){
$file_name=$_FILES['attachmentFile']['name'];
$file_name=time().'-'.$file_name;
copy($_FILES['attachmentFile']['tmp_name'],"dirfiles/".$file_name);
$attachmentvar=" <br><br><a href='".$fullurl."download/".$file_name."' target='_blank'><strong>Download Attachment</strong></a>";
}
$namevalue ='companyId="'.$companyId.'",deletestatus=0,queryDate="'.date('Y-m-d').'",attachmentFile="'.$file_name.'",adult="'.$adult.'",destinationId="'.$destinationId.'",child="'.$child.'",categoryId="'.$categoryId.'",officeBranch="'.$officeBranch.'",assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",night="'.$night.'",tourType="'.$tourType.'",subject="'.$subject.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",guest1="'.$guest1.'",guest2="'.$guest2.'",queryPriority="'.$queryPriority.'",clientType="'.$clientType.'",tat="'.$tat.'",queryTimer="'.time().'",rooms="'.$rooms.'",occupancyType="'.$occupancyType.'",hotelBudget="'.$hotelBudget.'",guest1email="'.$guest1email.'",guest1phone="'.$guest1phone.'",paymentMode="'.$paymentMode.'"';
$where='id='.$editId.'';
$update = updatelisting(_LEAD_MASTER_,$namevalue,$where);
if($update=='yes'){
if($savenew==1){
?>
<script>
parent.setupbox('showpage.crm?module=leads&add=yes');
</script>
<?php exit(); } else { ?>
<script>
parent.setupbox('showpage.crm?module=leads');
</script>
<?php
 exit();
}
}
}
if(trim($_POST['action'])=='editleads' && trim($_POST['companyId'])!='' && trim($_POST['assignTo'])!='' && $_POST['editId']!=''){
	

$savenew=clean($_POST['savenew']);
$companyId=decode($_POST['companyId']);
$editId=decode($_POST['editId']);
$companyName=clean($_POST['companyName']);
$assignTo=decode($_POST['assignTo']);
$OpsAssignTo=decode($_POST['OpsAssignTo']);
$description=clean($_POST['description']);
$country=clean($_POST['country']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$toDate=date("Y-m-d", strtotime($_POST['toDate']));
$followupdate=date("Y-m-d", strtotime($_POST['followupdate']));
$followuptime=$_POST['followuptime'];
$status=clean($_POST['status']);
$reminderTime=clean($_POST['reminderTime']);
$starttime=clean($_POST['starttime']);
// $duration=clean($_POST['duration']);
$endtime=clean($_POST['endtime']);
$subject=clean($_POST['subject']);
$guest1=clean($_POST['guest1']);
$additionalInfo=clean($_POST['additionalInfo']);

$fromDate2=clean($_POST['fromDate2']);
$toDate2=clean($_POST['toDate2']);
$night2=clean($_POST['night2']);
$adult=clean($_POST['adult']);
$Child=clean($_POST['child']);
$Infant=clean($_POST['infant']);

$sglRoom=clean($_POST['sglRoom']);
$dblRoom=clean($_POST['dblRoom']);
$twinRoom=clean($_POST['twinRoom']);
$tplRoom=clean($_POST['tplRoom']);
$quadNoofRoom=clean($_POST['quadNoofRoom']);
$extraNoofBed=clean($_POST['extraNoofBed']);
$cwbRoom=clean($_POST['cwbRoom']);
$cnbRoom=clean($_POST['cnbRoom']);
// fromDate2,toDate2,night2,adult,Child,Infant,sglRoom,dblRoom,twinRoom,tplRoom,quadNoofRoom
// extraNoofBed,cwbRoom,cnbRoom,guest1,additionalInfo


$destination = implode(',', $_POST['destinationId']);
$leadsource=clean($_POST['leadsource']);
// $leadsource=17;
$clientType=clean($_POST['clientType']);




$dealSize=clean($_POST['dealSize']);
$salesStage=clean($_POST['salesStage']);
$directiontype=clean($_POST['directiontype']);
$editedityes=clean($_POST['editedityes']);
$dateAdded=time();
if($editedityes=='1'){
$modifyBy=$_SESSION['userid'];
$dateAdded=time();
generateLogs('leads','edit',$editId);
} else {
generateLogs('leads','add',$editId);
}

 $remiderDate=date('Y-m-d H:i:s',strtotime($fromDate.' '.$starttime));
if($editedityes=='1'){
$namevalue ='companyId="'.$companyId.'",deletestatus=0,assignTo="'.$assignTo.'",OpsAssignTo="'.$OpsAssignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",status="'.$status.'",leadsource="'.$leadsource.'",guest1="'.$guest1.'",additionalInfo="'.$additionalInfo.'",subject="'.$subject.'",fromDate2="'.$fromDate2.'",toDate2="'.$toDate2.'",night2="'.$night2.'",adult="'.$adult.'",Child="'.$Child.'",Infant="'.$Infant.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",twinRoom="'.$twinRoom.'",tplRoom="'.$tplRoom.'",quadNoofRoom="'.$quadNoofRoom.'",extraNoofBed="'.$extraNoofBed.'",cwbRoom="'.$cwbRoom.'",cnbRoom="'.$cnbRoom.'",clientType="'.$clientType.'",directiontype="'.$directiontype.'",reminderTime="'.$reminderTime.'",followupdate="'.$followupdate.'",starttime="'.$starttime.'",endtime="'.$endtime.'",followuptime="'.$followuptime.'",destination="'.$destination.'",salesStage="'.$salesStage.'",dealSize="'.$dealSize.'"';
} else {
echo $namevalue ='companyId="'.$companyId.'",deletestatus=0,assignTo="'.$assignTo.'",OpsAssignTo="'.$OpsAssignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",status="'.$status.'",leadsource="'.$leadsource.'",guest1="'.$guest1.'",additionalInfo="'.$additionalInfo.'",subject="'.$subject.'",fromDate2="'.$fromDate2.'",toDate2="'.$toDate2.'",night2="'.$night2.'",adult="'.$adult.'",Child="'.$Child.'",Infant="'.$Infant.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",twinRoom="'.$twinRoom.'",tplRoom="'.$tplRoom.'",quadNoofRoom="'.$quadNoofRoom.'",extraNoofBed="'.$extraNoofBed.'",cwbRoom="'.$cwbRoom.'",cnbRoom="'.$cnbRoom.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",clientType="'.$clientType.'",directiontype="'.$directiontype.'",followupdate="'.$followupdate.'",starttime="'.$starttime.'",endtime="'.$endtime.'",reminderTime="'.$reminderTime.'",followuptime="'.$followuptime.'",destination="'.$destination.'",salesStage="'.$salesStage.'",dealSize="'.$dealSize.'"';
}


$where='id='.$editId.'';
$update = updatelisting('leadManageMaster',$namevalue,$where);
if($update=='yes'){
if($_POST['eventId']!=''){
$dateAdded=time();
$namevalue ='dateAdded="'.$dateAdded.'",parentId="'.decode($_POST['eventId']).'",eventType="leads",eventId="'.$editId.'"';
$lastqueryidmain= addlistinggetlastid(_SALES_TIMELINE_MASTER_,$namevalue);
}
if($_REQUEST['rpage']!=''){
?>
<script>
parent.setupbox('<?php echo ($_REQUEST['rpage']); ?>');
</script>
<?php exit(); } else { ?>
<script>
parent.setupbox('showpage.crm?module=leads&view=yes&id=<?php echo $_POST['editId']; ?>');
</script>
<?php
 exit();
}
}
}

if(trim($_REQUEST['action'])=='leaddelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting('leadManageMaster',$namevalue,$where);
generateLogs('leads','delete',$ansval);
} } }

?>
<script>
parent.setupbox('showpage.crm?module=leads&alt=3');
</script>
<?php
}

if(trim($_POST['action'])=='editcalls' && trim($_POST['companyId'])!='' && trim($_POST['assignTo'])!='' && trim($_POST['subject'])!='' && $_POST['editId']!=''){
	
$savenew=clean($_POST['savenew']);
$companyId=decode($_POST['companyId']);
$editId=decode($_POST['editId']);
$companyName=clean($_POST['companyName']);
$assignTo=decode($_POST['assignTo']);
$description=clean($_POST['description']);
$country=clean($_POST['country']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$toDate=date("Y-m-d", strtotime($_POST['toDate']));
$followupdate=date("Y-m-d", strtotime($_POST['followupdate']));
$followuptime=$_POST['followuptime'];
$status=clean($_POST['status']);
$starttime=clean($_POST['starttime']);
$duration=clean($_POST['duration']);
$endtime=clean($_POST['endtime']);
$subject=clean($_POST['subject']);
$destination = implode(',', $_POST['destinationId']);
$leadsource=clean($_POST['leadsource']);
$clientType=clean($_POST['clientType']);
$campaign=clean($_POST['campaign']);
$reminderTime=clean($_POST['reminderTime']);
$directiontype=clean($_POST['directiontype']);
$editedityes=clean($_POST['editedityes']);
$dateAdded=time();
if($editedityes=='1'){
$modifyBy=$_SESSION['userid'];
$dateAdded=time();
generateLogs('calls','edit',$editId);
} else {
generateLogs('calls','add',$editId);
}
 $remiderDate=date('Y-m-d H:i:s',strtotime($fromDate.' '.$starttime));
if($editedityes=='1'){
$namevalue ='companyId="'.$companyId.'",deletestatus=0,assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",status="'.$status.'",leadsource="'.$leadsource.'",subject="'.$subject.'",clientType="'.$clientType.'",directiontype="'.$directiontype.'",followupdate="'.$followupdate.'",starttime="'.$starttime.'",endtime="'.$endtime.'",reminderTime="'.$reminderTime.'",duration="'.$duration.'",followuptime="'.$followuptime.'",country="'.$country.'",destination="'.$destination.'",campaign="'.$campaign.'"';
} else {
$namevalue ='companyId="'.$companyId.'",deletestatus=0,assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",status="'.$status.'",leadsource="'.$leadsource.'",subject="'.$subject.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",clientType="'.$clientType.'",directiontype="'.$directiontype.'",followupdate="'.$followupdate.'",starttime="'.$starttime.'",endtime="'.$endtime.'",reminderTime="'.$reminderTime.'",duration="'.$duration.'",followuptime="'.$followuptime.'",country="'.$country.'",destination="'.$destination.'",campaign="'.$campaign.'"';
}
$where='id='.$editId.'';
$update = updatelisting(_CALLS_MASTER_,$namevalue,$where);
if($update=='yes'){
if($_POST['eventId']!=''){
$dateAdded=time();
$namevalue ='dateAdded="'.$dateAdded.'",parentId="'.decode($_POST['eventId']).'",eventType="calls",eventId="'.$editId.'"';
$lastqueryidmain= addlistinggetlastid(_SALES_TIMELINE_MASTER_,$namevalue);
}
if($_REQUEST['rpage']!=''){
?>
<script>
parent.setupbox('<?php echo ($_REQUEST['rpage']); ?>');
</script>
<?php exit(); } else { ?>
<script>
parent.setupbox('showpage.crm?module=calls&view=yes&id=<?php echo $_POST['editId']; ?>');
</script>
<?php
 exit();
}
}
}
if(trim($_REQUEST['action'])=='callsdelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_CALLS_MASTER_,$namevalue,$where);
generateLogs('calls','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=calls&alt=3');
</script>
<?php
}
if(trim($_POST['action'])=='editmeetings' && trim($_POST['companyId'])!='' && trim($_POST['assignTo'])!='' && trim($_POST['subject'])!='' && $_POST['editId']!=''){
	
$savenew=clean($_POST['savenew']);
$companyId=decode($_POST['companyId']);
$editId=decode($_POST['editId']);
$companyName=clean($_POST['companyName']);
$assignTo=decode($_POST['assignTo']);
$description=clean($_POST['description']);
$country=clean($_POST['country']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$toDate=date("Y-m-d", strtotime($_POST['toDate']));
$followupdate=date("Y-m-d", strtotime($_POST['followupdate']));
$followuptime=$_POST['followuptime'];
$status=clean($_POST['status']);
$starttime=clean($_POST['starttime']);
$duration=clean($_POST['duration']);
$endtime=clean($_POST['endtime']);
$subject=clean($_POST['subject']);
$destination = implode(',', $_POST['destinationId']);
$leadsource=clean($_POST['leadsource']);
$clientType=clean($_POST['clientType']);
$campaign=clean($_POST['campaign']);
$reminderTime=clean($_POST['reminderTime']);
$directiontype=clean($_POST['directiontype']);
$editedityes=clean($_POST['editedityes']);
$dateAdded=time();
if($editedityes=='1'){
$modifyBy=$_SESSION['userid'];
$dateAdded=time();
generateLogs('meetings','edit',$editId);
} else {
generateLogs('meetings','add',$editId);
}
 $remiderDate=date('Y-m-d H:i:s',strtotime($fromDate.' '.$starttime));
if($editedityes=='1'){
$namevalue ='companyId="'.$companyId.'",deletestatus=0,assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",status="'.$status.'",leadsource="'.$leadsource.'",subject="'.$subject.'",clientType="'.$clientType.'",directiontype="'.$directiontype.'",followupdate="'.$followupdate.'",starttime="'.$starttime.'",endtime="'.$endtime.'",reminderTime="'.$reminderTime.'",duration="'.$duration.'",followuptime="'.$followuptime.'",country="'.$country.'",destination="'.$destination.'",campaign="'.$campaign.'"';
} else {
$namevalue ='companyId="'.$companyId.'",deletestatus=0,assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",status="'.$status.'",leadsource="'.$leadsource.'",subject="'.$subject.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",clientType="'.$clientType.'",directiontype="'.$directiontype.'",followupdate="'.$followupdate.'",starttime="'.$starttime.'",endtime="'.$endtime.'",reminderTime="'.$reminderTime.'",duration="'.$duration.'",followuptime="'.$followuptime.'",country="'.$country.'",destination="'.$destination.'",campaign="'.$campaign.'"';
}
$where='id='.$editId.'';
$update = updatelisting(_MEETINGS_MASTER_,$namevalue,$where);
if($update=='yes'){
if($_POST['eventId']!=''){
$dateAdded=time();
$namevalue ='dateAdded="'.$dateAdded.'",parentId="'.decode($_POST['eventId']).'",eventType="meetings",eventId="'.$editId.'"';
$lastqueryidmain= addlistinggetlastid(_SALES_TIMELINE_MASTER_,$namevalue);
}
if($_REQUEST['rpage']!=''){
?>
<script>
parent.setupbox('<?php echo ($_REQUEST['rpage']); ?>');
</script>
<?php exit(); } else { ?>
<script>
parent.setupbox('showpage.crm?module=meetings&view=yes&id=<?php echo $_POST['editId']; ?>');
</script>
<?php
 exit();
}
}
}
if(trim($_REQUEST['action'])=='meetingsdelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_MEETINGS_MASTER_,$namevalue,$where);
generateLogs('meetings','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=meetings&alt=3');
</script>
<?php
}
if(trim($_POST['action'])=='edittasks' && trim($_POST['assignTo'])!='' && trim($_POST['subject'])!='' && $_POST['editId']!=''){
	
$savenew=clean($_POST['savenew']);
$companyId=decode($_POST['companyId']);
$editId=decode($_POST['editId']);
$companyName=clean($_POST['companyName']);
$assignTo=decode($_POST['assignTo']);
$description=clean($_POST['description']);
$country=clean($_POST['country']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$toDate=date("Y-m-d", strtotime($_POST['toDate']));
$followupdate=date("Y-m-d", strtotime($_POST['followupdate']));
$followuptime=$_POST['followuptime'];
$status=clean($_POST['status']);
$starttime=clean($_POST['starttime']);
$duration=clean($_POST['duration']);
$endtime=clean($_POST['endtime']);
$subject=clean($_POST['subject']);
$destination = implode(',', $_POST['destinationId']);
$leadsource=clean($_POST['leadsource']);
$clientType=clean($_POST['clientType']);
$campaign=clean($_POST['campaign']);
$reminderTime=clean($_POST['reminderTime']);
$directiontype=clean($_POST['directiontype']);
$editedityes=clean($_POST['editedityes']);
$dateAdded=time();
if($editedityes=='1'){
$modifyBy=$_SESSION['userid'];
$dateAdded=time();
generateLogs('tasks','edit',$editId);
} else {
generateLogs('tasks','add',$editId);
}
 $remiderDate=date('Y-m-d H:i:s',strtotime($fromDate.' '.$starttime));
if($editedityes=='1'){
$namevalue ='companyId="'.$companyId.'",deletestatus=0,assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",status="'.$status.'",leadsource="'.$leadsource.'",subject="'.$subject.'",clientType="'.$clientType.'",directiontype="'.$directiontype.'",followupdate="'.$followupdate.'",starttime="'.$starttime.'",endtime="'.$endtime.'",reminderTime="'.$reminderTime.'",duration="'.$duration.'",followuptime="'.$followuptime.'",country="'.$country.'",destination="'.$destination.'",campaign="'.$campaign.'"';
} else {
$namevalue ='companyId="'.$companyId.'",deletestatus=0,assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",status="'.$status.'",leadsource="'.$leadsource.'",subject="'.$subject.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",clientType="'.$clientType.'",directiontype="'.$directiontype.'",followupdate="'.$followupdate.'",starttime="'.$starttime.'",endtime="'.$endtime.'",reminderTime="'.$reminderTime.'",duration="'.$duration.'",followuptime="'.$followuptime.'",country="'.$country.'",destination="'.$destination.'",campaign="'.$campaign.'"';
}
$where='id='.$editId.'';
$update = updatelisting(_TASKS_MASTER_,$namevalue,$where);
if($update=='yes'){
if($_POST['eventId']!=''){
$dateAdded=time();
$namevalue ='dateAdded="'.$dateAdded.'",parentId="'.decode($_POST['eventId']).'",eventType="tasks",eventId="'.$editId.'"';
$lastqueryidmain= addlistinggetlastid(_SALES_TIMELINE_MASTER_,$namevalue);
}
if($_REQUEST['rpage']!=''){
?>
<script>
parent.setupbox('<?php echo ($_REQUEST['rpage']); ?>');
</script>
<?php exit(); } else { ?>
<script>
parent.setupbox('showpage.crm?module=tasks&view=yes&id=<?php echo $_POST['editId']; ?>');
</script>
<?php
 exit();
}
}
}
if(trim($_REQUEST['action'])=='tasksdelete'){
$check_list=$_REQUEST['check_list'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim(decode($check_list[$i]));
if(trim($ansval) != ''){
$namevalue ='deletestatus="1"';
$where='id="'.$ansval.'"';
$update = updatelisting(_TASKS_MASTER_,$namevalue,$where);
generateLogs('meetings','delete',$ansval);
} } }
?>
<script>
parent.setupbox('showpage.crm?module=tasks&alt=3');
</script>
<?php
}
if($_POST['addQuerySightseeing']=='1' && $_POST['LastQueryId']!='' && $_POST['destination']!='' && $_POST['sightseeingDate']!='' && $_POST['sightseeingId']!='' && $_POST['sightseeingType']!=''){
$LastQueryId=clean($_POST['LastQueryId']);
$destination=$_POST['destination'];
$sightseeingDate=date('Y-m-d',strtotime($_POST['sightseeingDate']));
$sightseeingId=clean($_POST['sightseeingId']);
$sightseeingType=clean($_POST['sightseeingType']);
$remark=clean($_POST['remark']);
$pickupType=clean($_POST['pickupType']);
$pickupTime=clean($_POST['pickupTime']);
if($pickupType==1){
if($pickupTime==''){
exit();
}
}
$dateAdded=time();
$namevalue ='queryId="'.$LastQueryId.'",destination="'.$destination.'",sightseeingDate="'.$sightseeingDate.'",sightseeingId="'.$sightseeingId.'",sightseeingType="'.$sightseeingType.'",remark="'.$remark.'",pickupType="'.$pickupType.'",pickupTime="'.$pickupTime.'"';
$lastid = addlistinggetlastid(_QUERY_SIGHTSEEING_MASTER_,$namevalue);
?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.alertspopupopenClose();
parent.loadsightseeingdetailsfun();
</script>
<?php
exit();
}
if($_POST['addQueryTransfer']=='1' && $_POST['LastQueryId']!='' && $_POST['destination']!='' && $_POST['sightseeingDate']!='' && $_POST['sightseeingId']!='' && $_POST['sightseeingType']!=''){
$transferFromId=clean($_POST['transferFromId']);
$transferToId=clean($_POST['transferToId']);
$LastQueryId=clean($_POST['LastQueryId']);
$destination=$_POST['destination'];
$sightseeingDate=date('Y-m-d',strtotime($_POST['sightseeingDate']));
$sightseeingId=clean($_POST['sightseeingId']);
$sightseeingType=clean($_POST['sightseeingType']);
$remark=clean($_POST['remark']);
$pickupTime=clean($_POST['pickupTime']);
$dateAdded=time();
$namevalue ='queryId="'.$LastQueryId.'",destination="'.$destination.'",transferDate="'.$sightseeingDate.'",transferId="'.$sightseeingId.'",transferType="'.$sightseeingType.'",remark="'.$remark.'",transferFromId="'.$transferFromId.'",transferToId="'.$transferToId.'",pickupTime="'.$pickupTime.'"';
$lastid = addlistinggetlastid(_QUERY_TRANSFER_MASTER_,$namevalue);
?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.alertspopupopenClose();
parent.loadtransferdetailsfun();
</script>
<?php
exit();
}
if($_POST['action']=='addtarget' && $_POST['assignto']!='' && $_POST['year']!='' && $_POST['editId']==''){
$namevalue='';
$assign_to=clean($_POST['assignto']);
$year=clean($_POST['year']);
$January=clean($_POST['January']);
$February=clean($_POST['February']);
$March=clean($_POST['March']);
$April=clean($_POST['April']);
$May=clean($_POST['May']);
$June=clean($_POST['June']);
$July=clean($_POST['July']);
$August=clean($_POST['August']);
$September=clean($_POST['September']);
$October=clean($_POST['October']);
$November=clean($_POST['November']);
$December=clean($_POST['December']);
$addby=clean($_SESSION['userid']);
$adddate=date("Y-m-d");
$editdate=date("Y-m-d");
$namevalue ='assign_to="'.$assign_to.'",year="'.$year.'",January="'.$January.'",February="'.$February.'",March="'.$March.'",April="'.$April.'",May="'.$May.'",June="'.$June.'",July="'.$July.'",August="'.$August.'",September="'.$September.'",October="'.$October.'",November="'.$November.'",December="'.$December.'",addby="'.$addby.'",adddate="'.$adddate.'"';
$add = addlisting(_TARGET_MASTER_,$namevalue);
?>
<script>
parent.setupbox('showpage.crm?module=usertarget&alt=1');
</script>
<?php
exit();
}
if($_POST['action']=='edittarget' && $_POST['assignto']!='' && $_POST['year']!='' && $_POST['editId']!=''){
$namevalue='';
$assign_to=clean($_POST['assignto']);
$editId=($_POST['editId']);
$year=clean($_POST['year']);
$January=clean($_POST['January']);
$February=clean($_POST['February']);
$March=clean($_POST['March']);
$April=clean($_POST['April']);
$May=clean($_POST['May']);
$June=clean($_POST['June']);
$July=clean($_POST['July']);
$August=clean($_POST['August']);
$September=clean($_POST['September']);
$October=clean($_POST['October']);
$November=clean($_POST['November']);
$December=clean($_POST['December']);
$addby=clean($_SESSION['userid']);
$adddate=date("Y-m-d");
$editdate=date("Y-m-d");
$namevalue ='year="'.$year.'",January="'.$January.'",February="'.$February.'",March="'.$March.'",April="'.$April.'",May="'.$May.'",June="'.$June.'",July="'.$July.'",August="'.$August.'",September="'.$September.'",October="'.$October.'",November="'.$November.'",December="'.$December.'",addby="'.$addby.'",adddate="'.$adddate.'"';
$where='id="'.$editId.'"';
$update = updatelisting(_TARGET_MASTER_,$namevalue,$where);
?>
<script>
parent.setupbox('showpage.crm?assignto=<?php echo encode($assign_to); ?>&year=<?php echo $year; ?>&module=usertarget&Submit=Search');
</script>
<?php
exit();
}
if($_POST['action']=='uploadgalleryimage' && $_POST['parentId']!=''){
$parentId=$_REQUEST['parentId'];
$time=time();
if(!empty($_FILES['imagename']['name'])){
$file_name=$time.'-'.$_FILES['imagename']['name'];
copy($_FILES['imagename']['tmp_name'],"dirfiles/".$file_name);
$namevalue ='name="'.$file_name.'",parentId="'.$parentId.'",galleryType="supplier"';
$add = addlisting(_IMAGE_GALLERY_MASTER_,$namevalue);
}
?>
<script>
parent.setupbox('showpage.crm?module=suppliers&view=yes&id=<?php echo encode($parentId); ?>');
</script>
<?php
}
if($_REQUEST['action']=='removepicture' && $_REQUEST['did']!='' && $_REQUEST['parentId']!='' ){
$parentId=$_REQUEST['parentId'];
$did=$_REQUEST['did'];
$sql_del="delete from "._IMAGE_GALLERY_MASTER_."  where parentId='".$parentId."' and id='".$did."' ";
mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
?>
<script>
setupbox('showpage.crm?module=suppliers&view=yes&id=<?php echo encode($parentId); ?>');
</script>
<?php
}
if(trim($_REQUEST['action'])=='addeditroomtypepop' && trim($_REQUEST['addnewtype'])!=''){
$name=clean($_REQUEST['addnewtype']);
$dateAdded=time();
$namevalue ='name="'.$name.'",dateAdded="'.$dateAdded.'",addedBy="'.$_SESSION['userid'].'"';
$lastid = addlistinggetlastid(_ROOM_TYPE_MASTER_,$namevalue);
?>
<script>
$('#roomType2').prepend($("<option></option>").attr("value","<?php echo $lastid; ?>").text("<?php echo $name; ?>"));
parent.canceladdnewtypefun();
parent.$('#addnewtype').val('');
setTimeout(function() { $('#roomType2').val('<?php echo $lastid; ?>'); 	 }, 700);
alert('Room Type Added Successfully');
 $('#showroomtypeloading').hide();
</script>
<?php }
if(trim($_REQUEST['action'])=='addeditsightseeingmaster'  && trim($_REQUEST['addnewtype'])!='' ){
$name=clean($_REQUEST['addnewtype']);
$dateAdded=time();
$destinationId=clean($_REQUEST['destinationId2']);
$namevalue ='name="'.$name.'",destinationId="'.$destinationId.'",dateAdded="'.$dateAdded.'",addedBy="'.$_SESSION['userid'].'"';
addlistinggetlastid(_SIGHTSEEING_MASTER_MASTER_,$namevalue);
$namevalue2 ='sightseeingName="'.$name.'",status="1"';
$lastid = addlistinggetlastid('packageBuilderSightseeingMaster',$namevalue2);
?>
<script>
$('#sightseeingNameId').prepend($("<option></option>").attr("value","<?php echo $lastid; ?>").text("<?php echo $name; ?>"));
parent.canceladdnewtypefun();
parent.$('#addnewtype').val('');
setTimeout(function() { $('#sightseeingNameId').val('<?php echo $lastid; ?>'); 	 }, 700);
alert('Sightseeing Added Successfully');
 $('#showroomtypeloading').hide();
</script>
<?php }
if(trim($_REQUEST['action'])=='addedittransfermaster'  && trim($_REQUEST['addnewtype'])!='' ){
$name=clean($_REQUEST['addnewtype']);
$destinationId=clean($_REQUEST['destinationId']);
$dateAdded=time();
$namevalue ='name="'.$name.'",destinationId="'.$destinationId.'",dateAdded="'.$dateAdded.'",addedBy="'.$_SESSION['userid'].'"';
addlistinggetlastid(_TRANSFER_MASTER_,$namevalue);
$namevalue2 ='transferName="'.$name.'",status="1"';
$lastid = addlistinggetlastid('packageBuilderTransportMaster',$namevalue2);
?>
<script>
$('#transferNameId').prepend($("<option></option>").attr("value","<?php echo $lastid; ?>").text("<?php echo $name; ?>"));
parent.canceladdnewtypefun();
parent.$('#addnewtype').val('');
setTimeout(function() { $('#transferNameId').val('<?php echo $lastid; ?>'); }, 700);
alert('Transfer Added Successfully');
 $('#showroomtypeloading').hide();
</script>
<?php }
if(trim($_REQUEST['action'])=='savequerysuplier' && trim($_REQUEST['queryId'])!='' && trim($_REQUEST['supplierType'])!=''){
$supplierType=clean($_REQUEST['supplierType']);
$id=decode($_REQUEST['id']);
$dateAdded=time();
$namevalue ='supplierType="'.$supplierType.'" ';
$where='id='.$id.'';
$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);
?>
<script>
window.location.href='frmaction.php?QueryId=<?php echo $_REQUEST['queryId']; ?>&addpaymentrequest=1&addsupplier=1&id=<?php echo $id; ?>';
</script>
<?php
exit();
}
if(trim($_REQUEST['action'])=='addvoucherdata' && $_REQUEST['userSupplierType']!='' && $_REQUEST['companyTypeId']!='')
{
if($_REQUEST['fromDate']=='' && $_REQUEST['flightDate']!=''){
$_REQUEST['fromDate'] = $_REQUEST['flightDate'];
}
if($_REQUEST['fromDate']=='' && $_REQUEST['transferDate']!=''){
$_REQUEST['fromDate'] = $_REQUEST['transferDate'];
}
if($_REQUEST['fromDate']=='' && $_REQUEST['sightseeingDate']!=''){
$_REQUEST['fromDate'] = $_REQUEST['sightseeingDate'];
}
$fromDate=date('Y-m-d',strtotime($_REQUEST['fromDate']));
$toDate=date('Y-m-d',strtotime($_REQUEST['toDate']));
$supConfirmationNo=trim($_REQUEST['supConfirmationNo']);
 $mainsupplierId=trim($_REQUEST['mainsupplierId']);
$flightDate=date('Y-m-d',strtotime($_REQUEST['flightDate']));
$flightName=trim($_REQUEST['flightName']);
$flightNumber=trim($_REQUEST['flightNumber']);
$transferDate=date('Y-m-d',strtotime($_REQUEST['transferDate']));
$sightseeingDate=date('Y-m-d',strtotime($_REQUEST['sightseeingDate']));
$sightSeeingTime=trim($_REQUEST['sightSeeingTime']);
if($_REQUEST['companyTypeId']==1)
{
$ansvalfinal='';
$check_list=$_REQUEST['check_listaminities'];
if($check_list!=""){
 for($i=0;$i<=count($check_list)-1;$i++)
{
$ansval=trim($check_list[$i]);
if(trim($ansval) != ''){
$ansvalfinal.=$ansval.',';
} } }
$specialrequest=trim($_REQUEST['specialrequest']);
}
echo $namevalue ='voucherid="'.$_REQUEST['voucherid'].'",supplierId="'.$_REQUEST['supplierId'].'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",companyTypeId="'.$_REQUEST['companyTypeId'].'",roomType="'.$_REQUEST['roomType'].'",userSupplierType="'.$_REQUEST['userSupplierType'].'",supConfirmationNo="'.$supConfirmationNo.'",flightName="'.$flightName.'",flightNumber="'.$flightNumber.'",flightDate="'.$flightDate.'",transferId="'.$_REQUEST['transferId'].'",transferDate="'.$transferDate.'",sightseeingId="'.$_REQUEST['sightseeingId'].'",sightseeingDate="'.$sightseeingDate.'",sightSeeingTime="'.$sightSeeingTime.'",amenitiesList="'.$ansvalfinal.'",specialrequest="'.$specialrequest.'",mainsupplierId="'.$mainsupplierId.'" ';
$add = addlisting(_VOUCHER_SUPPLIER_DATA_,$namevalue);
?>
<script>
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.$('#dmchotel<?php echo $_REQUEST['voucherid'];?><?php echo $_REQUEST['mainsupplierId']; ?>').load('loaddmchotel.php?voucherid=<?php echo $_REQUEST['voucherid'];?>&mainsupplierId=<?php echo $_REQUEST['mainsupplierId']; ?>');
</script>
<?php
}
if(trim($_REQUEST['action'])=='approvequery' && trim($_REQUEST['companyId'])!=''){
$companyId=decode($_POST['companyId']);
$companyName=clean($_POST['companyName']);
$assignTo=decode($_POST['assignTo']);
$description=clean($_POST['description']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$toDate=date("Y-m-d", strtotime($_POST['toDate']));
$night=clean($_POST['night']);
$subject=clean($_POST['subject']);
$clientType=clean($_POST['clientType']);
$guest1phone=clean($_POST['guest1phone']);
$guest1email=($_POST['guest1email']);
$queryDate = $_POST['queryDate'];
$dateAdded=time();
$namevalue ='companyId="'.$companyId.'",dateAdded="'.$queryDate.'",addedBy="'.$_SESSION['userid'].'",assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",night="'.$night.'",subject="'.$subject.'",clientType="'.$clientType.'",guest1phone="'.$guest1phone.'",guest1email="'.$guest1email.'",queryDate="'.$queryDate.'"';
$lastid = addlistinggetlastid(_QUERY_MASTER_,$namevalue);
$namevalue ='status=1';
$where='id="'.$_POST['queryId'].'"';
$update = updatelisting(_INCOMING_QUERY_,$namevalue,$where);
?>
<script>
	parent.window.location.href='showpage.crm?module=incomingquery&alt=1';
</script>
<?php } 
// remove these actions from here
// supplierQuotationReplyToSupplier, supplierQuotationConfirmation, createpackagedetail, createpackagedetail, addhotelcity, saveday, addOptional,  addCostWeb, addCostSheet, addMarkup, addOptional, saveQueryday, loadPackage,suppiermiceReplyaction
if(trim($_POST['action'])=='editfitterms'  && $_POST['editId']!=''){   
	$savenew=($_POST['savenew']);
	$editId=decode($_POST['editId']);
	$termsType=($_POST['termsType']); 
	$type=addslashes($_POST['Ttype']);

	$contactPerson=addslashes($_POST['contactPerson']);
	$countryCode=addslashes($_POST['countryCode']);
	$phoneNo=addslashes($_POST['phoneNo']);
	$emailId=addslashes($_POST['emailId']);
	$availableOn=addslashes($_POST['availableOn']);

	// facelogo,faceurl,twitterlogo,twitterurl,instalogo,instaurl,linklogo,linkurl,facename,twittername,instaname,linkname
	$facename=addslashes($_POST['facename']);
	$socialmediadtlshow=addslashes($_POST['socialmediadtlshow']);
	$contactdddttl=addslashes($_POST['contactdddttl']);
	
	$twittername=addslashes($_POST['twittername']);
	$instaname=addslashes($_POST['instaname']);
	$linkname=addslashes($_POST['linkname']);
	$youtubename=addslashes($_POST['youtubename']);
	
	// $facelogo=addslashes($_POST['facelogo']);
	$faceurl=addslashes($_POST['faceurl']);
	// $twitterlogo=addslashes($_POST['twitterlogo']);
	$twitterurl=addslashes($_POST['twitterurl']);
	// $instalogo=addslashes($_POST['instalogo']);
	$instaurl=addslashes($_POST['instaurl']);
	// $linklogo=addslashes($_POST['linklogo']);
	$linkurl=addslashes($_POST['linkurl']);

	$youtubeurl=addslashes($_POST['youtubeurl']);

	if(!empty($_FILES['facelogo']['name'])){  
		$facelogo=time().$_FILES['facelogo']['name'];  
		copy($_FILES['facelogo']['tmp_name'],"dirfiles/".$facelogo); 
	}else{ 
		$facelogo=$_REQUEST['facelogo2'];
	}

	if(!empty($_FILES['twitterlogo']['name'])){  
		$twitterlogo=time().$_FILES['twitterlogo']['name'];  
		copy($_FILES['twitterlogo']['tmp_name'],"dirfiles/".$twitterlogo); 
	}else{ 
		$twitterlogo=$_REQUEST['twitterlogo2'];
	}


	if(!empty($_FILES['instalogo']['name'])){  
		$instalogo=time().$_FILES['instalogo']['name'];  
		copy($_FILES['instalogo']['tmp_name'],"dirfiles/".$instalogo); 
	}else{ 
		$instalogo=$_REQUEST['instalogo2'];
	}


	if(!empty($_FILES['linklogo']['name'])){  
		$linklogo=time().$_FILES['linklogo']['name'];  
		copy($_FILES['linklogo']['tmp_name'],"dirfiles/".$linklogo); 
	}else{ 
		$linklogo=$_REQUEST['linklogo2'];
	}

	if(!empty($_FILES['youtubelogo']['name'])){  
		$youtubelogo=time().$_FILES['youtubelogo']['name'];  
		copy($_FILES['youtubelogo']['tmp_name'],"dirfiles/".$youtubelogo); 
	}else{ 
		$youtubelogo=$_REQUEST['youtubelogo2'];
	}


	$inclusion = mysqli_real_escape_string(db(),urldecode($_REQUEST['inclusion']));
	$exclusion = mysqli_real_escape_string(db(),urldecode($_REQUEST['exclusion']));
	$termscondition = mysqli_real_escape_string(db(),urldecode($_REQUEST['termscondition']));
	$cancelation = mysqli_real_escape_string(db(),urldecode($_REQUEST['cancelation']));
	$paymentpolicy = mysqli_real_escape_string(db(),urldecode($_REQUEST['paymentpolicy']));
	$remarks = mysqli_real_escape_string(db(),urldecode($_REQUEST['remarks']));
	$travelbasic = mysqli_real_escape_string(db(),urldecode($_REQUEST['travelbasic']));
	$booking = mysqli_real_escape_string(db(),urldecode($_REQUEST['booking']));
	$whyuse = mysqli_real_escape_string(db(),urldecode($_REQUEST['whyuse']));
	$dateAdded = date('Y-m-d H:i:s');
	$namevalue ='addedBy="'.$_SESSION['userid'].'",inclusion="'.$inclusion.'",exclusion="'.$exclusion.'",termscondition="'.$termscondition.'",cancelation="'.$cancelation.'",paymentpolicy="'.$paymentpolicy.'",remarks="'.$remarks.'",travelbasic="'.$travelbasic.'",booking="'.$booking.'",whyuse="'.$whyuse.'",fit_git="'.$type.'",modifyDate="'.$dateAdded.'",contactPerson="'.$contactPerson.'",countryCode="'.$countryCode.'",phone="'.$phoneNo.'",email="'.$emailId.'",availableOn="'.$availableOn.'",socialmediadtlshow="'.$socialmediadtlshow.'",contactdddttl="'.$contactdddttl.'",facelogo="'.$facelogo.'",faceurl="'.$faceurl.'",twitterlogo="'.$twitterlogo.'",twitterurl="'.$twitterurl.'",instalogo="'.$instalogo.'",instaurl="'.$instaurl.'",youtubelogo="'.$youtubelogo.'",linklogo="'.$linklogo.'",youtubeurl="'.$youtubeurl.'",linkurl="'.$linkurl.'",facename="'.$facename.'",twittername="'.$twittername.'",instaname="'.$instaname.'",youtubename="'.$youtubename.'",linkname="'.$linkname.'"';
	$where='id="'.$editId.'"';
	
	
	$update = updatelisting(_PACKAGE_TERMS_CONDITIONS_MASTER,$namevalue,$where); 
	?>
	<script>
	parent.setupbox('showpage.crm?module=fitterms&edit=yes&id=<?php echo encode($editId); ?>'); 
	</script>
	<?php
	exit();
}
if(trim($_POST['action'])=='editgitterms'  && $_POST['editId']!=''){   
	$savenew=($_POST['savenew']);
	$editId=decode($_POST['editId']);
	$termsType=($_POST['termsType']);
	$Ttype=($_POST['Ttype']);
	/* $inclusion=($_POST['inclusion']); 
	$exclusion=($_POST['exclusion']); 
	$termscondition=($_POST['termscondition']);
	$cancelation=($_POST['cancelation']);
	$travelbasic=($_POST['travelbasic']);
	$booking=($_POST['booking']);
	$whyuse=($_POST['whyuse']);*/
	// $type=addslashes($_POST['type']);
	$inclusion = mysqli_real_escape_string(db(),urldecode($_REQUEST['inclusion']));
	$exclusion = mysqli_real_escape_string(db(),urldecode($_REQUEST['exclusion']));
	$termscondition = mysqli_real_escape_string(db(),urldecode($_REQUEST['termscondition']));
	$cancelation = mysqli_real_escape_string(db(),urldecode($_REQUEST['cancelation']));
	$paymentpolicy = mysqli_real_escape_string(db(),urldecode($_REQUEST['paymentpolicy']));
	$remarks = mysqli_real_escape_string(db(),urldecode($_REQUEST['remarks']));
	$travelbasic = mysqli_real_escape_string(db(),urldecode($_REQUEST['travelbasic']));
	$booking = mysqli_real_escape_string(db(),urldecode($_REQUEST['booking']));
	$whyuse = mysqli_real_escape_string(db(),urldecode($_REQUEST['whyuse']));
	$dateAdded = date('Y-m-d H:i:s');
	$namevalue ='addedBy="'.$_SESSION['userid'].'",inclusion="'.$inclusion.'",exclusion="'.$exclusion.'",termscondition="'.$termscondition.'",cancelation="'.$cancelation.'",paymentpolicy="'.$paymentpolicy.'",remarks="'.$remarks.'",travelbasic="'.$travelbasic.'",booking="'.$booking.'",whyuse="'.$whyuse.'",fit_git="'.$Ttype.'",modifyDate="'.$dateAdded.'"';
	$where='id="'.$editId.'"';
	$update = updatelisting(_PACKAGE_TERMS_CONDITIONS_MASTER,$namevalue,$where); 
	?>
	<script>
	parent.setupbox('showpage.crm?module=gitterms&edit=yes&id=<?php echo encode($editId); ?>'); 
	</script>
	<?php
	exit();
}
if(trim($_POST['action'])=='packageterms'  && $_POST['packageId']!='' && $_POST['editId']==''){   
	$packageId=decode($_POST['packageId']);
	$savenew=($_POST['savenew']);
	$editId=($_POST['editId']);
	$termsType=addslashes($_POST['termsType']);
	$inclusion=addslashes($_POST['inclusion']); 
	$exclusion=addslashes($_POST['exclusion']); 
	$overview=addslashes($_POST['overview']); 
	$termscondition=addslashes($_POST['termscondition']);
	$cancelation=addslashes($_POST['cancelation']);
	$travelbasic=addslashes($_POST['travelbasic']);
	$booking=addslashes($_POST['booking']);
	$whyuse=addslashes($_POST['whyuse']);
	$dateAdded = date('Y-m-d H:i:s');
	$namevalue ='termsType="'.$termsType.'",packageId="'.$packageId.'",inclusion="'.$inclusion.'",overview="'.$overview.'",exclusion="'.$exclusion.'",termscondition="'.$termscondition.'",cancelation="'.$cancelation.'",travelbasic="'.$travelbasic.'",booking="'.$booking.'",whyuse="'.$whyuse.'"';
	addlistinggetlastid(_PACKAGE_BUILDER_TERMS_CONDITIONS_,$namevalue); 
	?>
	<script>
	parent.setupbox('showpage.crm?module=packagebuilder&add=yes&id=<?php echo $_POST['packageId']; ?>&selecttab=4'); 
	</script>
	<?php
	exit();
}
if(trim($_POST['action'])=='packageterms'  && $_POST['packageId']!='' && $_POST['editId']!=''){   
	$editId=$_POST['editId'];
	$savenew=($_POST['savenew']);
	//$editId=decode($_POST['editId']);
	$termsType=($_POST['termsType']);
	$inclusion=($_POST['inclusion']); 
	$exclusion=($_POST['exclusion']); 
	$termscondition=($_POST['termscondition']);
	$cancelation=($_POST['cancelation']);
	$overview=addslashes($_POST['overview']); 
	$travelbasic=($_POST['travelbasic']);
	$booking=($_POST['booking']);
	$whyuse=($_POST['whyuse']);
	$dateAdded = date('Y-m-d H:i:s');
	$namevalue ='termsType="'.$termsType.'",inclusion="'.$inclusion.'",overview="'.$overview.'",exclusion="'.$exclusion.'",termscondition="'.$termscondition.'",cancelation="'.$cancelation.'",travelbasic="'.$travelbasic.'",booking="'.$booking.'",whyuse="'.$whyuse.'"';
	$where='id='.$editId.'';
	$lastid = updatelisting(_PACKAGE_BUILDER_TERMS_CONDITIONS_,$namevalue,$where); 
	?>
	<script>
	parent.setupbox('showpage.crm?module=packagebuilder&add=yes&id=<?php echo $_POST['packageId']; ?>&selecttab=4'); 
	</script>
	<?php
	exit();
}
 
if($_REQUEST['action']=='loadWelcomeNote' && trim($_REQUEST['id'])!=''){    
	$queryId = $_REQUEST['queryId']; 
	$clientName = $_REQUEST['clientName']; 
	$emailTemplateId=$_REQUEST['id']; 
	$where2='';  
	$rs2='';    
	$select2='*';  
	$where2='id='.$emailTemplateId.'';  
	$rs2=GetPageRecord($select2,_EMAIL_TEMPLATE_MASTER_,$where2);  
	$resemail=mysqli_fetch_array($rs2);  
	$select='';  
	$where='';  
	$rs='';   
	$select='*';   
	$where='id=1';   
	$rs=GetPageRecord($select,_INVOICE_SETTING_MASTER_,$where);  
	$resultInvoiceSetting=mysqli_fetch_array($rs); 
	$templateString=str_replace('{Name of our company}',stripslashes($resultInvoiceSetting['companyname']),str_replace('{Client}',$clientName,$resemail['mailbody'])); 
	$templateString = nl2br($templateString);
	?> 
	<script type="text/javascript"> 
		tinymce.get('description').setContent(`<?php echo trim($templateString); ?>`);
	</script>
	<?php 
	exit(); 
}

if($_REQUEST['action']=='Itineraryoverview' && trim($_REQUEST['overviewNameId'])!='' && trim($_REQUEST['quotationId'])!=''){    
	$quotationId = $_REQUEST['quotationId']; 
	$languageType = $_REQUEST['languageType']; 
	$overviewNameId=$_REQUEST['overviewNameId']; 

	$rso='';
	$rso=GetPageRecord('*',_OVERVIEW_MASTER_,' id="'.trim($_REQUEST['overviewNameId']).'" order by id asc');
	$resListingo=mysqli_fetch_array($rso);

	$rsq='';
	$rsq=GetPageRecord('*','quotationOverview',' quotationId="'.trim($_REQUEST['quotationId']).'" and overviewNameId="'.trim($_REQUEST['overviewNameId']).'"order by id asc');
	$editoverview=mysqli_fetch_array($rsq);

	if($_REQUEST['languageType'] == 0) {   
 		if(!empty($editoverview['highlight'])){ 
 			$highlight =  $editoverview['highlight'];
 		}else{ 
 			$highlight =  stripslashes($resListingo['highlight']); 
 		} 
	} else { 
		$rsql='';
		$rsql=GetPageRecord('*','overviewLanguageMaster','overviewId="'.trim($_REQUEST['overviewNameId']).'" and languageId="'.trim($_REQUEST['languageType']).'"');
		$lanoverview=mysqli_fetch_array($rsql);	
 		if(!empty($lanoverview['highlight'])){
 		 	$highlight =  $lanoverview['highlight']; 
 		}else{ 
 			$highlight = '';
 		}
	}  

	if($_REQUEST['languageType'] == 0) { 	
		if(!empty($editoverview['overview'])) { 
			$overview =  $editoverview['overview']; 
		}else{ 
			$overview =  stripslashes($resListingo['overview']);
		}
	} else { 
		$rsql='';
		$rsql=GetPageRecord('*','overviewLanguageMaster','overviewId="'.trim($_REQUEST['overviewNameId']).'" and languageId="'.trim($_REQUEST['languageType']).'"');
		$lanoverview=mysqli_fetch_array($rsql); 
		
		if(!empty($lanoverview['overview'])){
 		 	$overview =  $lanoverview['overview']; 
 		}else{ 
 			$overview ='';
 		}
	}
	

	// Started ---- Itinerary introduction and itinerary Summary sec 
	if($_REQUEST['languageType'] == 0) { 	
		if(!empty($editoverview['itineraryintr'])) { 
			$itineraryintr =  $editoverview['itineraryintr']; 
		}else{ 
			$itineraryintr =  stripslashes($resListingo['itineraryintr']);
		}
	} else { 
		$rsql='';
		$rsql=GetPageRecord('*','overviewLanguageMaster','overviewId="'.trim($_REQUEST['overviewNameId']).'" and languageId="'.trim($_REQUEST['languageType']).'"');
		$lanoverview=mysqli_fetch_array($rsql); 
		
		if(!empty($lanoverview['itineraryintr'])){
 		 	$itineraryintr =  $lanoverview['itineraryintr']; 
 		}else{ 
 			$itineraryintr ='';
 		}
	}
	if($_REQUEST['languageType'] == 0) { 	
		if(!empty($editoverview['itinerarysumm'])) { 
			$itinerarysumm =  $editoverview['itinerarysumm']; 
		}else{ 
			$itinerarysumm =  stripslashes($resListingo['itinerarysumm']);
		}
	} else { 
		$rsql='';
		$rsql=GetPageRecord('*','overviewLanguageMaster','overviewId="'.trim($_REQUEST['overviewNameId']).'" and languageId="'.trim($_REQUEST['languageType']).'"');
		$lanoverview=mysqli_fetch_array($rsql); 
		
		if(!empty($lanoverview['itinerarysumm'])){
 		 	$itinerarysumm =  $lanoverview['itinerarysumm']; 
 		}else{ 
 			$itinerarysumm ='';
 		}
	}

	if($resListingo['overviewTitle_1']!=''){
		$overviewTitle_1 = $resListingo['overviewTitle_1'];
	}else{
		$overviewTitle_1 = "Overview Information";
	}
	if($resListingo['overviewTitle_2']!=''){
		$overviewTitle_2 = $resListingo['overviewTitle_2'];
	}else{
		$overviewTitle_2 = "Hightlight Information";
	}

	if($resListingo['overviewTitle_3']!=''){
		$overviewTitle_3 = $resListingo['overviewTitle_3'];
	}else{
		$overviewTitle_3 = "Itinerary introduction";
	}

	if($resListingo['overviewTitle_4']!=''){
		$overviewTitle_4 = $resListingo['overviewTitle_4'];
	}else{
		$overviewTitle_4 = "Itinerary Summary";
	}
	// Ended ---- Itinerary introduction and itinerary Summary sec 

	?> 
	<script type="text/javascript">
		
		$("#overviewTitle_1").text('<?php echo $overviewTitle_1; ?>');
		$("#overviewTitle_2").text('<?php echo $overviewTitle_2; ?>');
		$("#overviewTitle_3").text('<?php echo $overviewTitle_3; ?>');
		$("#overviewTitle_4").text('<?php echo $overviewTitle_4; ?>');

		tinymce.get('highlightsText').setContent(`<?php echo trim($highlight); ?>`); 
		tinymce.get('overviewText').setContent(`<?php echo trim($overview); ?>`);

		tinymce.get('itineraryintrText').setContent(`<?php echo trim($itineraryintr); ?>`); 
		tinymce.get('itinerarysummText').setContent(`<?php echo trim($itinerarysumm); ?>`);
 
	</script>
	<?php 
	exit(); 
}



// FIT and GIT Selection Block



if($_REQUEST['action']=='ItineraryFITANDGIT' && trim($_REQUEST['fitincexNameId'])!='' && trim($_REQUEST['quotationId'])!=''){    



	$quotationId = $_REQUEST['quotationId']; 



	$languageType = $_REQUEST['languageId']; 



	$fitincexNameId=trim($_REQUEST['fitincexNameId']);

	$serviceType=trim($_REQUEST['serviceType']);



	$rsFG='';

	if($serviceType==="FIT"){

		$rsFG=GetPageRecord('*','fitIncExcMaster',' id="'.$fitincexNameId.'" order by id asc');

	}



	if($serviceType==="GIT"){

		$rsFG=GetPageRecord('*','gitIncExcMaster',' id="'.$fitincexNameId.'" order by id asc');

	}



	$resListinGFData=mysqli_fetch_array($rsFG);  



	$inclusionContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['inclusion']))); 

	$exclusionContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['exclusion']))); 

	$termsconditionContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['termscondition']))); 

	$cancelationContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['cancelation']))); 

	 $paymentpolicyContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['paymentpolicy'])));

	$remarksContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['remarks'])));
	
	
	$serviceupgradationContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['serviceupgradation'])));

	$optionaltourContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['optionaltour'])));



	if($resListinGFData['title_1']==''){

		$inclusionTitle = 'Inclusion';

	}else{

		$inclusionTitle = $resListinGFData['title_1'];

	}



	if($resListinGFData['title_2']==''){

		$exclusionTitle = 'Exclusion';

	}else{

		$exclusionTitle = $resListinGFData['title_2'];

	}



	if($resListinGFData['title_3']==''){

		$termsconditionTitle = 'Terms &amp; Conditions';

	}else{

		$termsconditionTitle = $resListinGFData['title_3'];

	}



	if($resListinGFData['title_4']==''){

		$cancelationTitle = 'Cancellation Policies';

	}else{

		$cancelationTitle = $resListinGFData['title_4'];

	}


	if($resListinGFData['title_5']==''){
		$serviceupgradeTitle = 'Service Upgradation';
	}else{
		$serviceupgradeTitle = $resListinGFData['title_5'];
	}
	
	if($resListinGFData['title_6']==''){
		$optionaltourTitle = 'Optional Tour';
	}else{
		$optionaltourTitle = $resListinGFData['title_6'];
	}




	if($resListinGFData['title_7']==''){

		$paymentpolicyTitle = 'Payment &amp; Policy';

	}else{

		$paymentpolicyTitle = $resListinGFData['title_7'];

	}



	if($resListinGFData['title_8']==''){

		$remarksTitle = 'Remarks';

	}else{

		$remarksTitle = $resListinGFData['title_8'];

	}



?> 



<script type="text/javascript">



	// Title text

	$("#inclusionTitle").text('<?php echo $inclusionTitle; ?>');

	$("#exclusionTitle").text('<?php echo $exclusionTitle; ?>');

	$("#termsconditionTitle").text('<?php echo $termsconditionTitle; ?>');

	$("#cancelationTitle").text('<?php echo $cancelationTitle; ?>');

	$("#serviceupgradeTitle").text('<?php echo $serviceupgradeTitle; ?>');

	$("#optionaltourTitle").text('<?php echo $optionaltourTitle; ?>');

	$("#paymentpolicyTitle").text('<?php echo $paymentpolicyTitle; ?>');

	$("#remarksTitle").text('<?php echo $remarksTitle; ?>');

	// $("#serviceupgradationTitle").text('<?php echo $serviceupgradationTitle; ?>');

	// $("#optionaltourTitle").text('<?php echo $optionaltourTitle; ?>');

	

	// Body Text

	

	tinymce.get('inclusionText').setContent(`<?php echo ($inclusionContent); ?>`); 

	tinymce.get('exclusionText').setContent(`<?php echo ($exclusionContent); ?>`);

	tinymce.get('termsconditionText').setContent(`<?php echo trim($termsconditionContent); ?>`);

	tinymce.get('cancelationText').setContent(`<?php echo trim($cancelationContent); ?>`);

	tinymce.get('paymentpolicyText').setContent(`<?php echo trim($paymentpolicyContent); ?>`);

	tinymce.get('remarksText').setContent(`<?php echo trim($remarksContent); ?>`);

	tinymce.get('serviceupgradationText').setContent(`<?php echo trim($serviceupgradationContent); ?>`);

	tinymce.get('optionaltourText').setContent(`<?php echo trim($optionaltourContent); ?>`);

	

</script>



<?php 



}




// UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU
if($_REQUEST['action']=='ItineraryFITANDGITTEXT' && trim($_REQUEST['fitincexNameId'])!='' && trim($_REQUEST['quotationId'])!=''){    



	$quotationId = $_REQUEST['quotationId']; 



	$languageType = $_REQUEST['languageId']; 



	$fitincexNameId=trim($_REQUEST['fitincexNameId']);

	$serviceType=trim($_REQUEST['serviceType']);



	$rsFG='';

	if($serviceType==="FIT"){

		$rsFG=GetPageRecord('*','fitIncExcMaster',' id="'.$fitincexNameId.'" order by id asc');

	}



	if($serviceType==="GIT"){

		$rsFG=GetPageRecord('*','gitIncExcMaster',' id="'.$fitincexNameId.'" order by id asc');

	}



	$resListinGFData=mysqli_fetch_array($rsFG);  



	// $inclusionContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['inclusion']))); 

	// $exclusionContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['exclusion']))); 

	// $termsconditionContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['termscondition']))); 

	// $cancelationContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['cancelation']))); 

	//  $paymentpolicyContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['paymentpolicy'])));

	// $remarksContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['remarks'])));
	
	
	// $serviceupgradationContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['serviceupgradation'])));

	// $optionaltourContent=preg_replace('/\\\\/', '',clean(htmlspecialchars_decode($resListinGFData['optionaltour'])));



	if($resListinGFData['title_1']==''){

		$inclusionTitle = 'Inclusion';

	}else{

		$inclusionTitle = $resListinGFData['title_1'];

	}



	if($resListinGFData['title_2']==''){

		$exclusionTitle = 'Exclusion';

	}else{

		$exclusionTitle = $resListinGFData['title_2'];

	}



	if($resListinGFData['title_3']==''){

		$termsconditionTitle = 'Terms &amp; Conditions';

	}else{

		$termsconditionTitle = $resListinGFData['title_3'];

	}



	if($resListinGFData['title_4']==''){

		$cancelationTitle = 'Cancellation Policies';

	}else{

		$cancelationTitle = $resListinGFData['title_4'];

	}


	if($resListinGFData['title_5']==''){
		$serviceupgradeTitle = 'Service Upgradation';
	}else{
		$serviceupgradeTitle = $resListinGFData['title_5'];
	}
	
	if($resListinGFData['title_6']==''){
		$optionaltourTitle = 'Optional Tour';
	}else{
		$optionaltourTitle = $resListinGFData['title_6'];
	}




	if($resListinGFData['title_7']==''){

		$paymentpolicyTitle = 'Payment &amp; Policy';

	}else{

		$paymentpolicyTitle = $resListinGFData['title_7'];

	}



	if($resListinGFData['title_8']==''){

		$remarksTitle = 'Remarks';

	}else{

		$remarksTitle = $resListinGFData['title_8'];

	}



?> 



<script type="text/javascript">



	// Title text

	$("#inclusionTitle").text('<?php echo $inclusionTitle; ?>');

	$("#exclusionTitle").text('<?php echo $exclusionTitle; ?>');

	$("#termsconditionTitle").text('<?php echo $termsconditionTitle; ?>');

	$("#cancelationTitle").text('<?php echo $cancelationTitle; ?>');

	$("#serviceupgradeTitle").text('<?php echo $serviceupgradeTitle; ?>');

	$("#optionaltourTitle").text('<?php echo $optionaltourTitle; ?>');

	$("#paymentpolicyTitle").text('<?php echo $paymentpolicyTitle; ?>');

	$("#remarksTitle").text('<?php echo $remarksTitle; ?>');

	

	

	// Body Text

	

	// tinymce.get('inclusionText').setContent(`<?php echo ($inclusionContent); ?>`); 

	// tinymce.get('exclusionText').setContent(`<?php echo ($exclusionContent); ?>`);

	// tinymce.get('termsconditionText').setContent(`<?php echo trim($termsconditionContent); ?>`);

	// tinymce.get('cancelationText').setContent(`<?php echo trim($cancelationContent); ?>`);

	// tinymce.get('paymentpolicyText').setContent(`<?php echo trim($paymentpolicyContent); ?>`);

	// tinymce.get('remarksText').setContent(`<?php echo trim($remarksContent); ?>`);

	// tinymce.get('serviceupgradationText').setContent(`<?php echo trim($serviceupgradationContent); ?>`);

	// tinymce.get('optionaltourText').setContent(`<?php echo trim($optionaltourContent); ?>`);

	

</script>



<?php 



}

// UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU


// ended FIT and GIT select section

// Edit Invoice
if($_POST['action']=='editinvoicemain' && trim($_POST['queryId'])!='' && trim($_POST['totalVal'])!='' && trim($_POST['invoiceType'])!='' && trim($_POST['editId'])!=''){
		$editId=clean($_POST['editId']);
		$invoiceType=clean($_POST['invoiceType']);
		$queryId=clean($_POST['queryId']);
		$fileNo=clean($_POST['fileNo']);
		$referNo=clean($_POST['referNo']);
		$tourId=clean($_POST['tourId']);
		$glno=clean($_POST['glno']);
		$amount=clean($_POST['totalVal']);
		$invoiceDate=clean($_POST['invoiceDate']);
		$invoicedate=date("Y-m-d", strtotime($invoiceDate));
		$igst=clean($_POST['igst']);
		$cgst=clean($_POST['cgst']);
		$stg=clean($_POST['sgst']);
		$gstVal=clean($_POST['gstVal']);
		$tcs=clean($_POST['tcs']);
		$terms=addslashes($_POST['terms']);
		$payment=addslashes($_POST['payment']);
		$queryDetails=clean($_POST['description']);
		$queryDetails=clean($_POST['description']);
		$dueDate=clean($_POST['dueDate']);
		$dueDate = date('Y-m-d',strtotime($dueDate));
		$deliveryplace=clean($_POST['deliveryplace']);

		$beneficiaryName=clean($_POST['beneficiaryName']);
		$accountNumber=clean($_POST['accountNumber']);
		$bankName=clean($_POST['bankName']);
		$branchAddress=clean($_POST['branchAddress']);
		$branchIfsc=clean($_POST['branchIfsc']);
		$branchSwiftCode=clean($_POST['branchSwiftCode']);
		$accountType=clean($_POST['accountType']);
		$particularsubject=nl2br($_POST['particularsubject']);
		$hsnCode=clean($_POST['hsnCode']);
		$quotationId=clean($_POST['quotationId']);
		$guestName=clean($_POST['guestName']);

		$paymentTerms=addslashes($_POST['paymentTerms']);
		$invoiceNotes=addslashes($_POST['invoiceNotes']);


	if($igst!=''){
	$totalamountIGST = ($igst / 100) * $amount;
	}
	if($cgst!=''){
	$totalamountCGST = ($cgst / 100) * $amount;
	}
	if($stg!=''){
	$totalamountSTG = ($stg / 100) * $amount;
	}
	$totalamount=$totalamountIGST+$totalamountCGST+$totalamountSTG+$amount;
	$dateAdded=time();
	
	//$fileNo,$poNo,$costCenter,$glno;
	$namevalue ='invoiceType="'.$invoiceType.'",queryId="'.$queryId.'",quotationId="'.$quotationId.'",fileNo="'.$fileNo.'",referNo="'.$referNo.'",tourId="'.$tourId.'",glno="'.$glno.'",totalamount="'.$totalamount.'",amount="'.$amount.'",invoicedate="'.$invoicedate.'",igst="'.$igst.'",cgst="'.$cgst.'",stg="'.$stg.'",gstAMT="'.$gstVal.'",tcs="'.$tcs.'",queryDetails="'.$queryDetails.'",invoiceNotes="'.$invoiceNotes.'",terms="'.$terms.'",payment="'.$paymentTerms.'",deletestatus=0,beneficiaryName="'.$beneficiaryName.'",accountNumber="'.$accountNumber.'",bankName="'.$bankName.'",branchAddress="'.$branchAddress.'",branchIfsc="'.$branchIfsc.'",branchSwiftCode="'.$branchSwiftCode.'",accountType="'.$accountType.'",particularsubject="'.$particularsubject.'",hsnCode="'.$hsnCode.'",deliveryPlace="'.$deliveryplace.'",guestName="'.$guestName.'",dueDate="'.$dueDate.'"';

	$rs = GetPageRecord('*',_INVOICE_MASTER_,'quotationId="'.$quotationId.'" and queryId="'.$queryId.'" and invoiceType="'.$invoiceType.'" and deletestatus=0');
	if(mysqli_num_rows($rs)>0){
		$where='quotationId="'.$quotationId.'" and queryId="'.$queryId.'" and invoiceType="'.$invoiceType.'" and deletestatus=0';
		updatelisting(_INVOICE_MASTER_,$namevalue,$where);
	}else{ 

		$namevalue2 ='queryId="'.$queryId.'",quotationId="'.$quotationId.'",fileNo="'.$fileNo.'",referNo="'.$referNo.'",tourId="'.$tourId.'",glno="'.$glno.'",totalamount="'.$totalamount.'",amount="'.$amount.'",invoicedate="'.$invoicedate.'",igst="'.$igst.'",cgst="'.$cgst.'",stg="'.$stg.'",gstAMT="'.$gstVal.'",queryDetails="'.$queryDetails.'",invoiceNotes="'.$invoiceNotes.'",terms="'.$terms.'",payment="'.$paymentTerms.'",deletestatus=0,beneficiaryName="'.$beneficiaryName.'",accountNumber="'.$accountNumber.'",bankName="'.$bankName.'",branchAddress="'.$branchAddress.'",branchIfsc="'.$branchIfsc.'",branchSwiftCode="'.$branchSwiftCode.'",accountType="'.$accountType.'",particularsubject="'.$particularsubject.'",hsnCode="'.$hsnCode.'",deliveryPlace="'.$deliveryplace.'",dueDate="'.$dueDate.'"';

		$invoiceId = addlistinggetlastid(_INVOICE_MASTER_,$namevalue2);
	}
	?>
	<script>
	parent.setupbox('showpage.crm?module=invoice&invoiceTitle=<?php echo $invoiceType; ?>&alt=1');
	</script>
	<?php
}

 
if($_POST['action']=='suppierReplyaction' && trim($_POST['queryId'])!='' && trim($_POST['suppId'])!='' && trim($_POST['replysupcontent'])!=''){
$queryId=($_POST['queryId']);
$suppId=$_POST['suppId'];
$replysupcontent=stripslashes($_POST['replysupcontent']);
$select1='*';
$where1='queryid='.$queryId.' order by id asc LIMIT 1';
$rs1=GetPageRecord($select1,_QUERYMAILS_MASTER_,$where1);
$editresult=mysqli_fetch_array($rs1);
$ccmail='';
$ccmail=$_POST['ccSupplier'];

$subject=addslashes($editresult['subject']);
$rsp=GetPageRecord('*',_QUERY_MASTER_,'id="'.$queryId.'"');
$resultlists12=mysqli_fetch_array($rsp);
$subject='#'.makeQueryId($resultlists12['id']).' '.$subject;
$mailsubject='[SUP'.$suppId.'] ' .str_replace('#','@',$subject);

include "config/mail.php";
$fromemail='';
$mailto=getPrimaryEmail($suppId,'suppliers');
//$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,convert_cyr_string($replysupcontent,"w","w"),$ccmail);
//ADD EMAIL SIGNATURE
$select='emailsignature';
$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$LoginUserDetails=mysqli_fetch_array($rs);
// $emailsignature=stripslashes($LoginUserDetails['emailsignature']);

if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
}

$replysupcontent=$replysupcontent.$emailsignature;
$mailbody=str_replace('download/',$fullurl.'download/',$replysupcontent);
$namevalue ='queryId="'.$queryId.'",supplierId="'.$suppId.'",subject="'.$mailsubject.'",detail="'.addslashes($mailbody).'",dateAdded="'.date('Y-m-d H:i:s').'",ccmail="'.$ccmail.'"';
$adds = addlisting(_SUPPLIER_COMMUNICATION_MAIL_,$namevalue);
$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$mailbody,$ccmail);
if($exeMailresult!=true){
	?>
	<script>
	alert('Mail not sent, Please check your configration');
	</script>
	<?php
}else{
	?>
	<script>
	alert("Mail has been sent");
	parent.$('#loadquerynotes').load('loadquerysupplier.php?id=<?php echo $_POST['queryId']; ?>&s=<?php echo $suppId; ?>');
	</script>
	<?php
}
}

if($_REQUEST['action']=='readsuppliermail'){
	$suppliermailid=($_REQUEST['suppliermailid']);
	$queryId=clean($_REQUEST['queryId']);
	$where='queryId='.$queryId.' and id='.$suppliermailid.'';
	$namevalue ='replyStatus=0';
	updatelisting(_SUPPLIER_COMMUNICATION_MAIL_,$namevalue,$where);
}
 
if($_REQUEST['action']=='saveduedate' && $_REQUEST['dueDate']!='' && $_REQUEST['id']!=''){
$dueDate=date('Y-m-d',strtotime($_REQUEST['dueDate']));
$id=$_REQUEST['id'];
$duetime=$_REQUEST['duetime'];
$queryId=$_REQUEST['queryId'];
$namevalue ='dueDate="'.$dueDate.'",duetime="'.$duetime.'"';
$where='id="'.$id.'"';
$update = updatelisting(_PAYMENT_REQUEST_MASTER_,$namevalue,$where);
$selecttodoassign='*';
$wheretodoassign='id='.$queryId.'';
$rstodoassign=GetPageRecord($selecttodoassign,_QUERY_MASTER_,$wheretodoassign);
$resultpagetodoassign=mysqli_fetch_array($rstodoassign);
$assignTo=$resultpagetodoassign['assignTo'];
$select1='*';
$where1='serviceId='.$queryId.' and serviceType="Supplier Payment Follow-up" order by id asc ';
$rs1=GetPageRecord($select1,_TO_DO_TIMELINE_,$where1);
$count = mysqli_num_rows($rs1);
$newdatetime=strtotime($dueDate.' '.strtoupper($duetime));
$newdatetime=date('Y-m-d H:i:s',$newdatetime);
if($count > 0){
$wherex='serviceId='.$queryId.' and serviceType="Supplier Payment Follow-up" ';
$re ='toDoDate="'.$dueDate.'",toDotime="'.$duetime.'",dateTime="'.$newdatetime.'" ';
$update = updatelisting(_TO_DO_TIMELINE_,$re,$wherex);
}else{
$re ='serviceId="'.$queryId.'",serviceType="Supplier Payment Follow-up",toDoDate="'.$dueDate.'",toDotime="'.$duetime.'",assignto="'.$assignTo.'",dateTime="'.$newdatetime.'" ';
addlistinggetlastid(_TO_DO_TIMELINE_,$re);
}
 }
 if($_REQUEST['action']=='remiderdate' && $_REQUEST['dueDate']!='' && $_REQUEST['id']!=''){
$dueDate=date('Y-m-d',strtotime($_REQUEST['dueDate']));
$id=$_REQUEST['id'];
$duetime=$_REQUEST['duetime'];
$queryId=$_REQUEST['queryId'];
$namevalue ='remiderDate="'.$dueDate.'",reminderTime="'.$duetime.'"';
$where='id="'.$id.'"';
$update = updatelisting(_AGENT_PAYMENT_REQUEST_,$namevalue,$where);
$selecttodoassign='*';
$wheretodoassign='id='.$queryId.'';
$rstodoassign=GetPageRecord($selecttodoassign,_QUERY_MASTER_,$wheretodoassign);
$resultpagetodoassign=mysqli_fetch_array($rstodoassign);
$assignTo=$resultpagetodoassign['assignTo'];
$select1='*';
$where1='serviceId='.$queryId.' and serviceType="Agent Payment Follow-up" order by id asc ';
$rs1=GetPageRecord($select1,_TO_DO_TIMELINE_,$where1);
$count = mysqli_num_rows($rs1);
$newdatetime=strtotime($dueDate.' '.strtoupper($duetime));
$newdatetime=date('Y-m-d H:i:s',$newdatetime);
if($count > 0){
$wherex='serviceId='.$queryId.' and serviceType="Agent Payment Follow-up" ';
$re ='toDoDate="'.$dueDate.'",toDotime="'.$duetime.'",dateTime="'.$newdatetime.'" ';
$update = updatelisting(_TO_DO_TIMELINE_,$re,$wherex);
}else{
$re ='serviceId="'.$queryId.'",serviceType="Agent Payment Follow-up",toDoDate="'.$dueDate.'",toDotime="'.$duetime.'",assignto="'.$assignTo.'",dateTime="'.$newdatetime.'" ';
addlistinggetlastid(_TO_DO_TIMELINE_,$re);
}
 }
if($_REQUEST['action']=='createnewmail' && $_REQUEST['to']!='' && $_REQUEST['subject']!='' && $_REQUEST['description']!=''){
include "config/mail.php";
if(!empty($_FILES['uploadfile']['name'])){
$file_name=time().'-'.$_FILES['uploadfile']['name'];
copy($_FILES['uploadfile']['tmp_name'],"upload/".$file_name);
}
?>
<script>
parent.$('#addeditquery').html('<div style="text-align:center"><img src="images/animatedsendingmail.gif" width="100"><br><br>Sending Mail Please</div>');
</script>
<?php
$allvaluephone ='subject="'.addslashes($_REQUEST['subject']).'",mailBody="'.addslashes($_REQUEST['description']).'",mailDate="'.date('Y-m-d H:i:s').'",	mailStatus=3,mailAttachment="'.$file_name.'",mailFrom="'.$_REQUEST['to'].'",fromMail="'.$_REQUEST['fromMail'].'",fromSection="'.$_REQUEST['fromMail'].'" ';
addlisting(_MAIL_SECTION_MASTER_,$allvaluephone);
$fromemail=$_REQUEST['fromMail'];
$mailto=$_REQUEST['to'];
$mailsubject=stripslashes($_REQUEST['subject']);
$maildescription=stripslashes($_REQUEST['description']);
$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail,$file_name);
	if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	
		?>
		<script>
		parent.$('#addeditquery').html('<div style="text-align:center">Wait Please</div>');
		parent.funreadmailsectionsent2('na');
		</script>
		<?php  
	}
}
if($_REQUEST['action']=='loadWelcomeNoteQuery'){
$queryId = $_REQUEST['queryId'];
$clientName = $_REQUEST['clientName'];
$emailTemplateId=$_REQUEST['id'];
$where2='';
$rs2='';
$select2='*';
$where2='id='.$emailTemplateId.'';
$rs2=GetPageRecord($select2,_EMAIL_TEMPLATE_MASTER_,$where2);
$resemail=mysqli_fetch_array($rs2);
 ?>
 <textarea name="description" rows="20" class="gridfield" id="description" style="height:220px;"><?php echo nl2br($resemail['mailbody']); ?></textarea>
		<script type="text/javascript">
    tinymce.init({
        selector: "#description",
        themes: "modern",
        plugins: [
            "advlist autolink lists link image charmap print preview anchor",
            "searchreplace visualblocks code fullscreen"
        ],
        toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"
    });
    </script>
 <?php
 exit();
 }
if(trim($_POST['action'])=='addexpenses' && trim($_POST['id'])=='' && trim($_POST['venderId'])!=''){
if(!empty($_FILES['attachment']['name'])){
$file_name=time().'-'.$_FILES['attachment']['name'];
copy($_FILES['attachment']['tmp_name'],"upload/".$file_name);
}
$invoiceDate=date('Y-m-d',strtotime($_REQUEST['invoiceDate']));
$dueDate=date('Y-m-d',strtotime($_REQUEST['dueDate']));
$values ='venderId="'.$_REQUEST['venderId'].'",spendingType="'.$_REQUEST['expensesType'].'",invoiceDate="'.$invoiceDate.'",dueDate="'.$dueDate.'",totalAmount="'.$_REQUEST['totalAmount'].'",gst="'.$_REQUEST['gst'].'",cgst="'.$_REQUEST['cgst'].'",invoiceNumber="'.$_REQUEST['invoiceNumber'].'",sgst="'.$_REQUEST['sgst'].'",igst="'.$_REQUEST['igst'].'",remark="'.addslashes($_REQUEST['remark']).'",addBy="'.$_SESSION['userid'].'",addDate="'.time().'",attachment="'.$file_name.'" ';
addlisting('expensesMaster',$values);
?>
<script>
parent.setupbox('showpage.crm?module=expenses');
</script>
<?php
}
if(trim($_POST['action'])=='addleadquery' && trim($_POST['companyId'])!=''  && trim($_POST['assignTo'])!='' && trim($_POST['subject'])!='' && $_POST['editId']=='' ){
$totalQueryCost=clean($_POST['totalQueryCost']);
$savenew=clean($_POST['savenew']);
$incomingqueryId=clean($_POST['incomingqueryId']);
 $companyId=decode($_POST['companyId']);
$editId=decode($_POST['editId']);
$companyName=clean($_POST['companyName']);
 $destinationId=$_POST['destinationId'];
if(isset($_POST['destinationId'])){
foreach($_POST['destinationId'] as $k1=>$v1){
 $destinationId .= $_POST['destinationId'][$k1].',';
}
}
$destinationId = str_replace('Array','',$destinationId);
$child=clean($_POST['child']);
$queryPriority=clean($_POST['queryPriority']);
$categoryId=clean($_POST['categoryId']);
$assignTo=decode($_POST['assignTo']);
$description=addslashes($_POST['description']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$toDate=date("Y-m-d", strtotime($_POST['toDate']));
$tourType=clean($_POST['tourType']);
$subject=clean($_POST['subject']);
$multiemails=clean($_POST['multiemails']);
$clientType=clean($_POST['clientType']);
$rooms=clean($_POST['rooms']);
$occupancyType=clean($_POST['occupancyType']);
$hotelBudget=clean($_POST['hotelBudget']);
$guest1phone=clean($_POST['guest1phone']);
$guest1email=($_POST['guest1email']);
$paymentMode=($_POST['paymentMode']);
// $expectedSales=($_POST['expectedSales']);
$closerDate=($_POST['closerDate']);
$closerDate=date("Y-m-d", strtotime($closerDate));
$leadsource=($_POST['leadsource']);
$campaign=($_POST['campaign']);
$competitor=($_POST['competitor']);
$salesStage=($_POST['salesStage']);
$dateAdded=time();
 $myArray = explode(',', $destinationId);
foreach($myArray as $my_Array){
if($my_Array!=''){
$select4='name';
$where4='id='.$my_Array.'';
$rs4=GetPageRecord($select4,_DESTINATION_MASTER_,$where4);
$cityname=mysqli_fetch_array($rs4);
$cityNameVal .= $cityname['name'].', ';
} }
$namevalue ='companyId="'.$companyId.'",deletestatus=0,queryDate="'.date('Y-m-d').'",destinationId="'.$destinationId.'",assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",tourType="'.$tourType.'",subject="'.$subject.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",guest1="'.$guest1.'",guest2="'.$guest2.'",clientType="'.$clientType.'",occupancyType="'.$occupancyType.'",hotelBudget="'.$hotelBudget.'",guest1email="'.$guest1email.'",guest1phone="'.$guest1phone.'",paymentMode="'.$paymentMode.'",expectedSales="'.$budget.'",closerDate="'.$closerDate.'",leadsource="'.$leadsource.'",campaign="'.$campaign.'",salesStage="'.$salesStage.'",competitor="'.$competitor.'",servicePrice="'.$servicePrice.'",queryOrder="'.time().'"';
$adds = addlisting(_SALES_QUERY_MASTER_,$namevalue);
if($adds=='yes'){    ?>
<script>
parent.setupbox('showpage.crm?module=leads');
</script>
<?php exit();
}
}
if(trim($_POST['action'])=='editleadquery' && trim($_POST['companyId'])!=''  && trim($_POST['assignTo'])!='' && trim($_POST['subject'])!='' && $_POST['editId']!='' ){
$totalQueryCost=clean($_POST['totalQueryCost']);
$savenew=clean($_POST['savenew']);
$incomingqueryId=clean($_POST['incomingqueryId']);
 $companyId=decode($_POST['companyId']);
$editId=decode($_POST['editId']);
$companyName=clean($_POST['companyName']);
 $destinationId=$_POST['destinationId'];
if(isset($_POST['destinationId'])){
foreach($_POST['destinationId'] as $k1=>$v1){
 $destinationId .= $_POST['destinationId'][$k1].',';
}
}
$destinationId = str_replace('Array','',$destinationId);
$child=clean($_POST['child']);
$queryPriority=clean($_POST['queryPriority']);
$categoryId=clean($_POST['categoryId']);
$assignTo=decode($_POST['assignTo']);
$description=addslashes($_POST['description']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$toDate=date("Y-m-d", strtotime($_POST['toDate']));
$tourType=clean($_POST['tourType']);
$subject=clean($_POST['subject']);
$multiemails=clean($_POST['multiemails']);
$clientType=clean($_POST['clientType']);
$rooms=clean($_POST['rooms']);
$occupancyType=clean($_POST['occupancyType']);
$hotelBudget=clean($_POST['hotelBudget']);
$guest1phone=clean($_POST['guest1phone']);
$guest1email=($_POST['guest1email']);
$paymentMode=($_POST['paymentMode']);
// $expectedSales=($_POST['expectedSales']);
$closerDate=($_POST['closerDate']);
$closerDate=date("Y-m-d", strtotime($closerDate));
$leadsource=($_POST['leadsource']);
$campaign=($_POST['campaign']);
$competitor=($_POST['competitor']);
 $salesStage=($_POST['salesStage']);
$dateAdded=time();
 $myArray = explode(',', $destinationId);
foreach($myArray as $my_Array){
if($my_Array!=''){
$select4='name';
$where4='id='.$my_Array.'';
$rs4=GetPageRecord($select4,_DESTINATION_MASTER_,$where4);
$cityname=mysqli_fetch_array($rs4);
$cityNameVal .= $cityname['name'].', ';
} }
$namevalue ='companyId="'.$companyId.'",deletestatus=0,destinationId="'.$destinationId.'",assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",tourType="'.$tourType.'",subject="'.$subject.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",guest1="'.$guest1.'",guest2="'.$guest2.'",clientType="'.$clientType.'",occupancyType="'.$occupancyType.'",hotelBudget="'.$hotelBudget.'",guest1email="'.$guest1email.'",guest1phone="'.$guest1phone.'",paymentMode="'.$paymentMode.'",expectedSales="'.$budget.'",closerDate="'.$closerDate.'",leadsource="'.$leadsource.'",campaign="'.$campaign.'",competitor="'.$competitor.'",servicePrice="'.$servicePrice.'",salesStage="'.$salesStage.'",queryOrder="'.time().'"';
 $where='id="'.$editId.'"';
 $update = updatelisting(_SALES_QUERY_MASTER_,$namevalue,$where);
if($update=='yes'){    ?>
<script>
parent.setupbox('showpage.crm?module=leads');
</script>
<?php exit();
}
}
if(trim($_POST['action'])=='addstage' && trim($_POST['name'])!=''  && trim($_POST['probability'])!='' && $_POST['editId']=='' ){
$namevalue ='name="'.addslashes($_REQUEST['name']).'",probability="'.addslashes($_REQUEST['probability']).'",status="'.$_REQUEST['status'].'"';
$adds = addlisting('salesStageMaster',$namevalue);
 ?>
 <script>
parent.setupbox('showpage.crm?module=salesstages');
</script>
 <?php
 exit();
}
if(trim($_POST['action'])=='addstage' && trim($_POST['name'])!=''  && trim($_POST['probability'])!='' && $_POST['editId']!='' ){
 $namevalue ='name="'.addslashes($_REQUEST['name']).'",probability="'.addslashes($_REQUEST['probability']).'",status="'.$_REQUEST['status'].'"';
  $where='id="'.$_REQUEST['editId'].'"';
 $update = updatelisting('salesStageMaster',$namevalue,$where);
  ?>
 <script>
 parent.setupbox('showpage.crm?module=salesstages');
</script>
 <?php
 exit();
}
if(trim($_POST['action'])=='addactivity' && trim($_POST['subject'])!=''  && trim($_POST['fromDate'])!='' && $_POST['assignTo']!='' && $_POST['leadId']!='' && $_POST['activityType']!='4'){
$leadId=addslashes($_REQUEST['leadId']);
$rs1=GetPageRecord('leadsource,clientType,companyId','leadManageMaster','id="'.$leadId.'"'); 
$resultlists=mysqli_fetch_array($rs1);
$leadsource = $resultlists['leadsource'];
$companyId = $resultlists['companyId'];
$clientType = $resultlists['clientType'];
$subject=addslashes($_REQUEST['subject']);
$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
$assignTo=addslashes($_REQUEST['assignTo']);
$fromTime=addslashes($_REQUEST['fromTime']);
$toTime=addslashes($_REQUEST['toTime']);
$description=addslashes($_REQUEST['description']);
$followupdate=date('Y-m-d H:i:s',strtotime($fromDate.' '.$fromTime));
$remiderDate=date('Y-m-d H:i:s',strtotime($followupdate)-($_REQUEST['reminderTime'] * 60));
$activityType=addslashes($_REQUEST['activitytype']);
$namevalue ='subject="'.$subject.'",fromDate="'.$fromDate.'",assignTo="'.decode($assignTo).'",starttime="'.$fromTime.'",endtime="'.$toTime.'",description="'.$description.'",remiderDate="'.$remiderDate.'",followupdate="'.$followupdate.'",activityType="'.$activityType.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.date('Y-m-d').'",leadId="'.$leadId.'",leadsource="'.$leadsource.'",companyId="'.$companyId.'",clientType="'.$clientType.'"';
$adds = addlisting(_ACTIVITY_MASTER_,$namevalue);
?>
 <script>
 parent.addactivityview();
</script>
<?php
}
if(trim($_POST['action'])=='addactivity' && trim($_POST['subject'])!=''  && trim($_POST['clientType'])!='' && $_POST['companyId']!='' && $_POST['agentb2cmail']!='' && $_POST['leadId']!=''){
include "config/mail.php";
$leadId=addslashes($_REQUEST['leadId']);
$subject=addslashes($_REQUEST['subject']);
$fromDate=date("Y-m-d");
$assignTo=addslashes($_REQUEST['assignTo']);
$fromTime=date('H:i:s');
$agentb2cmail=addslashes($_REQUEST['agentb2cmail']);
$description=addslashes($_REQUEST['description']);
$followupdate=date('Y-m-d H:i:s',strtotime($fromDate.' '.$fromTime));
$remiderDate='0';
$activityType=4;
$clientType=addslashes($_REQUEST['clientType']);
$companyId=decode($_REQUEST['companyId']);
$clientEmail=addslashes($_REQUEST['agentb2cmail']);
$select='emailsignature';
$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$LoginUserDetails=mysqli_fetch_array($rs);
$fromemail='';
$mailto=$clientEmail;
$mailsubject=$subject;
$maildescription=nl2br(stripslashes($description)).stripslashes($LoginUserDetails['emailsignature']);
$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
	if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	

		$namevalue ='subject="'.$subject.'",fromDate="'.$fromDate.'",assignTo="'.decode($assignTo).'",starttime="'.$fromTime.'",endtime="'.$toTime.'",description="'.$description.'",remiderDate="'.$remiderDate.'",followupdate="'.$followupdate.'",activityType="'.$activityType.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.date('Y-m-d').'",leadId="'.$leadId.'",clientType="'.$clientType.'",companyId="'.$companyId.'",clientEmail="'.$clientEmail.'"';
		addlisting(_ACTIVITY_MASTER_,$namevalue);
		?>
		 <script>
		 parent.addactivityview();
		</script>
		<?php
	}
}
 
if(trim($_POST['action'])=='addquerynotes' && $_POST['queryId']!='' && $_POST['title']!='' && $_POST['subtitle']!=''){

$newdatetime=($_REQUEST['reminderDate'].' '.$_REQUEST['reminderTime']);

$namevalue ='queryId="'.$_REQUEST['queryId'].'",title="'.addslashes($_REQUEST['title']).'",userId="'.$_SESSION['userid'].'",subtitle="'.addslashes($_REQUEST['subtitle']).'",noteDetails="'.addslashes($_REQUEST['noteDetails']).'",addDate="'.date('Y-m-d H:i:s').'",reminderDate="'.addslashes($_REQUEST['reminderDate']).'",reminderTime="'.addslashes($_REQUEST['reminderTime']).'",dataandtime="'.$newdatetime.'"';  

addlistinggetlastid('queryNotesMaster',$namevalue);

$where='id='.$_REQUEST['queryId'].'';  


$namevalue ='queryStatus=7,queryCloseDetails="'.addslashes($_REQUEST['noteDetails']).'",queryCloseDate="'.date('Y-m-d').'",followupdate="'.addslashes(date('Y-m-d',strtotime($_REQUEST['reminderDate']))).'",followuptime="'.addslashes($_REQUEST['reminderTime']).'"'; 

$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);


$reminderTime = date('h:i A',strtotime($_REQUEST['reminderTime']));



if($_REQUEST['reminderDate']!='0000-00-00'){

$namevalue ='serviceId="'.$_REQUEST['queryId'].'",serviceType="'.addslashes($_REQUEST['title']).'",toDotime="'.$reminderTime.'",toDoDate="'.$_REQUEST['reminderDate'].'",dateTime="'.$newdatetime.'",assignto="'.$_REQUEST['assignTo'].'"';  

addlistinggetlastid('toDoTimeLine',$namevalue);

}

?>

<script>

parent.loadinnernotes();

parent.masters_alertspopupopenClose();

</script>

<?php 

}

if(trim($_POST['action'])=='addguestbook' && $_POST['queryId']!='' && $_POST['fname']!='' && $_POST['id']==''){
	$queryId=$_POST['queryId'];
	$hotelCategory=$_POST['hotelCategory'];
	$hotelId=$_POST['hotelId'];
	$occupancy=$_POST['occupancy'];
	$fromDate=date('Y-m-d',strtotime($_POST['fromDate']));
	$toDate=date('Y-m-d',strtotime($_POST['toDate']));
	$airline=$_POST['airline'];
	$transfer=$_POST['transfer'];
	$sightseeing=$_POST['sightseeing'];
	$name=addslashes($_POST['name']);
	$email=addslashes($_POST['email']);
	$phone=addslashes($_POST['phone']);
	$country=$_POST['country'];
	$address=addslashes($_POST['address']);
	//
	$title=$_POST['title'];
	$fname=addslashes($_POST['fname']);
	$lname=addslashes($_POST['lname']);
	$age=addslashes($_POST['age']);
	$gender=addslashes($_POST['gender']);
	$mealPreference=addslashes($_POST['mealPreference']);
	$seatPreference=addslashes($_POST['seatPreference']);
	$physicalCondition=addslashes($_POST['physicalCondition']);
	$namevalue ='hotelCategory="'.$hotelCategory.'",hotelId="'.$hotelId.'",occupancy="'.$occupancy.'",countryId="'.$country.'",checkIn="'.$fromDate.'",checkOut="'.$toDate.'",airline="'.$airline.'",transfer="'.$transfer.'",sightseeing="'.$sightseeing.'",name="'.$name.'",email="'.$email.'",phone="'.$phone.'",title="'.$title.'",fname="'.$fname.'",lname="'.$lname.'",age="'.$age.'",gender="'.$gender.'",mealPreference="'.$mealPreference.'",seatPreference="'.$seatPreference.'",physicalCondition="'.$physicalCondition.'",address="'.$address.'",addDate="'.time().'",addBy="'.$_SESSION['userid'].'",queryId="'.$queryId.'"';
	addlistinggetlastid('guestList',$namevalue);
	?>
	<script>
	parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo encode($_REQUEST['queryId']); ?>&guestlist=1');
	</script>
	<?php
 }
if(trim($_POST['action'])=='addguestbook' && $_POST['queryId']!='' && $_POST['fname']!='' && $_POST['id']!=''){
	$queryId=$_POST['queryId'];
	$hotelCategory=$_POST['hotelCategory'];
	$hotelId=$_POST['hotelId'];
	$occupancy=$_POST['occupancy'];
	$fromDate=date('Y-m-d',strtotime($_POST['fromDate']));
	$toDate=date('Y-m-d',strtotime($_POST['toDate']));
	$airline=$_POST['airline'];
	$transfer=$_POST['transfer'];
	$sightseeing=$_POST['sightseeing'];
	$name=addslashes($_POST['name']);
	$email=addslashes($_POST['email']);
	$phone=addslashes($_POST['phone']);
	$country=$_POST['country'];
	$address=addslashes($_POST['address']);
	//
	$title=$_POST['title'];
	$fname=addslashes($_POST['fname']);
	$lname=addslashes($_POST['lname']);
	$age=addslashes($_POST['age']);
	$gender=addslashes($_POST['gender']);
 	$mealPreference=addslashes($_POST['mealPreference']);
	$seatPreference=addslashes($_POST['seatPreference']);
	$physicalCondition=addslashes($_POST['physicalCondition']);
	$special_assist=addslashes($_POST['special_assist']);                       //
	$namevalue ='hotelCategory="'.$hotelCategory.'",hotelId="'.$hotelId.'",occupancy="'.$occupancy.'",countryId="'.$country.'",checkIn="'.$fromDate.'",checkOut="'.$toDate.'",airline="'.$airline.'",transfer="'.$transfer.'",sightseeing="'.$sightseeing.'",name="'.$name.'",email="'.$email.'",phone="'.$phone.'",title="'.$title.'",fname="'.$fname.'",lname="'.$lname.'",age="'.$age.'",gender="'.$gender.'",mealPreference="'.$mealPreference.'",seatPreference="'.$seatPreference.'",physicalCondition="'.$physicalCondition.'",address="'.$address.'",addDate="'.time().'",addBy="'.$_SESSION['userid'].'",queryId="'.$queryId.'"';
	$where='id='.$_REQUEST['id'].'';
	$update = updatelisting('guestList',$namevalue,$where);
	?>
	<script>
	parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo encode($_REQUEST['queryId']); ?>&guestlist=1');
	</script>
	<?php
 }
if(trim($_POST['action'])=='uploadguestlistfile' && $_POST['queryId']!='' && $_POST['id']!='' && isset($_FILES['guestattachpostsubmit']['name'])){
	$datef=time();
	$file_name=$_FILES['guestattachpostsubmit']['name'];
	$ext=getExtension($file_name);
	$file_name=str_replace(".","",substr($file_name, 0, strpos($file_name, '.')));
	$file_name2=str_replace(" ","",$file_name.'-'.$datef).'.'.$ext;
	copy($_FILES['guestattachpostsubmit']['tmp_name'],"dirfiles/".$file_name2);
	$namevalue ='queryId="'.$_REQUEST['queryId'].'",guestId="'.$_REQUEST['id'].'",name="'.addslashes($_REQUEST['name']).'",fileName="'.$file_name2.'",addDate="'.time().'",addBy="'.$_SESSION['userid'].'",documentType="'.$_REQUEST['documentType'].'"';
	addlistinggetlastid('guestListDocuments',$namevalue);
	?>
	<script>
	parent.funloadguestdocuments();
	</script>
	<?php
}


if(trim($_POST['action'])=='changepassword' && $_POST['oldpassword']!='' && $_POST['newpassword']!='' && $_POST['confirmpassword']!=''){
	//echo $LoginUserDetails['password'].'---'.$_POST['action'].'----'.md5($_POST['oldpassword']).'----'.$_POST['newpassword'].'----'.$_POST['confirmpassword'];
	$oldpassword=($_POST['oldpassword']);
	$newpassword=($_POST['newpassword']);
	$confirmpassword=($_POST['confirmpassword']);
	if(md5($oldpassword)!=$LoginUserDetails['password']){ ?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		alert('The old password you have entered is incorrect');
		</script>
		<?php
		exit();
	}
	if($newpassword!=$confirmpassword){ ?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		alert('Password and confirm password does not match');
		</script>
		<?php
		exit();
	}
	$namevalue ='password="'.md5($confirmpassword).'"';
	$where='id="'.$_SESSION['userid'].'"';
	updatelisting(_USER_MASTER_,$namevalue,$where);
	include "config/mail.php";
	$fromemail='';
	$mailto=$LoginUserDetails['email'];
	$ccmail='';
	$mailsubject='Your TravCRM account password has been changed!';
	$maildescription='Your TravCRM account password has been changed.<br><br>If you did not change your password please contact your Administrator<br><br>Thank You<br>Team TravCRM';
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
	if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
		
		?>
		<script>
		alert('Your password has been reset successfully!');
		parent.window.location.href='setupsetting.crm?module=personalsettings';
		</script>
		<?php exit();
	}
}

// add Quotation  
if($_REQUEST['action']=='createmultiquotation' ){
		$ispackage='';
		if($_POST['package']==='yes'){
			$ispackage = '&package='.$_POST['package'];
		}
		$quotationType = $_POST['package'];
		$quotationType = $_POST['quotationType'];
		$slabAndRoomType = $_POST['slabAndRoomType'];
		$calculationType = $_POST['calculationType'];
		$quotationSubject = $_POST['quotationSubject'];
		$quotationTotalPAX = $_POST['totalpax'];
		$quotationnewSingle = $_POST['newSingle'];
		$quotationnewDouble = $_POST['newDouble'];
		$quotationnewTriple = $_POST['newTriple'];
		$quotationnewTwin = $_POST['newTwin'];
		$quotationnewEBedC = $_POST['newEBedC'];
		$quotationnewENBedC = $_POST['newENBedC'];
		$quotationnewEBedA = $_POST['newEBedA'];
		$quotationnewQuad = $_POST['newQuad'];
		$quotationnewSixBed = $_POST['newSixBed'];
		$quotationnewEightBed = $_POST['newEightBed'];
		$quotationnewTenBed = $_POST['newTenBed'];
		$quotationnewTeenRoom = $_POST['newTeenRoom'];
	if($_POST['isFixDeparture']==='yes'){
		if($quotationnewSingle=='' && $quotationnewDouble=='' && $quotationnewTriple=='' && $quotationnewTwin=='' && $quotationnewEBedC=='' && $quotationnewENBedC=='' && $quotationnewEBedA=='' && $quotationnewQuad=='' && $quotationnewSixBed=='' && $quotationnewEightBed=='' && $quotationnewTenBed=='' && $quotationnewTeenRoom==''){
			echo '<script>alert("Please Select atleast one room!");</script>';
			return false;
		}
	}
	//package import id
	$packageId = $_POST['packageId'];

	$hotCategory = implode(',',$_POST['hotCategory']);
	
	$hotelType = implode(',',$_POST['hotType']);

	$hotType = implode(',',$_POST['hotCategory']);

	$qtype = $_POST['qtype'];
	
	if($_POST['quotationType'] == 2){
		$keyWordQuotType = "M";
		$keyWordHotCat = $hotCategory;
	}else{
		$keyWordQuotType = "S";
		$keyWordHotCat = "*";
	}
	$dateAdded=time(); 
	

	//IMPORT PACKAGE TO QUERY
	if($_POST['packageId']>0){

		// import code here
		$lastQueryId = $_REQUEST['queryId'];
	 	$queryType = $_REQUEST['qtype'];
		
		$querQuery=""; 
		$querQuery=GetPageRecord('*',_QUERY_MASTER_,' id="'.$lastQueryId.'"');
		$queryData=mysqli_fetch_array($querQuery);
		if($_POST['isFixDeparture']!='yes'){
			$adultPax = $queryData['adult'];
			$childPax = $queryData['child'];
			$infantPax = $queryData['infant'];
			// $queryType = $queryData['queryType'];
		}
		$quotSql="";
		//echo decode($_REQUEST['packageId']);
		$quotSql=GetPageRecord('*',_QUOTATION_MASTER_,' id="'.($_REQUEST['packageId']).'" ');  
		if(mysqli_num_rows($quotSql)>0 ){ 
			$quotationData=mysqli_fetch_array($quotSql);
			 
			$dayWise = $quotationData['dayWise'];
			$fromDate=date("Y-m-d", strtotime($queryData['fromDate'])); 
			$toDate=date("Y-m-d", strtotime($queryData['toDate']));
			$objec=date_diff(date_create($fromDate),date_create($toDate));
			$t_night = $objec->format("%a"); 
			 
			// get the season and Season Year 
			$seasonYear = date('Y',strtotime($fromDate));
			if (strtotime($fromDate)>=strtotime($seasonYear.'-04-01') || strtotime($fromDate)<=strtotime($seasonYear.'-09-30')) {
				$seasonType=1;
			}else{
				$seasonType=2;
			} 
			
			$rschk2="";
			$destinationId = "";
			$rschk2=GetPageRecord('*','newQuotationDays',' quotationId="'.$quotationData['id'].'" and deletestatus=0 and addstatus=0 order by srdate asc');  
			if( mysqli_num_rows($rschk2) > 0 ){
				while($packQueryData = mysqli_fetch_array($rschk2)){
					$destinationId .= $packQueryData['cityId'].',';
				}				
			} 
			

			// add new code goes here
			 $namevalue ='companyId="'.$companyId.'",leadPaxName="'.addslashes($guest1a).'",deletestatus=0,queryDate="'.date('Y-m-d').'",attachmentFile="'.$file_name.'",adult="'.$adult.'",destinationId="'.$destinationId.'",child="'.$child.'",infant="'.$infant.'",categoryId="'.$categoryId.'",mealPlanId="'.$mealPlanId.'",officeBranch="'.$officeBranch.'",assignTo="'.$assignTo.'",description="'.$description.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",night="'.$t_night.'",tourType="'.$tourType.'",queryType="'.$queryType.'",subject="'.$subject.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",guest1="'.$guest1.'",guest2="'.$guest2.'",queryPriority="'.$queryPriority.'",clientType="'.$clientType.'",tat="'.$tat.'",queryTimer="'.time().'",rooms="'.$rooms.'",occupancyType="'.$occupancyType.'",hotelBudget="'.$hotelBudget.'",guest1email="'.$guest1email.'",guest1phone="'.$guest1phone.'",paymentMode="'.$paymentMode.'",closerDate="'.$closerDate.'",leadsource="'.$leadsource.'",campaign="'.$campaign.'",competitor="'.$competitor.'",subDestination="'.$subDestination.'",age1="'.$age1.'",age2="'.$age2.'",age3="'.$age3.'",referanceno="'.$referanceno.'",filecode="'.$filecode.'",single="'.$single.'",doubleocp="'.$double.'",triple="'.$triple.'",childrensage="'.$childfinalage.'",servicePrice="'.$servicePrice.'",quotationYes="'.$quotationYes.'",fromdestinationId="'.$fromdestinationId.'",queryOrder="'.time().'",tatDate="'.date('Y-m-d H:i:s', strtotime("+".$tat." min")).'",tatNumber=0,queryStatus="10",hotelAccommodation="'.$hotelAccommodation.'",needFlight="'.$needFlight.'",earlyCheckin="'.$earlyCheckin.'",hotelCategory="'.$hotelCategory.'",cabforLocal="'.$cabforLocal.'",displayId="'.$displayId.'",mailId="'.$_REQUEST['mailId'].'",gstState="'.$gstState.'",uploadPhoto="'.$uploadPhoto.'",dayWise="'.$dayWise.'",seasonType="'.$seasonType.'",seasonYear="'.$seasonYear.'",additionalInfo="'.addslashes($_POST['additionalInfo']).'",groupName="'.addslashes($_POST['groupName']).'",groupCode="'.addslashes($_POST['groupCode']).'",preferredLang="'.addslashes($_POST['preferredLang']).'",nationality="'.addslashes($_POST['nationality']).'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",twinRoom="'.$twinRoom.'",cwbRoom="'.$cwbRoom.'",vehicleId="'.addslashes($_POST['vehicleId']).'",departureDest="'.addslashes($_POST['departureDest']).'",salesassignTo="'.addslashes($_POST['salesassignTo']).'",seriesCode="'.$seriesCode.'",FDCode="'.$FDCode.'",packageSupplier="'.$packageSupplier.'",packageCode="'.$packageCode.'",subName="'.$subName.'",moduleType=1';
			//$lastQueryId = addlistinggetlastid(_QUERY_MASTER_,$namevalue);
			// We dont have need to add new query
			$statusId=10;
			$notes="Created";
			// Copy the packageQueryDays Data to new 
			$rschk2="";
			$rschk2=GetPageRecord('*','newQuotationDays',' quotationId="'.$quotationData['id'].'" and addstatus=0 order by srdate asc');  
			if( mysqli_num_rows($rschk2) > 0 ){
				$day =1;   
				while($packQueryData = mysqli_fetch_array($rschk2)){
					$date = date('Y-m-d', strtotime($packQueryData['srdate']));
					
					$namevalue ='lastdeleted=1,cityId="'.$packQueryData['cityId'].'",srdate="'.$date.'",srn="'.$day.'",queryId="'.$lastQueryId.'",packageId="'.$lastQueryId.'"';  
					//$lastId = addlistinggetlastid('packageQueryDays',$namevalue);	 
					$day++;
				}				
			} 
			$editId = $lastQueryId;
			
			//Duplicate subseries to new quotation with new query 
			$queryId = $quotationData['queryId']; 
			$quotationId = $quotationData['id'];
			
			$rsp1=""; 
			$rsp1=GetPageRecord('quotationNo',_QUOTATION_MASTER_,' queryId="'.$lastQueryId.'" order by quotationNo desc');
			$quotationNo=mysqli_fetch_array($rsp1);
			if($quotationNo['quotationNo']!=''){
				//this is greater than first
				$letterAscii = ord($quotationNo['quotationNo']);
				$letterAscii++;
				$quotationNo = chr($letterAscii);
			}else{
				$quotationNo = "A";
			} 

			$q_token = mt_rand(10000000, 99999999); 
		
			$namevalue='clientType="'.$quotationData['clientType'].'",queryId="'.$lastQueryId.'",companyId="'.$quotationData['companyId'].'",quotationSubject="'.addslashes($quotationData['quotationSubject']).'",travelDate="'.$quotationData['travelDate'].'",queryDate="'.$quotationData['queryDate'].'",fromDate="'.$queryData['fromDate'].'",toDate="'.$queryData['toDate'].'",officeBranch="'.$quotationData['officeBranch'].'",destinationId="'.$quotationData['destinationId'].'",adult="'.$queryData['adult'].'",child="'.$queryData['child'].'",night="'.$queryData['night'].'",rooms="'.$quotationData['rooms'].'",infant="'.$queryData['infant'].'",sglRoom="'.$queryData['sglRoom'].'",dblRoom="'.$queryData['dblRoom'].'",tplRoom="'.$queryData['tplRoom'].'",twinRoom="'.$queryData['twinRoom'].'",childwithNoofBed="'.$queryData['cwbRoom'].'",childwithoutNoofBed="'.$queryData['cnbRoom'].'",extraNoofBed="'.$queryData['extraNoofBed'].'",sixNoofBedRoom="'.$queryData['sixNoofBedRoom'].'",eightNoofBedRoom="'.$queryData['eightNoofBedRoom'].'",tenNoofBedRoom="'.$queryData['tenNoofBedRoom'].'",quadNoofRoom="'.$queryData['quadNoofRoom'].'",teenNoofRoom="'.$queryData['teenNoofRoom'].'",totalpax="'.$quotationData['totalpax'].'",departureDestinationId="'.$quotationData['departureDestinationId'].'",guest1="'.$quotationData['guest1'].'",categoryId="'.$quotationData['categoryId'].'",modifyBy="'.$_SESSION['userid'].'",markup="'.$quotationData['markup'].'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'",modifyDate="'.$quotationData['modifyDate'].'",deletestatus="'.$quotationData['deletestatus'].'",quotationId="'.$quotationData['id'].'",starRating="'.$quotationData['starRating'].'",totalAmount="'.$quotationData['totalAmount'].'",totalClientCost="'.$quotationData['totalClientCost'].'",markupType="'.$quotationData['markupType'].'",finalQuotationType="'.$quotationData['finalQuotationType'].'",currencyId="'.$quotationData['currencyId'].'",queryType="'.$queryType.'",travelType="'.$quotationData['travelType'].'",cost2person="'.$quotationData['cost2person'].'",image="'.$quotationData['image'].'",flightCostType="'.$quotationData['flightCostType'].'",quotationType="'.$quotationData['quotationType'].'",hotCategory="'.$quotationData['hotCategory'].'",otherLocation="'.$quotationData['otherLocation'].'",otherLocationCost="'.$quotationData['otherLocationCost'].'",isOtherLocation="'.$quotationData['isOtherLocation'].'",inclusion="'.addslashes($quotationData['inclusion']).'",exclusion="'.addslashes($quotationData['exclusion']).'",isInc_exc="'.$quotationData['isInc_exc'].'",quotationNo="'.$quotationNo.'",generateNo="'.$quotationData['generateNo'].'",finalcategory="'.$quotationData['finalcategory'].'",dayroe="'.$quotationData['dayroe'].'",isSer_Mark="'.$quotationData['isSer_Mark'].'",lostStatus="'.$quotationData['lostStatus'].'",isAddExp="'.$quotationData['isAddExp'].'",overviewText="'.addslashes($quotationData['overviewText']).'",highlightsText="'.addslashes($quotationData['highlightsText']).'",tncText="'.addslashes($quotationData['tncText']).'",specialText="'.addslashes($quotationData['specialText']).'",proposalType="'.$quotationData['proposalType'].'",isTransport="'.$quotationData['isTransport'].'",isUni_Mark="'.$quotationData['isUni_Mark'].'",isPaymentRequest="'.$quotationData['isPaymentRequest'].'",departureDate="'.$quotationData['departureDate'].'",asOnDate="'.$quotationData['asOnDate'].'",voucherNumber="'.$quotationData['voucherNumber'].'",voucherReferanceNumber="'.$quotationData['voucherReferanceNumber'].'",voucherDate="'.$quotationData['voucherDate'].'",isSupp_TRR="'.$quotationData['isSupp_TRR'].'",discount="'.$quotationData['discount'].'",discountType="'.$quotationData['discountType'].'",costType="'.$quotationData['costType'].'",languageId="'.$quotationData['languageId'].'",deletestatusDuplicate="'.$quotationData['deletestatusDuplicate'].'",subName="'.clean($_POST['subName']).'",isSeries=0,isFD=0,issueDate="'.$quotationData['issueDate'].'",q_token="'.encode($q_token).'",onlyTFS="'.($queryData['onlyTFS']).'",visaRequired="'.$quotationData['visaRequired'].'",insuranceRequired="'.$quotationData['insuranceRequired'].'",passportRequired="'.$queryData['needPassport'].'",flightRequired="'.$quotationData['flightRequired'].'",calculationType="'.$quotationData['calculationType'].'",slabAndRoomType="'.$quotationData['slabAndRoomType'].'",gstType="'.$quotationData['gstType'].'",packageSupplier="'.$quotationData['packageSupplier'].'",dayWise="'.$dayWise.'",transferRequired="'.$quotationData['transferRequired'].'",trainRequired="'.$quotationData['trainRequired'].'",serviceTax="'.$quotationData['serviceTax'].'",tcs="'.$quotationData['tcs'].'"';
			
			$update = $lastQuotationId = addlistinggetlastid(_QUOTATION_MASTER_,$namevalue);
			
			// Fix Departure new quotation updates
			if($_POST['isFixDeparture']==='yes'){
				
				$isFD = '';
				$namevalue ='deletestatus=0,isUni_Mark=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'",quotationType="'.$quotationType.'",quotationNo="'.$quotationNo.'",quotationSubject="'.addslashes($quotationSubject).'",hotCategory="'.$hotCategory.'",adult="'.$quotationTotalPAX.'",sglRoom="'.$quotationnewSingle.'",dblRoom="'.$quotationnewDouble.'",tplRoom="'.$quotationnewTriple.'",twinRoom="'.$quotationnewTwin.'",childwithNoofBed="'.$quotationnewEBedC.'",childwithoutNoofBed="'.$quotationnewENBedC.'",extraNoofBed="'.$quotationnewEBedA.'",queryType="'.$qtype.'",isPackage="'.$isPackage.'",isFD="'.$isFD.'",calculationType="'.$calculationType.'",slabAndRoomType="'.$slabAndRoomType.'",gstType=1,packageSupplier="'.$queryData['packageSupplier'].'",q_token="'.encode($q_token).'",sixNoofBedRoom="'.$quotationnewSixBed.'",eightNoofBedRoom="'.$quotationnewEightBed.'",tenNoofBedRoom="'.$quotationnewTenBed.'",quadNoofRoom="'.$quotationnewQuad.'",teenNoofRoom="'.$quotationnewTeenRoom.'"';

				$updateFD = updatelisting(_QUOTATION_MASTER_,$namevalue,'id="'.$lastQuotationId.'"');
			}

			$rsp2=""; 
			$rsp2=GetPageRecord('id',_QUOTATION_MASTER_,' queryId="'.$lastQueryId.'" and status=1 '); 
			
			if($lastQuotationId>0 && mysqli_num_rows($rsp2) == 0){
				updatelisting(_QUERY_MASTER_,'queryStatus=5,quotationDate="'.date('Y-m-d').'"','id="'.$lastQueryId.'"');
			}

			// duplicate pax slab lists

			//  && $packageId=='0'  why this condition is user heere
			if($_POST['isFixDeparture']!='yes'){

				$DF_SGL = round($queryData['sglRoom']);
				$DF_DBL = round($queryData['dblRoom']*2);
				$DF_TWN = round($queryData['twinRoom']*2);
				$DF_TPL = round($queryData['tplRoom']*3);
				$DF_QUAD = round($queryData['quadNoofRoom']*4);
				$DF_SIX = round($queryData['sixNoofBedRoom']*6);
				$DF_EIGHT = round($queryData['eightNoofBedRoom']*8);
				$DF_TEN = round($queryData['tenNoofBedRoom']*10);
				$DF_ABED = round($queryData['extraNoofBed']);
				$DF_CBED = round($queryData['cwbRoom']+$queryData['cnbRoom']+$teenNoofRoom2);
				$DF_INF = round($queryData['infant']);

				$fromRange = $queryData['adult']+$queryData['child']+$queryData['infant'];
				$b='';
				$b=GetPageRecord('*','totalPaxSlab',' quotationId="'.$quotationId.'" limit 1');
				if(mysqli_num_rows($b)>0){
					while($slabData=mysqli_fetch_array($b)){
						$addHotel = '';  

						$modevalue = 'quotationId="'.$lastQuotationId.'", fromRange="'.$fromRange.'", toRange="'.$fromRange.'", localEscort="'.$slabData['localEscort'].'", foreignEscort="'.$slabData['foreignEscort'].'", dividingFactor="'.$fromRange.'", status=1, dateAdded="'.$slabData['dateAdded'].'", modifyDate="'.$slabData['modifyDate'].'",dividingFactorC="'.$slabData['dividingFactorC'].'", DF_SGL="'.$DF_SGL.'", DF_DBL="'.$DF_DBL.'", DF_TWN="'.$DF_TWN.'", DF_TPL="'.$DF_TPL.'", DF_QUAD="'.$DF_QUAD.'", DF_SIX="'.$DF_SIX.'", DF_EIGHT="'.$DF_EIGHT.'", DF_TEN="'.$DF_TEN.'", DF_ABED="'.$DF_ABED.'",DF_CBED="'.$DF_CBED.'",DF_INF="'.$DF_INF.'",adult="'.$queryData['adult'].'",child="'.$queryData['child'].'",infant="'.$queryData['infant'].'",sglRoom="'.$queryData['sglRoom'].'",dblRoom="'.$queryData['dblRoom'].'",twinRoom="'.$queryData['twinRoom'].'",tplRoom="'.$queryData['tplRoom'].'",quadNoofRoom="'.$queryData['quadNoofRoom'].'",sixNoofBedRoom="'.$queryData['sixNoofBedRoom'].'",eightNoofBedRoom="'.$queryData['eightNoofBedRoom'].'",tenNoofBedRoom="'.$queryData['tenNoofBedRoom'].'",teenNoofRoom="'.$queryData['teenNoofRoom'].'",extraNoofBed="'.$queryData['extraNoofBed'].'",childwithNoofBed="'.$queryData['cwbRoom'].'",childwithoutNoofBed="'.$queryData['cnbRoom'].'"';
						$slabId = addlistinggetlastid('totalPaxSlab',$modevalue);
						
						$esQ="";
						$esQ=GetPageRecord('*','quotationFOCRates',' slabId="'.$slabData['id'].'" and quotationId="'.$slabData['quotationId'].'"');
						if(mysqli_num_rows($esQ) > 0){
							while($escortData=mysqli_fetch_array($esQ)){
								$focRatesQuery = '';  
								$focRatesQuery ='quotationId="'.$lastQuotationId.'",slabId="'.$slabId.'",sglNORoom="'.$escortData['sglNORoom'].'",dblNORoom="'.$escortData['dblNORoom'].'",tplNORoom="'.$escortData['tplNORoom'].'",focType="'.$escortData['focType'].'",hotelCost="'.$escortData['hotelCost'].'",guideCost="'.$escortData['guideCost'].'",activityCost="'.$escortData['activityCost'].'",entranceCost="'.$escortData['entranceCost'].'",transferCost="'.$escortData['transferCost'].'",ferryCost="'.$escortData['ferryCost'].'",trainCost="'.$escortData['trainCost'].'",flightCost="'.$escortData['flightCost'].'",restaurantCost="'.$escortData['restaurantCost'].'",otherCost="'.$escortData['otherCost'].'",hotelCalType="'.$escortData['hotelCalType'].'",guideCalType="'.$escortData['guideCalType'].'",activityCalType="'.$escortData['activityCalType'].'",entranceCalType="'.$escortData['entranceCalType'].'",transferCalType="'.$escortData['transferCalType'].'",ferryCalType="'.$escortData['ferryCalType'].'",trainCalType="'.$escortData['trainCalType'].'",flightCalType="'.$escortData['flightCalType'].'",restaurantCalType="'.$escortData['restaurantCalType'].'",otherCalType="'.$escortData['otherCalType'].'"';
								$focRateId = addlistinggetlastid('quotationFOCRates',$focRatesQuery);
							} 
						}
					}
				}
			}
		
			$nodays = 0;
			$rs=GetPageRecord('*','newQuotationDays',' quotationId="'.$quotationId.'" and addstatus=0 order by srdate asc');
			while($QueryDaysData=mysqli_fetch_array($rs)){
		
				$adddays=''; 
				$srDaysDate  = date('Y-m-d', strtotime($fromDate. '+'.$nodays.' days'));
				$namevalue =' queryId="'.$lastQueryId.'",cityId="'.$QueryDaysData['cityId'].'",quotationId="'.$lastQuotationId.'",srdate="'.$srDaysDate.'",title="'.$QueryDaysData['title'].'",description="'.$QueryDaysData['description'].'"';
				$adddays = addlistinggetlastid('newQuotationDays',$namevalue);

		 		$b=GetPageRecord('*',_QUOTATION_HOTEL_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and supplierId in ( select serviceId from quotationItinerary where serviceType="hotel" order by serviceId asc ) and (isGuestType=1 or isLocalEscort=1 or isForeignEscort=1) and isRoomSupplement=0 and isHotelSupplement=0 order by id asc');

				while($HotelRes=mysqli_fetch_array($b)) {
					if($HotelRes['isEarlyCheckin']==1){
						// only for Early Arrival date change curren
						$srDaysDate = date('Y-m-d', strtotime("-1 day", strtotime($fromDate)));
					}
					$namevalue ='';
					$quotHotelId =''; 
					$namevalue ='hotelName="'.$HotelRes['hotelName'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",checkin="'.$HotelRes['checkin'].'",checkout="'.$HotelRes['checkout'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",destinationId="'.$HotelRes['destinationId'].'",categoryId="'.$HotelRes['categoryId'].'",roomTariffId="'.$HotelRes['roomTariffId'].'",currencyId="'.$HotelRes['currencyId'].'",currencyValue="'.$HotelRes['currencyValue'].'",supplierId="'.$HotelRes['supplierId'].'",supplierMasterId="'.$HotelRes['supplierMasterId'].'",mealPlan="'.$HotelRes['mealPlan'].'",night="'.$HotelRes['night'].'",status="'.$HotelRes['status'].'",address="'.$HotelRes['address'].'",roomprice="'.$HotelRes['roomprice'].'",noofrooms="'.$HotelRes['noofrooms'].'",roomType="'.$HotelRes['roomType'].'",tariffType="'.$HotelRes['tariffType'].'",quotTotalNight="'.$HotelRes['quotTotalNight'].'",hotelQuotatoinType="'.$HotelRes['hotelQuotatoinType'].'",singleoccupancy="'.$HotelRes['singleoccupancy'].'",doubleoccupancy="'.$HotelRes['doubleoccupancy'].'",tripleoccupancy="'.$HotelRes['tripleoccupancy'].'",twinoccupancy="'.$HotelRes['twinoccupancy'].'",childwithbed="'.$HotelRes['childwithbed'].'",childwithoutbed="'.$HotelRes['childwithoutbed'].'",lunch="'.$HotelRes['lunch'].'",dinner="'.$HotelRes['dinner'].'",extraadult="'.$HotelRes['extraadult'].'",taxType="'.$HotelRes['taxType'].'",markupType="'.$HotelRes['markupType'].'",sglMarkup="'.$HotelRes['sglMarkup'].'",dblMarkup="'.$HotelRes['dblMarkup'].'",twinMarkup="'.$HotelRes['twinMarkup'].'",tplMarkup="'.$HotelRes['tplMarkup'].'",cwbMarkup="'.$HotelRes['cwbMarkup'].'",quadMarkup="'.$HotelRes['quadMarkup'].'",sixMarkup="'.$HotelRes['sixMarkup'].'",eightMarkup="'.$HotelRes['eightMarkup'].'",tenMarkup="'.$HotelRes['tenMarkup'].'",teenMarkup="'.$HotelRes['teenMarkup'].'",cnbMarkup="'.$HotelRes['cnbMarkup'].'",exMarkup="'.$HotelRes['exMarkup'].'",mealMarkup="'.$HotelRes['mealMarkup'].'",singleNoofRoom="'.$queryData['sglRoom'].'",doubleNoofRoom="'.$queryData['dblRoom'].'",tripleNoofRoom="'.$queryData['tplRoom'].'",twinNoofRoom="'.$queryData['twinRoom'].'",childwithNoofBed="'.$queryData['cwbRoom'].'",childwithoutNoofBed="'.$queryData['cnbRoom'].'",extraNoofBed="'.$queryData['extraNoofBed'].'",paymentMode="'.$HotelRes['paymentMode'].'",agentCode="'.$HotelRes['agentCode'].'",fileNo="'.$HotelRes['fileNo'].'",confirmation="'.$HotelRes['confirmation'].'",arrivalBy="'.$HotelRes['arrivalBy'].'",departureBy="'.$HotelRes['departureBy'].'",specialRequest="'.$HotelRes['specialRequest'].'",remark="'.$HotelRes['remark'].'",tourManager="'.$HotelRes['tourManager'].'",harrivalon="'.$HotelRes['harrivalon'].'",hfrom="'.$HotelRes['hfrom'].'",hbyfrom="'.$HotelRes['hbyfrom'].'",hatfrom="'.$HotelRes['hatfrom'].'",hdepartureon="'.$HotelRes['hdepartureon'].'",hto="'.$HotelRes['hto'].'",hbyto="'.$HotelRes['hbyto'].'",hatto="'.$HotelRes['hatto'].'",supplementCostAdded="'.$HotelRes['supplementCostAdded'].'",isHotelSupplement="'.$HotelRes['isHotelSupplement'].'",isRoomSupplement="'.$HotelRes['isRoomSupplement'].'",rand_color="'.$HotelRes['rand_color'].'",hotelQuoteId="'.$HotelRes['hotelQuoteId'].'",breakfast="'.$HotelRes['breakfast'].'",extraBed="'.$HotelRes['extraBed'].'",roomGST="'.$HotelRes['roomGST'].'",mealGST="'.$HotelRes['mealGST'].'",TAC="'.$HotelRes['TAC'].'",complimentaryLunch="'.$HotelRes['complimentaryLunch'].'",complimentaryDinner="'.$HotelRes['complimentaryDinner'].'",complimentaryBreakfast="'.$HotelRes['complimentaryBreakfast'].'",isChildBreakfast="'.$HotelRes['isChildBreakfast'].'",isChildLunch="'.$HotelRes['isChildLunch'].'",isChildDinner="'.$HotelRes['isChildDinner'].'",startDayDate="'.$HotelRes['startDayDate'].'",endDayDate="'.$HotelRes['endDayDate'].'",escortHotelStatus="'.$HotelRes['escortHotelStatus'].'",escortType="'.$HotelRes['escortType'].'",isGuestType="'.$HotelRes['isGuestType'].'",isLocalEscort="'.$HotelRes['isLocalEscort'].'",isForeignEscort="'.$HotelRes['isForeignEscort'].'",isEarlyCheckin="'.$HotelRes['isEarlyCheckin'].'"';
 	
					$addHotel = addlistinggetlastid(_QUOTATION_HOTEL_MASTER_,$namevalue);

					$check_h=GetPageRecord('*','quotationItinerary',' queryId="'.$HotelRes['queryId'].'" and dayId="'.$adddays.'" and quotationId="'.$lastQuotationId.'" and serviceId="'.$HotelRes['supplierId'].'"');
					if(mysqli_num_rows($check_h)==0){
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$HotelRes['supplierId'].'",quotationId="'.$lastQuotationId.'",serviceType="hotel",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
					}

					// supplement
					$hotelSuppQuery=GetPageRecord('*',_QUOTATION_HOTEL_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and hotelQuoteId="'.$HotelRes['id'].'" and (isRoomSupplement=1 or isHotelSupplement=1) order by id asc');
					while($hotelSuppD=mysqli_fetch_array($hotelSuppQuery)){
						
						$namevalue ='';
						$namevalue ='hotelName="'.$hotelSuppD['hotelName'].'",fromDate="'.$hotelSuppD['fromDate'].'",toDate="'.$hotelSuppD['toDate'].'",checkin="'.$hotelSuppD['checkin'].'",checkout="'.$hotelSuppD['checkout'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",destinationId="'.$hotelSuppD['destinationId'].'",categoryId="'.$hotelSuppD['categoryId'].'",roomTariffId="'.$hotelSuppD['roomTariffId'].'",currencyId="'.$hotelSuppD['currencyId'].'",currencyValue="'.$hotelSuppD['currencyValue'].'",supplierId="'.$hotelSuppD['supplierId'].'",supplierMasterId="'.$hotelSuppD['supplierMasterId'].'",mealPlan="'.$hotelSuppD['mealPlan'].'",night="'.$hotelSuppD['night'].'",status="'.$hotelSuppD['status'].'",address="'.$hotelSuppD['address'].'",roomprice="'.$hotelSuppD['roomprice'].'",noofrooms="'.$hotelSuppD['noofrooms'].'",roomType="'.$hotelSuppD['roomType'].'",tariffType="'.$hotelSuppD['tariffType'].'",quotTotalNight="'.$hotelSuppD['quotTotalNight'].'",hotelQuotatoinType="'.$hotelSuppD['hotelQuotatoinType'].'",singleoccupancy="'.$hotelSuppD['singleoccupancy'].'",doubleoccupancy="'.$hotelSuppD['doubleoccupancy'].'",twinoccupancy="'.$hotelSuppD['twinoccupancy'].'",tripleoccupancy="'.$hotelSuppD['tripleoccupancy'].'",quadoccupancy="'.$hotelSuppD['quadoccupancy'].'",childwithbed="'.$hotelSuppD['childwithbed'].'",childwithoutbed="'.$hotelSuppD['childwithoutbed'].'",lunch="'.$hotelSuppD['lunch'].'",dinner="'.$hotelSuppD['dinner'].'",extraadult="'.$hotelSuppD['extraadult'].'",paymentMode="'.$hotelSuppD['paymentMode'].'",agentCode="'.$hotelSuppD['agentCode'].'",fileNo="'.$hotelSuppD['fileNo'].'",confirmation="'.$hotelSuppD['confirmation'].'",arrivalBy="'.$hotelSuppD['arrivalBy'].'",departureBy="'.$hotelSuppD['departureBy'].'",specialRequest="'.$hotelSuppD['specialRequest'].'", taxType="'.$hotelSuppD['taxType'].'",markupType="'.$hotelSuppD['markupType'].'",sglMarkup="'.$hotelSuppD['sglMarkup'].'",dblMarkup="'.$hotelSuppD['dblMarkup'].'",twinMarkup="'.$hotelSuppD['twinMarkup'].'",tplMarkup="'.$hotelSuppD['tplMarkup'].'",cwbMarkup="'.$hotelSuppD['cwbMarkup'].'",quadMarkup="'.$hotelSuppD['quadMarkup'].'",sixMarkup="'.$hotelSuppD['sixMarkup'].'",eightMarkup="'.$hotelSuppD['eightMarkup'].'",tenMarkup="'.$hotelSuppD['tenMarkup'].'",teenMarkup="'.$hotelSuppD['teenMarkup'].'",cnbMarkup="'.$hotelSuppD['cnbMarkup'].'",exMarkup="'.$hotelSuppD['exMarkup'].'",mealMarkup="'.$hotelSuppD['mealMarkup'].'",remark="'.$hotelSuppD['remark'].'",tourManager="'.$hotelSuppD['tourManager'].'",supplementCostAdded="'.$hotelSuppD['supplementCostAdded'].'",isHotelSupplement="'.$hotelSuppD['isHotelSupplement'].'",isRoomSupplement="'.$hotelSuppD['isRoomSupplement'].'",rand_color="'.$hotelSuppD['rand_color'].'",hotelQuoteId="'.$addHotel.'",breakfast="'.$hotelSuppD['breakfast'].'",extraBed="'.$hotelSuppD['extraBed'].'",roomGST="'.$hotelSuppD['roomGST'].'",mealGST="'.$hotelSuppD['mealGST'].'",TAC="'.$hotelSuppD['TAC'].'",complimentaryLunch="'.$hotelSuppD['complimentaryLunch'].'",complimentaryDinner="'.$hotelSuppD['complimentaryDinner'].'",complimentaryBreakfast="'.$hotelSuppD['complimentaryBreakfast'].'",startDayDate="'.$hotelSuppD['startDayDate'].'",endDayDate="'.$hotelSuppD['endDayDate'].'",singleNoofRoom="'.$queryData['sglRoom'].'",doubleNoofRoom="'.$queryData['dblRoom'].'",tripleNoofRoom="'.$queryData['tplRoom'].'",twinNoofRoom="'.$queryData['twinRoom'].'",childwithNoofBed="'.$queryData['cwbRoom'].'",childwithoutNoofBed="'.$queryData['cnbRoom'].'",extraNoofBed="'.$queryData['extraNoofBed'].'",isGuestType="'.$hotelSuppD['isGuestType'].'",isLocalEscort="'.$hotelSuppD['isLocalEscort'].'",isForeignEscort="'.$hotelSuppD['isForeignEscort'].'",isEarlyCheckin="'.$hotelSuppD['isEarlyCheckin'].'",sixBedRoom="'.$hotelSuppD['sixBedRoom'].'",eightBedRoom="'.$hotelSuppD['eightBedRoom'].'",tenBedRoom="'.$hotelSuppD['tenBedRoom'].'",quadRoom="'.$hotelSuppD['quadRoom'].'",teenRoom="'.$hotelSuppD['teenRoom'].'",childBreakfast="'.$hotelSuppD['childBreakfast'].'",childDinner="'.$hotelSuppD['childDinner'].'",childLunch="'.$hotelSuppD['childLunch'].'",sixNoofBedRoom="'.$hotelSuppD['sixNoofBedRoom'].'",eightNoofBedRoom="'.$hotelSuppD['eightNoofBedRoom'].'",tenNoofBedRoom="'.$hotelSuppD['tenNoofBedRoom'].'",quadNoofRoom="'.$hotelSuppD['quadNoofRoom'].'",teenNoofRoom="'.$hotelSuppD['teenNoofRoom'].'",isChildBreakfast="'.$hotelSuppD['isChildBreakfast'].'",isChildLunch="'.$hotelSuppD['isChildLunch'].'",isChildDinner="'.$hotelSuppD['isChildDinner'].'"';
						$addSuppId = addlistinggetlastid(_QUOTATION_HOTEL_MASTER_,$namevalue);

						 $check_h=GetPageRecord('*','quotationItinerary',' queryId="'.$QueryDaysData['queryId'].'" and dayId="'.$adddays.'" and quotationId="'.$lastQuotationId.'" and serviceId="'.$hotelSuppD['supplierId'].'"');
						if(mysqli_num_rows($check_h)==0 && $hotelSuppD['isHotelSupplement'] == 1){
							$namevalue ='';
							$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$hotelSuppD['supplierId'].'",quotationId="'.$lastQuotationId.'",serviceType="hotel",startDate="'.$hotelSuppD['fromDate'].'",endDate="'.$hotelSuppD['fromDate'].'"';
							addlistinggetlastid('quotationItinerary',$namevalue);
						}

					} 
		
				}

				$b='';
				$b=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in ( select serviceId from quotationItinerary where serviceType="transfer" or serviceType="transportation" order by serviceId asc ) order by id asc');
				if(mysqli_num_rows($b)>0){
					while($quotTransferData=mysqli_fetch_array($b)){
					 
						$bb2='';
						$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1');
						$paxSlabData2=mysqli_fetch_array($bb2);
						$totalPaxId = $paxSlabData2['id'];
						 
						$transQuoteId = '';
						 $transfernamevalue ='fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",destinationId="'.$quotTransferData['destinationId'].'",transferNameId="'.$quotTransferData['transferNameId'].'",supplierId="'.$quotTransferData['supplierId'].'",tariffId="'.$quotTransferData['tariffId'].'",vehicleId="'.$quotTransferData['vehicleId'].'",vehicleModelId="'.$quotTransferData['vehicleModelId'].'",currencyId="'.$quotTransferData['currencyId'].'",currencyValue="'.$quotTransferData['currencyValue'].'",transferToId="'.$quotTransferData['transferToId'].'",transferFromId="'.$quotTransferData['transferFromId'].'",transferType="'.$quotTransferData['transferType'].'",adultCost="'.$quotTransferData['adultCost'].'",childCost="'.$quotTransferData['childCost'].'",infantCost="'.$quotTransferData['infantCost'].'",roomPrice="'.$quotTransferData['roomPrice'].'",detail="'.$quotTransferData['detail'].'",vehicleCost="'.$quotTransferData['vehicleCost'].'",transferQuotatoinType="'.$quotTransferData['transferQuotatoinType'].'",dmcId="'.$quotTransferData['dmcId'].'",pickupFrom="'.$quotTransferData['pickupFrom'].'",pickupTime="'.$quotTransferData['pickupTime'].'",duration="'.$quotTransferData['duration'].'",vehicleMaxPax="'.$quotTransferData['vehicleMaxPax'].'",adMarkup="'.$quotTransferData['adMarkup'].'",chMarkup="'.$quotTransferData['chMarkup'].'",vehMarkup="'.$quotTransferData['vehMarkup'].'",remark="'.$quotTransferData['remark'].'",confirmation="'.$quotTransferData['confirmation'].'",tourManager="'.$quotTransferData['tourManager'].'",driverId="'.$quotTransferData['driverId'].'",vehicleType="'.$quotTransferData['vehicleType'].'",parkingFee="'.$quotTransferData['parkingFee'].'",representativeEntryFee="'.$quotTransferData['representativeEntryFee'].'",assistance="'.$quotTransferData['assistance'].'",guideAllowance="'.$quotTransferData['guideAllowance'].'",interStateAndToll="'.$quotTransferData['interStateAndToll'].'",miscellaneous="'.$quotTransferData['miscellaneous'].'",transferName="'.$quotTransferData['transferName'].'",noOfDays="'.$quotTransferData['noOfDays'].'",dayId="'.$adddays.'",serviceType="'.$quotTransferData['serviceType'].'",costType="'.$quotTransferData['costType'].'",distance="'.$quotTransferData['distance'].'",noOfVehicles="'.$quotTransferData['noOfVehicles'].'",markupType="'.$quotTransferData['markupType'].'",markupCost="'.$quotTransferData['markupCost'].'",taxType="'.$quotTransferData['taxType'].'",gstTax="'.$quotTransferData['gstTax'].'",totalPax="'.$totalPaxId.'",isGuestType="'.$quotTransferData['isGuestType'].'",startDay="'.$quotTransferData['startDay'].'",endDay="'.$quotTransferData['endDay'].'"';
		
						$transQuoteId = addlistinggetlastid(_QUOTATION_TRANSFER_MASTER_,$transfernamevalue);
						
						$c1="";
						$c1=GetPageRecord('*','quotationTransferTimelineDetails','transferQuoteId="'.$quotTransferData['id'].'" and quotationId="'.$quotTransferData['quotationId'].'"');
						if(mysqli_num_rows($c1)>0){
							$transferTimelineData=mysqli_fetch_array($c1);
		
							 $namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",supplierId="'.$transferTimelineData['supplierId'].'",transferQuoteId="'.$transQuoteId.'",arrivalFrom="'.$transferTimelineData['arrivalFrom'].'",trainName="'.$transferTimelineData['trainName'].'",trainNumber="'.$transferTimelineData['trainNumber'].'",flightName="'.$transferTimelineData['flightName'].'",flightNumber="'.$transferTimelineData['flightNumber'].'",vehicleName="'.$transferTimelineData['vehicleName'].'",airportName="'.$transferTimelineData['airportName'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'",VehicleModel="'.$transferTimelineData['VehicleModel'].'",arrivalTime="'.$transferTimelineData['arrivalTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",mode="'.$transferTimelineData['mode'].'",pickupTime="'.$transferTimelineData['pickupTime'].'"';
							 $hotelSupHot = addlistinggetlastid('quotationTransferTimelineDetails',$namevalue); 
						}
		
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$transQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="'.$quotTransferData['serviceType'].'",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
		
					}
				}
			
				$b="";
				$b=GetPageRecord('*','quotationGuideMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="guide" order by serviceId asc) and isGuestType=1 order by id asc');
				while($quotGuideData=mysqli_fetch_array($b)){

					$bb2='';
					$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1');
					$paxSlabData2=mysqli_fetch_array($bb2);
					$totalPaxId = $paxSlabData2['id']; 

					$guideQuoteId =''; 
					$transfernamevalue ='guideId="'.$quotGuideData['guideId'].'",isGuestType="'.$quotGuideData['isGuestType'].'",slabId="'.$totalPaxId.'",price="'.$quotGuideData['price'].'",guideName="'.$quotGuideData['guideName'].'",queryId="'.$lastQueryId.'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",supplierId="'.$quotGuideData['supplierId'].'",tariffId="'.$quotGuideData['tariffId'].'",quotationId="'.$lastQuotationId.'",srn="'.$quotGuideData['srn'].'",destinationId="'.$quotGuideData['destinationId'].'",rules="'.$quotGuideData['rules'].'",category="'.$quotGuideData['category'].'",subcategory="'.$quotGuideData['subcategory'].'",totalDays="'.$quotGuideData['totalDays'].'",perDaycost="'.$quotGuideData['perDaycost'].'",serviceType="'.$quotGuideData['serviceType'].'",currencyId="'.$quotGuideData['currencyId'].'",currencyValue="'.$quotGuideData['currencyValue'].'",isSelectedFinal="'.$quotGuideData['isSelectedFinal'].'",paxRange="'.$quotGuideData['paxRange'].'",markupType="'.$quotGuideData['markupType'].'",markupCost="'.$quotGuideData['markupCost'].'",taxType="'.$quotGuideData['taxType'].'",gstTax="'.$quotGuideData['gstTax'].'",dayId="'.$adddays.'"';
		
					$guideQuoteId = addlistinggetlastid('quotationGuideMaster',$transfernamevalue);

					$bSupp=GetPageRecord('*','quotationGuideMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'"  and guideQuoteId="'.$quotGuideData['id'].'" and isSupplement=1 order by id asc');
					while($transferSuppRes=mysqli_fetch_array($bSupp)){
						$suppGuidevalue ='guideId="'.$transferSuppRes['guideId'].'",slabId="'.$totalPaxId.'",price="'.$transferSuppRes['price'].'",guideName="'.$transferSuppRes['guideName'].'",queryId="'.$lastQueryId.'",fromDate="'.$quotGuideData['fromDate'].'",toDate="'.$quotGuideData['toDate'].'",supplierId="'.$transferSuppRes['supplierId'].'",tariffId="'.$transferSuppRes['tariffId'].'",quotationId="'.$lastQuotationId.'",srn="'.$transferSuppRes['srn'].'",destinationId="'.$transferSuppRes['destinationId'].'",rules="'.$transferSuppRes['rules'].'",category="'.$transferSuppRes['category'].'",subcategory="'.$transferSuppRes['subcategory'].'",totalDays="'.$transferSuppRes['totalDays'].'",perDaycost="'.$transferSuppRes['perDaycost'].'",serviceType="'.$transferSuppRes['serviceType'].'",currencyId="'.$transferSuppRes['currencyId'].'",currencyValue="'.$transferSuppRes['currencyValue'].'",guideQuoteId="'.$guideQuoteId.'",isGuestType="'.$transferSuppRes['isGuestType'].'",isSupplement="'.$transferSuppRes['isSupplement'].'",isSelectedFinal="'.$transferSuppRes['isSelectedFinal'].'",paxRange="'.$transferSuppRes['paxRange'].'",dayType="'.$transferSuppRes['dayType'].'",markupType="'.$quotGuideData['markupType'].'",markupCost="'.$quotGuideData['markupCost'].'",taxType="'.$quotGuideData['taxType'].'",gstTax="'.$quotGuideData['gstTax'].'",dayId="'.$adddays.'"';
			
						$addSuppHotel = addlistinggetlastid('quotationGuideMaster',$suppGuidevalue);
					}
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$guideQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="guide",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
		
				}
				
			
				$b="";
				$b=GetPageRecord('*',_QUOTATION_OTHER_ACTIVITY_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="activity" order by serviceId asc) order by id asc');
				while($quotActivityData=mysqli_fetch_array($b)){
					// tarifId
					if($_POST['isFixDeparture']==='yes'){
						$adultPax = $quotActivityData['adultPax'];
						$childPax = $quotActivityData['childPax'];
						$infantPax = $quotActivityData['infantPax'];
					}
					
					$activityQuoteId = '';
					$transfernamevalue ='otherActivityName="'.$quotActivityData['otherActivityName'].'",dateotherActivity="'.$quotActivityData['dateotherActivity'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",adultCost="'.$quotActivityData['adultCost'].'",supplierId="'.$quotActivityData['supplierId'].'",tariffId="'.$quotActivityData['tariffId'].'",childCost="'.$quotActivityData['childCost'].'",infantCost="'.$quotActivityData['infantCost'].'",groupCost="'.$quotActivityData['groupCost'].'",otherActivityCity="'.$quotActivityData['otherActivityCity'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",activityCost="'.$quotActivityData['activityCost'].'",maxpax="'.$quotActivityData['maxpax'].'",perPaxCost="'.$quotActivityData['perPaxCost'].'",transferType="'.$quotActivityData['transferType'].'",vehicleId="'.$quotActivityData['vehicleId'].'",vehicleCost="'.$quotActivityData['vehicleCost'].'",noOfVehicles="'.$quotActivityData['noOfVehicles'].'",repCost="'.$quotActivityData['repCost'].'",ticketAdultCost="'.$quotActivityData['ticketAdultCost'].'",ticketchildCost="'.$quotActivityData['ticketchildCost'].'",ticketinfantCost="'.$quotActivityData['ticketinfantCost'].'",quotationOtherActivitymaster="'.$quotActivityData['quotationOtherActivitymaster'].'",currencyId="'.$quotActivityData['currencyId'].'",currencyValue="'.$quotActivityData['currencyValue'].'",markupType="'.$quotActivityData['markupType'].'",markupCost="'.$quotActivityData['markupCost'].'",taxType="'.$quotActivityData['taxType'].'",gstTax="'.$quotActivityData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
					
					$activityQuoteId = addlistinggetlastid(_QUOTATION_OTHER_ACTIVITY_MASTER_,$transfernamevalue);
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$activityQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="activity",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
					
					$c1="";
					$c1=GetPageRecord('*','quotationActivityTimelineDetails','  hotelQuoteId="'.$quotActivityData['id'].'"');  
					if(mysqli_num_rows($c1)>0){
						$transferTimelineData=mysqli_fetch_array($c1); 
						 $namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",hotelQuoteId="'.$activityQuoteId.'",supplierId="'.$quotActivityData['supplierId'].'",startTime="'.$transferTimelineData['startTime'].'",endTime="'.$transferTimelineData['endTime'].'"';
						 $entraceTimeId = addlistinggetlastid('quotationActivityTimelineDetails',$namevalue);
		
					}
		
				}
		
				$b="";
				$b=GetPageRecord('*','quotationEnrouteMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="enroute" order by serviceId asc) order by id asc');
				while($quotEnrouteData=mysqli_fetch_array($b)){
					$enrQuoteId ='';
					if($_POST['isFixDeparture']==='yes'){
						$adultPax = $quotEnrouteData['adultPax'];
						$childPax = $quotEnrouteData['childPax'];
						$infantPax = $quotEnrouteData['infantPax'];
					}
					$transfernamevalue ='enrouteId="'.$quotEnrouteData['enrouteId'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",adultCost="'.$quotEnrouteData['adultCost'].'",childCost="'.$quotEnrouteData['childCost'].'",infantCost="'.$quotEnrouteData['infantCost'].'",destinationId="'.$quotEnrouteData['destinationId'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",markupType="'.$quotEnrouteData['markupType'].'",markupCost="'.$quotEnrouteData['markupCost'].'",taxType="'.$quotEnrouteData['taxType'].'",gstTax="'.$quotEnrouteData['gstTax'].'",dayId="'.$adddays.'",currencyId="'.$quotEnrouteData['currencyId'].'",currencyValue="'.$quotEnrouteData['currencyValue'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
					$enrQuoteId = addlistinggetlastid('quotationEnrouteMaster',$transfernamevalue);
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$enrQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="enroute",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
		
				}
		
				$b="";
				$b=GetPageRecord('*','quotationEntranceMaster','quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="entrance" order by serviceId asc) order by id asc');
				while($quotEntranceData=mysqli_fetch_array($b)){
					$entQuoteId = ''; 
					// transferType
					if($_POST['isFixDeparture']==='yes'){
						$adultPax = $quotEntranceData['adultPax'];
						$childPax = $quotEntranceData['childPax'];
						$infantPax = $quotEntranceData['infantPax'];
					}
					$transfernamevalue ='entranceNameId="'.$quotEntranceData['entranceNameId'].'",quotationId="'.$lastQuotationId.'",destinationId="'.$quotEntranceData['destinationId'].'",dmcId="'.$quotEntranceData['dmcId'].'",vehicleId="'.$quotEntranceData['vehicleId'].'",supplierId="'.$quotEntranceData['supplierId'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",ticketAdultCost="'.$quotEntranceData['ticketAdultCost'].'",ticketchildCost="'.$quotEntranceData['ticketchildCost'].'",ticketinfantCost="'.$quotEntranceData['ticketinfantCost'].'",entranceType="'.$quotEntranceData['entranceType'].'",transferType="'.$quotEntranceData['transferType'].'",adultCost="'.$quotEntranceData['adultCost'].'",childCost="'.$quotEntranceData['childCost'].'",infantCost="'.$quotEntranceData['infantCost'].'",detail="'.$quotEntranceData['detail'].'",vehicleCost="'.$quotEntranceData['vehicleCost'].'",noOfVehicles="'.$quotEntranceData['noOfVehicles'].'",currencyId="'.$quotEntranceData['currencyId'].'",currencyValue="'.$quotEntranceData['currencyValue'].'",entranceQuotatoinType="'.$quotEntranceData['entranceQuotatoinType'].'",pickupTime="'.$quotEntranceData['pickupTime'].'",pickupFrom="'.$quotEntranceData['pickupFrom'].'",duration="'.$quotEntranceData['duration'].'",vehicleMaxPax="'.$quotEntranceData['vehicleMaxPax'].'",adMarkup="'.$quotEntranceData['adMarkup'].'",chMarkup="'.$quotEntranceData['chMarkup'].'",remark="'.$quotEntranceData['remark'].'",confirmation="'.$quotEntranceData['confirmation'].'",tourManager="'.$quotEntranceData['tourManager'].'",guideCost="'.$quotEntranceData['guideCost'].'",queryId="'.$lastQueryId.'",markupType="'.$quotEntranceData['markupType'].'",markupCost="'.$quotEntranceData['markupCost'].'",taxType="'.$quotEntranceData['taxType'].'",gstTax="'.$quotEntranceData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"'; 
					$entQuoteId = addlistinggetlastid('quotationEntranceMaster',$transfernamevalue);
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$entQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="entrance",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
					
					$c1="";
					$c1=GetPageRecord('*','quotationEntranceTimelineDetails','  hotelQuoteId="'.$quotEntranceData['id'].'"');  
					if(mysqli_num_rows($c1)>0){
						$transferTimelineData=mysqli_fetch_array($c1);
		
						 $namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",hotelQuoteId="'.$entQuoteId.'",supplierId="'.$transferTimelineData['supplierId'].'",startTime="'.$transferTimelineData['startTime'].'",endTime="'.$transferTimelineData['endTime'].'",pickupTime="'.$transferTimelineData['pickupTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'"';
						 $entraceTimeId = addlistinggetlastid('quotationEntranceTimelineDetails',$namevalue);
		
					}
				}

				// Quoatation Ferry
				$b=GetPageRecord('*','quotationFerryMaster','quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="ferry" order by serviceId asc) order by id asc');
				while($ferryTranfer=mysqli_fetch_array($b)){
					$endFerryId= '';
					if($_POST['isFixDeparture']==='yes'){
						$adultPax = $ferryTranfer['adultPax'];
						$childPax = $ferryTranfer['childPax'];
						$infantPax = $ferryTranfer['infantPax'];
					}
					$ferrynamevalue ='ferryNameId="'.$ferryTranfer['ferryNameId'].'",serviceid="'.$ferryTranfer['serviceid'].'",quotationId="'.$lastQuotationId.'",destinationId="'.$ferryTranfer['destinationId'].'",supplierId="'.$ferryTranfer['supplierId'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",ferryClass="'.$ferryTranfer['ferryClass'].'",adultCost="'.$ferryTranfer['adultCost'].'",childCost="'.$ferryTranfer['childCost'].'",infantCost="'.$ferryTranfer['infantCost'].'",ferryCost="'.$ferryTranfer['ferryCost'].'",processingfee="'.$ferryTranfer['processingfee'].'",miscCost="'.$ferryTranfer['miscCost'].'",currencyId="'.$ferryTranfer['currencyId'].'",currencyValue="'.$ferryTranfer['currencyValue'].'",pickupTime="'.$ferryTranfer['pickupTime'].'",dropTime="'.$ferryTranfer['dropTime'].'",remark="'.$ferryTranfer['remark'].'",rateId="'.$ferryTranfer['rateId'].'",timeId="'.$ferryTranfer['timeId'].'",queryId="'.$lastQueryId.'",markupType="'.$ferryTranfer['markupType'].'",markupCost="'.$ferryTranfer['markupCost'].'",taxType="'.$ferryTranfer['taxType'].'",gstTax="'.$ferryTranfer['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
					$endFerryId = addlistinggetlastid('quotationFerryMaster',$ferrynamevalue);

					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$endFerryId.'",quotationId="'.$lastQuotationId.'",serviceType="ferry",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
					
					}

		
				$b="";
				$b=GetPageRecord('*',_QUOTATION_INBOUND_MEAL_PLAN_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="mealplan" order by serviceId asc) order by id asc');
				while($quotMealPlanData=mysqli_fetch_array($b)){
					$mealQuoteId = ''; 
					if($_POST['isFixDeparture']==='yes'){
						$adultPax = $quotMealPlanData['adultPax'];
						$childPax = $quotMealPlanData['childPax'];
						$infantPax = $quotMealPlanData['infantPax'];
					}
					$rstnamevalue ='mealPlanName="'.$quotMealPlanData['mealPlanName'].'",mealPlanNameId="'.$quotMealPlanData['mealPlanNameId'].'",quotationId="'.$lastQuotationId.'",dateMealPlan="'.$quotMealPlanData['dateMealPlan'].'",adultCost="'.$quotMealPlanData['adultCost'].'",childCost="'.$quotMealPlanData['childCost'].'",infantCost="'.$quotMealPlanData['infantCost'].'",groupCost="'.$quotMealPlanData['groupCost'].'",mealPlanCity="'.$quotMealPlanData['mealPlanCity'].'",mealType="'.$quotMealPlanData['mealType'].'",destinationId="'.$quotMealPlanData['destinationId'].'",fromDate="'.$srDaysDate.'",currencyId="'.$quotMealPlanData['currencyId'].'",currencyValue="'.$quotMealPlanData['currencyValue'].'",toDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",markupType="'.$quotMealPlanData['markupType'].'",markupCost="'.$quotMealPlanData['markupCost'].'",taxType="'.$quotMealPlanData['taxType'].'",gstTax="'.$quotMealPlanData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"'; 
					$mealQuoteId = addlistinggetlastid(_QUOTATION_INBOUND_MEAL_PLAN_MASTER_,$rstnamevalue);

					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$mealQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="mealplan",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
		
				}
		 

				$b="";
				$b=GetPageRecord('*',_QUOTATION_FLIGHT_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="flight" order by serviceId asc) order by id asc');
				while($quotFlightData=mysqli_fetch_array($b)){
					$flightQuoteId = '';
					if($_POST['isFixDeparture']==='yes'){
						$adultPax = $quotFlightData['adultPax'];
						$childPax = $quotFlightData['childPax'];
						$infantPax = $quotFlightData['infantPax'];
					}
					$transfernamevalue ='fromDate="'.$srDaysDate.'",quotationId="'.$lastQuotationId.'",toDate="'.$srDaysDate.'",adultCost="'.$quotFlightData['adultCost'].'",childCost="'.$quotFlightData['childCost'].'",infantCost="'.$quotFlightData['infantCost'].'",flightId="'.$quotFlightData['flightId'].'",arrivalTo="'.$quotFlightData['arrivalTo'].'",departureFrom="'.$quotFlightData['departureFrom'].'",departureDate="'.$quotFlightData['departureDate'].'",arrivalDate="'.$quotFlightData['arrivalDate'].'",departureTime="'.$quotFlightData['departureTime'].'",arrivalTime="'.$quotFlightData['arrivalTime'].'",destinationId="'.$quotFlightData['destinationId'].'",flightNumber="'.$quotFlightData['flightNumber'].'",flightClass="'.$quotFlightData['flightClass'].'",queryId="'.$lastQueryId.'",markupType="'.$quotFlightData['markupType'].'",markupCost="'.$quotFlightData['markupCost'].'",taxType="'.$quotFlightData['taxType'].'",gstTax="'.$quotFlightData['gstTax'].'",dayId="'.$adddays.'",currencyId="'.$quotFlightData['currencyId'].'",currencyValue="'.$quotFlightData['currencyValue'].'",isGuestType="'.$quotFlightData['isGuestType'].'",adult="'.$quotFlightData['adult'].'",child="'.$quotFlightData['child'].'",infant="'.$quotFlightData['infant'].'",isLocalEscort="'.$quotFlightData['isLocalEscort'].'",isForeignEscort="'.$quotFlightData['isForeignEscort'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
					$flightQuoteId = addlistinggetlastid(_QUOTATION_FLIGHT_MASTER_,$transfernamevalue);
					
					$c1 ='';
					$c1=GetPageRecord('*','flightTimeLineMaster',' flightQuoteId="'.$quotFlightData['id'].'" and quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'"');
					if(mysqli_num_rows($c1)>0){
					$timeData = mysqli_fetch_assoc($c1);
						$timeValue = 'quotationId="'.$lastQuotationId.'",flightQuoteId="'.$flightQuoteId.'",dayId="'.$adddays.'",flightId="'.$timeData['flightId'].'",departureDate="'.$timeData['departureDate'].'",departureTime="'.$timeData['departureTime'].'",arrivalDate="'.$timeData['arrivalDate'].'",arrivalTime="'.$timeData['arrivalTime'].'",status="'.$timeData['status'].'",deletestatus="'.$timeData['deletestatus'].'",remark="'.$timeData['remark'].'",queryId="'.$lastQueryId.'"';
						$addTime = addlistinggetlastid('flightTimeLineMaster',$timeValue);
					}

					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$flightQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="flight",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
		
				}
		
				$b="";
				$b=GetPageRecord('*',_QUOTATION_TRAINS_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="train" order by serviceId asc) order by id asc');
				while($quotTrainData=mysqli_fetch_array($b)){
					$trainQuoteId = '';
					if($_POST['isFixDeparture']==='yes'){
						$adultPax = $quotTrainData['adultPax'];
						$childPax = $quotTrainData['childPax'];
						$infantPax = $quotTrainData['infantPax'];
					}
					$transfernamevalue ='fromDate="'.$srDaysDate.'",quotationId="'.$lastQuotationId.'",toDate="'.$srDaysDate.'",adultCost="'.$quotTrainData['adultCost'].'",childCost="'.$quotTrainData['childCost'].'",infantCost="'.$quotTrainData['infantCost'].'",trainId="'.$quotTrainData['trainId'].'",arrivalTo="'.$quotTrainData['arrivalTo'].'",departureFrom="'.$quotTrainData['departureFrom'].'",departureDate="'.$quotTrainData['departureDate'].'",arrivalDate="'.$quotTrainData['arrivalDate'].'",departureTime="'.$quotTrainData['departureTime'].'",arrivalTime="'.$quotTrainData['arrivalTime'].'",journeyType="'.$quotTrainData['journeyType'].'",destinationId="'.$quotTrainData['destinationId'].'",trainNumber="'.$quotTrainData['trainNumber'].'",trainClass="'.$quotTrainData['trainClass'].'",queryId="'.$lastQueryId.'",markupType="'.$quotTrainData['markupType'].'",markupCost="'.$quotTrainData['markupCost'].'",taxType="'.$quotTrainData['taxType'].'",gstTax="'.$quotTrainData['gstTax'].'",dayId="'.$adddays.'",currencyId="'.$quotTrainData['currencyId'].'",currencyValue="'.$quotTrainData['currencyValue'].'",isGuestType="'.$quotTrainData['isGuestType'].'",isLocalEscort="'.$quotTrainData['isLocalEscort'].'",isForeignEscort="'.$quotTrainData['isForeignEscort'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';
					$trainQuoteId = addlistinggetlastid(_QUOTATION_TRAINS_MASTER_,$transfernamevalue);
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$trainQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="train",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
				}
		
		
				$b='';
				$b=GetPageRecord('*',_QUOTATION_EXTRA_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="additional" order by serviceId asc) order by id asc');
				if(mysqli_num_rows($b)>0){
		
					while($quotExtraData=mysqli_fetch_array($b)){
						$extraQuoteId = '';
						if($_POST['isFixDeparture']==='yes'){
							$adultPax = $quotExtraData['adultPax'];
							$childPax = $quotExtraData['childPax'];
							$infantPax = $quotExtraData['infantPax'];
						}
						$transfernamevalue ='name="'.$quotExtraData['name'].'",dateExtra="'.$quotExtraData['dateExtra'].'",queryId="'.$lastQueryId.'",adultCost="'.$quotExtraData['adultCost'].'",childCost="'.$quotExtraData['childCost'].'",infantCost="'.$quotExtraData['infantCost'].'",groupCost="'.$quotExtraData['groupCost'].'",destinationId="'.$quotExtraData['destinationId'].'",quotationId="'.$lastQuotationId.'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",currencyId="'.$quotExtraData['currencyId'].'",currencyValue="'.$quotExtraData['currencyValue'].'",additionalId="'.$quotExtraData['additionalId'].'",markupType="'.$quotExtraData['markupType'].'",markupCost="'.$quotExtraData['markupCost'].'",taxType="'.$quotExtraData['taxType'].'",gstTax="'.$quotExtraData['gstTax'].'",costType="'.$quotExtraData['costType'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",dayId="'.$adddays.'"';
						$extraQuoteId = addlistinggetlastid(_QUOTATION_EXTRA_MASTER_,$transfernamevalue);
		
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$extraQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="additional",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
		
					}
				}
		
				$b='';
				$b=GetPageRecord('*','quotationModeMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" order by id asc');
				if(mysqli_num_rows($b)>0){
					$quotModeData=mysqli_fetch_array($b);
					$modevalue ='name="'.$quotModeData['name'].'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'"';
					$modeId = addlistinggetlastid('quotationModeMaster',$modevalue);
		
				}
				
				$nodays++;
			}
			
					// New quotation days loop end
			// For Multiple services Quotation
			if($quotationData['flightRequired']==2){
				$b=GetPageRecord('*',_QUOTATION_FLIGHT_MASTER_,' quotationId="'.$quotationId.'" and dayId="0" and isFlightTaken="yes" and id in (select serviceId from quotationItinerary where serviceType="flight" order by serviceId asc) order by id asc');
				if(mysqli_num_rows($b)){
				while($transferRes=mysqli_fetch_array($b)){
					
					$addHotel = '';
					$transfernamevalue ='fromDate="'.$transferRes['fromDate'].'",quotationId="'.$lastQuotationId.'",toDate="'.$transferRes['toDate'].'",adultCost="'.$transferRes['adultCost'].'",childCost="'.$transferRes['childCost'].'",infantCost="'.$transferRes['infantCost'].'",flightId="'.$transferRes['flightId'].'",arrivalTo="'.$transferRes['arrivalTo'].'",departureFrom="'.$transferRes['departureFrom'].'",departureDate="'.$transferRes['departureDate'].'",arrivalDate="'.$transferRes['arrivalDate'].'",departureTime="'.$transferRes['departureTime'].'",arrivalTime="'.$transferRes['arrivalTime'].'",destinationId="'.$transferRes['destinationId'].'",flightNumber="'.$transferRes['flightNumber'].'",flightClass="'.$transferRes['flightClass'].'",isGuestType="'.$transferRes['isGuestType'].'",isLocalEscort="'.$transferRes['isLocalEscort'].'",markupType="'.$transferRes['markupType'].'",markupCost="'.$transferRes['markupCost'].'",currencyId="'.$transferRes['currencyId'].'",currencyValue="'.$transferRes['currencyValue'].'",adult="'.$transferRes['adult'].'",child="'.$transferRes['child'].'",infant="'.$transferRes['infant'].'",taxType="'.$transferRes['taxType'].'",gstTax="'.$transferRes['gstTax'].'",isForeignEscort="'.$transferRes['isForeignEscort'].'",totalAdultCost="'.$transferRes['totalAdultCost'].'",adultTax="'.$transferRes['adultTax'].'",totalChildCost="'.$transferRes['totalChildCost'].'",childTax="'.$transferRes['childTax'].'",totalInfantCost="'.$transferRes['totalInfantCost'].'",infantTax="'.$transferRes['infantTax'].'",cancellationPolicy="'.$transferRes['cancellationPolicy'].'",isFlightTaken="'.$transferRes['isFlightTaken'].'",supplierId="'.$transferRes['supplierId'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",queryId="'.$lastQueryId.'"';
					$addHotel = addlistinggetlastid(_QUOTATION_FLIGHT_MASTER_,$transfernamevalue);

					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$addHotel.'",quotationId="'.$lastQuotationId.'",serviceType="flight",startDate="'.$transferRes['fromDate'].'",endDate="'.$transferRes['fromDate'].'"';
					addlistinggetlastid('quotationItinerary',$namevalue);

				}
				}
			}

			$b='';
			$b=GetPageRecord('*',_QUOTATION_VISA_MASTER_,' quotationId="'.$quotationId.'" and id in (select serviceId from quotationItinerary where serviceType="visa" order by serviceId asc) order by id asc');

			if(mysqli_num_rows($b)>0 && $quotationData['visaRequired']==2){

				while($visaQuotData=mysqli_fetch_array($b)){
					$lastId = ''; 
					
					$visanamevalue ='fromDate="'.$visaQuotData['fromDate'].'",quotationId="'.$lastQuotationId.'",toDate="'.$visaQuotData['toDate'].'",adultCost="'.$visaQuotData['adultCost'].'",childCost="'.$visaQuotData['childCost'].'",infantCost="'.$visaQuotData['infantCost'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",serviceid="'.$visaQuotData['serviceid'].'",name="'.$visaQuotData['name'].'",rateId="'.$visaQuotData['rateId'].'",visaTypeId="'.$visaQuotData['visaTypeId'].'",supplierId="'.$visaQuotData['supplierId'].'",startDate="'.$visaQuotData['startDate'].'",currencyId="'.$visaQuotData['currencyId'].'",currencyValue="'.$visaQuotData['currencyValue'].'",gstTax="'.$visaQuotData['gstTax'].'",queryId="'.$lastQueryId.'",markupType="'.$visaQuotData['markupType'].'",processingFee="'.$visaQuotData['processingFee'].'",vfsCharges="'.$visaQuotData['vfsCharges'].'",embassyFee="'.$visaQuotData['embassyFee'].'",status="'.$visaQuotData['status'].'",deletestatus="'.$visaQuotData['deletestatus'].'",visaDate="'.$visaQuotData['visaDate'].'",visaCountryId="'.$visaQuotData['visaCountryId'].'",visaValidity="'.$visaQuotData['visaValidity'].'",entryType="'.$visaQuotData['entryType'].'"';

					$lastId = addlistinggetlastid(_QUOTATION_VISA_MASTER_,$visanamevalue);  
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$lastId.'",quotationId="'.$lastQuotationId.'",serviceType="visa",startDate="'.$visaQuotData['fromDate'].'",endDate="'.$visaQuotData['fromDate'].'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
				}
			}

			 
			$b='';
			$b=GetPageRecord('*',_QUOTATION_INSURANCE_MASTER_,' quotationId="'.$quotationId.'" and id in (select serviceId from quotationItinerary where serviceType="insurance" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0 && $quotationData['insuranceRequired']==2){

				while($insQuotData=mysqli_fetch_array($b)){
					$lastId = ''; 
				
					$insnamevalue ='fromDate="'.$insQuotData['fromDate'].'",quotationId="'.$lastQuotationId.'",toDate="'.$insQuotData['toDate'].'",adultCost="'.$insQuotData['adultCost'].'",childCost="'.$insQuotData['childCost'].'",infantCost="'.$insQuotData['infantCost'].'",serviceid="'.$insQuotData['serviceid'].'",name="'.$insQuotData['name'].'",rateId="'.$insQuotData['rateId'].'",insuranceTypeId="'.$insQuotData['insuranceTypeId'].'",supplierId="'.$insQuotData['supplierId'].'",startDate="'.$insQuotData['startDate'].'",currencyId="'.$insQuotData['currencyId'].'",currencyValue="'.$insQuotData['currencyValue'].'",gstTax="'.$insQuotData['gstTax'].'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",queryId="'.$lastQueryId.'",markupType="'.$insQuotData['markupType'].'",processingFee="'.$insQuotData['processingFee'].'",status="'.$insQuotData['status'].'",deletestatus="'.$insQuotData['deletestatus'].'",insuranceStartDate="'.$insQuotData['insuranceStartDate'].'",insuranceEndDate="'.$insQuotData['insuranceEndDate'].'",countryId="'.$insQuotData['countryId'].'"';

					$lastId = addlistinggetlastid(_QUOTATION_INSURANCE_MASTER_,$insnamevalue);  
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$lastId.'",quotationId="'.$lastQuotationId.'",serviceType="insurance",startDate="'.$insQuotData['fromDate'].'",endDate="'.$insQuotData['fromDate'].'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
				}

			}
					

			// Transfer service Copy
			if($quotationData['transferRequired']==2){
				$b=''; 
				$b=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' quotationId="'.$quotationId.'" and dayId="0" and isTransferTaken="yes" and id in (select serviceId from quotationItinerary where serviceType="transfer" order by serviceId asc) order by id asc');
				if(mysqli_num_rows($b)>0){ 
					while($transferRes=mysqli_fetch_array($b)){
						
						$bb2='';
						$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1');
						$paxSlabData2=mysqli_fetch_array($bb2);
						$totalPaxId = $paxSlabData2['id']; 

						$transfernamevalue ='fromDate="'.$transferRes['fromDate'].'",toDate="'.$transferRes['toDate'].'",queryId="'.$maintable['queryId'].'",quotationId="'.$lastQuotationId.'",destinationId="'.$transferRes['destinationId'].'",transferNameId="'.$transferRes['transferNameId'].'",supplierId="'.$transferRes['supplierId'].'",vehicleId="'.$transferRes['vehicleId'].'",vehicleModelId="'.$transferRes['vehicleModelId'].'",currencyId="'.$transferRes['currencyId'].'",currencyValue="'.$transferRes['currencyValue'].'",transferToId="'.$transferRes['transferToId'].'",transferFromId="'.$transferRes['transferFromId'].'",transferType="'.$transferRes['transferType'].'",adultCost="'.$transferRes['adultCost'].'",childCost="'.$transferRes['childCost'].'",infantCost="'.$transferRes['infantCost'].'",detail="'.$transferRes['detail'].'",vehicleCost="'.$transferRes['vehicleCost'].'",transferQuotatoinType="'.$transferRes['transferQuotatoinType'].'",dmcId="'.$transferRes['dmcId'].'",pickupFrom="'.$transferRes['pickupFrom'].'",pickupTime="'.$transferRes['pickupTime'].'",duration="'.$transferRes['duration'].'",vehicleMaxPax="'.$transferRes['vehicleMaxPax'].'",adMarkup="'.$transferRes['adMarkup'].'",chMarkup="'.$transferRes['chMarkup'].'",vehMarkup="'.$transferRes['vehMarkup'].'",remark="'.$transferRes['remark'].'",confirmation="'.$transferRes['confirmation'].'",tourManager="'.$transferRes['tourManager'].'",driverId="'.$transferRes['driverId'].'",vehicleType="'.$transferRes['vehicleType'].'",parkingFee="'.$transferRes['parkingFee'].'",representativeEntryFee="'.$transferRes['representativeEntryFee'].'",assistance="'.$transferRes['assistance'].'",guideAllowance="'.$transferRes['guideAllowance'].'",interStateAndToll="'.$transferRes['interStateAndToll'].'",miscellaneous="'.$transferRes['miscellaneous'].'",tariffId="'.$transferRes['tariffId'].'",markupType="'.$transferRes['markupType'].'",markupCost="'.$transferRes['markupCost'].'",taxType="'.$transferRes['taxType'].'",gstTax="'.$transferRes['gstTax'].'",transferName="'.$transferRes['transferName'].'",noOfDays="'.$transferRes['noOfDays'].'",serviceType="'.$transferRes['serviceType'].'",costType="'.$transferRes['costType'].'",distance="'.$transferRes['distance'].'",noOfVehicles="'.$transferRes['noOfVehicles'].'",totalPax="'.$totalPaxId.'",isGuestType="'.$transferRes['isGuestType'].'",isTransferTaken="'.$transferRes['isTransferTaken'].'"';

						$addHotel = addlistinggetlastid(_QUOTATION_TRANSFER_MASTER_,$transfernamevalue);
						 
						$c1=GetPageRecord('*','quotationTransferTimelineDetails','transferQuoteId="'.$transferRes['id'].'" ');
						if(mysqli_num_rows($c1)>0){
							$transferTimelineData=mysqli_fetch_array($c1);

								$namevalue ='quotationId="'.$add.'",dayId="'.$adddays.'",supplierId="'.$transferTimelineData['supplierId'].'",transferQuoteId="'.$addHotel.'",arrivalFrom="'.$transferTimelineData['arrivalFrom'].'",trainName="'.$transferTimelineData['trainName'].'",trainNumber="'.$transferTimelineData['trainNumber'].'",flightName="'.$transferTimelineData['flightName'].'",flightNumber="'.$transferTimelineData['flightNumber'].'",vehicleName="'.$transferTimelineData['vehicleName'].'",airportName="'.$transferTimelineData['airportName'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'",VehicleModel="'.$transferTimelineData['VehicleModel'].'",arrivalTime="'.$transferTimelineData['arrivalTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",mode="'.$transferTimelineData['mode'].'",pickupTime="'.$transferTimelineData['pickupTime'].'"';
			          
			          			$hotelSupHot = addlistinggetlastid('quotationTransferTimelineDetails',$namevalue);
						}

						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$addHotel.'",quotationId="'.$lastQuotationId.'",serviceType="'.$transferRes['serviceType'].'",startDate="'.$transferRes['fromDate'].'",endDate="'.$transferRes['fromDate'].'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
					}
				}
			}
			
				 

			$b='';
			$b=GetPageRecord('*','quotationServiceMarkup',' quotationId="'.$quotationId.'" order by id asc');
			if(mysqli_num_rows($b)>0){
				$transferRes=mysqli_fetch_array($b);
				$addHotel = '';
				$modevalue = ' markupCost="'.$transferRes['markupCost'].'", curren="'.$transferRes['curren'].'", quotationId="'.$lastQuotationId.'", package="'.$transferRes['package'].'", hotel="'.$transferRes['hotel'].'", guide="'.$transferRes['guide'].'", activity="'.$transferRes['activity'].'", entrance="'.$transferRes['entrance'].'", transfer="'.$transferRes['transfer'].'", train="'.$transferRes['train'].'",flight="'.$transferRes['flight'].'", restaurant="'.$transferRes['restaurant'].'",ferry="'.$transferRes['ferry'].'",visa="'.$transferRes['visa'].'",passport="'.$transferRes['passport'].'",insurance="'.$transferRes['insurance'].'",other="'.$transferRes['other'].'",packageMarkupType="'.$transferRes['packageMarkupType'].'",hotelMarkupType="'.$transferRes['hotelMarkupType'].'",guideMarkupType="'.$transferRes['guideMarkupType'].'",activityMarkupType="'.$transferRes['activityMarkupType'].'",entranceMarkupType="'.$transferRes['entranceMarkupType'].'",transferMarkupType="'.$transferRes['transferMarkupType'].'",trainMarkupType="'.$transferRes['trainMarkupType'].'",flightMarkupType="'.$transferRes['flightMarkupType'].'",restaurantMarkupType="'.$transferRes['restaurantMarkupType'].'",ferryMarkupType="'.$transferRes['ferryMarkupType'].'",visaMarkupType="'.$transferRes['visaMarkupType'].'",passportMarkupType="'.$transferRes['passportMarkupType'].'",insuranceMarkupType="'.$transferRes['insuranceMarkupType'].'",otherMarkupType="'.$transferRes['otherMarkupType'].'", status="'.$transferRes['status'].'"';
				$markup = addlistinggetlastid('quotationServiceMarkup',$modevalue);
			}

			$getPackageRateQuery="";
			$getPackageRateQuery=GetPageRecord('*','packageWiseRateMaster',' quotationId="'.$quotationId.'"');
			if(mysqli_num_rows($getPackageRateQuery) > 0){
			    while($transferRes=mysqli_fetch_array($getPackageRateQuery)){
					
				$addHotel = '';
				$modevalue = 'queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",singleCost="'.$transferRes['singleCost'].'",doubleCost="'.$transferRes['doubleCost'].'",tripleCost="'.$transferRes['tripleCost'].'",twinCost="'.$transferRes['twinCost'].'",quadCost="'.$transferRes['quadCost'].'",sixBedCost="'.$transferRes['sixBedCost'].'",eightBedCost="'.$transferRes['eightBedCost'].'",tenBedCost="'.$transferRes['tenBedCost'].'",teenBedCost="'.$transferRes['teenBedCost'].'",extraBedACost="'.$transferRes['extraBedACost'].'",childwithbedCost="'.$transferRes['childwithbedCost'].'",childwithoutbedCost="'.$transferRes['childwithoutbedCost'].'",infantBedCost="'.$transferRes['infantBedCost'].'",guideA="'.$transferRes['guideA'].'",activityA="'.$transferRes['activityA'].'",entranceA="'.$transferRes['entranceA'].'",enrouteA="'.$transferRes['enrouteA'].'",transferA="'.$transferRes['transferA'].'",trainA="'.$transferRes['trainA'].'",flightA="'.$transferRes['flightA'].'",restaurantA="'.$transferRes['restaurantA'].'",otherA="'.$transferRes['otherA'].'",guideC="'.$transferRes['guideC'].'",activityC="'.$transferRes['activityC'].'",entranceC="'.$transferRes['entranceC'].'",enrouteC="'.$transferRes['enrouteC'].'",transferC="'.$transferRes['transferC'].'",trainC="'.$transferRes['trainC'].'",flightC="'.$transferRes['flightC'].'",restaurantC="'.$transferRes['restaurantC'].'",otherC="'.$transferRes['otherC'].'",supplierId="'.$transferRes['supplierId'].'",currencyId="'.$transferRes['currencyId'].'",currencyValue="'.$transferRes['currencyValue'].'",singleBasis="'.$transferRes['singleBasis'].'",doubleBasis="'.$transferRes['doubleBasis'].'",tripleBasis="'.$transferRes['tripleBasis'].'",twinBasis="'.$transferRes['twinBasis'].'",quadBasis="'.$transferRes['quadBasis'].'",sixBedBasis="'.$transferRes['sixBedBasis'].'",eightBedBasis="'.$transferRes['eightBedBasis'].'",tenBedBasis="'.$transferRes['tenBedBasis'].'",teenBedBasis="'.$transferRes['teenBedBasis'].'",extraBedABasis="'.$transferRes['extraBedABasis'].'",childwithbedBasis="'.$transferRes['childwithbedBasis'].'",childwithoutbedBasis="'.$transferRes['childwithoutbedBasis'].'",infantBedBasis="'.$transferRes['infantBedBasis'].'",loopNum="'.$transferRes['loopNum'].'",hotelTypeId="'.$transferRes['hotelTypeId'].'",gstTax="'.$transferRes['gstTax'].'",serviceTax="'.$transferRes['serviceTax'].'",serviceType="'.$transferRes['serviceType'].'",serviceName="'.$transferRes['serviceName'].'",markupType="'.$transferRes['markupType'].'",markupValue="'.$transferRes['markupValue'].'",costTypeId="'.$transferRes['costTypeId'].'",adultPax="'.$adultPax.'",adultCost="'.$transferRes['adultCost'].'",ChildCost="'.$transferRes['ChildCost'].'",ChildPax="'.$childPax.'",infantCost="'.$transferRes['infantCost'].'",infantPax="'.$infantPax.'",groupCost="'.$transferRes['groupCost'].'",ROE="'.$transferRes['ROE'].'"';
				$addHotel = addlistinggetlastid('packageWiseRateMaster',$modevalue);
				}
			} 

			$c12=GetPageRecord('*','quotationAdditionalMaster',' quotationId="'.$quotationId.'" order by id asc');
			if( mysqli_num_rows($c12) > 0){
		
				updatelisting(_QUOTATION_MASTER_,' isAddExp="1"','id="'.$lastQuotationId.'"');
		
				while($quotAdditionalData=mysqli_fetch_array($c12)){
		
					$namevalue ='additionalId="'.$quotAdditionalData['additionalId'].'",adultCost="'.round($quotAdditionalData['adultCost']).'",childCost="'.round($quotAdditionalData['childCost']).'",infantCost="'.round($quotAdditionalData['infantCost']).'",quotationId="'.$lastQuotationId.'",serviceType="'.($quotAdditionalData['serviceType']).'",destinationId="'.($quotAdditionalData['destinationId']).'"';
					addlistinggetlastid('quotationAdditionalMaster',$namevalue);
		
				}
			}
		
			
		} 				
	
	}else{
		$queryDataq = GetPageRecord('*',_QUERY_MASTER_,'id="'.clean($_REQUEST['queryId']).'"');
		$queryData=mysqli_fetch_array($queryDataq);
		$isPackage = 0;
		if($queryData['moduleType'] == 4){
			$isPackage = 1;
		}
		if($queryData['moduleType'] == 3){
			$isFD = 1;
		}
		 
		if($queryData['moduleType'] == 2 || $queryData['moduleType'] == 3){
			$where1 ='id="'.clean($_REQUEST['queryId']).'"';
			$namevalue1 ='subject="'.addslashes($quotationSubject).'",sglRoom="'.$quotationnewSingle.'",dblRoom="'.$quotationnewDouble.'",tplRoom="'.$quotationnewTriple.'",twinRoom="'.$quotationnewTwin.'",cwbRoom="'.$quotationnewEBedC.'",cnbRoom="'.$quotationnewENBedC.'",extraNoofBed="'.$quotationnewEBedA.'",adult="'.$quotationTotalPAX.'",quadNoofRoom="'.$quotationnewQuad.'",sixNoofBedRoom="'.$quotationnewSixBed.'",eightNoofBedRoom="'.$quotationnewEightBed.'",tenNoofBedRoom="'.$quotationnewTenBed.'",teenNoofRoom="'.$quotationnewTeenRoom.'"';
			$updateQuery = updatelisting(_QUERY_MASTER_,$namevalue1,$where1);
		}
		
		
		$rsp1=GetPageRecord('quotationNo',_QUOTATION_MASTER_,' queryId="'.clean($_REQUEST['queryId']).'" order by quotationNo desc');
		$quotationNo=mysqli_fetch_array($rsp1);
		if($quotationNo['quotationNo']!=''){
			//this is greater than first
			$letterAscii = ord($quotationNo['quotationNo']);
			$letterAscii++;
			$quotationNo = chr($letterAscii);
		}else{
			$quotationNo = "A";
		}
		
		$q_token = mt_rand(10000000, 99999999);
		// add new quotation  
		 $namevalue ='deletestatus=0,isUni_Mark=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",quotationType="'.$quotationType.'",quotationNo="'.$quotationNo.'",quotationSubject="'.addslashes($quotationSubject).'",hotCategory="'.$hotCategory.'",hotelType="'.$hotelType.'",adult="'.$quotationTotalPAX.'",sglRoom="'.$quotationnewSingle.'",dblRoom="'.$quotationnewDouble.'",tplRoom="'.$quotationnewTriple.'",twinRoom="'.$quotationnewTwin.'",childwithNoofBed="'.$quotationnewEBedC.'",childwithoutNoofBed="'.$quotationnewENBedC.'",extraNoofBed="'.$quotationnewEBedA.'",queryType="'.$qtype.'",isPackage="'.$isPackage.'",isFD="'.$isFD.'",calculationType="'.$calculationType.'",slabAndRoomType="'.$slabAndRoomType.'",gstType=1,packageSupplier="'.$queryData['packageSupplier'].'",q_token="'.encode($q_token).'"';
		$lastQuotationId = addlistinggetlastid(_QUOTATION_MASTER_,$namevalue);
		// die("tesjdjjd111");

		$rsp2=""; 
		$rsp2=GetPageRecord('id',_QUOTATION_MASTER_,' queryId="'.$_REQUEST['queryId'].'" and status=1 ');  

		if($lastQuotationId>0 && mysqli_num_rows($rsp2) == 0 && $queryData['queryStatus'] <> 3){ 
			updatelisting(_QUERY_MASTER_,'queryStatus=5,quotationDate="'.date('Y-m-d').'"','id="'.$_REQUEST['queryId'].'"');
		}
 
		//COPY PACKAGE QYERY DAYS PLANS TO DAYS TABLE
		$rs="";
		$rs=GetPageRecord('*','packageQueryDays',' queryId="'.clean($_REQUEST['queryId']).'" order by srdate asc');
		$keyWordDaysC = mysqli_num_rows($rs);
		while($QueryDaysData=mysqli_fetch_array($rs)){
			//make keyword with dstin
			$destD=mysqli_fetch_array(GetPageRecord('name',_DESTINATION_MASTER_,'id="'.$QueryDaysData['cityId'].'"'));
			$keyWordCityNameVal .= strtolower($destD['name']).'/';
			//copy to data to quotation days table
			$namevalue =' queryId="'.$QueryDaysData['queryId'].'",cityId="'.$QueryDaysData['cityId'].'",srdate="'.$QueryDaysData['srdate'].'",quotationId="'.$lastQuotationId.'"';
			addlistinggetlastid('newQuotationDays',$namevalue);
		}
		
			$destDurKeyword = $keyWordCityNameVal.';'.$keyWordDaysC.';'.$keyWordQuotType.'/'.$keyWordHotCat;
		
		if($_REQUEST['queryId']!=0 && $_REQUEST['queryId']!=''){
			$select='';
			$where='';
			$rs='';
			$select='*';
			$id=clean($_REQUEST['queryId']);
			$where='id="'.$id.'"';
			$rs=GetPageRecord($select,_QUERY_MASTER_,$where);
			$resultpage=mysqli_fetch_array($rs);
			$editassignTo=clean($resultpage['assignTo']);
			$editcompanyId=clean($resultpage['companyId']);
			$edittravelDate=clean($resultpage['travelDate']);
			$editfromDate=clean($resultpage['fromDate']);
			$edittoDate=clean($resultpage['toDate']);
			$editofficeBranch=clean($resultpage['officeBranch']);
			$destinationId=clean($resultpage['destinationId']);
			$editadult=clean($resultpage['adult']);
			$editchild=clean($resultpage['child']);
			$editnight=clean($resultpage['night']);
			$edittourType=clean($resultpage['tourType']);
			$editdescription=clean($resultpage['description']);
			$editguest1=clean($resultpage['guest1']);
			$editguest2=clean($resultpage['guest2']);
			$editcategoryId=clean($resultpage['categoryId']);
			$editqueryCloseDetails=clean($resultpage['queryCloseDetails']);
			$editqueryCloseDate=clean($resultpage['queryCloseDate']);
			$editmultiemails=clean($resultpage['multiemails']);
			$editqueryStatus=clean($resultpage['queryStatus']);
			$editattachmentFileclean=($resultpage['attachmentFile']);
			$editremark=clean($resultpage['remark']);
			$editqueryId=clean($resultpage['queryId']);
			$editsubject=clean($resultpage['subject']);
			$addedBy=clean($resultpage['addedBy']);
			$dateAdded=clean($resultpage['dateAdded']);
			$modifyBy=clean($resultpage['modifyBy']);
			$modifyDate=clean($resultpage['modifyDate']);
			$lastId=$resultpage['id'];
			$clientType=$resultpage['clientType'];
			$lastqueryidmain=$resultpage['id'];
			$fromDate=$resultpage['fromDate'];
			$toDate=$resultpage['toDate'];
			$night=$resultpage['night'];
			$multiemails=$resultpage['multiemails'];
			$occupancyType=$resultpage['occupancyType'];
			$rooms=$resultpage['rooms'];
			$sglRoom=clean($resultpage['sglRoom']);
			$dblRoom=clean($resultpage['dblRoom']);
			$tplRoom=clean($resultpage['tplRoom']);
			$twinRoom=clean($resultpage['twinRoom']);
			$editinfant=clean($resultpage['infant']);
			$childwithNoofBed=clean($resultpage['cwbRoom']);
			$childwithoutNoofBed=clean($resultpage['cnbRoom']);
			$extraNoofBed=clean($resultpage['extraNoofBed']);
			$sixNoofBedRoom=clean($resultpage['sixNoofBedRoom']);
			$eightNoofBedRoom=clean($resultpage['eightNoofBedRoom']);
			$tenNoofBedRoom=clean($resultpage['tenNoofBedRoom']);
			$teenNoofRoom=clean($resultpage['teenNoofRoom']);
			$quadNoofRoom=clean($resultpage['quadNoofRoom']);
			$onlyTFS=clean($resultpage['onlyTFS']);
			$needFlight=clean($resultpage['needFlight']);
			$needVisa=clean($resultpage['needVisa']);
			$needInsurance=clean($resultpage['needInsurance']);
			$needPassport=clean($resultpage['needPassport']);
			
			$where='id="'.$lastQuotationId.'"';
			$dateAdded=time();
			$quotationId=$lastQuotationId+1;
			// flightCostType
			$namevalue ='fromDate="'.$fromDate.'",toDate="'.$toDate.'",destinationId="'.$destinationId.'",searchKeyword="'.$destDurKeyword.'",adult="'.$editadult.'",child="'.$editchild.'",infant="'.$editinfant.'",night="'.$night.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",calculationType="'.$calculationType.'",currencyId="'.$baseCurrencyId.'",twinRoom="'.$twinRoom.'",childwithNoofBed="'.$childwithNoofBed.'",childwithoutNoofBed="'.$childwithoutNoofBed.'",extraNoofBed="'.$extraNoofBed.'",queryId="'.$_REQUEST['queryId'].'",guest1="'.$editguest1.'",quotationId="'.$quotationId.'",sixNoofBedRoom="'.$sixNoofBedRoom.'",eightNoofBedRoom="'.$eightNoofBedRoom.'",tenNoofBedRoom="'.$tenNoofBedRoom.'",teenNoofRoom="'.$teenNoofRoom.'",quadNoofRoom="'.$quadNoofRoom.'",isUni_Mark=1,deletestatus=0,onlyTFS="'.$onlyTFS.'",flightRequired="'.$needFlight.'",visaRequired="'.$needVisa.'",insuranceRequired="'.$needInsurance.'",passportRequired="'.$needPassport.'",isFD="'.$isFD.'",subName="'.$resultpage['FDCode'].'",trainRequired="'.$resultpage['needTrain'].'",transferRequired="'.$resultpage['needTransfer'].'",dayWise="'.$resultpage['dayWise'].'",travelType="'.$resultpage['travelType'].'",quotationSubject="'.$resultpage['subject'].'",leadPaxName="'.$resultpage['leadPaxName'].'"';
			$updatelist = updatelisting(_QUOTATION_MASTER_,$namevalue,$where);
			// echo 'yes updated query table';
		}
	}
  	?>
	<script>
	parent.setupbox('showpage.crm?module=quotations&view=yes&id=<?php echo encode($lastQuotationId).$ispackage; ?>');
	</script>
	<?php
	exit();
}
 
if(trim($_POST['action'])=='sendbulkmail'){
	include "config/mail.php";
	$fromemail=$_POST['bulkemailsender'];
	$mailsubject=$_POST['bulkmailsubject'];
	$maildescription=$_POST['description'];
	$ccmail='samay.debox@gmail.com';
	if($_POST['bulkemailcategory']=='200'){
		$selectl='*';
		$wherel=' deletestatus=0 order by id asc';
		$rsl=GetPageRecord($selectl,'corporateMaster',$wherel);
		while($resListingl=mysqli_fetch_array($rsl)){
		$getEmail = getPrimaryEmail($resListingl['id'],'corporate');
		send_bulk_mail($fromemail,$getEmail,$mailsubject,$maildescription,$ccmail);
		}
	}
	if($_POST['bulkemailcategory']=='201'){
		$selectl='*';
		$wherel=' deletestatus=0 order by id asc';
		$rsl=GetPageRecord($selectl,'contactsMaster',$wherel);
		while($resListingl=mysqli_fetch_array($rsl)){
		$getEmail = getPrimaryEmail($resListingl['id'],'contacts');
		send_bulk_mail($fromemail,$getEmail,$mailsubject,$maildescription,$ccmail);
		}
	}
	if($_POST['bulkemailcategory']!='201' && $_POST['bulkemailcategory']!='200'){
		$selectl='*';
		$wherel=' deletestatus=0 and queryStatus='.$_POST['bulkemailcategory'].' order by id asc';
		$rsl=GetPageRecord($selectl,'queryMaster',$wherel);
		while($resListingl=mysqli_fetch_array($rsl)){
		if($resListingl['companyType']=='1'){
		$companytype='corporate'; }else{
		$companytype='contacts';
		}
		$getEmail = getPrimaryEmail($resListingl['companyId'],$companytype);
 		send_bulk_mail($fromemail,$getEmail,$mailsubject,$maildescription,$ccmail);
		}
	}
}


// copy data to final tables
if($_REQUEST['action']=='selectedquotations' && $_REQUEST['queryid']!='' && $_REQUEST['id']!='' && $_REQUEST['status']!=''){
	
	if($_REQUEST['quotationType'] == 2){
		$finalcategory = $_REQUEST['finalcategory'];
		$quotationType = $_REQUEST['quotationType'];
		$finalcategoryQuery = " and categoryId = '".$_REQUEST['finalcategory']."'";
	}else{
		$finalcategoryQuery = $finalcategory = 0;
		$quotationType = 1;
		$finalQuery = $finalcategoryQuery = $roomSuppCateQuery = "";
	}
	
	//make un-final quotation of this query markupCost
	if($_REQUEST['tourextension'] == 1) {
 		$update = updatelisting(_QUOTATION_MASTER_,'status="'.$_REQUEST['status'].'",finalcategory="'.$finalcategory.'"','id="'.$_REQUEST['id'].'"');
	} 
	else{
		$update = updatelisting(_QUOTATION_MASTER_,'status="0",finalcategory="0"','queryId="'.$_REQUEST['queryid'].'" and status=1');
		
		// $tourIdMakeQuery=GetPageRecord('*',_QUOTATION_MASTER_,'id='.$_REQUEST['id'].'');
		// $tourIdMakeD=mysqli_fetch_array($tourIdMakeQuery);  

		// $wherel=' deletestatus=0 and MONTH(fromDate)="'.date('m',strtotime($tourIdMakeD['fromDate'])).'" and YEAR(fromDate)="'.date('Y',strtotime($tourIdMakeD['fromDate'])).'" and queryStatus=3 order by queryConfirmingTourId desc';
		// $rsl=GetPageRecord('id,queryConfirmingTourId','queryMaster',$wherel); 
		// if(mysqli_num_rows($rsl)>0){
		// 	$restti=mysqli_fetch_array($rsl);
		// 	$queryConfirmingTourId = $restti['queryConfirmingTourId']+1;
		// }else{
		// 	$queryConfirmingTourId = 1;
		// }

		generateQueryTourId($_REQUEST['id']); 



		//make final to this quotation and query 
		$update = updatelisting(_QUERY_MASTER_,'queryStatus=3','id="'.$_REQUEST['queryId'].'"');
		$update = updatelisting(_QUOTATION_MASTER_,'status="'.$_REQUEST['status'].'",isPaymentRequest=0,finalcategory="'.$finalcategory.'"','id="'.$_REQUEST['id'].'"');

		$rsd3=GetPageRecord('referanceSR',_QUERY_MASTER_,'subject!="" and deletestatus=0 order by referanceSR desc ');
		$referance=mysqli_fetch_array($rsd3);
		$referanceSR = $referance['referanceSR']+1;
		$newno='R'.date('Y').str_pad($referanceSR, 4, "0", STR_PAD_LEFT);
		updatelisting(_QUERY_MASTER_,'referanceNumber="'.$newno.'",referanceSR="'.$referanceSR.'"','id="'.$_REQUEST['queryid'].'"');	
	}
	
	// delete previous data if any exist
	$finalquotationItinerary = mysqli_query(db(),"delete from finalquotationItinerary where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuote = mysqli_query(db(),"delete from finalQuote where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuotetransfer = mysqli_query(db(),"delete from finalQuotetransfer where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteGuides = mysqli_query(db(),"delete from finalQuoteGuides where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteActivity = mysqli_query(db(),"delete from finalQuoteActivity where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteEnroute = mysqli_query(db(),"delete from finalQuoteEnroute where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteEntrance = mysqli_query(db(),"delete from finalQuoteEntrance where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteFerry = mysqli_query(db(),"delete from finalQuoteFerry where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteMealPlan = mysqli_query(db(),"delete from finalQuoteMealPlan where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteFlights = mysqli_query(db(),"delete from finalQuoteFlights where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteTrains = mysqli_query(db(),"delete from finalQuoteTrains where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteExtra = mysqli_query(db(),"delete from finalQuoteExtra where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuoteInsurence = mysqli_query(db(),"delete from finalQuoteInsurence where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalServiceMarkup = mysqli_query(db(),"delete from finalServiceMarkup where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	$finalQuotSupplierStatus = mysqli_query(db(),"delete from finalQuotSupplierStatus where quotationId='".$_REQUEST['id']."'") or die(mysqli_error(db()));
	
	// ************** ********** move data to final tables****** *******************************
	$queryId=$_REQUEST['queryid'];
	$countQuot=''; 
	$rs2='';
	$rs2=GetPageRecord('*',_QUOTATION_MASTER_,'id="'.$_REQUEST['id'].'"');
	$countQuot=mysqli_num_rows($rs2);
	if($countQuot>0){

		$quoteData=mysqli_fetch_array($rs2);  
	    $quotationId = $quoteData['id'];

		$dayId = 0;
		$shareDate = date('Y-m-d H:i:s');
		$rs=GetPageRecord('*','newQuotationDays',' queryId="'.$quoteData['queryId'].'" and quotationId="'.$quotationId.'"  and addstatus=0  order by id asc');
		while($QueryDaysData=mysqli_fetch_array($rs)){

		 	$dayId = $QueryDaysData['id'];
		 	// endDayDate
			$b="";
			$b=GetPageRecord('*',_QUOTATION_HOTEL_MASTER_,' quotationId="'.$quotationId.'" '.$finalcategoryQuery.' and dayId="'.$dayId.'" and supplierId in ( select serviceId from quotationItinerary where serviceType="hotel" order by serviceId asc ) and isSelectedFinal=1 order by id asc');
			if(mysqli_num_rows($b)>0){ 
				while($HotelRes=mysqli_fetch_array($b)){
			 			
			 		if($HotelRes['isSelectedType']=='isGuestType'){
			 			$isGuestType = 1;
			 		}elseif($HotelRes['isSelectedType']=='isLocalEscort'){
			 			$isLocalEscort = 1;
			 		}elseif($HotelRes['isSelectedType']=='isForeignEscort'){
			 			$isForeignEscort = 1;
			 		}else{
			 			$isGuestType = 0;
			 		}
			 		
			 		// remove supplement mark 
			 		// updatelisting('quotationHotelMaster','isHotelSupplement=0,isRoomSupplement=0,isGuestType="'.$isGuestType.'",isLocalEscort="'.$isLocalEscort.'",isForeignEscort="'.$isForeignEscort.'"','id="'.$HotelRes['id'].'"');

					$namevalue2 ='';
					$addHotel =''; 
					$tripleCost = $HotelRes['doubleoccupancy']+$HotelRes['extraBed'];
					$namevalue2 ='hotelQuotationId="'.$HotelRes['id'].'",fromDate="'.$HotelRes['fromDate'].'",toDate="'.$HotelRes['toDate'].'",dayId="'.$dayId.'",currencyId="'.$HotelRes['currencyId'].'",currencyValue="'.$HotelRes['currencyValue'].'",hotelId="'.$HotelRes['supplierId'].'",roomType="'.$HotelRes['roomType'].'",mealPlanId="'.$HotelRes['mealPlan'].'",supplierId="'.$HotelRes['supplierMasterId'].'",quotationId="'.$quotationId.'",roomSingleCost="'.$HotelRes['singleoccupancy'].'",roomDoubleCost="'.$HotelRes['doubleoccupancy'].'",roomTwinCost="'.$HotelRes['twinoccupancy'].'",roomTripleCost="'.$tripleCost.'",roomEBedACost="'.$HotelRes['extraBed'].'",roomEBedCCost="'.$HotelRes['childwithbed'].'",roomENBedCCost="'.$HotelRes['childwithoutbed'].'",breakfast="'.$HotelRes['breakfast'].'",lunch="'.$HotelRes['lunch'].'",dinner="'.$HotelRes['dinner'].'",breakfast2="'.$HotelRes['breakfast'].'",lunch2="'.$HotelRes['lunch'].'",dinner2="'.$HotelRes['dinner'].'",roomSingle="'.$HotelRes['singleNoofRoom'].'",roomDouble="'.$HotelRes['doubleNoofRoom'].'",roomTriple="'.$HotelRes['tripleNoofRoom'].'",roomTwin="'.$HotelRes['twinNoofRoom'].'",roomEBedA="'.$HotelRes['extraNoofBed'].'",roomEBedC="'.$HotelRes['childwithNoofBed'].'",roomENBedC="'.$HotelRes['childwithoutNoofBed'].'",roomSingleCost2="'.$HotelRes['singleoccupancy'].'",roomDoubleCost2="'.$HotelRes['doubleoccupancy'].'",roomTwinCost2="'.$HotelRes['twinoccupancy'].'",roomTripleCost2="'.$tripleCost.'",roomEBedACost2="'.$HotelRes['extraBed'].'",roomEBedCCost2="'.$HotelRes['childwithbed'].'",roomENBedCCost2="'.$HotelRes['childwithoutbed'].'",roomSingle2="'.$HotelRes['singleNoofRoom'].'",roomDouble2="'.$HotelRes['doubleNoofRoom'].'",roomTriple2="'.$HotelRes['tripleNoofRoom'].'",roomTwin2="'.$HotelRes['twinNoofRoom'].'",roomEBedA2="'.$HotelRes['extraNoofBed'].'",roomEBedC2="'.$HotelRes['childwithNoofBed'].'",roomENBedC2="'.$HotelRes['childwithoutNoofBed'].'",destinationId="'.$HotelRes['destinationId'].'",shareDate="'.$shareDate.'",startDayDate="'.$HotelRes['startDayDate'].'",endDayDate="'.$HotelRes['endDayDate'].'",complimentaryLunch="'.$HotelRes['complimentaryLunch'].'",complimentaryDinner="'.$HotelRes['complimentaryDinner'].'",complimentaryBreakfast="'.$HotelRes['complimentaryBreakfast'].'",isChildBreakfast="'.$HotelRes['isChildBreakfast'].'",isChildLunch="'.$HotelRes['isChildLunch'].'",isChildDinner="'.$HotelRes['isChildDinner'].'",isGuestType="'.$HotelRes['isGuestType'].'",isLocalEscort="'.$HotelRes['isLocalEscort'].'",isForeignEscort="'.$HotelRes['isForeignEscort'].'",isEarlyCheckin="'.$HotelRes['isEarlyCheckin'].'",sixBedRoomCost="'.$HotelRes['sixBedRoom'].'",eightBedRoomCost="'.$HotelRes['eightBedRoom'].'",tenBedRoomCost="'.$HotelRes['tenBedRoom'].'",quadRoomCost="'.$HotelRes['quadRoom'].'",teenRoomCost="'.$HotelRes['teenRoom'].'",childBreakfast="'.$HotelRes['childBreakfast'].'",childLunch="'.$HotelRes['childLunch'].'",childDinner="'.$HotelRes['childDinner'].'",sixNoofBedRoom="'.$HotelRes['sixNoofBedRoom'].'",eightNoofBedRoom="'.$HotelRes['eightNoofBedRoom'].'",tenNoofBedRoom="'.$HotelRes['tenNoofBedRoom'].'",quadNoofRoom="'.$HotelRes['quadNoofRoom'].'",teenNoofRoom="'.$HotelRes['teenNoofRoom'].'"';
					$addHotel = addlistinggetlastid('finalQuote',$namevalue2);

					$qhaQuery=GetPageRecord('*','quotationHotelAdditionalMaster','hotelQuotId="'.$HotelRes['id'].'"  and quotationId="'.$quotationId.'" order by id asc');
					while($qhAData=mysqli_fetch_array($qhaQuery)){

						$namevalue ='quotationId="'.$quotationId.'",dayId="'.$dayId.'",hotelId="'.$qhAData['hotelId'].'",additionalCost="'.$qhAData['additionalCost'].'",additionalCost2="'.$qhAData['additionalCost'].'",name="'.$qhAData['name'].'",finalQuotId="'.$addHotel.'",additionalId="'.$qhAData['additionalId'].'",costType="'.$qhAData['costType'].'",queryId="'.$qhAData['queryId'].'",destinationId="'.$qhAData['destinationId'].'",fromDate="'.$qhAData['fromDate'].'",toDate="'.$qhAData['toDate'].'",currencyId="'.$qhAData['currencyId'].'",currencyValue="'.$qhAData['currencyValue'].'",rateId="'.$qhAData['rateId'].'"';
						addlistinggetlastid('finalQuoteHotelAdditional',$namevalue);
					}

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$addHotel.'",quotationId="'.$quotationId.'",serviceType="hotel",startDate="'.$HotelRes['fromDate'].'",endDate="'.$HotelRes['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);
				}
			}

			// markup
			$b=''; 
			$b=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and isTransferTaken="" and id in (select serviceId from quotationItinerary where serviceType in ("transfer","transportation") order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){ 
				while($transferData=mysqli_fetch_array($b)){
					$lastId = '';  
					// vehicleId 
					$namevalue2 ='transferQuotationId="'.$transferData['id'].'",fromDate="'.$transferData['fromDate'].'",toDate="'.$transferData['toDate'].'",dayId="'.$dayId.'",currencyId="'.$transferData['currencyId'].'",currencyValue="'.$transferData['currencyValue'].'",transferType="'.$transferData['transferType'].'",transferId="'.$transferData['transferNameId'].'",vehicleModelId="'.$transferData['vehicleModelId'].'",vehicleId="'.$transferData['vehicleId'].'",destinationId="'.$transferData['destinationId'].'",supplierId="'.$transferData['supplierId'].'",quotationId="'.$quotationId.'",vehicleCost="'.$transferData['vehicleCost'].'",distance="'.$transferData['distance'].'",costType="'.$transferData['costType'].'",vehicleCost2="'.$transferData['vehicleCost'].'",adultCost="'.$transferData['adultCost'].'",adultCost2="'.$transferData['adultCost'].'",childCost="'.$transferData['childCost'].'",childCost2="'.$transferData['childCost'].'",infantCost="'.$transferData['infantCost'].'",infantCost2="'.$transferData['infantCost'].'",noOfVehicles="'.$transferData['noOfVehicles'].'",repCost="'.$transferData['representativeEntryFee'].'",repCost2="'.$transferData['representativeEntryFee'].'",totalPax="'.$transferData['totalPax'].'",startDate="'.$transferData['startDate'].'",gstTax="'.$transferData['gstTax'].'",endDate="'.$transferData['endDate'].'",markupCost="'.$transferData['markupCost'].'",markupType="'.$transferData['markupType'].'",shareDate="'.$shareDate.'"';   
				 
					$lastId = addlistinggetlastid('finalQuotetransfer',$namevalue2); 

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="'.$transferData['serviceType'].'",startDate="'.$transferData['fromDate'].'",endDate="'.$transferData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);
				}
			}
 
 

			$b='';
			$b=GetPageRecord('*','quotationGuideMaster',' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="guide" order by serviceId asc ) and isSelectedFinal=1 order by id asc');
			if(mysqli_num_rows($b)>0){ 
				while($guideQuotData=mysqli_fetch_array($b)){

					// remove supplement mark and make supplement as default
			 		updatelisting('quotationGuideMaster','isSupplement=0,isGuestType=1','id="'.$guideQuotData['id'].'"');
			 		updatelisting('quotationItinerary','serviceId="'.$guideQuotData['id'].'"','serviceId="'.$guideQuotData['id'].'" and serviceType="guide" and quotationId="'.$quotationId.'"');

					$lastId ='';  
					$namevalue2 ='guideQuotationId="'.$guideQuotData['id'].'",slabId="'.$guideQuotData['slabId'].'",tariffId="'.$guideQuotData['tariffId'].'",serviceType="'.$guideQuotData['serviceType'].'",paxRange="'.$guideQuotData['paxRange'].'",remark="'.$guideQuotData['remark'].'",voucherNo="'.$guideQuotData['voucherNo'].'",destinationId="'.$guideQuotData['destinationId'].'",currencyId="'.$guideQuotData['currencyId'].'",currencyValue="'.$guideQuotData['currencyValue'].'",guideId="'.$guideQuotData['guideId'].'",fromDate="'.$guideQuotData['fromDate'].'",toDate="'.$guideQuotData['toDate'].'",dayId="'.$dayId.'",supplierId="'.$guideQuotData['supplierId'].'",quotationId="'.$quotationId.'",adultCost="'.$guideQuotData['price'].'",adultCost2="'.$guideQuotData['price'].'",childCost="'.$guideQuotData['price'].'",childCost2="'.$guideQuotData['price'].'",infantCost="'.$guideQuotData['price'].'",infantCost2="'.$guideQuotData['price'].'",shareDate="'.$shareDate.'",markupCost="'.$guideQuotData['markupCost'].'",markupType="'.$guideQuotData['markupType'].'"';
					$lastId = addlistinggetlastid('finalQuoteGuides',$namevalue2); 	

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="guide",startDate="'.$guideQuotData['fromDate'].'",endDate="'.$guideQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);

				}
			}

			$b='';
			$b=GetPageRecord('*',_QUOTATION_OTHER_ACTIVITY_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="activity" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){ 	
				while($activityQuotData=mysqli_fetch_array($b)){
					$lastId = ''; 

					$activityCost2=$activityQuotData['activityCost'];
					$maxpax2=$activityQuotData['maxpax'];
					$perPaxCost2=$activityQuotData['perPaxCost'];
					
					$supplierId = $activityQuotData['supplierId'];
					if($supplierId < 1){ 			
						$suppSql=""; 
						$suppSql=GetPageRecord('id','suppliersMaster',' self=1'); 
						$supplierData=mysqli_fetch_array($suppSql);
						$supplierId = $supplierData['id'];
					} 
				  	// destinationId 
					$namevalue2 ='activityQuotationId="'.$activityQuotData['id'].'",fromDate="'.$activityQuotData['fromDate'].'",toDate="'.$activityQuotData['toDate'].'",otherActivityCity="'.$activityQuotData['otherActivityCity'].'",dayId="'.$dayId.'",activityId="'.$activityQuotData['otherActivityName'].'",supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",activityCost="'.$activityCost2.'",currencyId="'.$activityQuotData['currencyId'].'",currencyValue="'.$activityQuotData['currencyValue'].'",maxpax="'.$maxpax2.'",perPaxCost="'.$perPaxCost2.'",activityCost2="'.$activityCost2.'",maxpax2="'.$maxpax2.'",perPaxCost2="'.$perPaxCost2.'",transferType="'.$activityQuotData['transferType'].'",vehicleId="'.$activityQuotData['vehicleId'].'",vehicleCost="'.$activityQuotData['vehicleCost'].'",repCost="'.$activityQuotData['repCost'].'",ticketAdultCost="'.$activityQuotData['ticketAdultCost'].'",ticketchildCost="'.$activityQuotData['ticketchildCost'].'",ticketinfantCost="'.$activityQuotData['ticketinfantCost'].'",adultCost="'.$activityQuotData['adultCost'].'",childCost="'.$activityQuotData['childCost'].'",infantCost="'.$activityQuotData['infantCost'].'",adultPax="'.$activityQuotData['adultPax'].'",childPax="'.$activityQuotData['childPax'].'",infantPax="'.$activityQuotData['infantPax'].'",adultPax2="'.$activityQuotData['adultPax'].'",childPax2="'.$activityQuotData['childPax'].'",infantPax2="'.$activityQuotData['infantPax'].'",gstTax="'.$activityQuotData['gstTax'].'",shareDate="'.$shareDate.'",markupType="'.$activityQuotData['markupType'].'",markupCost="'.$activityQuotData['markupCost'].'"';  
					$lastId = addlistinggetlastid('finalQuoteActivity',$namevalue2); 	

	 
					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="activity",startDate="'.$activityQuotData['fromDate'].'",endDate="'.$activityQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);

				}


			}

			$b='';
			$b=GetPageRecord('*','quotationEnrouteMaster',' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="enroute" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){
				while($enrouteQuotData=mysqli_fetch_array($b)){
	  			
					$suppSql=""; 
					$suppSql=GetPageRecord('id','suppliersMaster',' self=1'); 
					$supplierData=mysqli_fetch_array($suppSql);
					$supplierId = $supplierData['id'];
			 

					$lastId =''; 
					$namevalue2 ='enrouteQuotationId="'.$enrouteQuotData['id'].'",fromDate="'.$enrouteQuotData['fromDate'].'",toDate="'.$enrouteQuotData['toDate'].'",dayId="'.$dayId.'",destinationId="'.$enrouteQuotData['destinationId'].'",enrouteId="'.$enrouteQuotData['enrouteId'].'",supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",currencyId="'.$enrouteQuotData['currencyId'].'",currencyValue="'.$enrouteQuotData['currencyValue'].'",adultCost="'.$enrouteQuotData['adultCost'].'",adultCost2="'.$enrouteQuotData['adultCost'].'",childCost="'.$enrouteQuotData['childCost'].'",childCost2="'.$enrouteQuotData['childCost'].'",infantCost="'.$enrouteQuotData['infantCost'].'",infantCost2="'.$enrouteQuotData['infantCost'].'",shareDate="'.$shareDate.'",adultPax="'.$enrouteQuotData['adultPax'].'",childPax="'.$enrouteQuotData['childPax'].'",infantPax="'.$enrouteQuotData['infantPax'].'",adultPax2="'.$enrouteQuotData['adultPax'].'",childPax2="'.$enrouteQuotData['childPax'].'",infantPax2="'.$enrouteQuotData['infantPax'].'",gstTax="'.$enrouteQuotData['gstTax'].'",markupCost="'.$enrouteQuotData['markupCost'].'",markupType="'.$enrouteQuotData['markupType'].'"';  
					$lastId = addlistinggetlastid('finalQuoteEnroute',$namevalue2);

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="enroute",startDate="'.$enrouteQuotData['fromDate'].'",endDate="'.$enrouteQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);
					 

				}
			}


			$b='';
			$b=GetPageRecord('*','quotationEntranceMaster','quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="entrance" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){
				while($entranceQuotData=mysqli_fetch_array($b)){
					$lastId = ''; 
					$supplierId='';  
					$supplierId = $entranceQuotData['supplierId'];
					$entranceId = $entranceQuotData['entranceNameId'];
				 	// transferType
					$namevalue2 ='entranceQuotationId="'.$entranceQuotData['id'].'",fromDate="'.$entranceQuotData['fromDate'].'",toDate="'.$entranceQuotData['toDate'].'",dayId="'.$dayId.'",entranceId="'.$entranceId.'",supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",destinationId="'.$entranceQuotData['destinationId'].'",transferType="'.$entranceQuotData['transferType'].'",currencyId="'.$entranceQuotData['currencyId'].'",currencyValue="'.$entranceQuotData['currencyValue'].'",ticketAdultCost="'.$entranceQuotData['ticketAdultCost'].'",ticketAdultCost2="'.$entranceQuotData['ticketAdultCost'].'",ticketchildCost="'.$entranceQuotData['ticketchildCost'].'",ticketchildCost2="'.$entranceQuotData['ticketchildCost'].'",ticketinfantCost="'.$entranceQuotData['ticketinfantCost'].'",ticketinfantCost2="'.$entranceQuotData['ticketinfantCost'].'",adultCost="'.$entranceQuotData['adultCost'].'",childCost="'.$entranceQuotData['childCost'].'",infantCost="'.$entranceQuotData['infantCost'].'",adultCost2="'.$entranceQuotData['adultCost'].'",childCost2="'.$entranceQuotData['childCost'].'",infantCost2="'.$entranceQuotData['infantCost'].'",vehicleCost="'.$entranceQuotData['vehicleCost'].'",vehicleCost2="'.$entranceQuotData['vehicleCost'].'",repCost="'.$entranceQuotData['repCost'].'",repCost2="'.$entranceQuotData['repCost'].'",vehicleId="'.$entranceQuotData['vehicleId'].'",shareDate="'.$shareDate.'",adultPax="'.$entranceQuotData['adultPax'].'",childPax="'.$entranceQuotData['childPax'].'",infantPax="'.$entranceQuotData['infantPax'].'",adultPax2="'.$entranceQuotData['adultPax'].'",childPax2="'.$entranceQuotData['childPax'].'",infantPax2="'.$entranceQuotData['infantPax'].'",gstTax="'.$entranceQuotData['gstTax'].'",markupCost="'.$entranceQuotData['markupCost'].'",markupType="'.$entranceQuotData['markupType'].'"';  
					$lastId = addlistinggetlastid('finalQuoteEntrance',$namevalue2); 	

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="entrance",startDate="'.$entranceQuotData['fromDate'].'",endDate="'.$entranceQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);
				}
			}

			$b='';
			$b=GetPageRecord('*',_QUOTATION_FERRY_MASTER_,'quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="ferry" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){
				while($ferryQuotData=mysqli_fetch_array($b)){
					$lastId = ''; 
					$supplierId='';  
					$supplierId = $ferryQuotData['supplierId'];

					$namevalue2 ='ferryQuotationId="'.$ferryQuotData['id'].'",quotationId="'.$quotationId.'",fromDate="'.$ferryQuotData['fromDate'].'",toDate="'.$ferryQuotData['toDate'].'",dayId="'.$dayId.'",ferryId="'.$ferryQuotData['serviceid'].'",ferryNameId="'.$ferryQuotData['ferryNameId'].'",ferryClass="'.$ferryQuotData['ferryClass'].'",supplierId="'.$supplierId.'",destinationId="'.$ferryQuotData['destinationId'].'",currencyId="'.$ferryQuotData['currencyId'].'",currencyValue="'.$ferryQuotData['currencyValue'].'",adultCost="'.$ferryQuotData['adultCost'].'",childCost="'.$ferryQuotData['childCost'].'",infantCost="'.$ferryQuotData['infantCost'].'",ferryCost="'.$ferryQuotData['ferryCost'].'",processingfee="'.$ferryQuotData['processingfee'].'",miscCost="'.$ferryQuotData['miscCost'].'",adultCost2="'.$ferryQuotData['adultCost'].'",childCost2="'.$ferryQuotData['childCost'].'",infantCost2="'.$ferryQuotData['infantCost'].'",ferryCost2="'.$ferryQuotData['ferryCost'].'",processingfee2="'.$ferryQuotData['processingfee'].'",miscCost2="'.$ferryQuotData['miscCost'].'",shareDate="'.$shareDate.'",adultPax="'.$ferryQuotData['adultPax'].'",childPax="'.$ferryQuotData['childPax'].'",infantPax="'.$ferryQuotData['infantPax'].'",adultPax2="'.$ferryQuotData['adultPax'].'",childPax2="'.$ferryQuotData['childPax'].'",infantPax2="'.$ferryQuotData['infantPax'].'",gstTax="'.$ferryQuotData['gstTax'].'",markupCost="'.$ferryQuotData['markupCost'].'",markupType="'.$ferryQuotData['markupType'].'"';  
					$lastId = addlistinggetlastid('finalQuoteFerry',$namevalue2); 	

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="ferry",startDate="'.$ferryQuotData['fromDate'].'",endDate="'.$ferryQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);
				}
			}

			// Cruise Services
			$b='';
			$b=GetPageRecord('*',_QUOTATION_CRUISE_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="cruise" order by serviceId asc) order by id asc');

				while($transferRes=mysqli_fetch_array($b)){

					$lastId ='';
					$namevalue2='';
					$namevalue2 = 'supplerId="'.$transferRes['supplerId'].'",fromDate="'.$transferRes['fromDate'].'",serviceId="'.$transferRes['serviceId'].'",cruisePackageId="'.$transferRes['serviceId'].'",cruiseQuotationId="'.$transferRes['id'].'",toDate="'.$transferRes['toDate'].'",destinationId="'.$transferRes['destinationId'].'",adultCost="'.$transferRes['adultCost'].'",childCost="'.$transferRes['childCost'].'",infantCost="'.$transferRes['infantCost'].'",adultCost2="'.$transferRes['adultCost'].'",childCost2="'.$transferRes['childCost'].'",infantCost2="'.$transferRes['infantCost'].'",currencyId="'.$transferRes['currencyId'].'",currencyValue="'.$transferRes['currencyValue'].'",remark="'.$transferRes['remark'].'",queryId="'.$QueryDaysData['queryId'].'",quotationId="'.$quotationId.'",supplierId="'.$transferRes['supplierId'].'",rateId="'.$transferRes['rateId'].'",cabinTypeId="'.$transferRes['cabinTypeId'].'",cruiseNameId="'.$transferRes['cruiseNameId'].'",tariffTypeId="'.$transferRes['tariffTypeId'].'",gstTax="'.$transferRes['gstTax'].'",dayId="'.$dayId.'",duration="'.$transferRes['duration'].'",departureDate="'.$transferRes['departureDate'].'",departureTime="'.$transferRes['departureTime'].'",startDayDate="'.$transferRes['startDayDate'].'",endDayDate="'.$transferRes['endDayDate'].'",isGuestType="'.$transferRes['isGuestType'].'",status="'.$transferRes['status'].'",deletestatus=0,addedBy="'.$_SESSION['userid'].'",dateAdded="'.date('Y-m-d').'",adultPax="'.$transferRes['adultPax'].'",childPax="'.$transferRes['childPax'].'",adultPax2="'.$transferRes['adultPax'].'",childPax2="'.$transferRes['childPax'].'"';

					$lastId = addlistinggetlastid('finalQuoteCruise',$namevalue2);
					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="cruise",startDate="'.$transferRes['fromDate'].'",endDate="'.$transferRes['fromDate'].'"';

					addlistinggetlastid('finalquotationItinerary',$namevalue);

				}

			$b='';
			$b=GetPageRecord('*',_QUOTATION_INBOUND_MEAL_PLAN_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="mealplan" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){
				while($mealplanQuotData=mysqli_fetch_array($b)){
					$suppSql=""; 
					$suppSql=GetPageRecord('id','suppliersMaster',' self=1'); 
					$supplierData=mysqli_fetch_array($suppSql);
					$supplierId = $supplierData['id'];
					
					$lastId = ''; 
					$namevalue2 ='mealplanQuotationId="'.$mealplanQuotData['id'].'",fromDate="'.$mealplanQuotData['fromDate'].'",toDate="'.$mealplanQuotData['toDate'].'",dayId="'.$dayId.'",mealPlanName="'.$mealplanQuotData['mealPlanName'].'",mealPlanId="'.$mealplanQuotData['mealPlanNameId'].'",mealTypeId="'.$mealplanQuotData['mealType'].'",supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",destinationId="'.$mealplanQuotData['destinationId'].'",adultCost="'.$mealplanQuotData['adultCost'].'",childCost="'.$mealplanQuotData['childCost'].'",infantCost="'.$mealplanQuotData['infantCost'].'",currencyId="'.$mealplanQuotData['currencyId'].'",currencyValue="'.$mealplanQuotData['currencyValue'].'",adultCost2="'.$mealplanQuotData['adultCost'].'",childCost2="'.$mealplanQuotData['childCost'].'",infantCost2="'.$mealplanQuotData['infantCost'].'",shareDate="'.$shareDate.'",adultPax="'.$mealplanQuotData['adultPax'].'",childPax="'.$mealplanQuotData['childPax'].'",infantPax="'.$mealplanQuotData['infantPax'].'",adultPax2="'.$mealplanQuotData['adultPax'].'",childPax2="'.$mealplanQuotData['childPax'].'",infantPax2="'.$mealplanQuotData['infantPax'].'",gstTax="'.$mealplanQuotData['gstTax'].'",markupCost="'.$mealplanQuotData['markupCost'].'",markupType="'.$mealplanQuotData['markupType'].'"';  

					$lastId = addlistinggetlastid('finalQuoteMealPlan',$namevalue2); 


					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="mealplan",startDate="'.$mealplanQuotData['fromDate'].'",endDate="'.$mealplanQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);
				}
			}


			$b='';
			$b=GetPageRecord('*',_QUOTATION_FLIGHT_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="flight" and isFlightTaken="" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0 && ($quoteData['flightCostType']==0 || $quoteData['calculationType']==3)){
				while($flightQuotData=mysqli_fetch_array($b)){
				
					$suppSql=""; 
					$suppSql=GetPageRecord('id','suppliersMaster',' 1 and self=1'); 
					$supplierData=mysqli_fetch_array($suppSql);
					$supplierId = $supplierData['id'];
					 // isFlightTaken
					$lastId = ''; 
					$namevalue2 ='flightQuotationId="'.$flightQuotData['id'].'",flightId="'.$flightQuotData['flightId'].'",fromDate="'.$flightQuotData['fromDate'].'",toDate="'.$flightQuotData['toDate'].'",dayId="'.$dayId.'",quotationId="'.$quotationId.'",destinationId="'.$flightQuotData['destinationId'].'",adultCost="'.$flightQuotData['adultCost'].'",childCost="'.$flightQuotData['childCost'].'",infantCost="'.$flightQuotData['infantCost'].'",currencyId="'.$flightQuotData['currencyId'].'",currencyValue="'.$flightQuotData['currencyValue'].'",departureFrom="'.$flightQuotData['departureFrom'].'",arrivalTo="'.$flightQuotData['arrivalTo'].'",flightNumber="'.$flightQuotData['flightNumber'].'",flightClass="'.$flightQuotData['flightClass'].'",departureTime="'.$flightQuotData['departureTime'].'",arrivalTime="'.$flightQuotData['arrivalTime'].'",departureDate="'.$flightQuotData['departureDate'].'",arrivalDate="'.$flightQuotData['arrivalDate'].'",adultCost2="'.$flightQuotData['adultCost'].'",childCost2="'.$flightQuotData['childCost'].'",infantCost2="'.$flightQuotData['infantCost'].'",shareDate="'.$shareDate.'",isGuestType="'.$flightQuotData['isGuestType'].'",isLocalEscort="'.$flightQuotData['isLocalEscort'].'",isForeignEscort="'.$flightQuotData['isForeignEscort'].'",adultPax="'.$flightQuotData['adultPax'].'",childPax="'.$flightQuotData['childPax'].'",infantPax="'.$flightQuotData['infantPax'].'",adultPax2="'.$flightQuotData['adultPax'].'",childPax2="'.$flightQuotData['childPax'].'",infantPax2="'.$flightQuotData['infantPax'].'",gstTax="'.$flightQuotData['gstTax'].'",markupCost="'.$flightQuotData['markupCost'].'",markupType="'.$flightQuotData['markupType'].'",totalAdultCost="'.$flightQuotData['totalAdultCost'].'",adultTax="'.$flightQuotData['adultTax'].'",totalChildCost="'.$flightQuotData['totalChildCost'].'",childTax="'.$flightQuotData['childTax'].'",totalInfantCost="'.$flightQuotData['totalInfantCost'].'",infantTax="'.$flightQuotData['infantTax'].'",cancellationPolicy="'.$flightQuotData['cancellationPolicy'].'",isFlightTaken="'.$flightQuotData['isFlightTaken'].'",supplierId="'.$flightQuotData['supplierId'].'"';  

					$lastId = addlistinggetlastid('finalQuoteFlights',$namevalue2); 	

					// $c1 ='';
					// 	$c1=GetPageRecord('*','flightTimeLineMaster',' flightQuoteId="'.$flightQuotData['id'].'" and quotationId="'.$quotationId.'" and dayId="'.$dayId.'"');
					// 	if(mysqli_num_rows($c1)>0){
					// 	$timeData = mysqli_fetch_assoc($c1);
					// 	$timeValue = 'quotationId="'.$quotationId.'",flightQuoteId="'.$lastId.'",dayId="'.$dayId.'",flightId="'.$timeData['flightId'].'",departureDate="'.$timeData['departureDate'].'",departureTime="'.$timeData['departureTime'].'",status="'.$timeData['status'].'",deletestatus="'.$timeData['deletestatus'].'",remark="'.$timeData['remark'].'",queryId="'.$QueryDaysData['queryId'].'"';
					// 	$addTime = addlistinggetlastid('flightTimeLineMaster',$timeValue);
					// 	}

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="flight",startDate="'.$flightQuotData['fromDate'].'",endDate="'.$flightQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);

				}
			}

			$b='';
			$b=GetPageRecord('*',_QUOTATION_TRAINS_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="train" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){
				while($trainQuotData=mysqli_fetch_array($b)){
					$suppSql="";
					$suppSql=GetPageRecord('id','suppliersMaster',' self=1'); 
					$supplierData=mysqli_fetch_array($suppSql);
					$supplierId = $supplierData['id'];
					
					$lastId = '';  
				 	$namevalue2 ='trainQuotationId="'.$trainQuotData['id'].'",trainId="'.$trainQuotData['trainId'].'",fromDate="'.$trainQuotData['fromDate'].'",toDate="'.$trainQuotData['toDate'].'",dayId="'.$dayId.'",currencyId="'.$trainQuotData['currencyId'].'",currencyValue="'.$trainQuotData['currencyValue'].'",destinationId="'.$trainQuotData['destinationId'].'",supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",adultCost="'.$trainQuotData['adultCost'].'",childCost="'.$trainQuotData['childCost'].'",infantCost="'.$trainQuotData['infantCost'].'",departureFrom="'.$trainQuotData['departureFrom'].'",arrivalTo="'.$trainQuotData['arrivalTo'].'",trainNumber="'.$trainQuotData['trainNumber'].'",trainClass="'.$trainQuotData['trainClass'].'",departureTime="'.$trainQuotData['departureTime'].'",arrivalTime="'.$trainQuotData['arrivalTime'].'",journeyType="'.$trainQuotData['journeyType'].'",departureDate="'.$trainQuotData['departureDate'].'",arrivalDate="'.$trainQuotData['arrivalDate'].'",adultCost2="'.$trainQuotData['adultCost'].'",childCost2="'.$trainQuotData['childCost'].'",infantCost2="'.$trainQuotData['infantCost'].'",shareDate="'.$shareDate.'",isGuestType="'.$trainQuotData['isGuestType'].'",isLocalEscort="'.$trainQuotData['isLocalEscort'].'",isForeignEscort="'.$trainQuotData['isForeignEscort'].'",adultPax="'.$trainQuotData['adultPax'].'",childPax="'.$trainQuotData['childPax'].'",infantPax="'.$trainQuotData['infantPax'].'",adultPax2="'.$trainQuotData['adultPax'].'",childPax2="'.$trainQuotData['childPax'].'",infantPax2="'.$trainQuotData['infantPax'].'",gstTax="'.$trainQuotData['gstTax'].'",markupCost="'.$trainQuotData['markupCost'].'",markupType="'.$trainQuotData['markupType'].'"';  
					$lastId = addlistinggetlastid('finalQuoteTrains',$namevalue2); 
					
					// $c1 ='';
					// $c1=GetPageRecord('*','trainTimeLineMaster',' trainQuoteId="'.$transferRes['id'].'" and quotationId="'.$maintable['id'].'" and dayId="'.$QueryDaysData['id'].'"');
					// if(mysqli_num_rows($c1)>0){
					// $timeData = mysqli_fetch_assoc($c1);
					// 	$timeValue = 'quotationId="'.$add.'",flightQuoteId="'.$addHotel.'",dayId="'.$adddays.'",flightId="'.$timeData['flightId'].'",departureDate="'.$timeData['departureDate'].'",departureTime="'.$timeData['departureTime'].'",status="'.$timeData['status'].'",deletestatus="'.$timeData['deletestatus'].'",remark="'.$timeData['remark'].'",queryId="'.$maintable['queryId'].'"';
					// 	$addTime = addlistinggetlastid('flightTimeLineMaster',$timeValue);
					// }


					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="train",startDate="'.$trainQuotData['fromDate'].'",endDate="'.$trainQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);

				}
			}
 
			$b='';
			$b=GetPageRecord('*',_QUOTATION_EXTRA_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$dayId.'" and id in (select serviceId from quotationItinerary where serviceType="additional" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){

				while($additionalQuotData=mysqli_fetch_array($b)){
					$suppSql=""; 
					$suppSql=GetPageRecord('id','suppliersMaster',' self=1'); 
					$supplierData=mysqli_fetch_array($suppSql);
					$supplierId = $supplierData['id'];
					
					$lastId = ''; 
					$namevalue2 ='additionalQuotationId="'.$additionalQuotData['id'].'",fromDate="'.$additionalQuotData['fromDate'].'",toDate="'.$additionalQuotData['toDate'].'",dayId="'.$dayId.'",additionalId="'.$additionalQuotData['additionalId'].'",destinationId="'.$additionalQuotData['destinationId'].'",currencyId="'.$additionalQuotData['currencyId'].'",currencyValue="'.$additionalQuotData['currencyValue'].'",supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",groupCost="'.$additionalQuotData['groupCost'].'",groupCost2="'.$additionalQuotData['groupCost'].'",adultCost="'.$additionalQuotData['adultCost'].'",childCost="'.$additionalQuotData['childCost'].'",infantCost="'.$additionalQuotData['infantCost'].'",adultCost2="'.$additionalQuotData['adultCost'].'",childCost2="'.$additionalQuotData['childCost'].'",infantCost2="'.$additionalQuotData['infantCost'].'",costType="'.$additionalQuotData['costType'].'",shareDate="'.$shareDate.'",adultPax="'.$additionalQuotData['adultPax'].'",childPax="'.$additionalQuotData['childPax'].'",infantPax="'.$additionalQuotData['infantPax'].'",adultPax2="'.$additionalQuotData['adultPax'].'",childPax2="'.$additionalQuotData['childPax'].'",infantPax2="'.$additionalQuotData['infantPax'].'",gstTax="'.$additionalQuotData['gstTax'].'",markupCost="'.$additionalQuotData['markupCost'].'",markupType="'.$additionalQuotData['markupType'].'"';  
					$lastId = addlistinggetlastid('finalQuoteExtra',$namevalue2);


					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="additional",startDate="'.$additionalQuotData['fromDate'].'",endDate="'.$additionalQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);

				}
			}

		}
		// new Quotation days loop ends
		// package component
		$getPWRMQuery="";
		$getPWRMQuery=GetPageRecord('*','packageWiseRateMaster',' quotationId="'.$quotationId.'" and supplierId>0 order by id asc');
		if(mysqli_num_rows($getPWRMQuery) > 0  && $quoteData['calculationType']==3){
		    while($pwrmData=mysqli_fetch_array($getPWRMQuery)){ 
		    // supplierId
			$lastId = '';
			$modevalue = 'queryId="'.$pwrmData['queryId'].'",quotationId="'.$quotationId.'",singleCost="'.$pwrmData['singleCost'].'",doubleCost="'.$pwrmData['doubleCost'].'",tripleCost="'.$pwrmData['tripleCost'].'",twinCost="'.$pwrmData['twinCost'].'",quadCost="'.$pwrmData['quadCost'].'",sixBedCost="'.$pwrmData['sixBedCost'].'",eightBedCost="'.$pwrmData['eightBedCost'].'",tenBedCost="'.$pwrmData['tenBedCost'].'",teenBedCost="'.$pwrmData['teenBedCost'].'",extraBedACost="'.$pwrmData['extraBedACost'].'",childwithbedCost="'.$pwrmData['childwithbedCost'].'",childwithoutbedCost="'.$pwrmData['childwithoutbedCost'].'",infantBedCost="'.$pwrmData['infantBedCost'].'",guideA="'.$pwrmData['guideA'].'",activityA="'.$pwrmData['activityA'].'",entranceA="'.$pwrmData['entranceA'].'",enrouteA="'.$pwrmData['enrouteA'].'",transferA="'.$pwrmData['transferA'].'",trainA="'.$pwrmData['trainA'].'",flightA="'.$pwrmData['flightA'].'",restaurantA="'.$pwrmData['restaurantA'].'",otherA="'.$pwrmData['otherA'].'",guideC="'.$pwrmData['guideC'].'",activityC="'.$pwrmData['activityC'].'",entranceC="'.$pwrmData['entranceC'].'",enrouteC="'.$pwrmData['enrouteC'].'",transferC="'.$pwrmData['transferC'].'",trainC="'.$pwrmData['trainC'].'",flightC="'.$pwrmData['flightC'].'",restaurantC="'.$pwrmData['restaurantC'].'",otherC="'.$pwrmData['otherC'].'",supplierId="'.$pwrmData['supplierId'].'",currencyId="'.$pwrmData['currencyId'].'",currencyValue="'.$pwrmData['currencyValue'].'",singleBasis="'.$pwrmData['singleBasis'].'",doubleBasis="'.$pwrmData['doubleBasis'].'",tripleBasis="'.$pwrmData['tripleBasis'].'",twinBasis="'.$pwrmData['twinBasis'].'",quadBasis="'.$pwrmData['quadBasis'].'",sixBedBasis="'.$pwrmData['sixBedBasis'].'",eightBedBasis="'.$pwrmData['eightBedBasis'].'",tenBedBasis="'.$pwrmData['tenBedBasis'].'",teenBedBasis="'.$pwrmData['teenBedBasis'].'",extraBedABasis="'.$pwrmData['extraBedABasis'].'",childwithbedBasis="'.$pwrmData['childwithbedBasis'].'",childwithoutbedBasis="'.$pwrmData['childwithoutbedBasis'].'",infantBedBasis="'.$pwrmData['infantBedBasis'].'",loopNum="'.$pwrmData['loopNum'].'",hotelTypeId="'.$pwrmData['hotelTypeId'].'",hotelCategoryId="'.$pwrmData['hotelCategoryId'].'",gstTax="'.$pwrmData['gstTax'].'",serviceTax="'.$pwrmData['serviceTax'].'",serviceType="'.$pwrmData['serviceType'].'",serviceName="'.$pwrmData['serviceName'].'",markupType="'.$pwrmData['markupType'].'",markupValue="'.$pwrmData['markupValue'].'",costTypeId="'.$pwrmData['costTypeId'].'",adultPax="'.$pwrmData['adultPax'].'",adultCost="'.$pwrmData['adultCost'].'",ChildCost="'.$pwrmData['ChildCost'].'",ChildPax="'.$pwrmData['ChildPax'].'",infantCost="'.$pwrmData['infantCost'].'",infantPax="'.$pwrmData['infantPax'].'",groupCost="'.$pwrmData['groupCost'].'",ROE="'.$pwrmData['ROE'].'"';
			$lastId = addlistinggetlastid('finalPackWiseRateMaster',$modevalue);

			$namevalue ='';
			$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$quoteData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="package",startDate="'.$quoteData['fromDate'].'",endDate="'.$quoteData['toDate'].'"';
			addlistinggetlastid('finalquotationItinerary',$namevalue);
			

		    $namevalue = 'supplierId="' . $pwrmData['supplierId'] . '"';
		    $where     = 'quotationId="' . $quotationId . '"';
		    $update    = updatelisting('finalPackWiseRateMaster', $namevalue, $where);

		    $update    = updatelisting('finalQuote', $namevalue, $where);
		    $update    = updatelisting('finalQuotetransfer', $namevalue, $where);
		    $update    = updatelisting('finalQuoteEntrance', $namevalue, $where);
		    $update    = updatelisting('finalQuoteFerry', $namevalue, $where);
		    $update    = updatelisting('finalQuoteActivity', $namevalue, $where);
		    $update    = updatelisting('finalQuoteTrains', $namevalue, $where);
		    $update    = updatelisting('finalQuoteGuides', $namevalue, $where);
		    $update    = updatelisting('finalQuoteMealPlan', $namevalue, $where);
		    $update    = updatelisting('finalQuoteExtra', $namevalue, $where);
		    $update    = updatelisting('finalQuoteEnroute', $namevalue, $where);
		    // $update    = updatelisting('finalQuoteFlights', $namevalue, $where);
			}
		} 

		if($quoteData['queryType']==13 || $quoteData['calculationType']==3 || $quoteData['visaRequired']==2 || $quoteData['insuranceRequired']==2){

			
			$b='';
			$b=GetPageRecord('*',_QUOTATION_FLIGHT_MASTER_,' quotationId="'.$quotationId.'" and isFlightTaken="yes" and dayId=0 and id in (select serviceId from quotationItinerary where serviceType="flight" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0 && ($quoteData['flightCostType']==0 || $quoteData['calculationType']==3)){
				while($flightQuotData=mysqli_fetch_array($b)){
				
					$suppSql=""; 
					$suppSql=GetPageRecord('id','suppliersMaster',' 1 and self=1'); 
					$supplierData=mysqli_fetch_array($suppSql);
					$supplierId = $supplierData['id'];
					
					$lastId = ''; 
					$namevalue2 ='flightQuotationId="'.$flightQuotData['id'].'",flightId="'.$flightQuotData['flightId'].'",fromDate="'.$flightQuotData['fromDate'].'",toDate="'.$flightQuotData['toDate'].'",dayId="'.$dayId.'",quotationId="'.$quotationId.'",destinationId="'.$flightQuotData['destinationId'].'",adultCost="'.$flightQuotData['adultCost'].'",childCost="'.$flightQuotData['childCost'].'",infantCost="'.$flightQuotData['infantCost'].'",currencyId="'.$flightQuotData['currencyId'].'",currencyValue="'.$flightQuotData['currencyValue'].'",departureFrom="'.$flightQuotData['departureFrom'].'",arrivalTo="'.$flightQuotData['arrivalTo'].'",flightNumber="'.$flightQuotData['flightNumber'].'",flightClass="'.$flightQuotData['flightClass'].'",departureTime="'.$flightQuotData['departureTime'].'",arrivalTime="'.$flightQuotData['arrivalTime'].'",departureDate="'.$flightQuotData['departureDate'].'",arrivalDate="'.$flightQuotData['arrivalDate'].'",adultCost2="'.$flightQuotData['adultCost'].'",childCost2="'.$flightQuotData['childCost'].'",infantCost2="'.$flightQuotData['infantCost'].'",shareDate="'.$shareDate.'",isGuestType="'.$flightQuotData['isGuestType'].'",isLocalEscort="'.$flightQuotData['isLocalEscort'].'",isForeignEscort="'.$flightQuotData['isForeignEscort'].'",markupCost="'.$flightQuotData['markupCost'].'",markupType="'.$flightQuotData['markupType'].'",totalAdultCost="'.$flightQuotData['totalAdultCost'].'",adultTax="'.$flightQuotData['adultTax'].'",totalChildCost="'.$flightQuotData['totalChildCost'].'",childTax="'.$flightQuotData['childTax'].'",totalInfantCost="'.$flightQuotData['totalInfantCost'].'",infantTax="'.$flightQuotData['infantTax'].'",gstTax="'.$flightQuotData['gstTax'].'",adultPax="'.$flightQuotData['adultPax'].'",childPax="'.$flightQuotData['childPax'].'",infantPax="'.$flightQuotData['infantPax'].'",adultPax2="'.$flightQuotData['adultPax'].'",childPax2="'.$flightQuotData['childPax'].'",infantPax2="'.$flightQuotData['infantPax'].'",cancellationPolicy="'.$flightQuotData['cancellationPolicy'].'",isFlightTaken="'.$flightQuotData['isFlightTaken'].'",supplierId="'.$flightQuotData['supplierId'].'"';  
					$lastId = addlistinggetlastid('finalQuoteFlights',$namevalue2); 	

					// $c1 ='';
					// 	$c1=GetPageRecord('*','flightTimeLineMaster',' flightQuoteId="'.$flightQuotData['id'].'" and quotationId="'.$quotationId.'" and dayId="'.$dayId.'"');
					// 	if(mysqli_num_rows($c1)>0){
					// 	$timeData = mysqli_fetch_assoc($c1);
					// 	$timeValue = 'quotationId="'.$quotationId.'",flightQuoteId="'.$lastId.'",dayId="'.$dayId.'",flightId="'.$timeData['flightId'].'",departureDate="'.$timeData['departureDate'].'",departureTime="'.$timeData['departureTime'].'",status="'.$timeData['status'].'",deletestatus="'.$timeData['deletestatus'].'",remark="'.$timeData['remark'].'",queryId="'.$QueryDaysData['queryId'].'"';
					// 	$addTime = addlistinggetlastid('flightTimeLineMaster',$timeValue);
					// 	}

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$quoteData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="flight",startDate="'.$flightQuotData['fromDate'].'",endDate="'.$flightQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);

				}
			}


			$b='';
			$b=GetPageRecord('*',_QUOTATION_TRAINS_MASTER_,' quotationId="'.$quotationId.'" and id in (select serviceId from quotationItinerary where serviceType="train" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){
				while($trainQuotData=mysqli_fetch_array($b)){
					$suppSql=""; 
					$suppSql=GetPageRecord('id','suppliersMaster',' self=1'); 
					$supplierData=mysqli_fetch_array($suppSql);
					$supplierId = $supplierData['id'];
					
					$lastId = '';  
				 	$namevalue2 ='trainQuotationId="'.$trainQuotData['id'].'",trainId="'.$trainQuotData['trainId'].'",fromDate="'.$trainQuotData['fromDate'].'",toDate="'.$trainQuotData['toDate'].'",dayId="'.$dayId.'",currencyId="'.$trainQuotData['currencyId'].'",currencyValue="'.$trainQuotData['currencyValue'].'",destinationId="'.$trainQuotData['destinationId'].'",supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",adultCost="'.$trainQuotData['adultCost'].'",childCost="'.$trainQuotData['childCost'].'",infantCost="'.$trainQuotData['infantCost'].'",departureFrom="'.$trainQuotData['departureFrom'].'",arrivalTo="'.$trainQuotData['arrivalTo'].'",trainNumber="'.$trainQuotData['trainNumber'].'",trainClass="'.$trainQuotData['trainClass'].'",departureTime="'.$trainQuotData['departureTime'].'",arrivalTime="'.$trainQuotData['arrivalTime'].'",journeyType="'.$trainQuotData['journeyType'].'",departureDate="'.$trainQuotData['departureDate'].'",arrivalDate="'.$trainQuotData['arrivalDate'].'",adultCost2="'.$trainQuotData['adultCost'].'",childCost2="'.$trainQuotData['childCost'].'",infantCost2="'.$trainQuotData['infantCost'].'",shareDate="'.$shareDate.'",isGuestType="'.$trainQuotData['isGuestType'].'",isLocalEscort="'.$trainQuotData['isLocalEscort'].'",isForeignEscort="'.$trainQuotData['isForeignEscort'].'",markupCost="'.$trainQuotData['markupCost'].'",markupType="'.$trainQuotData['markupType'].'",adultPax="'.$trainQuotData['adultPax'].'",childPax="'.$trainQuotData['childPax'].'",infantPax="'.$trainQuotData['infantPax'].'",adultPax2="'.$trainQuotData['adultPax'].'",childPax2="'.$trainQuotData['childPax'].'",infantPax2="'.$trainQuotData['infantPax'].'",gstTax="'.$trainQuotData['gstTax'].'"';  
					$lastId = addlistinggetlastid('finalQuoteTrains',$namevalue2); 

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$quoteData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="train",startDate="'.$trainQuotData['fromDate'].'",endDate="'.$trainQuotData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);

				}
			}

			$b=''; 
			$b=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' quotationId="'.$quotationId.'" and isTransferTaken="yes" and dayId=0 and id in (select serviceId from quotationItinerary where serviceType="transfer" order by serviceId asc) order by id asc');
			if(mysqli_num_rows($b)>0){ 
				while($transferData=mysqli_fetch_array($b)){
					$lastId = '';  
					// vehicleId
					$namevalue2 ='transferQuotationId="'.$transferData['id'].'",fromDate="'.$transferData['fromDate'].'",toDate="'.$transferData['toDate'].'",dayId="'.$dayId.'",currencyId="'.$transferData['currencyId'].'",currencyValue="'.$transferData['currencyValue'].'",transferType="'.$transferData['transferType'].'",transferId="'.$transferData['transferNameId'].'",vehicleModelId="'.$transferData['vehicleModelId'].'",vehicleId="'.$transferData['vehicleId'].'",destinationId="'.$transferData['destinationId'].'",supplierId="'.$transferData['supplierId'].'",quotationId="'.$quotationId.'",vehicleCost="'.$transferData['vehicleCost'].'",vehicleCost2="'.$transferData['vehicleCost'].'",adultCost="'.$transferData['adultCost'].'",adultCost2="'.$transferData['adultCost'].'",childCost="'.$transferData['childCost'].'",childCost2="'.$transferData['childCost'].'",infantCost="'.$transferData['infantCost'].'",infantCost2="'.$transferData['infantCost'].'",noOfVehicles="'.$transferData['noOfVehicles'].'",repCost="'.$transferData['representativeEntryFee'].'",repCost2="'.$transferData['representativeEntryFee'].'",totalPax="'.$transferData['totalPax'].'",startDate="'.$transferData['startDate'].'",gstTax="'.$transferData['gstTax'].'",endDate="'.$transferData['endDate'].'",shareDate="'.$shareDate.'",markupCost="'.$transferData['markupCost'].'",markupType="'.$transferData['markupType'].'",isTransferTaken="'.$transferData['isTransferTaken'].'"';   
				 
					$lastId = addlistinggetlastid('finalQuotetransfer',$namevalue2); 

					$namevalue ='';
					$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$quoteData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="'.$transferData['serviceType'].'",startDate="'.$transferData['fromDate'].'",endDate="'.$transferData['fromDate'].'"';
					addlistinggetlastid('finalquotationItinerary',$namevalue);
				}
			}

		}


		// final Quote visa start
		$b='';
		$b=GetPageRecord('*',_QUOTATION_VISA_MASTER_,' quotationId="'.$quotationId.'" and id in (select serviceId from quotationItinerary where serviceType="visa" order by serviceId asc) order by id asc');
		if(mysqli_num_rows($b)>0 && $quoteData['visaCostType']==1){
			while($visaQuotData=mysqli_fetch_array($b)){
			
				$suppSql=""; 
				$suppSql=GetPageRecord('id','suppliersMaster',' 1 and self=1'); 
				$supplierData=mysqli_fetch_array($suppSql);
				$supplierId = $supplierData['id'];
				
				$lastId = ''; 
				$visanamevalue ='visaQuotationId="'.$visaQuotData['id'].'",fromDate="'.$visaQuotData['fromDate'].'",quotationId="'.$quotationId.'",toDate="'.$visaQuotData['toDate'].'",adultCost="'.$visaQuotData['adultCost'].'",childCost="'.$visaQuotData['childCost'].'",infantCost="'.$visaQuotData['infantCost'].'",adultCost2="'.$visaQuotData['adultCost'].'",childCost2="'.$visaQuotData['childCost'].'",infantCost2="'.$visaQuotData['infantCost'].'",visaNameId="'.$visaQuotData['serviceid'].'",name="'.$visaQuotData['name'].'",rateId="'.$visaQuotData['rateId'].'",visaTypeId="'.$visaQuotData['visaTypeId'].'",supplierId="'.$visaQuotData['supplierId'].'",startDate="'.$visaQuotData['startDate'].'",currencyId="'.$visaQuotData['currencyId'].'",currencyValue="'.$visaQuotData['currencyValue'].'",gstTax="'.$visaQuotData['gstTax'].'",adultPax="'.$visaQuotData['adultPax'].'",childPax="'.$visaQuotData['childPax'].'",infantPax="'.$visaQuotData['infantPax'].'",queryId="'.$visaQuotData['queryId'].'",markupCost="'.$visaQuotData['markupCost'].'",markupType="'.$visaQuotData['markupType'].'",processingFee="'.$visaQuotData['processingFee'].'",vfsCharges="'.$visaQuotData['vfsCharges'].'",embassyFee="'.$visaQuotData['embassyFee'].'",status="'.$visaQuotData['status'].'",deletestatus="'.$visaQuotData['deletestatus'].'",visaDate="'.$visaQuotData['visaDate'].'",visaCountryId="'.$visaQuotData['visaCountryId'].'",visaValidity="'.$visaQuotData['visaValidity'].'",entryType="'.$visaQuotData['entryType'].'"';
				$lastId = addlistinggetlastid('finalQuoteVisa',$visanamevalue);  
			
				$namevalue ='';
				$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$visaQuotData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="visa",startDate="'.$visaQuotData['fromDate'].'",endDate="'.$visaQuotData['toDate'].'"';
				addlistinggetlastid('finalquotationItinerary',$namevalue);

			}
		}
		
		$b='';
		$b=GetPageRecord('*',_QUOTATION_PASSPORT_MASTER_,' quotationId="'.$quotationId.'" and id in (select serviceId from quotationItinerary where serviceType="passport" order by serviceId asc) order by id asc');
		if(mysqli_num_rows($b)>0 && $quoteData['passportCostType']==1){
			while($passQuotData=mysqli_fetch_array($b)){
			
				$suppSql=""; 
				$suppSql=GetPageRecord('id','suppliersMaster',' 1 and self=1'); 
				$supplierData=mysqli_fetch_array($suppSql);
				$supplierId = $supplierData['id'];
				
				$lastId = ''; 
				$visanamevalue ='passportQuotationId="'.$passQuotData['id'].'",fromDate="'.$passQuotData['fromDate'].'",quotationId="'.$quotationId.'",toDate="'.$passQuotData['toDate'].'",adultCost="'.$passQuotData['adultCost'].'",childCost="'.$passQuotData['childCost'].'",infantCost="'.$passQuotData['infantCost'].'",adultCost2="'.$passQuotData['adultCost'].'",childCost2="'.$passQuotData['childCost'].'",infantCost2="'.$passQuotData['infantCost'].'",passportNameId="'.$passQuotData['serviceid'].'",name="'.$passQuotData['name'].'",rateId="'.$passQuotData['rateId'].'",passportTypeId="'.$passQuotData['passportTypeId'].'",supplierId="'.$passQuotData['supplierId'].'",startDate="'.$passQuotData['startDate'].'",currencyId="'.$passQuotData['currencyId'].'",currencyValue="'.$passQuotData['currencyValue'].'",gstTax="'.$passQuotData['gstTax'].'",adultPax="'.$passQuotData['adultPax'].'",childPax="'.$passQuotData['childPax'].'",infantPax="'.$passQuotData['infantPax'].'",queryId="'.$passQuotData['queryId'].'",markupCost="'.$passQuotData['markupCost'].'",markupType="'.$passQuotData['markupType'].'",processingFee="'.$passQuotData['processingFee'].'",status="'.$passQuotData['status'].'",deletestatus="'.$passQuotData['deletestatus'].'"';
				$lastId = addlistinggetlastid('finalQuotePassport',$visanamevalue);  
			


				$namevalue ='';
				$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$passQuotData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="passport",startDate="'.$passQuotData['fromDate'].'",endDate="'.$passQuotData['toDate'].'"';
				addlistinggetlastid('finalquotationItinerary',$namevalue);

			}
		}
		
		$b='';
		$b=GetPageRecord('*',_QUOTATION_INSURANCE_MASTER_,' quotationId="'.$quotationId.'" and id in (select serviceId from quotationItinerary where serviceType="insurance" order by serviceId asc) order by id asc');
		if(mysqli_num_rows($b)>0 && $quoteData['insuranceCostType']==1){
			while($insQuotData=mysqli_fetch_array($b)){
			
				$suppSql=""; 
				$suppSql=GetPageRecord('id','suppliersMaster',' 1 and self=1'); 
				$supplierData=mysqli_fetch_array($suppSql);
				$supplierId = $supplierData['id'];
				
				$lastId = ''; 
				$insnamevalue ='insuranceQuotationId="'.$insQuotData['id'].'",fromDate="'.$insQuotData['fromDate'].'",quotationId="'.$quotationId.'",toDate="'.$insQuotData['toDate'].'",adultCost="'.$insQuotData['adultCost'].'",childCost="'.$insQuotData['childCost'].'",infantCost="'.$insQuotData['infantCost'].'",adultCost2="'.$insQuotData['adultCost'].'",childCost2="'.$insQuotData['childCost'].'",infantCost2="'.$insQuotData['infantCost'].'",insuranceNameId="'.$insQuotData['serviceid'].'",name="'.$insQuotData['name'].'",rateId="'.$insQuotData['rateId'].'",insuranceTypeId="'.$insQuotData['insuranceTypeId'].'",supplierId="'.$insQuotData['supplierId'].'",startDate="'.$insQuotData['startDate'].'",currencyId="'.$insQuotData['currencyId'].'",currencyValue="'.$insQuotData['currencyValue'].'",gstTax="'.$insQuotData['gstTax'].'",adultPax="'.$insQuotData['adultPax'].'",childPax="'.$insQuotData['childPax'].'",infantPax="'.$insQuotData['infantPax'].'",queryId="'.$insQuotData['queryId'].'",markupCost="'.$insQuotData['markupCost'].'",markupType="'.$insQuotData['markupType'].'",processingFee="'.$insQuotData['processingFee'].'",status="'.$insQuotData['status'].'",deletestatus="'.$insQuotData['deletestatus'].'",insuranceStartDate="'.$insQuotData['insuranceStartDate'].'",insuranceEndDate="'.$insQuotData['insuranceEndDate'].'",countryId="'.$insQuotData['countryId'].'"';
				$lastId = addlistinggetlastid('finalQuoteInsurance',$insnamevalue);  
			


				$namevalue ='';
				$namevalue ='srn="'.$dayId.'",dayId="'.$dayId.'",queryId="'.$insQuotData['queryId'].'",serviceId="'.$lastId.'",quotationId="'.$quotationId.'",serviceType="insurance",startDate="'.$insQuotData['fromDate'].'",endDate="'.$insQuotData['toDate'].'"';
				addlistinggetlastid('finalquotationItinerary',$namevalue);

			}
		}
		
		//service markp
		$b='';
		$b=GetPageRecord('*','quotationServiceMarkup',' quotationId="'.$quotationId.'" order by id asc');
		if(mysqli_num_rows($b)>0){
			$serMarkupD=mysqli_fetch_array($b);
			$modevalue = '';
			$modevalue = 'markupCost="'.$serMarkupD['markupCost'].'", curren="'.$serMarkupD['curren'].'", quotationId="'.$lastQuotationId.'", hotel="'.$serMarkupD['hotel'].'", guide="'.$serMarkupD['guide'].'", activity="'.$serMarkupD['activity'].'",entrance="'.$serMarkupD['entrance'].'", transfer="'.$serMarkupD['transfer'].'",ferry="'.$serMarkupD['ferry'].'", cruise="'.$serMarkupD['cruise'].'", train="'.$serMarkupD['train'].'", flight="'.$serMarkupD['flight'].'",restaurant="'.$serMarkupD['restaurant'].'",visa="'.$serMarkupD['visa'].'",passport="'.$serMarkupD['passport'].'",insurance="'.$serMarkupD['insurance'].'",other="'.$serMarkupD['other'].'",hotelMarkupType="'.$serMarkupD['hotelMarkupType'].'", guideMarkupType="'.$serMarkupD['guideMarkupType'].'", activityMarkupType="'.$serMarkupD['activityMarkupType'].'", entranceMarkupType="'.$serMarkupD['entranceMarkupType'].'", transferMarkupType="'.$serMarkupD['transferMarkupType'].'",ferryMarkupType="'.$serMarkupD['ferryMarkupType'].'",cruiseMarkupType="'.$serMarkupD['cruiseMarkupType'].'", trainMarkupType="'.$serMarkupD['trainMarkupType'].'", flightMarkupType="'.$serMarkupD['flightMarkupType'].'", restaurantMarkupType="'.$serMarkupD['restaurantMarkupType'].'",visaMarkupType="'.$serMarkupD['visaMarkupType'].'",passportMarkupType="'.$serMarkupD['passportMarkupType'].'",insuranceMarkupType="'.$serMarkupD['insuranceMarkupType'].'",otherMarkupType="'.$serMarkupD['otherMarkupType'].'", status="'.$serMarkupD['status'].'"';
			$markup = addlistinggetlastid('finalServiceMarkup',$modevalue);
		}

		// DELETE UNSELECTED SERVICES **********************************************************

		// GUIDE DELETE
		mysqli_query(db(),'delete from quotationGuideMaster where quotationId="'.$quotationId.'" and isSelectedFinal=0');
		mysqli_query(db(),'delete from quotationItinerary where serviceType="guide" and quotationId="'.$quotationId.'" and serviceId in ( select id from quotationGuideMaster where quotationId="'.$quotationId.'" and isSelectedFinal=0 )');

		// HOTEL DELETE
		mysqli_query(db(),'delete from quotationHotelMaster where quotationId="'.$quotationId.'" and isSelectedFinal=0');
		mysqli_query(db(),'delete from quotationItinerary where serviceType="hotel" and quotationId="'.$quotationId.'" and serviceId in ( select id from quotationHotelMaster where quotationId="'.$quotationId.'" and isSelectedFinal=0 )');
		//END DELETE UNSELECTED SERVICES **********************************************************

		// end FINALIZED 
	}
	// *************************************************end of the moving data*****************************************************
	if($_REQUEST['quotationType'] == 2){
		$namevalue ='status="'.$_REQUEST['status'].'",finalcategory="'.$_REQUEST['finalcategory'].'"';
		$update = updatelisting(_QUOTATION_MASTER_,$namevalue,'id="'.$_REQUEST['id'].'"');
	}

	// make quotation mark as  do not delete
	updatelisting(_QUOTATION_MASTER_,'deletestatusDuplicate=0','id="'.$_REQUEST['id'].'"');
	
	//make final to this quotation and query 
	$update = updatelisting(_QUERY_MASTER_,'queryStatus=3','id="'.$_REQUEST['queryid'].'"');
	// saved
	if($_REQUEST['parentId']!=''){
		$url=$fullurl.'showpage.crm?module=query&view=yes&id='.$_REQUEST['parentId'].'&tourextension=1';
	}else{
		$url=$fullurl.'showpage.crm?module=query&view=yes&id='.encode($_REQUEST['queryid']).'&b2bquotation=1&qtype=1';
	}
	if($_REQUEST['status'] == 1 && $_REQUEST['quotationType']=='2'){
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.setupbox('<?php echo $url; ?>');
		parent.alertspopupopenClose();
		</script>
		<?php
	}else{
		header('location:'.$url);
		exit();
	}
}
if(trim($_POST['action'])=='changePIN' && $_POST['oldpin']!='' && $_POST['newpin']!='' && $_POST['confirmpin']!=''){
	$select='*';
	$where='id="37"';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	$userdetails=mysqli_fetch_array($rs);
	$oldpassword=($_POST['oldpin']);
	$newpassword=($_POST['newpin']);
	$confirmpassword=($_POST['confirmpin']);
	if(($oldpassword)!=$userdetails['pin']){ ?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	alert('The old PIN you have entered is incorrect');
	</script>
	<?php
	exit();
	}
	if($newpassword!=$confirmpassword){ ?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	alert('PIN and confirm password does not match');
	</script>
	<?php
	exit();
	}
	$namevalue ='pin="'.($confirmpassword).'"';
	$where='id="37"';
	updatelisting(_USER_MASTER_,$namevalue,$where);
	include "config/mail.php";
	$fromemail='';
	$mailto=$userdetails['email'];
	$ccmail='';
	$mailsubject='Your TravCRM account PIN has been changed!';
	$maildescription='Your TravCRM account PIN has been changed.<br><br>If you did not change your PIN please contact your Administrator<br><br>Thank You<br>Team TravCRM';
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
	if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	
		?>
		<script>
		alert('Your PIN has been reset successfully!');
		parent.window.location.href='setupsetting.crm?module=personalsettings';
		</script>
		<?php exit();
	}
}
if(trim($_REQUEST['action'])=='makeFinalQuotation' && trim($_REQUEST['makefinal'])!='' && trim($_REQUEST['quotationId'])!='' && trim($_REQUEST['queryId'])!=''){
$namevalue ='finalQuotationType="'.trim($_REQUEST['makefinal']).'"';
$where='id="'.decode($_REQUEST['quotationId']).'"';
$update = updatelisting(_QUOTATION_MASTER_,$namevalue,$where);
?>
<script>
parent.setupbox('showpage.crm?module=quotations&view=yes&id=<?php echo ($_REQUEST['quotationId']); ?>');
</script>
<?php
exit();
} 

if($_REQUEST['action']=='loadWelcomeNoteSupplier' && $_REQUEST['suppId']!=''){
	$suppId = $_REQUEST['suppId']; 
	$emailTemplateId=$_REQUEST['id']; 
	$where2='';
	$rs2=''; 
	if($emailTemplateId>0){
	    $where2='id="'.$emailTemplateId.'"';
	}else{
	    $where2=' 1 order by id asc limit 1';
	}

	$rs2=GetPageRecord('*',_EMAIL_TEMPLATE_MASTER_,$where2);
	$resemail=mysqli_fetch_array($rs2);
 	?>
 	<textarea name="replysupcontent" rows="20" class="gridfield" id="replysupcontent<?php echo $suppId; ?>" style=" height:220px !important;"  >
 		<?php if($resemail['mailbody']!='') { echo nl2br($resemail['mailbody']); } else{ echo "Please Provide the rates of below Services - "; } ?>
 	</textarea>
	<script type="text/javascript">
	    tinymce.init({
	        selector: "#replysupcontent<?php echo $suppId; ?>",
	        themes: "modern",
			relative_urls: false,
			remove_script_host: false,
	        plugins: [
	            "advlist autolink lists link image charmap print preview anchor",
	            "searchreplace visualblocks code fullscreen"
	        ],
	        toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"
	    }); 
	</script>
 	<?php
	exit();
}
 

if(trim($_POST['action'])=='addotherActivityPrice' && trim($_POST['activitySupplierId'])!='' && trim($_POST['otherActivityNameId'])!='' && trim($_POST['currencyId'])!=''){
	$activitySupplierId=clean($_REQUEST['activitySupplierId']);
	$otherActivityNameId=addslashes($_POST['otherActivityNameId']);
	
	$remarks=addslashes($_POST['remarks']);
	$status=addslashes($_POST['status']);
	$currencyId=addslashes($_POST['currencyId']);
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
	$toDate=date("Y-m-d", strtotime($_POST['toDate']));


	$ransferType=addslashes($_POST['ActransferType']);
	$markupType=addslashes($_POST['markupType']);
	$markupCost=addslashes($_POST['markupCost']);
	$gstTax=addslashes($_POST['gstTax']);

	$adultCost=addslashes($_POST['adultCost']);
	$childCost=addslashes($_POST['childCost']);
	$infantCost=addslashes($_POST['infantCost']);
	$vehicleCost=addslashes($_POST['vehicleCost']);
	$vehicleId=addslashes($_POST['vehicleId']);
	$repCost=addslashes($_POST['repCost']);
	$ticketAdultCost=addslashes($_POST['ticketAdultCost']);
	$ticketchildCost=addslashes($_POST['ticketchildCost']);
	$ticketinfantCost=addslashes($_POST['ticketinfantCost']);
	$nationalityType=addslashes($_POST['nationalityType']);
	$tarifType=addslashes($_POST['tarifType']);


	$dateAdded=time();
	$namevalue ='supplierId="'.$activitySupplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",otherActivityNameId="'.$otherActivityNameId.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",vehicleId="'.$vehicleId.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",remarks="'.$remarks.'",serviceid="'.$otherActivityNameId.'",transferType="'.$ransferType.'",tarifType="'.$tarifType.'",nationality="'.$nationalityType.'"';
	$lastid = addlistinggetlastid('dmcotherActivityRate',$namevalue);
	$msgbox = 1;
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.funloadotherActivitymaster();
	parent.setupbox('showpage.crm?module=otherActivityMaster&keyword=&view=yes&otherActivityNameId=<?php echo encode($otherActivityNameId); ?>&alt=<?php echo $msgbox; ?>');
	</script>
	<?php
	exit();
}
if(trim($_POST['action'])=='editdmcotherActivityRate' && trim($_POST['currencyId2'])!='' && trim($_POST['otherActivityNameId2'])!=''){
	$dmcotherActivityNameId=clean($_REQUEST['otherActivityNameId2']);
	$activityCost=addslashes($_POST['activityCost2']);
	$maxpax=addslashes($_POST['maxpax2']);
	$perPaxCost=addslashes($_POST['perPaxCost2']);
	$remarks=addslashes($_POST['remarks2']);
	$status=addslashes($_POST['status2']);
	$currencyId=addslashes($_POST['currencyId2']);
	$marketTypeId2=clean($_REQUEST['marketTypeId2']);
	$fromDate=date('Y-m-d',strtotime($_REQUEST['fromDate2']));
	$toDate=date('Y-m-d',strtotime($_REQUEST['toDate2']));
	$activitySupplierId=clean($_REQUEST['activitySupplierId2']);

	$ransferType=addslashes($_POST['ActransferType2']);
	$markupType=addslashes($_POST['markupType2']);
	$markupCost=addslashes($_POST['markupCost2']);
	$gstTax=addslashes($_POST['gstTax2']);

	$adultCost=addslashes($_POST['adulttptCost2']);
	$childCost=addslashes($_POST['childtptCost2']);
	$infantCost=addslashes($_POST['infanttptCost2']);
	$vehicleCost=addslashes($_POST['vehicleCost2']);
	$vehicleId=addslashes($_POST['vehicleId2']);
	$repCost=addslashes($_POST['repCost2']);
	$ticketAdultCost=addslashes($_POST['tickettptAdultCost2']);
	$ticketchildCost=addslashes($_POST['tickettptchildCost2']);
	$ticketinfantCost=addslashes($_POST['tickettptinfantCost2']);
	$nationalityType=addslashes($_POST['nationalityType']);
	$tarifType=addslashes($_POST['tarifType']);


	$dateAdded=time();
	$namevalue ='fromDate="'.$fromDate.'",toDate="'.$toDate.'",activityCost="'.$activityCost.'",supplierId="'.$activitySupplierId.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",vehicleId="'.$vehicleId.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",status="'.$status.'",currencyId="'.$currencyId.'",remarks="'.$remarks.'",transferType="'.$ransferType.'"';
	$where='id="'.$dmcotherActivityNameId.'"';
	$update = updatelisting('dmcotherActivityRate',$namevalue,$where);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.funloadotherActivitymaster();
	parent.$('#alertnotificationsmainbox').hide();
	parent.alertspopupopenClose();
	</script>
	<?php
	exit();
}
if(trim($_POST['action'])=='addGuidePorterPrice' && trim($_POST['supplierId'])!='' && trim($_POST['serviceid'])!='' && trim($_POST['currencyId'])!=''){
	$supplierId=clean($_REQUEST['supplierId']);
	$price=addslashes($_POST['price']);
	$paxRange=addslashes($_POST['paxRange']);
	$paxRangeFrom=addslashes($_POST['paxRangeFrom']);
	$paxRangeTo=addslashes($_POST['paxRangeTo']);
	if($paxRange == "1_5"){
		$CostsheetOrder = 1;
	}
	if($paxRange == "6_14"){
		$CostsheetOrder = 2;
	}
	if($paxRange == "15_40"){
		$CostsheetOrder = 3;
	}
	 //	$paxRange=$paxRangeFrom.'_'.$paxRangeTo;
		// $CostsheetOrder = 2;
	$fromDate=date('Y-m-d',strtotime($_POST['fromDate']));
	$toDate=date('Y-m-d',strtotime($_POST['toDate']));
	$dayType=addslashes($_POST['dayType']);
	if($_POST['universalCost'] == 1){
		$guidePorterId = $_REQUEST['guidePorterId'];
	}
	$serviceType=addslashes($_POST['serviceType']);
	$serviceid=addslashes($_POST['serviceid']);
	$status=addslashes($_POST['status']);
	$currencyId=addslashes($_POST['currencyId']);
	$dateAdded=time();
	$marketType=addslashes($_POST['marketType']);


	$markupType=addslashes($_POST['markupType']);
	$markupCost=addslashes($_POST['markupCost']);
	$gstTax=addslashes($_POST['gstTax']);

	$rs=GetPageRecord('*','dmcGuidePorterRate',' supplierId="'.$supplierId.'" and ( fromDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" OR "'.$fromDate.'" BETWEEN fromDate and toDate ) and  dayType="'.$dayType.'" and paxRange="'.$paxRange.'" and serviceid="'.$serviceid.'"');
	if(mysqli_num_rows($rs)==0){
		$namevalue ='supplierId="'.$supplierId.'",price="'.$price.'",dayType="'.$dayType.'",paxRange="'.$paxRange.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",guidePorterId="'.$guidePorterId.'",dateAdded="'.$dateAdded.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",remarks="'.$remarks.'",CostsheetOrder="'.$CostsheetOrder.'",serviceid="'.$serviceid.'",marketType="'.$marketType.'"';
		$lastid = addlistinggetlastid('dmcGuidePorterRate',$namevalue);
		$msgbox = 1;
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.funloadguidesubcatmaster();
	parent.setupbox('showpage.crm?module=guidesubcatmaster&view=yes&guidesubcatId=<?php echo encode($serviceid); ?>&alt=<?php echo $msgbox; ?>');
	</script>
	<?php
	}else{
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.alert('Guide/Porter tariff already exist.');
	parent.funloadguidesubcatmaster();
	</script>
	<?php
	}
	exit();
}
if(trim($_POST['action'])=='editGuidePorterPrice' && trim($_POST['currencyId2'])!='' && trim($_POST['serviceid2'])!=''){
	$tariffId=clean($_REQUEST['tariffId2']);
	$supplierId=clean($_REQUEST['supplierId2']);
	$price=addslashes($_POST['price2']);
	$paxRange=addslashes($_POST['paxRange2']);
	if($paxRange == "1_5"){
		$CostsheetOrder = 1;
	}
	if($paxRange == "6_14"){
		$CostsheetOrder = 2;
	}
	if($paxRange == "15_40"){
		$CostsheetOrder = 3;
	}
	$fromDate=date('Y-m-d',strtotime($_POST['fromDate2']));
	$toDate=date('Y-m-d',strtotime($_POST['toDate2']));
	$dayType=addslashes($_POST['dayType2']);
	if($_POST['universalCost2'] == 1){
		$guidePorterId = $_REQUEST['guidePorterId2'];
	}
 	$serviceid=addslashes($_POST['serviceid2']);
	$status=addslashes($_POST['status2']);
	$currencyId=addslashes($_POST['currencyId2']);
	$marketTypeId2=clean($_REQUEST['marketTypeId2']);
	$dateAdded=time();


	$markupType=addslashes($_POST['markupType2']);
	$markupCost=addslashes($_POST['markupCost2']);
	$gstTax=addslashes($_POST['gstTax2']);


	// echo ' supplierId="'.$supplierId.'" and ( fromDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" OR "'.$fromDate.'" BETWEEN fromDate and toDate ) and  dayType="'.$dayType.'" and paxRange="'.$paxRange.'" and serviceid="'.$serviceid.'" and price="'.$price.'" and id != "'.$tariffId.'"';
 	if($fromDate < $toDate){
		$rs=GetPageRecord('*','dmcGuidePorterRate',' supplierId="'.$supplierId.'" and ( fromDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" OR "'.$fromDate.'" BETWEEN fromDate and toDate ) and  dayType="'.$dayType.'" and paxRange="'.$paxRange.'" and serviceid="'.$serviceid.'" and price="'.$price.'" and id != "'.$tariffId.'"');
		if(mysqli_num_rows($rs) == 0 ){
			$namevalue ='supplierId="'.$supplierId.'",price="'.$price.'",dayType="'.$dayType.'",paxRange="'.$paxRange.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",guidePorterId="'.$guidePorterId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",CostsheetOrder="'.$CostsheetOrder.'",remarks="'.$remarks.'",serviceid="'.$serviceid.'",marketType="'.$marketTypeId2.'"';
			$where='id="'.$tariffId.'"';
			$update = updatelisting('dmcGuidePorterRate',$namevalue,$where);
			?>
			<script>
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
			parent.funloadguidesubcatmaster();
			parent.$('#alertnotificationsmainbox').hide();
			parent.alertspopupopenClose();
			</script>
			<?php
		}else{
			?>
			<script>
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
			parent.alert('Guide/Porter tariff already exist.');
			parent.funloadguidesubcatmaster();
			parent.$('#alertnotificationsmainbox').hide();
			parent.alertspopupopenClose();
			</script>
			<?php
		}
	}else{
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alert('Invalid duration.');
		parent.funloadguidesubcatmaster();
		parent.$('#alertnotificationsmainbox').hide();
		parent.alertspopupopenClose();
		</script>
		<?php
	}
	exit();
}



if(trim($_POST['action'])=='addDmcAirlineRate' && trim($_POST['dmcAdultCost'])!='' && trim($_POST['dmcServiceId'])!='' && trim($_POST['dmcCurrencyId'])!=''){
	$flightNumber=addslashes($_POST['dmcFlightNumber']);
	$flightClass=addslashes($_POST['dmcFlightClass']);
	$currencyId=addslashes($_POST['dmcCurrencyId']);
	$adultCost=addslashes($_POST['dmcAdultCost']);
	$childCost=addslashes($_POST['dmcChildCost']);
	$infantCost=addslashes($_POST['dmcInfantCost']);
	$baggageAllowance=addslashes($_POST['dmcBaggageAllowance']);
	$serviceId=addslashes($_POST['dmcServiceId']);
	$remarks=addslashes($_POST['dmcRemarks']);
	$status=addslashes($_POST['dmcStatus']);
	$dateAdded=time();
	$gstTax=addslashes($_POST['dmcGstTax']);
	
	$supplierId=addslashes($_POST['supplierId']);
	$fromDestination=addslashes($_POST['fromDestination']);
	$toDestination=addslashes($_POST['toDestination']);
	
	$airlaineTaxA=addslashes($_REQUEST['airlaineTaxA']);

	$totalCostA=addslashes($_REQUEST['totalCostA']);

	$airlaineTaxC=addslashes($_REQUEST['airlaineTaxC']);

	$totalCostC=addslashes($_REQUEST['totalCostC']);

	$airlaineTaxE=addslashes($_REQUEST['airlaineTaxE']);

	$totalCostE=addslashes($_REQUEST['totalCostE']);
	$cancellation=addslashes($_REQUEST['cancellation']);

	$markupType=addslashes($_POST['markupType']);
	$markupCost=addslashes($_POST['markupCost']);

	
	$rs=GetPageRecord('*','dmcAirlineMasterRate',' 1 and flightNumber="'.$flightNumber.'" and flightClass="'.$flightClass.'" and currencyId="'.$currencyId.'" and serviceId="'.$serviceId.'"');
	if(mysqli_num_rows($rs)==0){
		$namevalue ='supplierId="'.$supplierId.'",marketType="'.$marketType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",baggageAllowance="'.$baggageAllowance.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",flightNumber="'.$flightNumber.'",flightClass="'.$flightClass.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",remarks="'.$remarks.'",CostsheetOrder="'.$CostsheetOrder.'",serviceId="'.$serviceId.'",adultTax="'.$airlaineTaxA.'",totalAdultCost="'.$totalCostA.'",childTax="'.$airlaineTaxC.'",totalChildCost="'.$totalCostC.'",infantTax="'.$airlaineTaxE.'",totalInfantCost="'.$totalCostE.'",cancellationPolicy="'.$cancellation.'",fromDestination="'.$fromDestination.'",toDestination="'.$toDestination.'"';
		$lastid = addlistinggetlastid('dmcAirlineMasterRate',$namevalue);
		$msgbox = 1;
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.funloadairlinemaster();
		parent.setupbox('showpage.crm?module=packageairlinemaster&view=yes&id=<?php echo encode($serviceId); ?>&alt=<?php echo $msgbox; ?>');
		</script>
		<?php
	}else{
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alert('Airline tariff already exist.');
		parent.funloadairlinemaster();
		</script>
		<?php
	}
	exit();
}

if(trim($_POST['action'])=='editDmcAirlineRate' && trim($_POST['dmcCurrencyId2'])!='' && trim($_POST['dmcServiceId2'])!=''){
	// echo '<pre>';
	// print_r($_POST);
	// exit;
	// $supplierId=clean($_REQUEST['dmcSupplierId']);
	// $fromDate=date('Y-m-d',strtotime($_POST['dmcFromDate']));
	// $toDate=date('Y-m-d',strtotime($_POST['dmcToDate']));
	// $marketType=addslashes($_POST['dmcMarketType']);
	$tariffId=clean($_REQUEST['dmcTariffId2']);
	$flightNumber=addslashes($_POST['dmcFlightNumber2']);
	$flightClass=addslashes($_POST['dmcFlightClass2']);
	$currencyId=addslashes($_POST['dmcCurrencyId2']);
	$adultCost=addslashes($_POST['dmcAdultCost2']);
	$childCost=addslashes($_POST['dmcChildCost2']);
	$infantCost=addslashes($_POST['dmcInfantCost2']);
	$baggageAllowance=addslashes($_POST['dmcBaggageAllowance2']);
	$serviceId=addslashes($_POST['dmcServiceId2']);
	$status=addslashes($_POST['dmcStatus2']);
	$remarks=addslashes($_POST['dmcRemarks2']);
	$dateAdded=time();

	$gstTax=addslashes($_POST['dmcGstTax1']);
	$supplierId=addslashes($_POST['DMCFsupplierId']);
	$fromDestination=addslashes($_POST['fromDestination1']);
	$toDestination=addslashes($_POST['toDestination1']);

	$airlaineTaxA=addslashes($_REQUEST['dmcAdultTax']);

	$totalCostA=addslashes($_REQUEST['dmcTotalCostA']);

	$airlaineTaxC=addslashes($_REQUEST['dmcChildTax']);

	$totalCostC=addslashes($_REQUEST['dmcTotalCostC']);

	$airlaineTaxE=addslashes($_REQUEST['dmcInfantTax']);

	$totalCostE=addslashes($_REQUEST['dmcTotalCostE']);

	$cancellation=addslashes($_REQUEST['cancellationPolicy']);

	$markupType=addslashes($_POST['markupTypeDF']);
	$markupCost=addslashes($_POST['markupCostDF']);
		
		$namevalue ='supplierId="'.$supplierId.'",flightClass="'.$flightClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",baggageAllowance="'.$baggageAllowance.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",remarks="'.$remarks.'",CostsheetOrder="'.$CostsheetOrder.'",adultTax="'.$airlaineTaxA.'",totalAdultCost="'.$totalCostA.'",childTax="'.$airlaineTaxC.'",totalChildCost="'.$totalCostC.'",infantTax="'.$airlaineTaxE.'",totalInfantCost="'.$totalCostE.'",cancellationPolicy="'.$cancellation.'",fromDestination="'.$fromDestination.'",toDestination="'.$toDestination.'"';

		$where='id="'.$tariffId.'"';
		$update = updatelisting('dmcAirlineMasterRate',$namevalue,$where);
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.funloadairlinemaster();
		parent.$('#alertnotificationsmainbox').hide();
		parent.alertspopupopenClose();
		</script>
		<?php

}

if(trim($_POST['action'])=='addDmcTrainRate' && trim($_POST['dmcAdultCost'])!='' && trim($_POST['dmcServiceId'])!='' && trim($_POST['dmcCurrencyId'])!=''){
	$trainNumber=addslashes($_POST['dmcTrainNumber']);
	$journeyType=addslashes($_POST['dmcJourneyType']);
	$trainClass=addslashes($_POST['dmcTrainClass']);
	$currencyId=addslashes($_POST['dmcCurrencyId']);
	$adultCost=addslashes($_POST['dmcAdultCost']);
	$childCost=addslashes($_POST['dmcChildCost']);
	$infantCost=addslashes($_POST['dmcInfantCost']);
	$baggageAllowance=addslashes($_POST['dmcBaggageAllowance']);
	$serviceId=addslashes($_POST['dmcServiceId']);
	$status=addslashes($_POST['dmcStatus']);
	$dateAdded=time();
	$remarks=addslashes($_POST['dmcRemarks']);
	
	$gstTax=addslashes($_POST['dmcGstTax']);
	$markupType=addslashes($_POST['markupType']);
	$markupCost=addslashes($_POST['markupCost']);

	// $rs=GetPageRecord('*','dmcTrainMasterRate',' supplierId="'.$supplierId.'" and ( fromDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" OR "'.$fromDate.'" BETWEEN fromDate and toDate ) and  dayType="'.$dayType.'" and paxRange="'.$paxRange.'" and serviceId="'.$serviceId.'"');
	$rs=GetPageRecord('*','dmcTrainMasterRate',' 1 and trainNumber="'.$trainNumber.'"  and trainClass="'.$trainClass.'" and journeyType="'.$journeyType.'" and currencyId="'.$currencyId.'" and serviceId="'.$serviceId.'"');
	if(mysqli_num_rows($rs)==0){
		$namevalue ='supplierId="'.$supplierId.'",journeyType="'.$journeyType.'",trainClass="'.$trainClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",baggageAllowance="'.$baggageAllowance.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",trainNumber="'.$trainNumber.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",remarks="'.$remarks.'",serviceId="'.$serviceId.'"';
		$lastid = addlistinggetlastid('dmcTrainMasterRate',$namevalue);
		$msgbox = 1;
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.funloadtrainmaster();
		parent.setupbox('showpage.crm?module=trainmaster&view=yes&id=<?php echo encode($serviceId); ?>&alt=<?php echo $msgbox; ?>');
		</script>
		<?php
	}else{
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alert('Train tariff already exist.');
		parent.funloadtrainmaster();
		</script>
		<?php
	}
	exit();
}

if(trim($_POST['action'])=='editDmcTrainRate' && trim($_POST['dmcCurrencyId2'])!='' && trim($_POST['dmcServiceId2'])!=''){
 
	$tariffId=clean($_REQUEST['dmcTariffId2']);
	$trainNumber=addslashes($_POST['dmcTrainNumber2']);
	$journeyType=addslashes($_POST['dmcJourneyType2']);
	$trainClass=addslashes($_POST['dmcTrainClass2']);

	$currencyId=addslashes($_POST['dmcCurrencyId2']);
	$adultCost=addslashes($_POST['dmcAdultCost2']);
	$childCost=addslashes($_POST['dmcChildCost2']);
	$infantCost=addslashes($_POST['dmcInfantCost2']);
	$baggageAllowance=addslashes($_POST['dmcBaggageAllowance2']);
	$serviceId=addslashes($_POST['dmcServiceId2']);
	$status=addslashes($_POST['dmcStatus2']);
	$remarks=addslashes($_POST['dmcRemarks2']);
	$dateAdded=time();

	$gstTax=addslashes($_POST['dmcGstTax2']);
	$markupType=addslashes($_POST['markupTypeDMC']);
	$markupCost=addslashes($_POST['markupCostDMC']);
	
	$rs=GetPageRecord('*','dmcTrainMasterRate',' 1 and trainNumber="'.$trainNumber.'"  and trainClass="'.$trainClass.'" and journeyType="'.$journeyType.'" and currencyId="'.$currencyId.'" and serviceId="'.$serviceId.'" and id != "'.$tariffId.'"');
	if(mysqli_num_rows($rs) == 0 ){ 
		
		$namevalue ='supplierId="'.$supplierId.'",journeyType="'.$journeyType.'",trainClass="'.$trainClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",currencyId="'.$currencyId.'",infantCost="'.$infantCost.'",baggageAllowance="'.$baggageAllowance.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",remarks="'.$remarks.'"';

		$where='id="'.$tariffId.'"';
		$update = updatelisting('dmcTrainMasterRate',$namevalue,$where);
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.funloadtrainmaster();
		parent.$('#alertnotificationsmainbox').hide();
		parent.alertspopupopenClose();
		</script>
		<?php
	}else{
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alert('Train tariff already exist.');
		parent.funloadtrainmaster();
		parent.$('#alertnotificationsmainbox').hide();
		parent.alertspopupopenClose();
		</script>
		<?php
	}
	exit();
}

if($_REQUEST['action']=="saverestaurantsmealplan" && $_POST['serviceId']!=''){

	$mealPlanType=clean($_POST['mealPlanType']); 
	$childCost=clean($_POST['childCostRest']);    
	$adultCost=clean($_POST['adultCostRest']); 
	$currencyId=clean($_POST['currencyId']);
	$RestaurantGST=clean($_POST['RestaurantGST']);
	$serviceId = $_POST['serviceId'];

	$markupType = $_POST['markupType'];
	$markupCost = $_POST['markupCost'];

	$selectmp='*';    
    $wheremp='mealPlanType="'.$mealPlanType.'" and serviceId="'.$serviceId.'" and status=1';  
    $rsmp=GetPageRecord($selectmp,'dmcRestaurantsMealPlanRate',$wheremp); 
    if(mysqli_num_rows($rsmp)==0){
		$namevalue ='childCost="'.$childCost.'",adultCost="'.$adultCost.'",currencyId="'.$currencyId.'",restaurantId="'.$serviceId.'",serviceId="'.$serviceId.'",mealPlanType="'.$mealPlanType.'",RestaurantGST="'.$RestaurantGST.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",status="1"'; 
		$lastid = addlistinggetlastid('dmcRestaurantsMealPlanRate',$namevalue);
		$msgbox = 1; 
		?>
		<script>
		parent.funloadinboundmealplanmaster();
		</script>
	 	<?php 
	 }else{?>
		<script type="text/javascript">  
		parent.alert("Meal Type already exist, Please Select another Meal Type");
		parent.funloadinboundmealplanmaster();
		</script>
	 	<?php 
	} 
}

if( $_REQUEST['action'] =='deleterestaurantsmealplan' && $_REQUEST['tariffId']>0){   
	$sql_del="delete from dmcRestaurantsMealPlanRate  where id='".($_REQUEST['tariffId'])."'"; 
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
	?>
	<script>
	   parent.funloadinboundmealplanmaster();
	</script>
	<?php
}

//START - add/edit quotation level rates before adding to quotation
if(trim($_POST['action'])=='addQuotationGuidePrice' && trim($_POST['guideSupplierId'])!='' && trim($_POST['serviceid'])!='' && trim($_POST['currencyId'])!=''){
	$guideeditId=clean($_REQUEST['editId']);
	$rateId=clean($_REQUEST['rateId']);
	$quotationId=clean($_REQUEST['quotationId']);
	$supplierId=clean($_REQUEST['guideSupplierId']);
	$price=addslashes($_POST['price']);
	$languageAllowance=addslashes($_POST['languageAllowance']);
	$otherCost=addslashes($_POST['otherCost']);
	$paxRange=addslashes($_POST['paxRange']);
	$paxRangeFrom=addslashes($_POST['paxRangeFrom']);
	$paxRangeTo=addslashes($_POST['paxRangeTo']);
	if($paxRange == "1_5"){
		$CostsheetOrder = 1;
	}
	if($paxRange == "6_14"){
		$CostsheetOrder = 2;
	}
	if($paxRange == "15_40"){
		$CostsheetOrder = 3;
	}
	$fromDate=date('Y-m-d',strtotime($_POST['fromDate']));
	$toDate=date('Y-m-d',strtotime($_POST['toDate']));
	$dayType=addslashes($_POST['dayType']);
	if($_POST['universalCost'] == 1){
		$guidePorterId = $_REQUEST['guidePorterId'];
	}
	$serviceType=addslashes($_POST['serviceType']);
	$serviceid=addslashes($_POST['serviceid']);
	$currencyId=addslashes($_POST['currencyId']);
	$currencyValue=addslashes($_POST['currencyValue']);
	$dateAdded=time();
	$marketType=addslashes($_POST['marketType']);
	$guideGST=addslashes($_POST['guideGST']);

	$markupType=addslashes($_POST['markupType']);
	$markupCost=addslashes($_POST['markupCost']);

	$namevalue ='supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",guiderateId="'.$rateId.'",price="'.$price.'",languageAllowance="'.$languageAllowance.'",otherCost="'.$otherCost.'",dayType="'.$dayType.'",paxRange="'.$paxRange.'",addBy="'.$_SESSION['userid'].'",guidePorterId="'.$guidePorterId.'",dateAdded="'.$dateAdded.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",remarks="'.$remarks.'",CostsheetOrder="'.$CostsheetOrder.'",serviceid="'.$serviceid.'",status=1,marketType="'.$marketType.'",guideGST="'.$guideGST.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
	if($_POST['editId']!=''){
		$whereee = 'id="'.$_POST['editId'].'"';
		updatelisting('quotationGuideRateMaster',$namevalue,$whereee);
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.loadsearchguidefunction();
		</script>
		<?php 
	}else{
		$lastid = addlistinggetlastid('quotationGuideRateMaster',$namevalue);
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.loadsearchguidefunction();
		</script>
		<?php
	}
}

if(trim($_REQUEST['action'])=='addQuotationActivityPrice' && trim($_REQUEST['act_supplierId'])!='' && trim($_REQUEST['act_serviceId'])!='' && trim($_REQUEST['act_currencyId'])!='' && trim($_REQUEST['act_currencyValue'])!=''){
	
	$supplierId = clean($_REQUEST['act_supplierId']);
	$tarifType = clean($_REQUEST['act_tarifType']);
	$transferType = clean($_REQUEST['act_transferType']);
	$ticketAdultCost = clean($_REQUEST['act_ticketAdultCost']);
	$adultPax = clean($_REQUEST['act_adultPax']);
	$ticketchildCost = clean($_REQUEST['act_ticketchildCost']);
	$childPax = clean($_REQUEST['act_childPax']);
	$ticketinfantCost = clean($_REQUEST['act_ticketinfantCost']);
	$infantPax = clean($_REQUEST['act_infantPax']);
	$currencyId = clean($_REQUEST['act_currencyId']);
	$currencyValue = clean($_REQUEST['act_currencyValue']);
	$repCost = clean($_REQUEST['act_repCost']);
	$transferAdultCost = clean($_REQUEST['act_transferAdultCost']);
	$transferChildCost = clean($_REQUEST['act_transferChildCost']);
	$transferInfantCost = clean($_REQUEST['act_transferInfantCost']);
	$vehicleType = clean($_REQUEST['act_vehicleType']);
	$vehicleCost = clean($_REQUEST['act_vehicleCost']);
	$noOfVehicles = clean($_REQUEST['act_noOfVehicles']);
	$markupType = clean($_REQUEST['act_markupType']);
	$markupCost = clean($_REQUEST['act_markupCost']);
	$gstTax = clean($_REQUEST['act_gstTax']);
	$remark = clean($_REQUEST['act_remark']); 
	$serviceId = clean($_REQUEST['act_serviceId']);
	$quotationId = clean($_REQUEST['act_quotationId']);
	$dayId = clean($_REQUEST['act_dayId']);
	$rateid = clean($_REQUEST['act_rateid']);
	$tableN = clean($_REQUEST['act_tableN']);

	$rs1=GetPageRecord(' * ',_QUOTATION_MASTER_,'id="'.$quotationId.'"'); 
	$quotationData = mysqli_fetch_array($rs1);

	$fromDate=date('Y-m-d',strtotime($quotationData['fromDate']));
	$toDate=date('Y-m-d',strtotime($quotationData['toDate']));

	$dateAdded=date('Y-m-d');  
	if($_REQUEST['act_rateid'] > 0 && $_REQUEST['act_tableN'] == 2){
		$editId = $_REQUEST['act_rateid'];
		
		$namevalue='supplierId="'.$supplierId.'",tarifType="'.$tarifType.'",transferType="'.$transferType.'",vehicleId="'.$vehicleType.'",gstTax="'.$gstTax.'",markupCost="'.$markupCost.'",markupType="'.$markupType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",ticketAdultCost="'.$ticketAdultCost.'",adultPax="'.$adultPax.'",ticketchildCost="'.$ticketchildCost.'",childPax="'.$childPax.'",ticketinfantCost="'.$ticketinfantCost.'",infantPax="'.$infantPax.'",adultCost="'.$transferAdultCost.'",childCost="'.$transferChildCost.'",infantCost="'.$transferInfantCost.'",vehicleCost="'.$vehicleCost.'",noOfVehicles="'.$noOfVehicles.'",repCost="'.$repCost.'",remarks="'.$remark.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",serviceId="'.$serviceId.'",addBy="'.$_SESSION['userid'].'",status=1';
		$whereee = 'id="'.$editId.'"';
		updatelisting('quotationActivityRateMaster',$namevalue,$whereee);

	}elseif($_REQUEST['act_rateid'] > 0 && $_REQUEST['act_tableN'] == 1){

		$dmcId = $_REQUEST['act_rateid'];
		$namevalue ='quotationId="'.$quotationId.'",dayId="'.$dayId.'",supplierId="'.$supplierId.'",tarifType="'.$tarifType.'",transferType="'.$transferType.'",vehicleId="'.$vehicleType.'",gstTax="'.$gstTax.'",markupCost="'.$markupCost.'",markupType="'.$markupType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",ticketAdultCost="'.$ticketAdultCost.'",adultPax="'.$adultPax.'",ticketchildCost="'.$ticketchildCost.'",childPax="'.$childPax.'",ticketinfantCost="'.$ticketinfantCost.'",infantPax="'.$infantPax.'",adultCost="'.$transferAdultCost.'",childCost="'.$transferChildCost.'",infantCost="'.$transferInfantCost.'",vehicleCost="'.$vehicleCost.'",noOfVehicles="'.$noOfVehicles.'",repCost="'.$repCost.'",remarks="'.$remark.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",serviceId="'.$serviceId.'",dmcId="'.$dmcId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",status=1';
		$lastid = addlistinggetlastid('quotationActivityRateMaster',$namevalue);

	}elseif($_REQUEST['act_rateid'] > 0 && $_REQUEST['act_tableN'] == 3){ 

		$dmcId = 0;
		$namevalue ='quotationId="'.$quotationId.'",dayId="'.$dayId.'",supplierId="'.$supplierId.'",tarifType="'.$tarifType.'",transferType="'.$transferType.'",vehicleId="'.$vehicleType.'",gstTax="'.$gstTax.'",markupCost="'.$markupCost.'",markupType="'.$markupType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",ticketAdultCost="'.$ticketAdultCost.'",adultPax="'.$adultPax.'",ticketchildCost="'.$ticketchildCost.'",childPax="'.$childPax.'",ticketinfantCost="'.$ticketinfantCost.'",infantPax="'.$infantPax.'",adultCost="'.$transferAdultCost.'",childCost="'.$transferChildCost.'",infantCost="'.$transferInfantCost.'",vehicleCost="'.$vehicleCost.'",noOfVehicles="'.$noOfVehicles.'",repCost="'.$repCost.'",remarks="'.$remark.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",serviceId="'.$serviceId.'",dmcId="'.$dmcId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",status=1';
		$lastid = addlistinggetlastid('quotationActivityRateMaster',$namevalue);
	}
	?>
	<script>
	parent.loadsearchactivityfunction();
	</script>
	<?php 
}

if(trim($_REQUEST['action'])=='addQuotationEntrancePrice' && trim($_REQUEST['ent_supplierId'])!=''  && trim($_REQUEST['ent_serviceId'])!='' && trim($_REQUEST['ent_currencyId'])!='' && trim($_REQUEST['ent_currencyValue'])!=''){

	$supplierId = clean($_REQUEST['ent_supplierId']);
	$tarifType = clean($_REQUEST['ent_tarifType']);
	$transferType = clean($_REQUEST['ent_transferType']);
	$ticketAdultCost = clean($_REQUEST['ent_ticketAdultCost']);
	$adultPax = clean($_REQUEST['ent_adultPax']);
	$ticketchildCost = clean($_REQUEST['ent_ticketchildCost']);
	$childPax = clean($_REQUEST['ent_childPax']);
	$ticketinfantCost = clean($_REQUEST['ent_ticketinfantCost']);
	$infantPax = clean($_REQUEST['ent_infantPax']);
	$currencyId = clean($_REQUEST['ent_currencyId']);
	$currencyValue = clean($_REQUEST['ent_currencyValue']);
	$repCost = clean($_REQUEST['ent_repCost']);
	$adultCost = clean($_REQUEST['ent_transferAdultCost']);
	$childCost = clean($_REQUEST['ent_transferChildCost']);
	$infantCost = clean($_REQUEST['ent_transferInfantCost']);
	$vehicleType = clean($_REQUEST['ent_vehicleType']);
	$vehicleCost = clean($_REQUEST['ent_vehicleCost']);
	$noOfVehicles = clean($_REQUEST['ent_noOfVehicles']);
	$markupType = clean($_REQUEST['ent_markupType']);
	$markupCost = clean($_REQUEST['ent_markupCost']);
	$gstTax = clean($_REQUEST['ent_gstTax']);
	$remark = clean($_REQUEST['ent_remark']);
	$serviceId = clean($_REQUEST['ent_serviceId']);
	$nationalityType = clean($_REQUEST['ent_nationalityType']);
	$quotationId = clean($_REQUEST['ent_quotationId']);
	$dayId = clean($_REQUEST['ent_dayId']);
	$rateid = clean($_REQUEST['ent_rateid']);
	$tableN = clean($_REQUEST['ent_tableN']);
 
	$rs1=GetPageRecord(' * ',_QUOTATION_MASTER_,'id="'.$quotationId.'"'); 
	$quotationData = mysqli_fetch_array($rs1);

	$fromDate=date('Y-m-d',strtotime($quotationData['fromDate']));
	$toDate=date('Y-m-d',strtotime($quotationData['toDate']));

	$dateAdded=date('Y-m-d');


	if($rateid > 0 && $tableN == 2){
		$editId = $rateid;
		
		$namevalue = 'supplierId="'.$supplierId.'",vehicleId="'.$vehicleType.'",entranceType="'.$entranceType.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",transferType="'.$transferType.'",tarifType="'.$tarifType.'",nationalityType="'.$nationalityType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$whereee = 'id="'.$editId.'"';
		updatelisting('quotationEntranceRateMaster',$namevalue,$whereee);

	}elseif($rateid > 0 && $tableN == 1){

		$dmcId = $rateid;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",dmcId="'.$dmcId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",vehicleId="'.$vehicleType.'",entranceType="'.$entranceType.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",vehicleCost="'.$vehicleCost.'",noOfVehicles="'.$noOfVehicles.'",repCost="'.$repCost.'",transferType="'.$transferType.'",tarifType="'.$tarifType.'",nationalityType="'.$nationalityType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$lastid = addlistinggetlastid('quotationEntranceRateMaster',$namevalue);

	}elseif($rateid > 0 && $tableN == 3){ 

		$dmcId = 0;
		$serviceId = $rateid; 
		echo $namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",dmcId="'.$dmcId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",vehicleId="'.$vehicleType.'",entranceType="'.$entranceType.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",vehicleCost="'.$vehicleCost.'",noOfVehicles="'.$noOfVehicles.'",repCost="'.$repCost.'",transferType="'.$transferType.'",tarifType="'.$tarifType.'",nationalityType="'.$nationalityType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$lastid = addlistinggetlastid('quotationEntranceRateMaster',$namevalue);
	}
	?>
	<script> 
	parent.loadsearchentrancefunction();
	</script>
	<?php 
}

// cruise rate
// if(trim($_REQUEST['action'])=='addQuotationCruisePrice' && trim($_REQUEST['crs_supplierId'])!=''  && trim($_REQUEST['crs_serviceId'])!='' && trim($_REQUEST['crs_currencyId'])!='' && trim($_REQUEST['crs_currencyValue'])!=''){

// 	$supplierId = clean($_REQUEST['crs_supplierId']);
// 	$tarifType = clean($_REQUEST['crs_tarifType']);
// 	$cabinType = clean($_REQUEST['cruiseCainType']);

// 	$adultCost = clean($_REQUEST['cruiseAdultCost']);
// 	$adultPax = clean($_REQUEST['cruisePaxA']);
// 	$childCost = clean($_REQUEST['cruiseChildCost']);
// 	$childPax = clean($_REQUEST['cruisePaxC']);
// 	$infantCost = clean($_REQUEST['cruiseInfantCost']);
// 	$infantPax = clean($_REQUEST['cruisePaxE']);

// 	$currencyId = clean($_REQUEST['crs_currencyId']);
// 	$currencyValue = clean($_REQUEST['crs_currencyValue']);

// 	$markupType = clean($_REQUEST['crs_markupType']);
// 	$markupCost = clean($_REQUEST['crs_markupCost']);
// 	$gstTax = clean($_REQUEST['crs_gstTax']);
// 	$remark = clean($_REQUEST['crs_remark']);

// 	$serviceId = clean($_REQUEST['crs_serviceId']);
// 	$quotationId = clean($_REQUEST['crs_quotationId']);
// 	$dayId = clean($_REQUEST['crs_dayId']);
// 	$rateid = clean($_REQUEST['crs_rateid']);
// 	$tableN = clean($_REQUEST['crs_tableN']);
 
// 	$rs1=GetPageRecord(' * ',_QUOTATION_MASTER_,'id="'.$quotationId.'"'); 
// 	$quotationData = mysqli_fetch_array($rs1);

// 	$fromDate=date('Y-m-d',strtotime($quotationData['fromDate']));
// 	$toDate=date('Y-m-d',strtotime($quotationData['toDate']));

// 	$dateAdded=date('Y-m-d');


// 	if($rateid > 0 && $tableN == 2){
// 		$editId = $rateid;
		
// 		$namevalue = 'quotationId="'.$quotationId.'",supplierId="'.$supplierId.'",dayId="'.$dayId.'",serviceId="'.$serviceId.'",cabinTypeId="'.$cabinType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",tariffTypeId="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
// 		$whereee = 'id="'.$editId.'"';
// 		updatelisting('quotationCruiseRateMaster',$namevalue,$whereee);

// 	}elseif($rateid > 0 && $tableN == 1){

// 		$dmcId = $rateid;
// 		$namevalue = 'rateId="'.$rateid.'",quotationId="'.$quotationId.'",dayId="'.$dayId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",cabinTypeId="'.$cabinType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",tariffTypeId="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
// 		$lastid = addlistinggetlastid('quotationCruiseRateMaster',$namevalue);

// 	}elseif($rateid > 0 && $tableN == 3){ 

// 		$dmcId = 0;
// 		$serviceId = $rateid; 
// 		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",cabinTypeId="'.$cabinType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",tariffTypeId="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
// 		$lastid = addlistinggetlastid('quotationCruiseRateMaster',$namevalue);
// 	}
// 	?>
 	<script> 
// 	parent.loadsearchcruisefunction();
// 	</script>
 	<?php 
// }

if(trim($_REQUEST['action'])=='addQuotationAdditionalPrice' && trim($_REQUEST['ad_rateid'])!=''  && trim($_REQUEST['ad_additionalNameId'])!='' && trim($_REQUEST['ad_currencyId'])!='' && trim($_REQUEST['ad_currencyValue'])!=''){
 
	$additionalName = clean($_REQUEST['ad_additionalName']);
	$supplierId = clean($_REQUEST['ad_supplierId']);
	$costType = clean($_REQUEST['ad_costType']);
	
	$isMarkupApply = clean($_REQUEST['ad_isMarkupApply']);
	$gstTax = clean($_REQUEST['ad_gstTax']);
	$gstTax = clean($_REQUEST['ad_gstTax']);

	$groupCost = clean($_REQUEST['ad_groupCost']);
	$adultCost = clean($_REQUEST['ad_adultCost']);
	$adultPax = clean($_REQUEST['ad_adultPax']);
	$childCost = clean($_REQUEST['ad_childCost']);
	$childPax = clean($_REQUEST['ad_childPax']);
	$infantCost = clean($_REQUEST['ad_infantCost']);
	$infantPax = clean($_REQUEST['ad_infantPax']);
	$currencyId = clean($_REQUEST['ad_currencyId']);
	$currencyValue = clean($_REQUEST['ad_currencyValue']);
	 $remarks = clean($_REQUEST['ad_remark']);
	$quotationId = clean($_REQUEST['ad_quotationId']);
	$dayId = clean($_REQUEST['ad_dayId']);
	$cityId = clean($_REQUEST['ad_cityId']);
	$additionalNameId = clean($_REQUEST['ad_additionalNameId']);
	$queryId = $_REQUEST['queryId'];

	$markupType=clean($_REQUEST['markupType']);
	$markupCost=clean($_REQUEST['markupCost']);


	$rateId = clean($_REQUEST['ad_rateid']);
	$tableN = clean($_REQUEST['ad_tableN']);

	if($tableN==1){ 
		$nameValue = 'rateId="'.$rateId.'",name="'.$additionalName.'",supplierId="'.$supplierId.'",gstTax="'.$gstTax.'",isMarkupApply="'.$isMarkupApply.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",additionalId="'.$additionalNameId.'",costType="'.$costType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",groupCost="'.$groupCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",dayId="'.$dayId.'",remark="'.$remarks.'"';
		addlisting('quotationAdditionalRateMaster',$nameValue);
	}elseif($tableN==2 && $rateId>0){
		 $nameValue = 'name="'.$additionalName.'",supplierId="'.$supplierId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",gstTax="'.$gstTax.'",isMarkupApply="'.$isMarkupApply.'",costType="'.$costType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",groupCost="'.$groupCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",dayId="'.$dayId.'",remark="'.$remarks.'"';
		updatelisting('quotationAdditionalRateMaster',$nameValue,'id="'.$rateId.'"');
	}else{
		$nameValue = 'rateId="'.$rateId.'",name="'.$additionalName.'",supplierId="'.$supplierId.'",gstTax="'.$gstTax.'",isMarkupApply="'.$isMarkupApply.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",additionalId="'.$additionalNameId.'",costType="'.$costType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",groupCost="'.$groupCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",dayId="'.$dayId.'",remark="'.$remarks.'"';
		addlisting('quotationAdditionalRateMaster',$nameValue);
	}
	?>
	<script>
		parent.openinboundpop('action=addServiceAdditional&dayId=<?php echo $dayId; ?>&cityId=<?php echo $cityId; ?>','900px')
	</script>
	<?php

}
 
if(trim($_REQUEST['action'])=='addQuotationExtraPrice' && trim($_REQUEST['rateid2'])!=''  && trim($_REQUEST['serviceId2'])!='' && trim($_REQUEST['currencyId2'])!='' && trim($_REQUEST['currencyValue2'])!=''){

	$supplierId = clean($_REQUEST['supplierId2']);
	$currencyId = clean($_REQUEST['currencyId2']);
	$currencyValue = clean($_REQUEST['currencyValue2']);
	$costType = clean($_REQUEST['costType2']);
	$adultCost = clean($_REQUEST['adultCost2']);
	$childCost = clean($_REQUEST['childCost2']);
	$groupCost = clean($_REQUEST['groupCost2']);
	$remark = clean($_REQUEST['remark2']);
	$gstTax = clean($_REQUEST['gstTax2']);
	$isMarkupApply = clean($_REQUEST['isMarkupApply2']);
	$serviceId = clean($_REQUEST['serviceId2']);

	$dayId = clean($_REQUEST['dayId2']);
	$cityId = clean($_REQUEST['cityId2']);

	$quotationId = clean($_REQUEST['quotationId2']);
	$rateid = clean($_REQUEST['rateid2']);

	$rs1=GetPageRecord(' * ',_QUOTATION_MASTER_,'id="'.$quotationId.'"'); 
	$quotationData = mysqli_fetch_array($rs1);

	$fromDate=date('Y-m-d',strtotime($quotationData['fromDate']));
	$toDate=date('Y-m-d',strtotime($quotationData['toDate']));
	$dateAdded=time();

	if($rateid > 0){
		$namevalue = 'supplierId="'.$supplierId.'",costType="'.$costType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",groupCost="'.$groupCost.'",additionalId="'.$rateid.'",destinationId="'.$cityId.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",gstTax="'.$gstTax.'",isMarkupApply="'.$isMarkupApply.'"';
		$whereee = 'id="'.$rateid.'"';
		updatelisting(_EXTRA_QUOTATION_MASTER_,$namevalue,$whereee);
	}
	?>
	<script> 
	parent.SearchAdditionRequirement();
	</script>
	<?php 
}

if(trim($_REQUEST['action'])=='addQuotationFlightPrice' && clean($_REQUEST['ft_supplierId'])!='' && clean($_REQUEST['ft_serviceId'])!='' && clean($_REQUEST['ft_currencyId'])!='' && clean($_REQUEST['ft_currencyValue'])!=''){

	$supplierId = clean($_REQUEST['ft_supplierId']);
	$flightNumber = clean($_REQUEST['ft_flightNumber']);
	$flightClass = clean($_REQUEST['ft_flightClass']);
	$baggageAllowance = clean($_REQUEST['ft_baggageAllowance']);
	$gstTax = clean($_REQUEST['ft_gstTax']);
	$adultCost = clean($_REQUEST['ft_adultCost']);
	$adultPax = clean($_REQUEST['ft_adultPax']);
	$childCost = clean($_REQUEST['ft_childCost']);
	$childPax = clean($_REQUEST['ft_childPax']);
	$infantCost = clean($_REQUEST['ft_infantCost']);
	$infantPax = clean($_REQUEST['ft_infantPax']);
	$currencyId = clean($_REQUEST['ft_currencyId']);
	$currencyValue = clean($_REQUEST['ft_currencyValue']);
	$remark = clean($_REQUEST['ft_remark']);
	$tarifType = clean($_REQUEST['ft_tarifType']);
	$serviceId = clean($_REQUEST['ft_serviceId']);
	$quotationId = clean($_REQUEST['ft_quotationId']);
	$dayId = clean($_REQUEST['ft_dayId']);
	$rateid = clean($_REQUEST['ft_rateid']);
	$tableN = clean($_REQUEST['ft_tableN']);

	$markupType = clean($_REQUEST['markupType']);
	$markupCost = clean($_REQUEST['markupCost']);

	$rs1=GetPageRecord(' * ',_QUOTATION_MASTER_,'id="'.$quotationId.'"'); 
	$quotationData = mysqli_fetch_array($rs1);

	$fromDate=date('Y-m-d',strtotime($quotationData['fromDate']));
	$toDate=date('Y-m-d',strtotime($quotationData['toDate']));
	$dateAdded=date('Y-m-d');

	if($rateid > 0 && $tableN == 2){
		$editId = $rateid;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",supplierId="'.$supplierId.'",flightNumber="'.$flightNumber.'",flightClass="'.$flightClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",baggageAllowance="'.$baggageAllowance.'",tarifType="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$whereee = 'id="'.$editId.'"';
		updatelisting(_QUOTATION_FLIGHT_RATE_MASTER_,$namevalue,$whereee);

	}elseif($rateid > 0 && $tableN == 1){
		$dmcId = $rateid;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",dmcId="'.$dmcId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",flightNumber="'.$flightNumber.'",flightClass="'.$flightClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",baggageAllowance="'.$baggageAllowance.'",tarifType="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$lastid = addlistinggetlastid(_QUOTATION_FLIGHT_RATE_MASTER_,$namevalue);

	}elseif($rateid > 0 && $tableN == 3){ 

		$dmcId = 0;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",dmcId="'.$dmcId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",flightNumber="'.$flightNumber.'",flightClass="'.$flightClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",baggageAllowance="'.$baggageAllowance.'",tarifType="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$serviceId = $rateid; 
		$lastid = addlistinggetlastid(_QUOTATION_FLIGHT_RATE_MASTER_,$namevalue);
	}
	?>
	<script> 
	parent.loadsearchflightfunction();
	</script>
	<?php 
}

if(trim($_REQUEST['action'])=='addQuotationTrainPrice' && clean($_REQUEST['tr_supplierId'])!='' && trim($_REQUEST['tr_serviceId'])!='' && trim($_REQUEST['tr_currencyId'])!='' && trim($_REQUEST['tr_currencyValue'])!=''){

	$supplierId = clean($_REQUEST['tr_supplierId']);
	$trainNumber = clean($_REQUEST['tr_trainNumber']);
	$trainClass = clean($_REQUEST['tr_trainClass']);
	$journeyType = clean($_REQUEST['tr_journeyType']);
	$gstTax = clean($_REQUEST['tr_gstTax']);
	$adultCost = clean($_REQUEST['tr_adultCost']);
	$adultPax = clean($_REQUEST['tr_adultPax']);
	$childCost = clean($_REQUEST['tr_childCost']);
	$childPax = clean($_REQUEST['tr_childPax']);
	$infantCost = clean($_REQUEST['tr_infantCost']);
	$infantPax = clean($_REQUEST['tr_infantPax']);
	$currencyId = clean($_REQUEST['tr_currencyId']);
	$currencyValue = clean($_REQUEST['tr_currencyValue']);
	$remark = clean($_REQUEST['tr_remark']);
	$tarifType = clean($_REQUEST['tr_tarifType']);
	$serviceId = clean($_REQUEST['tr_serviceId']);
	$quotationId = clean($_REQUEST['tr_quotationId']);
	$dayId = clean($_REQUEST['tr_dayId']);
	$rateid = clean($_REQUEST['tr_rateid']);
	$tableN = clean($_REQUEST['tr_tableN']);
	$markupType = clean($_REQUEST['markupType']);
	$markupCost = clean($_REQUEST['markupCost']);

	$rs1=GetPageRecord(' * ',_QUOTATION_MASTER_,'id="'.$quotationId.'"'); 
	$quotationData = mysqli_fetch_array($rs1);

	$fromDate=date('Y-m-d',strtotime($quotationData['fromDate']));
	$toDate=date('Y-m-d',strtotime($quotationData['toDate']));
	$dateAdded=date('Y-m-d');

	if($rateid > 0 && $tableN == 2){
		$editId = $rateid;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",supplierId="'.$supplierId.'",trainNumber="'.$trainNumber.'",trainClass="'.$trainClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",journeyType="'.$journeyType.'",tarifType="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$whereee = 'id="'.$editId.'"';
		updatelisting(_QUOTATION_TRAIN_RATE_MASTER_,$namevalue,$whereee);

	}elseif($rateid > 0 && $tableN == 1){
		$dmcId = $rateid;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",dmcId="'.$dmcId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",trainNumber="'.$trainNumber.'",trainClass="'.$trainClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",journeyType="'.$journeyType.'",tarifType="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$lastid = addlistinggetlastid(_QUOTATION_TRAIN_RATE_MASTER_,$namevalue);

	}elseif($rateid > 0 && $tableN == 3){ 

		$dmcId = 0;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",dmcId="'.$dmcId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",trainNumber="'.$trainNumber.'",trainClass="'.$trainClass.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",journeyType="'.$journeyType.'",tarifType="'.$tarifType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$serviceId = $rateid; 
		$lastid = addlistinggetlastid(_QUOTATION_TRAIN_RATE_MASTER_,$namevalue);
	}
	?>
	<script> 
	parent.loadsearchtrainfunction();
	</script>
	<?php 
}

if(trim($_REQUEST['action'])=='addQuotationRestaurantPrice' && trim($_REQUEST['re_supplierId'])!='' && trim($_REQUEST['re_serviceId'])!='' && trim($_REQUEST['re_currencyId'])!='' && trim($_REQUEST['re_currencyValue'])!=''){

	$supplierId = clean($_REQUEST['re_supplierId']);
	$mealPlanType = clean($_REQUEST['re_mealPlanType']);
	$gstTax = clean($_REQUEST['re_gstTax']);
	$adultCost = clean($_REQUEST['re_adultCost']);
	$adultPax = clean($_REQUEST['re_adultPax']);
	$childCost = clean($_REQUEST['re_childCost']);
	$childPax = clean($_REQUEST['re_childPax']);
	$infantCost = clean($_REQUEST['re_infantCost']);
	$infantPax = clean($_REQUEST['re_infantPax']);
	$currencyId = clean($_REQUEST['re_currencyId']);
	$currencyValue = clean($_REQUEST['re_currencyValue']);
	$remark = clean($_REQUEST['re_remark']);
	$serviceId = clean($_REQUEST['re_serviceId']);
	$tarifType = 1;
	$quotationId = clean($_REQUEST['re_quotationId']);
	$dayId = clean($_REQUEST['re_dayId']);
	$rateid = clean($_REQUEST['re_rateid']);
	$tableN = clean($_REQUEST['re_tableN']);
	$markupType = clean($_REQUEST['markupType']);
	$markupCost = clean($_REQUEST['markupCost']);
 
	$rs1=GetPageRecord(' * ',_QUOTATION_MASTER_,'id="'.$quotationId.'"'); 
	$quotationData = mysqli_fetch_array($rs1);

	$fromDate=date('Y-m-d',strtotime($quotationData['fromDate']));
	$toDate=date('Y-m-d',strtotime($quotationData['toDate']));
	$dateAdded=time();

	if($rateid > 0 && $tableN == 2){
		$editId = $rateid;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",supplierId="'.$supplierId.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",tarifType="'.$tarifType.'",mealPlanType="'.$mealPlanType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$whereee = 'id="'.$editId.'"';
		updatelisting(_QUOTATION_RESTAURANT_RATE_MASTER_,$namevalue,$whereee);

	}elseif($rateid > 0 && $tableN == 1){
		$dmcId = $rateid;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",dmcId="'.$dmcId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",tarifType="'.$tarifType.'",mealPlanType="'.$mealPlanType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$lastid = addlistinggetlastid(_QUOTATION_RESTAURANT_RATE_MASTER_,$namevalue);
	}elseif($rateid > 0 && $tableN == 3){ 
		$dmcId = 0;
		$namevalue = 'quotationId="'.$quotationId.'",dayId="'.$dayId.'",dmcId="'.$dmcId.'",serviceId="'.$serviceId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",supplierId="'.$supplierId.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'",tarifType="'.$tarifType.'",mealPlanType="'.$mealPlanType.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",remark="'.$remark.'",taxType="'.$taxType.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
		$serviceId = $rateid; 
		$lastid = addlistinggetlastid(_QUOTATION_RESTAURANT_RATE_MASTER_,$namevalue);
	}
	?>
	<script> 
	parent.loadsearchrestaurantfunction();
	</script>
	<?php 
}
//END - add/edit quotation level rates before adding to quotation




if($_REQUEST['action']=='sortingservice' && $_REQUEST['serviceids']!='0'){
  	 $no=1;
	foreach($_REQUEST['serviceids'] as $i => $item) {
	 $namevalue ='srn="'.$no.'"';
	 $where='id="'.$item.'"';
	 $update = updatelisting('quotationItinerary',$namevalue,$where);
	 $no++;
	}
}
// remove unecessory actions from here
// vsectionid,saveHotelConfirmationNo,saveSightseeingConfirmationNo,saveTransferConfirmationNo,cmscreatepackagedetail,cmscreatepackagedetail,uploadgalleryimagepackage,packageremovepicture,deletehotelCity,addqueryQuotationItinerary,changeItineraryQuotStatus,deleteHotelAll,sendmailItineraryQuotation,getactivitycostmain,savehotelvoucher,saveguidevoucher,saveactivityvoucher,saveentrancevoucher,saverestaurantvoucher,saveadditionalvoucher,savetrainvoucher,saveflightvoucher,savetransfervoucher


if(trim($_POST['action'])=='addTRAVELARRANGEMENTLIST' && $_POST['subGroupCode']!='' && $_POST['vehicleConfirmationNo']!=''){
	$queryId=clean($_POST['queryId']);
	$quotationId=clean($_POST['quotationId']);
	$groupCode=($_POST['groupCode']);
	$subGroupCode=clean($_POST['subGroupCode']);
	$vehicleId=clean($_POST['vehicleId']);
	$vehicleCapct=clean($_POST['vehicleCapct']);
	$vehicleConfirmationNo=clean($_POST['vehicleConfirmationNo']);
	$dateAdded=time();
	$rs=GetPageRecord('*','subGroupCodeMaster',' queryId="'.$queryId.'" and subGroupCode="'.$subGroupCode.'" order by id desc');
	$resListing=mysqli_fetch_array($rs);
	if(mysqli_num_rows($rs)<1){
	$namevalue ='queryId="'.$queryId.'",quotationId="'.$quotationId.'",groupCode="'.$_POST['groupCode'].'",subGroupCode="'.$subGroupCode.'",vehicleId="'.$vehicleId.'",vehicleCapacity="'.$vehicleCapct.'",vehicleConfirmationNo="'.$vehicleConfirmationNo.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
	$lastid = addlistinggetlastid('subGroupCodeMaster',$namevalue);
	}else{
	?>
	<script>
	parent.loadTravelArrangementListfun();
	parent.loadAddedArrangementfun();
	parent.$('#successmsg').text('Sub Group is already exist...');
	parent.$('#successmsg').show();
	setTimeout(function(){ parent.$('#successmsg').hide(); }, 3000);
	</script>
	<?php
	}
	?>
	<script>
	parent.$('#successmsg').text('Sub Group is added successfully...');
	parent.$('#successmsg').show();
	setTimeout(function(){ parent.$('#successmsg').hide(); }, 3000);
	parent.loadTravelArrangementListfun();
	parent.loadAddedArrangementfun();
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
if(trim($_POST['action'])=='addGuestTRAVELARRANGEMENTLIST' && $_POST['subGroupCode']!='' && $_POST['queryId']!=''){
	$queryId=clean($_POST['queryId']);
	$subGroupCode=clean($_POST['subGroupCode']);
	$dateAdded=time();
	$rs=GetPageRecord('*','subGroupCodeMaster',' queryId="'.$queryId.'" and id="'.$subGroupCode.'" order by id desc');
	$resListing=mysqli_fetch_array($rs);
	$vehicleCapct=($resListing['vehicleCapacity']);
	$totlGst=count($_POST['guest']);
	if($totlGst>$vehicleCapct){
	?>
	<script>
	parent.$('#successmsg').text('');
	parent.$('#successmsg').show();
	parent.$('#successmsg').text('Selected Guests is more than Vehicle Capacity...');
	setTimeout(function(){ parent.$('#successmsg').hide(); }, 3000);
	</script>
	<?php
	}else{
	foreach($_POST['guest'] as $val){
	?>
	<script>
	parent.$('#successmsg').text('Guest added successfully...');
	parent.$('#successmsg').show();
	setTimeout(function(){ parent.$('#successmsg').hide(); }, 3000);
	</script>
	<?php
	$namevalue ='queryId="'.$queryId.'",quotationId="'.$resListing['quotationId'].'",groupCode="'.$resListing['groupCode'].'",subGroupCode="'.$resListing['subGroupCode'].'",vehicleId="'.$resListing['vehicleId'].'",vehicleCapacity="'.$resListing['vehicleCapacity'].'",vehicleConfirmationNo="'.$resListing['vehicleConfirmationNo'].'",guestListId="'.$val.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
	$lastid = addlistinggetlastid('travelArrangementMaster',$namevalue);
	}
	}
	 ?>
	<script>
	parent.loadTravelArrangementListfun();
	parent.loadAddedArrangementfun();
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	 <?php
} 
if(trim($_POST['action'])=='addtodolist' && trim($_POST['actionDate'])!='' && trim($_POST['queryId'])!='' && trim($_POST['editid'])!=''){ 
	$tourType=addslashes($_POST['tourType2']);
	$taskTitle=addslashes($_POST['taskTitle']);
	$assignTo12=decode($_POST['assignTo']);
	$actionDate=date("Y-m-d", strtotime($_POST['actionDate']));
	$completionDate=date("Y-m-d", strtotime($_POST['completionDate']));
	$actionTime = $_POST['actionTime'];
	$completionTime = $_POST['completionTime'];   
	$remark=$_POST['remark'];
	$statusId=addslashes($_POST['statusId']);
	$queryId=addslashes($_POST['queryId']);
	$selecttodoassign='*';
	$wheretodoassign='id='.$queryId.'';
	$rstodoassign=GetPageRecord($selecttodoassign,_QUERY_MASTER_,$wheretodoassign);
	$resultpagetodoassign=mysqli_fetch_array($rstodoassign);
	$assignTo=$resultpagetodoassign['assignTo']; 
	$new_completionDate=date('Y-m-d H:i:s',strtotime($actionDate.' '.$actionTime));
	///////////////////////////////////////////////////////////////////////////////////////////////////  
	$namevalue ='actionDate="'.$actionDate.'",taskTitle="'.$taskTitle.'",taskId="'.$tourType.'",actionTime="'.$actionTime.'",statusId="'.$statusId.'",dateAdded="'.time().'",queryId="'.$queryId.'",assignTo="'.$assignTo12.'",remark="'.$remark.'",completionDate="'.$completionDate.'",completedTime="'.$completionTime.'"';
	$where='id="'.$_POST['editid'].'" and queryId="'.$queryId.'"';
	$update = updatelisting(_CHECK_TODOLIST_MASTER_,$namevalue,$where);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.loadtodolistfun();
	</script>
	<?php
	exit();
}
if(trim($_POST['action'])=='addVehicleExcursionReport'){
// quotation hotel data
	$c=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' id="'.$_REQUEST['transferQuoteId'].'"');
	$hotelQuotData=mysqli_fetch_array($c);
	$c1=GetPageRecord('*','quotationTransferTimelineDetails',' transferQuoteId="'.$hotelQuotData['id'].'" and quotationId="'.$hotelQuotData['quotationId'].'"');
	$dtime=mysqli_fetch_array($c1);
	    if(!empty($_REQUEST['ArribleTime'])){
			$ArribleTime = date('h:i A', strtotime($_REQUEST['ArribleTime']));
		}else{
			$ArribleTime = '';
		}
		if(!empty($_REQUEST['dropTime'])){
           $dropTime = date('h:i A', strtotime($_REQUEST['dropTime']));
		}else{
           $dropTime = '';
		}
		if(!empty($_REQUEST['pickupTime'])){
		   $pickupTime = date('h:i A', strtotime($_REQUEST['pickupTime']));
		}else{
           $pickupTime = '';
		}
	if(mysqli_num_rows($c1) == 0){
		  $namevalue ='quotationId="'.$hotelQuotData['quotationId'].'",dayId="'.$_REQUEST['dayId'].'",supplierId="'.$hotelQuotData['supplierId'].'",transferQuoteId="'.$hotelQuotData['id'].'",arrivalFrom="'.$_REQUEST['CityName'].'",trainName="'.$_REQUEST['trainName'].'",trainNumber="'.$_REQUEST['TrainNumber'].'",flightName="'.$_REQUEST['flightName'].'",flightNumber="'.$_REQUEST['flightNumber'].'",vehicleName="'.$_REQUEST['vehicleName'].'",VehicleModel="'.$_REQUEST['VehicleModel'].'",arrivalTime="'.$ArribleTime.'",dropTime="'.$dropTime.'",mode="'.$_REQUEST['mode'].'",pickupTime="'.$pickupTime.'"';
		$hotelSupHot = addlistinggetlastid('quotationTransferTimelineDetails',$namevalue);
	}else{
		 $namevalue ='quotationId="'.$hotelQuotData['quotationId'].'",dayId="'.$_REQUEST['dayId'].'",supplierId="'.$hotelQuotData['supplierId'].'",transferQuoteId="'.$hotelQuotData['id'].'",arrivalFrom="'.$_REQUEST['CityName'].'",trainName="'.$_REQUEST['trainName'].'",trainNumber="'.$_REQUEST['TrainNumber'].'",flightName="'.$_REQUEST['flightName'].'",flightNumber="'.$_REQUEST['flightNumber'].'",vehicleName="'.$_REQUEST['vehicleName'].'",VehicleModel="'.$_REQUEST['VehicleModel'].'",arrivalTime="'.$ArribleTime.'",dropTime="'.$dropTime.'",mode="'.$_REQUEST['mode'].'",pickupTime="'.$pickupTime.'"';
		$where='id="'.$dtime['id'].'"';
		$hotelSupHot = updatelisting('quotationTransferTimelineDetails',$namevalue,$where);
	}
?>

<script>
parent.setupbox('showpage.crm?fromDate=<?php echo $_REQUEST['fromDate']; ?>&toDate=<?php echo $_REQUEST['toDate']; ?>&module=reports&report=22');
</script>
<?php
exit();
}
if(trim($_POST['action'])=='addVehicleAllocation'){
        $pickupTime= $_REQUEST['pickupTime'];
		$dropTime= $_REQUEST['dropTime'];
		$fromdate= $_REQUEST['fromdate'];
		$c=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' id="'.$_REQUEST['transferQuoteId1'].'" and vehicleModelId="'.$_REQUEST['modelId'].'"');
	    $hotelQuotData=mysqli_fetch_array($c);
		$c1=GetPageRecord('*','quotationTransferTimelineDetails',' hotelQuoteId="'.$hotelQuotData['id'].'" and pickupTime="'.         $pickupTime.'" and dropTime="'.$dropTime.'"');
		$quotationtimeline=mysqli_fetch_array($c1);
		$c3443=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' id="'.$quotationtimeline['hotelQuoteId'].'" and vehicleModelId="'.$_REQUEST['modelId'].'"');
	    $modelwise=mysqli_fetch_array($c3443);
		if(mysqli_num_rows($c1) == 0){
		$namevalue ='id="'.$_REQUEST['transferQuoteId'].'",vehicleModelId="'.$_REQUEST['modelId'].'"';
		$where='id="'.$_REQUEST['transferQuoteId'].'"';
		$hotelSupHot = updatelisting(_QUOTATION_TRANSFER_MASTER_,$namevalue,$where);
		}
?>
<script>
<?php if(mysqli_num_rows($c1) == 0){?>
parent.setupbox('showpage.crm?fromDate=<?php echo $_REQUEST['fromDate']; ?>&toDate=<?php echo $_REQUEST['toDate']; ?>&module=reports&report=22');
<?php } ?>
<?php if($modelwise['vehicleModelId']!=''){?>
parent.$('#driverInfo123123').html('<div style="color: red;padding: 7px;border: 1px solid;background-color: #57a0a42b;">This Veicle is not available now</div>');
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
<?php } ?>
<?php if($modelwise['vehicleModelId']==''){?>
parent.$('#driverInfo123123').hide();
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
<?php } ?>
</script>
<?php
exit();
}
if(trim($_POST['action'])=='addeDriverExcursionReport'){
$tranferquotId=clean($_POST['id']);
$driverId=clean($_POST['driverId']);
$fromDate=clean($_POST['fromDate']);
$toDate=clean($_POST['toDate']);
$queryId=clean($_POST['displayId']);
$quotationId=clean($_POST['quotationId']);
 $sel='*';
 $wherev='transferQuotId = "'.$tranferquotId.'" order by id desc';
 $rsv=GetPageRecord($sel,'driverAllocationDetails',$wherev);
 $traquotId=mysqli_num_rows($rsv);
 $namevalue ='driverId="'.trim($_POST['driverId']).'",transferQuotId="'.$tranferquotId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",name="",mobileNo="",whatsAppno="",details="",allocationStatus=1';
 if($traquotId>0){
   $where='transferQuotId="'.$tranferquotId.'"';
   $update = updatelisting('driverAllocationDetails',$namevalue,$where);
 }else{
   addlisting('driverAllocationDetails',$namevalue);
 }
$rsDv=GetPageRecord('*',_DRIVER_MASTER_MASTER_,'1 and id="'.$_POST['driverId'].'" order by name');
$driverData=mysqli_fetch_array($rsDv);
  ?>
<script>
parent.$('#driverInfo<?php echo $_POST['id']; ?>').html('<div><?php echo $driverData['name']; ?><br /><?php echo addslashes($driverData['mobile']); ?></div>');
parent.$('#pageloading').hide();
parent.$('#pageloader').hide();
parent.alertspopupopenClose();
parent.$('#loaderbox').hide();
</script>
<?php
exit();
}
if(trim($_REQUEST['action'])=='addedit_vehicle'){
  $vehicleType=addslashes($_REQUEST['vehicleType']);
  $transferQuoteId=addslashes($_REQUEST['transferQuoteId']);
  $brand=addslashes($_REQUEST['brand']);
  $model=addslashes($_REQUEST['model']);
  $registrationNo=addslashes($_REQUEST['registrationNo']);
  $sel='*';
  $wherev='transferQuotId = "'.$transferQuoteId.'" order by id desc';
  $rsv=GetPageRecord($sel,'quotVhicleDetails',$wherev);
  $traquotId=mysqli_num_rows($rsv);
  $namevalue ='transferQuotId="'.$transferQuoteId.'",vehicleType="'.$vehicleType.'",vehicleBrand="'.$vehicleBrand.'",vehicleName="'.$model.'",registrationNo="'.$registrationNo.'",type="tranQuoteId",allocatedStatus="1"';
  if($traquotId>0){ 
     $where='transferQuotId="'.$transferQuoteId.'"';
     $update = updatelisting('quotVhicleDetails',$namevalue,$where);
  }else{
  	 $update = addlisting('quotVhicleDetails',$namevalue);
  }
  ?>
<script>
parent.setupbox('showpage.crm?fromDate=<?php echo $_REQUEST['fromDate']; ?>&toDate=<?php echo $_REQUEST['toDate']; ?>&module=reports&report=22');
</script>
<?php
}
if(trim($_POST['action'])=='addedit_driver'){
	$tranferquotId=clean($_POST['id']);
	$driverId=clean($_POST['driverId']);
	$serviceType=addslashes($_POST['serviceType']);
	$name=addslashes($_POST['name']);
	$mobileNo=addslashes($_POST['mobileNo']);
	$whatappNo=addslashes($_POST['whatappNo']);
	$description=addslashes($_POST['description']);
	$id = addslashes($_REQUEST['id']);
	$serviceType = addslashes($_REQUEST['serviceType']);
	$fromDate = addslashes($_REQUEST['fromDate']);
	$toDate = addslashes($_REQUEST['toDate']);
	$queryId = addslashes($_REQUEST['displayId']);
	$quotationId = addslashes($_REQUEST['quotationId']);
	 $sel='*';
	 $wherev='transferQuotId = "'.$tranferquotId.'" order by id desc';
	 $rsv=GetPageRecord($sel,'driverAllocationDetails',$wherev);
	 $traquotId=mysqli_num_rows($rsv);
	 $namevalue ='driverId="",transferQuotId="'.$tranferquotId.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",name="'.$name.'",mobileNo="'.$mobileNo.'",whatsAppno="'.$whatappNo.'",details="'.$description.'"';
	 if($traquotId>0){
	   $where='transferQuotId="'.$tranferquotId.'"';
	   $update = updatelisting('driverAllocationDetails',$namevalue,$where);
	 }else{
	   addlisting('driverAllocationDetails',$namevalue);
	 }
	$rsDv=GetPageRecord('*',_DRIVER_MASTER_MASTER_,'1 and id="'.$_POST['driverId'].'" order by name');
	$driverData=mysqli_fetch_array($rsDv);
	  ?>
	<script>
	parent.$('#driverInfo<?php echo $_POST['id']; ?>').html('<div><?php echo $name; ?><br /><?php echo addslashes($mobileNo); ?></div>');
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.alertspopupopenClose();
	parent.$('#loaderbox').hide();
	</script>
	<?php
	exit();
}
if($_REQUEST['action']=='addtask'){
	$taskName=$_REQUEST['taskName'];
	$queryId=decode($_REQUEST['queryId']);
	$namevalue ='taskName="'.$taskName.'",queryId="'.$queryId.'"';
	//echo $namevalue;die();
	$add = addlisting(_TASK_MASTER_,$namevalue);
	?>
	<script>
	parent.setupbox('showpage.crm?module=todolist&view=yes&id=<?php echo encode($queryId); ?>');
	</script>
	<?php
}
if(trim($_REQUEST['action'])=='saveProposalType'  && trim($_REQUEST['proposalType'])!='' && trim($_REQUEST['id'])!=''){
	$proposalType=addslashes($_REQUEST['proposalType']);
	$namevalue ='proposalType="'.trim($_REQUEST['proposalType']).'"';
	$where='id="'.decode($_REQUEST['id']).'"';
	$update = updatelisting(_QUOTATION_MASTER_,$namevalue,$where);
}
if(trim($_REQUEST['action'])=='selectModeltransfer'){
  $vehicledate=addslashes($_REQUEST['vehicleId']);
  $vehicledetail  = explode(',', $vehicledate);
  $modelId = $vehicledetail[0];
  $type = $vehicledetail[1];
  $tranferquotId=addslashes($_REQUEST['transferQuoteId']);
  $selvehd='*';
  $wherevehd='id="'.$modelId.'"';
  $rsvehd=GetPageRecord($selvehd,_VEHICLE_MASTER_MASTER_,$wherevehd);
  $vehicalnamed=mysqli_fetch_array($rsvehd);
  $sel='*';
  $wherev='transferQuotId = "'.$tranferquotId.'" order by id desc';
  $rsv=GetPageRecord($sel,'quotVhicleDetails',$wherev);
  $traquotId=mysqli_num_rows($rsv);
  $namevalue ='transferQuotId="'.$tranferquotId.'",vehicleName="'.$vehicalnamed['model'].'",vehicleId="'.$vehicalnamed['id'].'",registrationNo="'.$vehicalnamed['registrationNo'].'",allocatedStatus="1",type="'.$type.'"';
  if($traquotId>0){ 
     $where='transferQuotId="'.$tranferquotId.'"';
     $update = updatelisting('quotVhicleDetails',$namevalue,$where);
  }else{
  	 $update = addlisting('quotVhicleDetails',$namevalue);
  }
  ?>
	<script>
	parent.setupbox('showpage.crm?fromDate=<?php echo $_REQUEST['fromDate1']; ?>&toDate=<?php echo $_REQUEST['toDate1']; ?>&module=reports&report=22');
	</script>
	<?php
}
if(trim($_POST['action'])=='addTourExtension'  && trim($_POST['quotationId'])!='' && trim($_POST['quotationSubject'])!=''){
	$lastQuotationId=decode($_POST['quotationId']);
	$lastQueryId=decode($_POST['queryId']);
	$extensionType=trim($_POST['extensionType']);
	$quotationSubject=trim($_POST['quotationSubject']);
	$quotationType=trim($_POST['quotationType']);
	$hotCategory=implode(',',$_POST['hotCategory']);
	$adult=trim($_POST['adult']);
	$child=trim($_POST['child']);
	$infant=trim($_POST['infant']);
	// totalPax
	$sglRoom=trim($_POST['sglRoom']);
	$dblRoom=trim($_POST['dblRoom']);
	$tplRoom=trim($_POST['tplRoom']);
	$twinRoom=trim($_POST['twinRoom']);
	$extraNoofBed=trim($_POST['extraNoofBed']);
	$noofQuadRoom=trim($_POST['noofQuadRoom']);
	$noofSixBRoom=trim($_POST['noofSixBRoom']);
	$noofEightBRoom=trim($_POST['noofEightBRoom']);
	$noofTenBRoom=trim($_POST['noofTenBRoom']);
	$noofTeenRoom=trim($_POST['noofTeenRoom']);
	$noofchildwithoutbed=trim($_POST['noofchildwithoutbed']);
	
	$night=trim($_POST['totalNights']);
	$leadPaxName=trim($_POST['leadPaxName']);
	$fromDate = date('Y-m-d',strtotime($_POST['fromDate']));
	$toDate = date('Y-m-d',strtotime($_POST['toDate']));
	$isTourEx = trim($_POST['isTourEx']); 

	if($_POST['packageId']  > 0){
		// import code here 
		
		$quotSql="";
		//echo decode($_REQUEST['packageId']);
		$quotSql=GetPageRecord('*',_QUOTATION_MASTER_,' id="'.($_REQUEST['packageId']).'" ');  
		if(mysqli_num_rows($quotSql)>0 ){ 
			$quotationData=mysqli_fetch_array($quotSql);
			 
			$dayWise = 1;
			$fromDate=date("Y-m-d", strtotime($quotationData['fromDate'])); 
			$toDate=date("Y-m-d", strtotime($quotationData['toDate']));
			$objec=date_diff(date_create($fromDate),date_create($toDate));
			$t_night = $objec->format("%a"); 
			 
			// get the season and Season Year 
			$seasonYear = date('Y',strtotime($fromDate));
			if (strtotime($fromDate)>=strtotime($seasonYear.'-04-01') || strtotime($fromDate)<=strtotime($seasonYear.'-09-30')) {
				$seasonType=1;
			}else{
				$seasonType=2;
			} 
					   
			//Duplicate subseries to new quotation with new query 
			$queryId = $quotationData['queryId']; 
			$quotationId = $quotationData['id'];
			
			$rsp1=""; 
			$rsp1=GetPageRecord('quotationNo',_QUOTATION_MASTER_,' queryId="'.$lastQueryId.'" order by quotationNo desc');
			$quotationNo=mysqli_fetch_array($rsp1);
			if($quotationNo['quotationNo']!=''){
				//this is greater than first
				$letterAscii = ord($quotationNo['quotationNo']);
				$letterAscii++;
				$quotationNo = chr($letterAscii);
			}else{
				$quotationNo = "A";
			} 
		 
		$namevalue='clientType="'.$quotationData['clientType'].'",queryId="'.$lastQueryId.'",companyId="'.$quotationData['companyId'].'",travelDate="'.$quotationData['travelDate'].'",queryDate="'.$quotationData['queryDate'].'",officeBranch="'.$quotationData['officeBranch'].'",destinationId="'.$quotationData['destinationId'].'",rooms="'.$quotationData['rooms'].'",infant="'.$quotationData['infant'].'",departureDestinationId="'.$quotationData['departureDestinationId'].'",categoryId="'.$quotationData['categoryId'].'",modifyBy="'.$_SESSION['userid'].'",markup="'.$quotationData['markup'].'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'",modifyDate="'.$quotationData['modifyDate'].'",deletestatus="'.$quotationData['deletestatus'].'",quotationId="'.$quotationData['id'].'",starRating="'.$quotationData['starRating'].'",totalAmount="'.$quotationData['totalAmount'].'",totalClientCost="'.$quotationData['totalClientCost'].'",markupType="'.$quotationData['markupType'].'",serviceTax="'.$quotationData['serviceTax'].'",tcs="'.$quotationData['tcs'].'",finalQuotationType="'.$quotationData['finalQuotationType'].'",currencyId="'.$quotationData['currencyId'].'",cost2person="'.$quotationData['cost2person'].'",image="'.$quotationData['image'].'",flightCostType="'.$quotationData['flightCostType'].'",otherLocation="'.$quotationData['otherLocation'].'",otherLocationCost="'.$quotationData['otherLocationCost'].'",isOtherLocation="'.$quotationData['isOtherLocation'].'",inclusion="'.addslashes($quotationData['inclusion']).'",exclusion="'.addslashes($quotationData['exclusion']).'",isInc_exc="'.$quotationData['isInc_exc'].'",quotationNo="'.$quotationNo.'",generateNo="'.$quotationData['generateNo'].'",finalcategory="'.$quotationData['finalcategory'].'",dayroe="'.$quotationData['dayroe'].'",isSer_Mark="'.$quotationData['isSer_Mark'].'",lostStatus="'.$quotationData['lostStatus'].'",isAddExp="'.$quotationData['isAddExp'].'",overviewText="'.addslashes($quotationData['overviewText']).'",highlightsText="'.addslashes($quotationData['highlightsText']).'",tncText="'.addslashes($quotationData['tncText']).'",specialText="'.addslashes($quotationData['specialText']).'",proposalType="'.$quotationData['proposalType'].'",isTransport="'.$quotationData['isTransport'].'",isUni_Mark="'.$quotationData['isUni_Mark'].'",isPaymentRequest="'.$quotationData['isPaymentRequest'].'",departureDate="'.$quotationData['departureDate'].'",asOnDate="'.$quotationData['asOnDate'].'",voucherNumber="'.$quotationData['voucherNumber'].'",voucherReferanceNumber="'.$quotationData['voucherReferanceNumber'].'",voucherDate="'.$quotationData['voucherDate'].'",isSupp_TRR="'.$quotationData['isSupp_TRR'].'",discount="'.$quotationData['discount'].'",discountType="'.$quotationData['discountType'].'",costType="'.$quotationData['costType'].'",languageId="'.$quotationData['languageId'].'",deletestatusDuplicate="'.$quotationData['deletestatusDuplicate'].'",subName="'.clean($_POST['subName']).'",isSeries=0,isFD=0,issueDate="'.$quotationData['issueDate'].'",quotationSubject="'.$quotationSubject.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",adult="'.$adult.'",child="'.$child.'",night="'.$night.'",quotationType="'.$quotationType.'",hotCategory="'.$hotCategory.'",guest1="'.$leadPaxName.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",extraNoofBed="'.$extraNoofBed.'",twinRoom="'.$twinRoom.'",isTourEx="'.$isTourEx.'",extensionType="'.$extensionType.'",quotationId="'.$quotationId.'",quadNoofRoom="'.$noofQuadRoom.'",teenNoofRoom="'.$noofTeenRoom.'",sixNoofBedRoom="'.$noofSixBRoom.'",eightNoofBedRoom="'.$noofEightBRoom.'",tenNoofBedRoom="'.$noofTenBRoom.'",extraNoofBed="'.$extraNoofBed.'",childwithoutNoofBed="'.$noofchildwithoutbed.'",transferRequired="'.$quotationData['transferRequired'].'",trainRequired="'.$quotationData['trainRequired'].'"'; 
			 
			$where='id="'.$lastQuotationId.'"';
			$updatelist = updatelisting(_QUOTATION_MASTER_,$namevalue,$where);
			 
			// duplicate pax slab lists
			$b='';
			$b=GetPageRecord('*','totalPaxSlab',' quotationId="'.$quotationId.'" order by fromRange asc');
			if(mysqli_num_rows($b)>0){
				while($slabData=mysqli_fetch_array($b)){
					$addHotel = '';  
					$modevalue = 'quotationId="'.$lastQuotationId.'", fromRange="'.$slabData['fromRange'].'", toRange="'.$slabData['toRange'].'", localEscort="'.$slabData['localEscort'].'", foreignEscort="'.$slabData['foreignEscort'].'", dividingFactor="'.$slabData['dividingFactor'].'", status="'.$slabData['status'].'", deletestatus="'.$slabData['deletestatus'].'", dateAdded="'.$slabData['dateAdded'].'", modifyDate="'.$slabData['modifyDate'].'", modifyBy="'.$slabData['modifyBy'].'",dividingFactorC="'.$slabData['dividingFactorC'].'", DF_SGL="'.$slabData['DF_SGL'].'", DF_DBL="'.$slabData['DF_DBL'].'", DF_TWN="'.$slabData['DF_TWN'].'", DF_TPL="'.$slabData['DF_TPL'].'", DF_QUAD="'.$slabData['DF_QUAD'].'", DF_SIX="'.$slabData['DF_SIX'].'", DF_EIGHT="'.$slabData['DF_EIGHT'].'", DF_TEN="'.$slabData['DF_TEN'].'", DF_ABED="'.$slabData['DF_ABED'].'", DF_CBED="'.$slabData['DF_CBED'].'",adult="'.$slabData['adult'].'",child="'.$slabData['child'].'",infant="'.$slabData['infant'].'",sglRoom="'.$slabData['sglRoom'].'",dblRoom="'.$slabData['dblRoom'].'",twinRoom="'.$slabData['twinRoom'].'",tplRoom="'.$slabData['tplRoom'].'",quadNoofRoom="'.$slabData['quadNoofRoom'].'",sixNoofBedRoom="'.$slabData['sixNoofBedRoom'].'",eightNoofBedRoom="'.$slabData['eightNoofBedRoom'].'",tenNoofBedRoom="'.$slabData['tenNoofBedRoom'].'",teenNoofRoom="'.$slabData['teenNoofRoom'].'",extraNoofBed="'.$slabData['extraNoofBed'].'",childwithNoofBed="'.$slabData['childwithNoofBed'].'",childwithoutNoofBed="'.$slabData['childwithoutNoofBed'].'"';
					$slabId = addlistinggetlastid('totalPaxSlab',$modevalue);
					
					$esQ="";
					$esQ=GetPageRecord('*','quotationFOCRates',' slabId="'.$slabData['id'].'" and quotationId="'.$slabData['quotationId'].'"');
					if(mysqli_num_rows($esQ) > 0){
						while($escortData=mysqli_fetch_array($esQ)){
							$focRatesQuery = '';  
							$focRatesQuery ='quotationId="'.$lastQuotationId.'",slabId="'.$slabId.'",occupancyType="'.$escortData['occupancyType'].'",NORoom="'.$escortData['NORoom'].'",focType="'.$escortData['focType'].'",calType="'.$escortData['calType'].'",hotelCost="'.$escortData['hotelCost'].'",guideCost="'.$escortData['guideCost'].'",activityCost="'.$escortData['activityCost'].'",entranceCost="'.$escortData['entranceCost'].'",transferCost="'.$escortData['transferCost'].'",trainCost="'.$escortData['trainCost'].'",flightCost="'.$escortData['flightCost'].'",restaurantCost="'.$escortData['restaurantCost'].'",otherCost="'.$escortData['otherCost'].'"';
							$focRateId = addlistinggetlastid('quotationFOCRates',$focRatesQuery);
						} 
					}
				}
			}
			
			//first delete all entries from daysTable of new tour extenction quotation 
			$sql_del="delete from newQuotationDays where quotationId='".$lastQuotationId."'";
			mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
			
			$rs=GetPageRecord('*','newQuotationDays',' quotationId="'.$quotationId.'" and addstatus=0 order by srdate asc');
			while($QueryDaysData=mysqli_fetch_array($rs)){
		
				$adddays='';
				$srDaysDate  = date('Y-m-d', strtotime($QueryDaysData['srdate']));
				$namevalue =' queryId="'.$lastQueryId.'",cityId="'.$QueryDaysData['cityId'].'",quotationId="'.$lastQuotationId.'",srdate="'.$srDaysDate.'"';
				$adddays = addlistinggetlastid('newQuotationDays',$namevalue);
		 
				$b=GetPageRecord('*',_QUOTATION_HOTEL_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and supplierId in ( select serviceId from quotationItinerary where serviceType="hotel" order by serviceId asc ) and (isGuestType=1 or isLocalEscort=1 or isForeignEscort=1) and isRoomSupplement=0 and isHotelSupplement=0 order by id asc');

					while($HotelRes=mysqli_fetch_array($b)) {
						if($HotelRes['isEarlyCheckin']==1){
							// only for Early Arrival date change
							$srDaysDate = date('Y-m-d', strtotime("-1 day", strtotime($fromDate)));
						}
						$namevalue ='';
						$quotHotelId =''; 
						$namevalue ='hotelName="'.$HotelRes['hotelName'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",checkin="'.$HotelRes['checkin'].'",checkout="'.$HotelRes['checkout'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",destinationId="'.$HotelRes['destinationId'].'",categoryId="'.$HotelRes['categoryId'].'",roomTariffId="'.$HotelRes['roomTariffId'].'",currencyId="'.$HotelRes['currencyId'].'",currencyValue="'.$HotelRes['currencyValue'].'",supplierId="'.$HotelRes['supplierId'].'",supplierMasterId="'.$HotelRes['supplierMasterId'].'",mealPlan="'.$HotelRes['mealPlan'].'",night="'.$HotelRes['night'].'",status="'.$HotelRes['status'].'",address="'.$HotelRes['address'].'",roomprice="'.$HotelRes['roomprice'].'",noofrooms="'.$HotelRes['noofrooms'].'",roomType="'.$HotelRes['roomType'].'",tariffType="'.$HotelRes['tariffType'].'",quotTotalNight="'.$HotelRes['quotTotalNight'].'",hotelQuotatoinType="'.$HotelRes['hotelQuotatoinType'].'",singleoccupancy="'.$HotelRes['singleoccupancy'].'",doubleoccupancy="'.$HotelRes['doubleoccupancy'].'",tripleoccupancy="'.$HotelRes['tripleoccupancy'].'",twinoccupancy="'.$HotelRes['twinoccupancy'].'",childwithbed="'.$HotelRes['childwithbed'].'",childwithoutbed="'.$HotelRes['childwithoutbed'].'",lunch="'.$HotelRes['lunch'].'",dinner="'.$HotelRes['dinner'].'",extraadult="'.$HotelRes['extraadult'].'",taxType="'.$HotelRes['taxType'].'",markupType="'.$HotelRes['markupType'].'",sglMarkup="'.$HotelRes['sglMarkup'].'",dblMarkup="'.$HotelRes['dblMarkup'].'",twinMarkup="'.$HotelRes['twinMarkup'].'",tplMarkup="'.$HotelRes['tplMarkup'].'",cwbMarkup="'.$HotelRes['cwbMarkup'].'",quadMarkup="'.$HotelRes['quadMarkup'].'",sixMarkup="'.$HotelRes['sixMarkup'].'",eightMarkup="'.$HotelRes['eightMarkup'].'",tenMarkup="'.$HotelRes['tenMarkup'].'",teenMarkup="'.$HotelRes['teenMarkup'].'",cnbMarkup="'.$HotelRes['cnbMarkup'].'",exMarkup="'.$HotelRes['exMarkup'].'",mealMarkup="'.$HotelRes['mealMarkup'].'",singleNoofRoom="'.$sglRoom.'",doubleNoofRoom="'.$dblRoom.'",tripleNoofRoom="'.$tplRoom.'",twinNoofRoom="'.$twinRoom.'",childwithNoofBed="'.$cwbRoom.'",childwithoutNoofBed="'.$cnbRoom.'",extraNoofBed="'.$extraNoofBed.'",paymentMode="'.$HotelRes['paymentMode'].'",agentCode="'.$HotelRes['agentCode'].'",fileNo="'.$HotelRes['fileNo'].'",confirmation="'.$HotelRes['confirmation'].'",arrivalBy="'.$HotelRes['arrivalBy'].'",departureBy="'.$HotelRes['departureBy'].'",specialRequest="'.$HotelRes['specialRequest'].'",remark="'.$HotelRes['remark'].'",tourManager="'.$HotelRes['tourManager'].'",harrivalon="'.$HotelRes['harrivalon'].'",hfrom="'.$HotelRes['hfrom'].'",hbyfrom="'.$HotelRes['hbyfrom'].'",hatfrom="'.$HotelRes['hatfrom'].'",hdepartureon="'.$HotelRes['hdepartureon'].'",hto="'.$HotelRes['hto'].'",hbyto="'.$HotelRes['hbyto'].'",hatto="'.$HotelRes['hatto'].'",supplementCostAdded="'.$HotelRes['supplementCostAdded'].'",isHotelSupplement="'.$HotelRes['isHotelSupplement'].'",isRoomSupplement="'.$HotelRes['isRoomSupplement'].'",rand_color="'.$HotelRes['rand_color'].'",hotelQuoteId="'.$HotelRes['hotelQuoteId'].'",breakfast="'.$HotelRes['breakfast'].'",extraBed="'.$HotelRes['extraBed'].'",roomGST="'.$HotelRes['roomGST'].'",mealGST="'.$HotelRes['mealGST'].'",TAC="'.$HotelRes['TAC'].'",complimentaryLunch="'.$HotelRes['complimentaryLunch'].'",complimentaryDinner="'.$HotelRes['complimentaryDinner'].'",complimentaryBreakfast="'.$HotelRes['complimentaryBreakfast'].'",isChildBreakfast="'.$HotelRes['isChildBreakfast'].'",isChildLunch="'.$HotelRes['isChildLunch'].'",isChildDinner="'.$HotelRes['isChildDinner'].'",startDayDate="'.$HotelRes['startDayDate'].'",endDayDate="'.$HotelRes['endDayDate'].'",escortHotelStatus="'.$HotelRes['escortHotelStatus'].'",escortType="'.$HotelRes['escortType'].'",isGuestType="'.$HotelRes['isGuestType'].'",isLocalEscort="'.$HotelRes['isLocalEscort'].'",isForeignEscort="'.$HotelRes['isForeignEscort'].'",isEarlyCheckin="'.$HotelRes['isEarlyCheckin'].'"';
	 
						$addHotel = addlistinggetlastid(_QUOTATION_HOTEL_MASTER_,$namevalue);

						$check_h=GetPageRecord('*','quotationItinerary',' queryId="'.$HotelRes['queryId'].'" and dayId="'.$adddays.'" and quotationId="'.$lastQuotationId.'" and serviceId="'.$HotelRes['supplierId'].'"');
						if(mysqli_num_rows($check_h)==0){
							$namevalue ='';
							$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$HotelRes['supplierId'].'",quotationId="'.$lastQuotationId.'",serviceType="hotel",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
							addlistinggetlastid('quotationItinerary',$namevalue);
						}

						// supplement
						$hotelSuppQuery=GetPageRecord('*',_QUOTATION_HOTEL_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and hotelQuoteId="'.$HotelRes['id'].'" and (isRoomSupplement=1 or isHotelSupplement=1) order by id asc');
						while($hotelSuppD=mysqli_fetch_array($hotelSuppQuery)){
							
							$namevalue ='';
							$namevalue ='hotelName="'.$hotelSuppD['hotelName'].'",fromDate="'.$hotelSuppD['fromDate'].'",toDate="'.$hotelSuppD['toDate'].'",checkin="'.$hotelSuppD['checkin'].'",checkout="'.$hotelSuppD['checkout'].'",queryId="'.$hotelSuppD['queryId'].'",quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",destinationId="'.$hotelSuppD['destinationId'].'",categoryId="'.$hotelSuppD['categoryId'].'",roomTariffId="'.$hotelSuppD['roomTariffId'].'",currencyId="'.$hotelSuppD['currencyId'].'",currencyValue="'.$hotelSuppD['currencyValue'].'",supplierId="'.$hotelSuppD['supplierId'].'",supplierMasterId="'.$hotelSuppD['supplierMasterId'].'",mealPlan="'.$hotelSuppD['mealPlan'].'",night="'.$hotelSuppD['night'].'",status="'.$hotelSuppD['status'].'",address="'.$hotelSuppD['address'].'",roomprice="'.$hotelSuppD['roomprice'].'",noofrooms="'.$hotelSuppD['noofrooms'].'",roomType="'.$hotelSuppD['roomType'].'",tariffType="'.$hotelSuppD['tariffType'].'",quotTotalNight="'.$hotelSuppD['quotTotalNight'].'",hotelQuotatoinType="'.$hotelSuppD['hotelQuotatoinType'].'",singleoccupancy="'.$hotelSuppD['singleoccupancy'].'",doubleoccupancy="'.$hotelSuppD['doubleoccupancy'].'",twinoccupancy="'.$hotelSuppD['twinoccupancy'].'",tripleoccupancy="'.$hotelSuppD['tripleoccupancy'].'",quadoccupancy="'.$hotelSuppD['quadoccupancy'].'",childwithbed="'.$hotelSuppD['childwithbed'].'",childwithoutbed="'.$hotelSuppD['childwithoutbed'].'",lunch="'.$hotelSuppD['lunch'].'",dinner="'.$hotelSuppD['dinner'].'",extraadult="'.$hotelSuppD['extraadult'].'",paymentMode="'.$hotelSuppD['paymentMode'].'",agentCode="'.$hotelSuppD['agentCode'].'",fileNo="'.$hotelSuppD['fileNo'].'",confirmation="'.$hotelSuppD['confirmation'].'",arrivalBy="'.$hotelSuppD['arrivalBy'].'",departureBy="'.$hotelSuppD['departureBy'].'",specialRequest="'.$hotelSuppD['specialRequest'].'", taxType="'.$hotelSuppD['taxType'].'",markupType="'.$hotelSuppD['markupType'].'",sglMarkup="'.$hotelSuppD['sglMarkup'].'",dblMarkup="'.$hotelSuppD['dblMarkup'].'",twinMarkup="'.$hotelSuppD['twinMarkup'].'",tplMarkup="'.$hotelSuppD['tplMarkup'].'",cwbMarkup="'.$hotelSuppD['cwbMarkup'].'",quadMarkup="'.$hotelSuppD['quadMarkup'].'",sixMarkup="'.$hotelSuppD['sixMarkup'].'",eightMarkup="'.$hotelSuppD['eightMarkup'].'",tenMarkup="'.$hotelSuppD['tenMarkup'].'",teenMarkup="'.$hotelSuppD['teenMarkup'].'",cnbMarkup="'.$hotelSuppD['cnbMarkup'].'",exMarkup="'.$hotelSuppD['exMarkup'].'",mealMarkup="'.$hotelSuppD['mealMarkup'].'",remark="'.$hotelSuppD['remark'].'",tourManager="'.$hotelSuppD['tourManager'].'",supplementCostAdded="'.$hotelSuppD['supplementCostAdded'].'",isHotelSupplement="'.$hotelSuppD['isHotelSupplement'].'",isRoomSupplement="'.$hotelSuppD['isRoomSupplement'].'",rand_color="'.$hotelSuppD['rand_color'].'",hotelQuoteId="'.$addHotel.'",breakfast="'.$hotelSuppD['breakfast'].'",extraBed="'.$hotelSuppD['extraBed'].'",roomGST="'.$hotelSuppD['roomGST'].'",mealGST="'.$hotelSuppD['mealGST'].'",TAC="'.$hotelSuppD['TAC'].'",complimentaryLunch="'.$hotelSuppD['complimentaryLunch'].'",complimentaryDinner="'.$hotelSuppD['complimentaryDinner'].'",complimentaryBreakfast="'.$hotelSuppD['complimentaryBreakfast'].'",startDayDate="'.$hotelSuppD['startDayDate'].'",endDayDate="'.$hotelSuppD['endDayDate'].'",singleNoofRoom="'.$hotelSuppD['singleNoofRoom'].'",doubleNoofRoom="'.$hotelSuppD['doubleNoofRoom'].'",twinNoofRoom="'.$hotelSuppD['twinNoofRoom'].'",tripleNoofRoom="'.$hotelSuppD['tripleNoofRoom'].'",extraNoofBed="'.$hotelSuppD['extraNoofBed'].'",childwithNoofBed="'.$hotelSuppD['childwithNoofBed'].'",childwithoutNoofBed="'.$hotelSuppD['childwithoutNoofBed'].'",isGuestType="'.$hotelSuppD['isGuestType'].'",isLocalEscort="'.$hotelSuppD['isLocalEscort'].'",isForeignEscort="'.$hotelSuppD['isForeignEscort'].'",isEarlyCheckin="'.$hotelSuppD['isEarlyCheckin'].'",sixBedRoom="'.$hotelSuppD['sixBedRoom'].'",eightBedRoom="'.$hotelSuppD['eightBedRoom'].'",tenBedRoom="'.$hotelSuppD['tenBedRoom'].'",quadRoom="'.$hotelSuppD['quadRoom'].'",teenRoom="'.$hotelSuppD['teenRoom'].'",childBreakfast="'.$hotelSuppD['childBreakfast'].'",childDinner="'.$hotelSuppD['childDinner'].'",childLunch="'.$hotelSuppD['childLunch'].'",sixNoofBedRoom="'.$hotelSuppD['sixNoofBedRoom'].'",eightNoofBedRoom="'.$hotelSuppD['eightNoofBedRoom'].'",tenNoofBedRoom="'.$hotelSuppD['tenNoofBedRoom'].'",quadNoofRoom="'.$hotelSuppD['quadNoofRoom'].'",teenNoofRoom="'.$hotelSuppD['teenNoofRoom'].'",isChildBreakfast="'.$hotelSuppD['isChildBreakfast'].'",isChildLunch="'.$hotelSuppD['isChildLunch'].'",isChildDinner="'.$hotelSuppD['isChildDinner'].'"';
							$addSuppId = addlistinggetlastid(_QUOTATION_HOTEL_MASTER_,$namevalue);

							 $check_h=GetPageRecord('*','quotationItinerary',' queryId="'.$QueryDaysData['queryId'].'" and dayId="'.$adddays.'" and quotationId="'.$lastQuotationId.'" and serviceId="'.$hotelSuppD['supplierId'].'"');
							if(mysqli_num_rows($check_h)==0 && $hotelSuppD['isHotelSupplement'] == 1){
								$namevalue ='';
								$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$QueryDaysData['queryId'].'",serviceId="'.$hotelSuppD['supplierId'].'",quotationId="'.$lastQuotationId.'",serviceType="hotel",startDate="'.$hotelSuppD['fromDate'].'",endDate="'.$hotelSuppD['fromDate'].'"';
								addlistinggetlastid('quotationItinerary',$namevalue);
							}

						} 
			
					} 
		
				$b='';
				$b=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in ( select serviceId from quotationItinerary where serviceType="transfer" order by serviceId asc ) order by id asc');
				if(mysqli_num_rows($b)>0){
					while($quotTransferData=mysqli_fetch_array($b)){
					
						$bb2='';
						$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1 ');
						$paxSlabData2=mysqli_fetch_array($bb2);
						$totalPaxId = $paxSlabData2['id'];

						$transQuoteId = '';
						$transfernamevalue ='fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",destinationId="'.$quotTransferData['destinationId'].'",transferNameId="'.$quotTransferData['transferNameId'].'",supplierId="'.$quotTransferData['supplierId'].'",tariffId="'.$quotTransferData['tariffId'].'",vehicleId="'.$quotTransferData['vehicleId'].'",vehicleModelId="'.$quotTransferData['vehicleModelId'].'",currencyId="'.$quotTransferData['currencyId'].'",currencyValue="'.$quotTransferData['currencyValue'].'",transferToId="'.$quotTransferData['transferToId'].'",transferFromId="'.$quotTransferData['transferFromId'].'",transferType="'.$quotTransferData['transferType'].'",adultCost="'.$quotTransferData['adultCost'].'",childCost="'.$quotTransferData['childCost'].'",infantCost="'.$quotTransferData['infantCost'].'",roomPrice="'.$quotTransferData['roomPrice'].'",detail="'.$quotTransferData['detail'].'",vehicleCost="'.$quotTransferData['vehicleCost'].'",transferQuotatoinType="'.$quotTransferData['transferQuotatoinType'].'",dmcId="'.$quotTransferData['dmcId'].'",pickupFrom="'.$quotTransferData['pickupFrom'].'",pickupTime="'.$quotTransferData['pickupTime'].'",duration="'.$quotTransferData['duration'].'",vehicleMaxPax="'.$quotTransferData['vehicleMaxPax'].'",adMarkup="'.$quotTransferData['adMarkup'].'",chMarkup="'.$quotTransferData['chMarkup'].'",vehMarkup="'.$quotTransferData['vehMarkup'].'",remark="'.$quotTransferData['remark'].'",confirmation="'.$quotTransferData['confirmation'].'",tourManager="'.$quotTransferData['tourManager'].'",driverId="'.$quotTransferData['driverId'].'",vehicleType="'.$quotTransferData['vehicleType'].'",parkingFee="'.$quotTransferData['parkingFee'].'",representativeEntryFee="'.$quotTransferData['representativeEntryFee'].'",assistance="'.$quotTransferData['assistance'].'",guideAllowance="'.$quotTransferData['guideAllowance'].'",interStateAndToll="'.$quotTransferData['interStateAndToll'].'",miscellaneous="'.$quotTransferData['miscellaneous'].'",transferName="'.$quotTransferData['transferName'].'",noOfDays="'.$quotTransferData['noOfDays'].'",dayId="'.$adddays.'",serviceType="'.$quotTransferData['serviceType'].'",costType="'.$quotTransferData['costType'].'",distance="'.$quotTransferData['distance'].'",noOfVehicles="'.$quotTransferData['noOfVehicles'].'",markupType="'.$quotTransferData['markupType'].'",markupCost="'.$quotTransferData['markupCost'].'",taxType="'.$quotTransferData['taxType'].'",gstTax="'.$quotTransferData['gstTax'].'",totalPax="'.$totalPaxId.'",isGuestType="'.$quotTransferData['isGuestType'].'",startDay="'.$quotTransferData['startDay'].'",endDay="'.$quotTransferData['endDay'].'"';
		
						$transQuoteId = addlistinggetlastid(_QUOTATION_TRANSFER_MASTER_,$transfernamevalue);
						
						$c1="";
						$c1=GetPageRecord('*','quotationTransferTimelineDetails','transferQuoteId="'.$quotTransferData['id'].'" and quotationId="'.$quotTransferData['quotationId'].'"');
						if(mysqli_num_rows($c1)>0){
							$transferTimelineData=mysqli_fetch_array($c1);
		
							 $namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",supplierId="'.$transferTimelineData['supplierId'].'",transferQuoteId="'.$transQuoteId.'",arrivalFrom="'.$transferTimelineData['arrivalFrom'].'",trainName="'.$transferTimelineData['trainName'].'",trainNumber="'.$transferTimelineData['trainNumber'].'",flightName="'.$transferTimelineData['flightName'].'",flightNumber="'.$transferTimelineData['flightNumber'].'",vehicleName="'.$transferTimelineData['vehicleName'].'",airportName="'.$transferTimelineData['airportName'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'",VehicleModel="'.$transferTimelineData['VehicleModel'].'",arrivalTime="'.$transferTimelineData['arrivalTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",mode="'.$transferTimelineData['mode'].'",pickupTime="'.$transferTimelineData['pickupTime'].'"';
							 $hotelSupHot = addlistinggetlastid('quotationTransferTimelineDetails',$namevalue); 
						}
		
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$transQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="'.$quotTransferData['serviceType'].'",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
		
					}
				}

				$b='';
				$b=GetPageRecord('*',_QUOTATION_TRANSFER_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in ( select serviceId from quotationItinerary where serviceType="transportation" order by serviceId asc ) order by id asc');
				if(mysqli_num_rows($b)>0){
					while($quotTransferData=mysqli_fetch_array($b)){
					
						$bb2='';
						$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1 ');
						$paxSlabData2=mysqli_fetch_array($bb2);
						$totalPaxId = $paxSlabData2['id'];

						$transQuoteId = '';
						$transfernamevalue ='fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",destinationId="'.$quotTransferData['destinationId'].'",transferNameId="'.$quotTransferData['transferNameId'].'",supplierId="'.$quotTransferData['supplierId'].'",tariffId="'.$quotTransferData['tariffId'].'",vehicleId="'.$quotTransferData['vehicleId'].'",vehicleModelId="'.$quotTransferData['vehicleModelId'].'",currencyId="'.$quotTransferData['currencyId'].'",currencyValue="'.$quotTransferData['currencyValue'].'",transferToId="'.$quotTransferData['transferToId'].'",transferFromId="'.$quotTransferData['transferFromId'].'",transferType="'.$quotTransferData['transferType'].'",adultCost="'.$quotTransferData['adultCost'].'",childCost="'.$quotTransferData['childCost'].'",infantCost="'.$quotTransferData['infantCost'].'",roomPrice="'.$quotTransferData['roomPrice'].'",detail="'.$quotTransferData['detail'].'",vehicleCost="'.$quotTransferData['vehicleCost'].'",transferQuotatoinType="'.$quotTransferData['transferQuotatoinType'].'",dmcId="'.$quotTransferData['dmcId'].'",pickupFrom="'.$quotTransferData['pickupFrom'].'",pickupTime="'.$quotTransferData['pickupTime'].'",duration="'.$quotTransferData['duration'].'",vehicleMaxPax="'.$quotTransferData['vehicleMaxPax'].'",adMarkup="'.$quotTransferData['adMarkup'].'",chMarkup="'.$quotTransferData['chMarkup'].'",vehMarkup="'.$quotTransferData['vehMarkup'].'",remark="'.$quotTransferData['remark'].'",confirmation="'.$quotTransferData['confirmation'].'",tourManager="'.$quotTransferData['tourManager'].'",driverId="'.$quotTransferData['driverId'].'",vehicleType="'.$quotTransferData['vehicleType'].'",parkingFee="'.$quotTransferData['parkingFee'].'",representativeEntryFee="'.$quotTransferData['representativeEntryFee'].'",assistance="'.$quotTransferData['assistance'].'",guideAllowance="'.$quotTransferData['guideAllowance'].'",interStateAndToll="'.$quotTransferData['interStateAndToll'].'",miscellaneous="'.$quotTransferData['miscellaneous'].'",transferName="'.$quotTransferData['transferName'].'",noOfDays="'.$quotTransferData['noOfDays'].'",dayId="'.$adddays.'",serviceType="'.$quotTransferData['serviceType'].'",costType="'.$quotTransferData['costType'].'",distance="'.$quotTransferData['distance'].'",noOfVehicles="'.$quotTransferData['noOfVehicles'].'",markupType="'.$quotTransferData['markupType'].'",markupCost="'.$quotTransferData['markupCost'].'",taxType="'.$quotTransferData['taxType'].'",gstTax="'.$quotTransferData['gstTax'].'",totalPax="'.$totalPaxId.'",isGuestType="'.$quotTransferData['isGuestType'].'",startDay="'.$quotTransferData['startDay'].'",endDay="'.$quotTransferData['endDay'].'"';
		
						$transQuoteId = addlistinggetlastid(_QUOTATION_TRANSFER_MASTER_,$transfernamevalue);
						
						$c1="";
						$c1=GetPageRecord('*','quotationTransferTimelineDetails','transferQuoteId="'.$quotTransferData['id'].'" and quotationId="'.$quotTransferData['quotationId'].'"');
						if(mysqli_num_rows($c1)>0){
							$transferTimelineData=mysqli_fetch_array($c1);
		
							 $namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",supplierId="'.$transferTimelineData['supplierId'].'",transferQuoteId="'.$transQuoteId.'",arrivalFrom="'.$transferTimelineData['arrivalFrom'].'",trainName="'.$transferTimelineData['trainName'].'",trainNumber="'.$transferTimelineData['trainNumber'].'",flightName="'.$transferTimelineData['flightName'].'",flightNumber="'.$transferTimelineData['flightNumber'].'",vehicleName="'.$transferTimelineData['vehicleName'].'",airportName="'.$transferTimelineData['airportName'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'",VehicleModel="'.$transferTimelineData['VehicleModel'].'",arrivalTime="'.$transferTimelineData['arrivalTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",mode="'.$transferTimelineData['mode'].'",pickupTime="'.$transferTimelineData['pickupTime'].'"';
							 $hotelSupHot = addlistinggetlastid('quotationTransferTimelineDetails',$namevalue); 
						}
		
						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$transQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="'.$quotTransferData['serviceType'].'",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
		
					}
				}
		
				$b="";
				$b=GetPageRecord('*','quotationGuideMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="guide" order by serviceId asc) and isGuestType=1 order by id asc');
				while($quotGuideData=mysqli_fetch_array($b)){

					$bb2='';
					$bb2=GetPageRecord('id','totalPaxSlab',' quotationId="'.$lastQuotationId.'" and status=1');
					$paxSlabData2=mysqli_fetch_array($bb2);
					$totalPaxId = $paxSlabData2['id']; 

					$guideQuoteId =''; 
					$transfernamevalue ='guideId="'.$quotGuideData['guideId'].'",slabId="'.$totalPaxId.'",price="'.$quotGuideData['price'].'",guideName="'.$quotGuideData['guideName'].'",queryId="'.$lastQueryId.'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",supplierId="'.$quotGuideData['supplierId'].'",tariffId="'.$quotGuideData['tariffId'].'",quotationId="'.$lastQuotationId.'",srn="'.$quotGuideData['srn'].'",destinationId="'.$quotGuideData['destinationId'].'",rules="'.$quotGuideData['rules'].'",category="'.$quotGuideData['category'].'",subcategory="'.$quotGuideData['subcategory'].'",totalDays="'.$quotGuideData['totalDays'].'",perDaycost="'.$quotGuideData['perDaycost'].'",serviceType="'.$quotGuideData['serviceType'].'",currencyId="'.$quotGuideData['currencyId'].'",currencyValue="'.$quotGuideData['currencyValue'].'",markupType="'.$quotGuideData['markupType'].'",markupCost="'.$quotGuideData['markupCost'].'",taxType="'.$quotGuideData['taxType'].'",gstTax="'.$quotGuideData['gstTax'].'",dayId="'.$adddays.'"';
		
					$guideQuoteId = addlistinggetlastid('quotationGuideMaster',$transfernamevalue);

					$bSupp=GetPageRecord('*','quotationGuideMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'"  and guideQuoteId="'.$quotGuideData['id'].'" and isSupplement=1 order by id asc');
					while($transferSuppRes=mysqli_fetch_array($bSupp)){
						$suppGuidevalue ='guideId="'.$transferSuppRes['guideId'].'",slabId="'.$totalPaxId.'",price="'.$transferSuppRes['price'].'",guideName="'.$transferSuppRes['guideName'].'",queryId="'.$lastQueryId.'",fromDate="'.$quotGuideData['fromDate'].'",toDate="'.$quotGuideData['toDate'].'",supplierId="'.$transferSuppRes['supplierId'].'",tariffId="'.$transferSuppRes['tariffId'].'",quotationId="'.$lastQuotationId.'",srn="'.$transferSuppRes['srn'].'",destinationId="'.$transferSuppRes['destinationId'].'",rules="'.$transferSuppRes['rules'].'",category="'.$transferSuppRes['category'].'",subcategory="'.$transferSuppRes['subcategory'].'",totalDays="'.$transferSuppRes['totalDays'].'",perDaycost="'.$transferSuppRes['perDaycost'].'",serviceType="'.$transferSuppRes['serviceType'].'",currencyId="'.$transferSuppRes['currencyId'].'",currencyValue="'.$transferSuppRes['currencyValue'].'",guideQuoteId="'.$guideQuoteId.'",isGuestType="'.$transferSuppRes['isGuestType'].'",isSupplement="'.$transferSuppRes['isSupplement'].'",isSelectedFinal="'.$transferSuppRes['isSelectedFinal'].'",paxRange="'.$transferSuppRes['paxRange'].'",dayType="'.$transferSuppRes['dayType'].'",markupType="'.$transferSuppRes['markupType'].'",markupCost="'.$transferSuppRes['markupCost'].'",taxType="'.$transferSuppRes['taxType'].'",gstTax="'.$transferSuppRes['gstTax'].'",dayId="'.$adddays.'"';
			
						$addSuppHotel = addlistinggetlastid('quotationGuideMaster',$suppGuidevalue);
					}
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$guideQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="guide",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
		
				}
		
				$b="";
				$b=GetPageRecord('*',_QUOTATION_OTHER_ACTIVITY_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="activity" order by serviceId asc) order by id asc');
				while($quotActivityData=mysqli_fetch_array($b)){
					// tarifId
					$activityQuoteId = '';
					$transfernamevalue ='otherActivityName="'.$quotActivityData['otherActivityName'].'",dateotherActivity="'.$quotActivityData['dateotherActivity'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",adultCost="'.$quotActivityData['adultCost'].'",supplierId="'.$quotActivityData['supplierId'].'",tariffId="'.$quotActivityData['tariffId'].'",childCost="'.$quotActivityData['childCost'].'",infantCost="'.$quotActivityData['infantCost'].'",transferType="'.$quotActivityData['transferType'].'",vehicleId="'.$quotActivityData['vehicleId'].'",vehicleCost="'.$quotActivityData['vehicleCost'].'",repCost="'.$quotActivityData['repCost'].'",ticketAdultCost="'.$quotActivityData['ticketAdultCost'].'",ticketchildCost="'.$quotActivityData['ticketchildCost'].'",ticketinfantCost="'.$quotActivityData['ticketinfantCost'].'",groupCost="'.$quotActivityData['groupCost'].'",otherActivityCity="'.$quotActivityData['otherActivityCity'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",activityCost="'.$quotActivityData['activityCost'].'",maxpax="'.$quotActivityData['maxpax'].'",perPaxCost="'.$quotActivityData['perPaxCost'].'",quotationOtherActivitymaster="'.$quotActivityData['quotationOtherActivitymaster'].'",noOfVehicles="'.$quotActivityData['noOfVehicles'].'",currencyId="'.$quotActivityData['currencyId'].'",currencyValue="'.$quotActivityData['currencyValue'].'",markupType="'.$quotActivityData['markupType'].'",markupCost="'.$quotActivityData['markupCost'].'",taxType="'.$quotActivityData['taxType'].'",gstTax="'.$quotActivityData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$quotActivityData['adultPax'].'",childPax="'.$quotActivityData['childPax'].'",infantPax="'.$quotActivityData['infantPax'].'"';
					$activityQuoteId = addlistinggetlastid(_QUOTATION_OTHER_ACTIVITY_MASTER_,$transfernamevalue);
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$activityQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="activity",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
					
					$c1="";
					$c1=GetPageRecord('*','quotationActivityTimelineDetails','  hotelQuoteId="'.$quotActivityData['id'].'"');  
					if(mysqli_num_rows($c1)>0){
						$transferTimelineData=mysqli_fetch_array($c1); 
						 $namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",hotelQuoteId="'.$activityQuoteId.'",supplierId="'.$quotActivityData['supplierId'].'",startTime="'.$transferTimelineData['startTime'].'",endTime="'.$transferTimelineData['endTime'].'"';
						 $entraceTimeId = addlistinggetlastid('quotationActivityTimelineDetails',$namevalue);
		
					}
		
				}
		
				$b="";
				$b=GetPageRecord('*','quotationEnrouteMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="enroute" order by serviceId asc) order by id asc');
				while($quotEnrouteData=mysqli_fetch_array($b)){
					$enrQuoteId ='';
		
					$transfernamevalue ='enrouteId="'.$quotEnrouteData['enrouteId'].'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",adultCost="'.$quotEnrouteData['adultCost'].'",childCost="'.$quotEnrouteData['childCost'].'",infantCost="'.$quotEnrouteData['infantCost'].'",destinationId="'.$quotEnrouteData['destinationId'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",dayId="'.$adddays.'",currencyId="'.$quotEnrouteData['currencyId'].'",currencyValue="'.$quotEnrouteData['currencyValue'].'",adultPax="'.$quotEnrouteData['adultPax'].'",childPax="'.$quotEnrouteData['childPax'].'",infantPax="'.$quotEnrouteData['infantPax'].'"';
					$enrQuoteId = addlistinggetlastid('quotationEnrouteMaster',$transfernamevalue);
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$enrQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="enroute",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
		
				}
		
		
		
				$b="";
				$b=GetPageRecord('*','quotationEntranceMaster','quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="entrance" order by serviceId asc) order by id asc');
				while($quotEntranceData=mysqli_fetch_array($b)){
					$entQuoteId = '';
					// transferType
					$transfernamevalue ='entranceNameId="'.$quotEntranceData['entranceNameId'].'",quotationId="'.$lastQuotationId.'",destinationId="'.$quotEntranceData['destinationId'].'",dmcId="'.$quotEntranceData['dmcId'].'",vehicleId="'.$quotEntranceData['vehicleId'].'",supplierId="'.$quotEntranceData['supplierId'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",ticketAdultCost="'.$quotEntranceData['ticketAdultCost'].'",ticketchildCost="'.$quotEntranceData['ticketchildCost'].'",ticketinfantCost="'.$quotEntranceData['ticketinfantCost'].'",entranceType="'.$quotEntranceData['entranceType'].'",transferType="'.$quotEntranceData['transferType'].'",adultCost="'.$quotEntranceData['adultCost'].'",childCost="'.$quotEntranceData['childCost'].'",infantCost="'.$quotEntranceData['infantCost'].'",detail="'.$quotEntranceData['detail'].'",vehicleCost="'.$quotEntranceData['vehicleCost'].'",noOfVehicles="'.$quotEntranceData['noOfVehicles'].'",currencyId="'.$quotEntranceData['currencyId'].'",currencyValue="'.$quotEntranceData['currencyValue'].'",entranceQuotatoinType="'.$quotEntranceData['entranceQuotatoinType'].'",pickupTime="'.$quotEntranceData['pickupTime'].'",pickupFrom="'.$quotEntranceData['pickupFrom'].'",duration="'.$quotEntranceData['duration'].'",vehicleMaxPax="'.$quotEntranceData['vehicleMaxPax'].'",adMarkup="'.$quotEntranceData['adMarkup'].'",chMarkup="'.$quotEntranceData['chMarkup'].'",remark="'.$quotEntranceData['remark'].'",confirmation="'.$quotEntranceData['confirmation'].'",tourManager="'.$quotEntranceData['tourManager'].'",guideCost="'.$quotEntranceData['guideCost'].'",queryId="'.$lastQueryId.'",markupType="'.$quotEntranceData['markupType'].'",markupCost="'.$quotEntranceData['markupCost'].'",taxType="'.$quotEntranceData['taxType'].'",gstTax="'.$quotEntranceData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$quotEntranceData['adultPax'].'",childPax="'.$quotEntranceData['childPax'].'",infantPax="'.$quotEntranceData['infantPax'].'"';
					$entQuoteId = addlistinggetlastid('quotationEntranceMaster',$transfernamevalue);
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$entQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="entrance",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
					
					$c1="";
					$c1=GetPageRecord('*','quotationEntranceTimelineDetails','  hotelQuoteId="'.$quotEntranceData['id'].'"');  
					if(mysqli_num_rows($c1)>0){
						$transferTimelineData=mysqli_fetch_array($c1);
		
						 $namevalue ='quotationId="'.$lastQuotationId.'",dayId="'.$adddays.'",hotelQuoteId="'.$entQuoteId.'",supplierId="'.$transferTimelineData['supplierId'].'",startTime="'.$transferTimelineData['startTime'].'",endTime="'.$transferTimelineData['endTime'].'",pickupTime="'.$transferTimelineData['pickupTime'].'",dropTime="'.$transferTimelineData['dropTime'].'",pickupAddress="'.$transferTimelineData['pickupAddress'].'",dropAddress="'.$transferTimelineData['dropAddress'].'"';
						 $entraceTimeId = addlistinggetlastid('quotationEntranceTimelineDetails',$namevalue);
		
					}
				}

				$b=GetPageRecord('*','quotationFerryMaster','quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="ferry" order by serviceId asc) order by id asc');
					while($ferryTranfer=mysqli_fetch_array($b)){
						$endFerryId= '';
						$ferrynamevalue ='ferryNameId="'.$ferryTranfer['ferryNameId'].'",serviceid="'.$ferryTranfer['serviceid'].'",quotationId="'.$lastQuotationId.'",destinationId="'.$ferryTranfer['destinationId'].'",supplierId="'.$ferryTranfer['supplierId'].'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",ferryClass="'.$ferryTranfer['ferryClass'].'",adultCost="'.$ferryTranfer['adultCost'].'",childCost="'.$ferryTranfer['childCost'].'",infantCost="'.$ferryTranfer['infantCost'].'",ferryCost="'.$ferryTranfer['ferryCost'].'",processingfee="'.$ferryTranfer['processingfee'].'",miscCost="'.$ferryTranfer['miscCost'].'",currencyId="'.$ferryTranfer['currencyId'].'",currencyValue="'.$ferryTranfer['currencyValue'].'",pickupTime="'.$ferryTranfer['pickupTime'].'",dropTime="'.$ferryTranfer['dropTime'].'",remark="'.$ferryTranfer['remark'].'",rateId="'.$ferryTranfer['rateId'].'",timeId="'.$ferryTranfer['timeId'].'",queryId="'.$lastQueryId.'",markupType="'.$ferryTranfer['markupType'].'",markupCost="'.$ferryTranfer['markupCost'].'",taxType="'.$ferryTranfer['taxType'].'",gstTax="'.$ferryTranfer['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$ferryTranfer['adultPax'].'",childPax="'.$ferryTranfer['childPax'].'",infantPax="'.$ferryTranfer['infantPax'].'"';
						$endFerryId = addlistinggetlastid('quotationFerryMaster',$ferrynamevalue);

						$namevalue ='';
						$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$endFerryId.'",quotationId="'.$lastQuotationId.'",serviceType="ferry",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
						
					}



		
				$b="";
				$b=GetPageRecord('*',_QUOTATION_INBOUND_MEAL_PLAN_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="mealplan" order by serviceId asc) order by id asc');
				while($quotMealPlanData=mysqli_fetch_array($b)){
					$mealQuoteId = '';
					$transfernamevalue ='mealPlanName="'.$quotMealPlanData['mealPlanName'].'",quotationId="'.$lastQuotationId.'",dateMealPlan="'.$quotMealPlanData['dateMealPlan'].'",adultCost="'.$quotMealPlanData['adultCost'].'",childCost="'.$quotMealPlanData['childCost'].'",infantCost="'.$quotMealPlanData['infantCost'].'",groupCost="'.$quotMealPlanData['groupCost'].'",mealPlanCity="'.$quotMealPlanData['mealPlanCity'].'",mealType="'.$quotMealPlanData['mealType'].'",destinationId="'.$quotMealPlanData['destinationId'].'",fromDate="'.$srDaysDate.'",currencyId="'.$quotMealPlanData['currencyId'].'",currencyValue="'.$quotMealPlanData['currencyValue'].'",toDate="'.$srDaysDate.'",queryId="'.$lastQueryId.'",markupType="'.$quotMealPlanData['markupType'].'",markupCost="'.$quotMealPlanData['markupCost'].'",taxType="'.$quotMealPlanData['taxType'].'",gstTax="'.$quotMealPlanData['gstTax'].'",dayId="'.$adddays.'",adultPax="'.$quotMealPlanData['adultPax'].'",childPax="'.$quotMealPlanData['childPax'].'",infantPax="'.$quotMealPlanData['infantPax'].'"';
					$mealQuoteId = addlistinggetlastid(_QUOTATION_INBOUND_MEAL_PLAN_MASTER_,$transfernamevalue);
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$mealQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="mealplan",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
		
				}
		
		
		
		
				$b="";
				$b=GetPageRecord('*',_QUOTATION_FLIGHT_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="flight" order by serviceId asc) order by id asc');
				while($quotFlightData=mysqli_fetch_array($b)){
					$flightQuoteId = '';
					$transfernamevalue ='fromDate="'.$srDaysDate.'",quotationId="'.$lastQuotationId.'",toDate="'.$srDaysDate.'",adultCost="'.$quotFlightData['adultCost'].'",childCost="'.$quotFlightData['childCost'].'",infantCost="'.$quotFlightData['infantCost'].'",flightId="'.$quotFlightData['flightId'].'",arrivalTo="'.$quotFlightData['arrivalTo'].'",departureFrom="'.$quotFlightData['departureFrom'].'",destinationId="'.$quotFlightData['destinationId'].'",flightNumber="'.$quotFlightData['flightNumber'].'",flightClass="'.$quotFlightData['flightClass'].'",queryId="'.$lastQueryId.'",markupType="'.$quotFlightData['markupType'].'",markupCost="'.$quotFlightData['markupCost'].'",taxType="'.$quotFlightData['taxType'].'",gstTax="'.$quotFlightData['gstTax'].'",dayId="'.$adddays.'",currencyId="'.$quotFlightData['currencyId'].'",currencyValue="'.$quotFlightData['currencyValue'].'",isGuestType="'.$quotFlightData['isGuestType'].'",adult="'.$quotFlightData['adult'].'",child="'.$quotFlightData['child'].'",infant="'.$quotFlightData['infant'].'",isLocalEscort="'.$quotFlightData['isLocalEscort'].'",isForeignEscort="'.$quotFlightData['isForeignEscort'].'",adultPax="'.$quotFlightData['adultPax'].'",childPax="'.$quotFlightData['childPax'].'",infantPax="'.$quotFlightData['infantPax'].'"';
					$flightQuoteId = addlistinggetlastid(_QUOTATION_FLIGHT_MASTER_,$transfernamevalue);
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$flightQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="flight",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
		
				}
		
		
		
		
				$b="";
				$b=GetPageRecord('*',_QUOTATION_TRAINS_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="train" order by serviceId asc) order by id asc');
				while($quotTrainData=mysqli_fetch_array($b)){
					$trainQuoteId = '';
					$transfernamevalue ='fromDate="'.$srDaysDate.'",quotationId="'.$lastQuotationId.'",toDate="'.$srDaysDate.'",adultCost="'.$quotTrainData['adultCost'].'",childCost="'.$quotTrainData['childCost'].'",infantCost="'.$quotTrainData['infantCost'].'",trainId="'.$quotTrainData['trainId'].'",arrivalTo="'.$quotTrainData['arrivalTo'].'",departureFrom="'.$quotTrainData['departureFrom'].'",destinationId="'.$quotTrainData['destinationId'].'",trainNumber="'.$quotTrainData['trainNumber'].'",trainClass="'.$quotTrainData['trainClass'].'",queryId="'.$lastQueryId.'",markupType="'.$quotTrainData['markupType'].'",markupCost="'.$quotTrainData['markupCost'].'",taxType="'.$quotTrainData['taxType'].'",gstTax="'.$quotTrainData['gstTax'].'",dayId="'.$adddays.'",currencyId="'.$quotTrainData['currencyId'].'",currencyValue="'.$quotTrainData['currencyValue'].'",isGuestType="'.$quotTrainData['isGuestType'].'",isLocalEscort="'.$quotTrainData['isLocalEscort'].'",isForeignEscort="'.$quotTrainData['isForeignEscort'].'",adultPax="'.$quotTrainData['adultPax'].'",childPax="'.$quotTrainData['childPax'].'",infantPax="'.$quotTrainData['infantPax'].'"';
					$trainQuoteId = addlistinggetlastid(_QUOTATION_TRAINS_MASTER_,$transfernamevalue);
		
					$namevalue ='';
					$namevalue ='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$trainQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="train",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
					addlistinggetlastid('quotationItinerary',$namevalue);
				}
		
		
				$b='';
				$b=GetPageRecord('*',_QUOTATION_EXTRA_MASTER_,' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" and id in (select serviceId from quotationItinerary where serviceType="additional" order by serviceId asc) order by id asc');
				if(mysqli_num_rows($b)>0){
		
					while($quotExtraData=mysqli_fetch_array($b)){
						$extraQuoteId = '';
						$transfernamevalue ='name="'.$quotExtraData['name'].'",dateExtra="'.$quotExtraData['dateExtra'].'",queryId="'.$lastQueryId.'",adultCost="'.$quotExtraData['adultCost'].'",childCost="'.$quotExtraData['childCost'].'",infantCost="'.$quotExtraData['infantCost'].'",groupCost="'.$quotExtraData['groupCost'].'",destinationId="'.$quotExtraData['destinationId'].'",quotationId="'.$lastQuotationId.'",fromDate="'.$srDaysDate.'",toDate="'.$srDaysDate.'",currencyId="'.$quotExtraData['currencyId'].'",currencyValue="'.$quotExtraData['currencyValue'].'",additionalId="'.$quotExtraData['additionalId'].'",markupType="'.$quotExtraData['markupType'].'",markupCost="'.$quotExtraData['markupCost'].'",taxType="'.$quotExtraData['taxType'].'",gstTax="'.$quotExtraData['gstTax'].'",dayId="'.$adddays.'",costType="'.$quotExtraData['costType'].'",adultPax="'.$quotExtraData['adultPax'].'",childPax="'.$quotExtraData['childPax'].'",infantPax="'.$quotExtraData['infantPax'].'"';
						$extraQuoteId = addlistinggetlastid(_QUOTATION_EXTRA_MASTER_,$transfernamevalue);

						$namevalue ='';
						$namevalue='srn="'.$adddays.'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",serviceId="'.$extraQuoteId.'",quotationId="'.$lastQuotationId.'",serviceType="additional",startDate="'.$srDaysDate.'",endDate="'.$srDaysDate.'"';
						addlistinggetlastid('quotationItinerary',$namevalue);
		
					}
				}
		
				$b='';
				$b=GetPageRecord('*','quotationModeMaster',' quotationId="'.$quotationId.'" and dayId="'.$QueryDaysData['id'].'" order by id asc');
				if(mysqli_num_rows($b)>0){
					$quotModeData=mysqli_fetch_array($b);
					$modevalue ='name="'.$quotModeData['name'].'",dayId="'.$adddays.'",queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'"';
					$modeId = addlistinggetlastid('quotationModeMaster',$modevalue);
		
				}
				
		
			} 

			
			$b='';
			$b=GetPageRecord('*','quotationServiceMarkup',' quotationId="'.$quotationId.'" order by id asc');
			if(mysqli_num_rows($b)>0){
				$transferRes=mysqli_fetch_array($b);
				$addHotel = '';
				$modevalue = ' markupCost="'.$transferRes['markupCost'].'", curren="'.$transferRes['curren'].'", quotationId="'.$lastQuotationId.'", package="'.$transferRes['package'].'", hotel="'.$transferRes['hotel'].'", guide="'.$transferRes['guide'].'", activity="'.$transferRes['activity'].'", entrance="'.$transferRes['entrance'].'", transfer="'.$transferRes['transfer'].'", train="'.$transferRes['train'].'",flight="'.$transferRes['flight'].'", restaurant="'.$transferRes['restaurant'].'",ferry="'.$transferRes['ferry'].'",visa="'.$transferRes['visa'].'",passport="'.$transferRes['passport'].'",insurance="'.$transferRes['insurance'].'",other="'.$transferRes['other'].'",packageMarkupType="'.$transferRes['packageMarkupType'].'",hotelMarkupType="'.$transferRes['hotelMarkupType'].'",guideMarkupType="'.$transferRes['guideMarkupType'].'",activityMarkupType="'.$transferRes['activityMarkupType'].'",entranceMarkupType="'.$transferRes['entranceMarkupType'].'",transferMarkupType="'.$transferRes['transferMarkupType'].'",trainMarkupType="'.$transferRes['trainMarkupType'].'",flightMarkupType="'.$transferRes['flightMarkupType'].'",restaurantMarkupType="'.$transferRes['restaurantMarkupType'].'",ferryMarkupType="'.$transferRes['ferryMarkupType'].'",visaMarkupType="'.$transferRes['visaMarkupType'].'",passportMarkupType="'.$transferRes['passportMarkupType'].'",insuranceMarkupType="'.$transferRes['insuranceMarkupType'].'",otherMarkupType="'.$transferRes['otherMarkupType'].'", status="'.$transferRes['status'].'"';
				$markup = addlistinggetlastid('quotationServiceMarkup',$modevalue);
			}
			
			$getPackageRateQuery="";
			$getPackageRateQuery=GetPageRecord('*','packageWiseRateMaster',' quotationId="'.$quotationId.'"');
			if(mysqli_num_rows($getPackageRateQuery) > 0){
			    while($transferRes=mysqli_fetch_array($getPackageRateQuery)){

				$addHotel = '';
				$modevalue = 'queryId="'.$lastQueryId.'",quotationId="'.$lastQuotationId.'",singleCost="'.$transferRes['singleCost'].'",doubleCost="'.$transferRes['doubleCost'].'",tripleCost="'.$transferRes['tripleCost'].'",twinCost="'.$transferRes['twinCost'].'",quadCost="'.$transferRes['quadCost'].'",sixBedCost="'.$transferRes['sixBedCost'].'",eightBedCost="'.$transferRes['eightBedCost'].'",tenBedCost="'.$transferRes['tenBedCost'].'",teenBedCost="'.$transferRes['teenBedCost'].'",extraBedACost="'.$transferRes['extraBedACost'].'",childwithbedCost="'.$transferRes['childwithbedCost'].'",childwithoutbedCost="'.$transferRes['childwithoutbedCost'].'",infantBedCost="'.$transferRes['infantBedCost'].'",guideA="'.$transferRes['guideA'].'",activityA="'.$transferRes['activityA'].'",entranceA="'.$transferRes['entranceA'].'",enrouteA="'.$transferRes['enrouteA'].'",transferA="'.$transferRes['transferA'].'",trainA="'.$transferRes['trainA'].'",flightA="'.$transferRes['flightA'].'",restaurantA="'.$transferRes['restaurantA'].'",otherA="'.$transferRes['otherA'].'",guideC="'.$transferRes['guideC'].'",activityC="'.$transferRes['activityC'].'",entranceC="'.$transferRes['entranceC'].'",enrouteC="'.$transferRes['enrouteC'].'",transferC="'.$transferRes['transferC'].'",trainC="'.$transferRes['trainC'].'",flightC="'.$transferRes['flightC'].'",restaurantC="'.$transferRes['restaurantC'].'",otherC="'.$transferRes['otherC'].'",supplierId="'.$transferRes['supplierId'].'",currencyId="'.$transferRes['currencyId'].'",currencyValue="'.$transferRes['currencyValue'].'",singleBasis="'.$transferRes['singleBasis'].'",doubleBasis="'.$transferRes['doubleBasis'].'",tripleBasis="'.$transferRes['tripleBasis'].'",twinBasis="'.$transferRes['twinBasis'].'",quadBasis="'.$transferRes['quadBasis'].'",sixBedBasis="'.$transferRes['sixBedBasis'].'",eightBedBasis="'.$transferRes['eightBedBasis'].'",tenBedBasis="'.$transferRes['tenBedBasis'].'",teenBedBasis="'.$transferRes['teenBedBasis'].'",extraBedABasis="'.$transferRes['extraBedABasis'].'",childwithbedBasis="'.$transferRes['childwithbedBasis'].'",childwithoutbedBasis="'.$transferRes['childwithoutbedBasis'].'",infantBedBasis="'.$transferRes['infantBedBasis'].'",loopNum="'.$transferRes['loopNum'].'",hotelTypeId="'.$transferRes['hotelTypeId'].'",hotelCategoryId="'.$transferRes['hotelCategoryId'].'",gstTax="'.$transferRes['gstTax'].'",serviceTax="'.$transferRes['serviceTax'].'",serviceType="'.$transferRes['serviceType'].'",serviceName="'.$transferRes['serviceName'].'",markupType="'.$transferRes['markupType'].'",markupValue="'.$transferRes['markupValue'].'",costTypeId="'.$transferRes['costTypeId'].'",adultPax="'.$transferRes['adultPax'].'",adultCost="'.$transferRes['adultCost'].'",ChildCost="'.$transferRes['ChildCost'].'",ChildPax="'.$transferRes['ChildPax'].'",infantCost="'.$transferRes['infantCost'].'",infantPax="'.$transferRes['infantPax'].'",groupCost="'.$transferRes['groupCost'].'",ROE="'.$transferRes['ROE'].'"';
				$addHotel = addlistinggetlastid('packageWiseRateMaster',$modevalue);
				}
			} 
		
			$c12=GetPageRecord('*','quotationAdditionalMaster',' quotationId="'.$quotationId.'" order by id asc');
			if( mysqli_num_rows($c12) > 0){ 
				updatelisting(_QUOTATION_MASTER_,' isAddExp="1"','id="'.$lastQuotationId.'"');
		
				while($quotAdditionalData=mysqli_fetch_array($c12)){ 
					$namevalue ='additionalId="'.$quotAdditionalData['additionalId'].'",adultCost="'.round($quotAdditionalData['adultCost']).'",childCost="'.round($quotAdditionalData['childCost']).'",infantCost="'.round($quotAdditionalData['infantCost']).'",quotationId="'.$lastQuotationId.'",serviceType="'.($quotAdditionalData['serviceType']).'",destinationId="'.($quotAdditionalData['destinationId']).'"';
					addlistinggetlastid('quotationAdditionalMaster',$namevalue);
		
				}
			}
		
			
		} 				
	
	}else{
		//normal
	
		$where='id="'.$lastQuotationId.'"';
		$namevalue ='quotationSubject="'.$quotationSubject.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",adult="'.$adult.'",child="'.$child.'",infant="'.$infant.'",night="'.$night.'",quotationType="'.$quotationType.'",hotCategory="'.$hotCategory.'",guest1="'.$leadPaxName.'",sglRoom="'.$sglRoom.'",dblRoom="'.$dblRoom.'",tplRoom="'.$tplRoom.'",extraNoofBed="'.$extraNoofBed.'",twinRoom="'.$twinRoom.'",quadNoofRoom="'.$noofQuadRoom.'",teenNoofRoom="'.$noofTeenRoom.'",sixNoofBedRoom="'.$noofSixBRoom.'",eightNoofBedRoom="'.$noofEightBRoom.'",tenNoofBedRoom="'.$noofTenBRoom.'",isTourEx="'.$isTourEx.'",extensionType="'.$extensionType.'",childwithoutNoofBed="'.$noofchildwithoutbed.'",quotationId="'.$quotationId.'",deletestatus=0';
		$updatelist = updatelisting(_QUOTATION_MASTER_,$namevalue,$where);
	}
	?>
	<script>
	parent.window.location.href="<?php echo $fullurl; ?>showpage.crm?module=query&view=yes&id=<?php echo encode($lastQueryId); ?>&tourextension=1";
	</script>
	<?php
	exit();
}
// Tour Extension Ends ========================

if($_POST['action']=='mailsendtoclient'){
include "config/mail.php";
$fromemail='';
$mailto = addslashes($_POST['emailid']);
$repotBodymail = ($_POST['repotBodymail']);
$fromDate=date('Y-m-d',strtotime($_POST['fromDate']));
$toDate=date('Y-m-d',strtotime($_POST['toDate']));
$assignto = addslashes($_POST['assignto']);
$select='emailsignature';
$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
$LoginUserDetails=mysqli_fetch_array($rs);
$ccmail = '';
$attfilename = '';
$tablemedille ='';
$subject='USER WISE REPORT '.date('d F Y H:i:a');
$maildescription=$repotBodymail.'<br /><br />'.stripslashes($LoginUserDetails['emailsignature']);
  $thead='<thead>
	<tr style="font-family:normal;text-transform:uppercase;text-align:center;">
		<th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;"><label for="checkAll"><span></span>Name</label></th>
      <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;" ><label for="checkAll"><span></span>Queries</label></th>
      <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Created</th>
      <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Confirmed</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Reverted</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Cancel</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Assigned</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Sent</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Follow&nbsp;Up</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;"> Lost</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Time Limit </th>
     <!-- <th align="center" class="header">TAT&nbsp;followed</th>-->
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;"> Sales</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Gross&nbsp;Margin </th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Total&nbsp;Pax</th>
     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">No(s)&nbsp;Nights </th>
		</tr>
	<thead> ';
$strWhere='';
if($fromDate!='' && $toDate!=''){
	$fromDate = date('Y-m-d', strtotime( $fromDate ));
	$toDate = date('Y-m-d', strtotime( $toDate ));
	 $strWhere.=' and  queryDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" and deletestatus=0';
}
$strWhere25='';
if($assignto!=''){
	$strWhere25 = ' and id="'.$assignto.'"';
}else{
	$strWhere25='';
}
$select='*';
$where='status=1  '.$strWhere25.'  order by firstName asc';
$rs=GetPageRecord($select,_USER_MASTER_,$where);
while($resListing=mysqli_fetch_array($rs)){
$sql1="select id from "._QUERY_MASTER_." where 1 ".$strWhere." and assignTo=".$resListing['id']."";
$res1 = mysqli_query(db(),$sql1);
$tquery1=mysqli_num_rows($res1);
$tqueryTotal=$tqueryTotal+$tquery1;
$sql567="select id from "._QUERY_MASTER_." where 1  ".$strWhere." and queryStatus=10 and assignTo=".$resListing['id']."";
$res567 = mysqli_query(db(),$sql567);
$tquery567=mysqli_num_rows($res567);
$totalcreated=$totalcreated+mysqli_num_rows($res567);
$sql="select id from "._QUERY_MASTER_." where  1 ".$strWhere." and queryStatus=3 and assignTo=".$resListing['id']."";
$res = mysqli_query(db(),$sql);
$tquery=mysqli_num_rows($res);
$confirmedqueryTotl=$tquery+$confirmedqueryTotl;
$sql2="select id from "._QUERY_MASTER_." where  1 ".$strWhere." and queryStatus=2 and assignTo=".$resListing['id']."";
$res2 = mysqli_query(db(),$sql2);
$tquery2=mysqli_num_rows($res2);
$revertedqueryTotal=$revertedqueryTotal+$tquery2;
$sql3="select id from "._QUERY_MASTER_." where 1  ".$strWhere." and queryStatus=20 and deletestatus=0 and assignTo=".$resListing['id']."";
$res3 = mysqli_query(db(),$sql3);
$tquery3=mysqli_num_rows($res3);
$canceltotal=$canceltotal+$tquery3;
$sql4="select id from "._QUERY_MASTER_." where 1  ".$strWhere." and queryStatus=1 and assignTo=".$resListing['id']."";
$res4 = mysqli_query(db(),$sql4);
$tquery4=mysqli_num_rows($res4);
$assignedqueryTotal=$assignedqueryTotal+$tquery4;
$sql5="select id from "._QUERY_MASTER_." where  1 ".$strWhere." and queryStatus=6 and assignTo=".$resListing['id']."";
$res5 = mysqli_query(db(),$sql5);
$tquery5=mysqli_num_rows($res5);
$sentqueryTotal=$tquery5+$sentqueryTotal;
$sql6="select id from "._QUERY_MASTER_." where  1 ".$strWhere." and queryStatus=7 and assignTo=".$resListing['id']."";
$res6 = mysqli_query(db(),$sql6);
$tquery6=mysqli_num_rows($res6);
$followQueryTotal=$followQueryTotal+$tquery6;
 $sql7="select id from "._QUERY_MASTER_." where  1 ".$strWhere." and (queryStatus=4 or queryStatus=20) and assignTo=".$resListing['id']."";
$res7 = mysqli_query(db(),$sql7);
$tquery7=mysqli_num_rows($res7);
$lostqueryTotal=$lostqueryTotal+$tquery7;
$sql8="select id from "._QUERY_MASTER_." where  1 ".$strWhere." and queryStatus=5 and assignTo=".$resListing['id']."";
$res8 = mysqli_query(db(),$sql8);
$tquery8=mysqli_num_rows($res8);
$tlbqueryTotal=$tlbqueryTotal+$tquery8;
$suppliertotalcost_sum=0;
$suppliertotalcost_gross=0;
$salesqueryGrossTotal=0;
$menu=mysqli_query(db(),"select * from "._QUERY_MASTER_."    where  1 ".$strWhere." and queryStatus=3 and assignTo=".$resListing['id']."");
while($res_menu=mysqli_fetch_array($menu)){
$suppliertotalcost_sum = $suppliertotalcost_sum+$res_menu['totalQueryCost'];
$suppliertotalcost_gross = $suppliertotalcost_gross+$res_menu['totalQueryCostwithoutpercent'];
$salesqueryTotal=$salesqueryTotal+$suppliertotalcost_sum;
}
if($suppliertotalcost_sum-$suppliertotalcost_gross<0){  $gross=0; }else {  $gross=$suppliertotalcost_sum-$suppliertotalcost_gross; } $salesqueryGrossTotal=$gross+$salesqueryGrossTotal;
 $result = mysqli_query(db(),"SELECT SUM(adult) AS value_sum from "._QUERY_MASTER_." where  1 ".$strWhere." and queryStatus=3 and assignTo=".$resListing['id']." and assignTo=".$resListing['id']."");
$row = mysqli_fetch_assoc($result);
 $adultsum = $row['value_sum'];
$result2 = mysqli_query(db(),"SELECT SUM(child) AS childsum from "._QUERY_MASTER_." where  1 ".$strWhere." and queryStatus=3 and assignTo=".$resListing['id']." and assignTo=".$resListing['id']."");
$row2 = mysqli_fetch_assoc($result2);
$totalpax=$adultsum+$row2['childsum'];
$totalpaxTotal=$totalpax+$totalpaxTotal;
 $result3 = mysqli_query(db(),"SELECT SUM(night) AS nightsum from "._QUERY_MASTER_." where  1 ".$strWhere." and queryStatus=3 and assignTo=".$resListing['id']."");
$row3 = mysqli_fetch_assoc($result3);
$nonights=$adultsum+$row3['nightsum'];
$nonightsTotal=$nonights+$nonightsTotal;
// print_r($resListing);
	 $tablemedille.='<tr style="text-align:center;">
   <td align="left" valign="middle">'.$resListing['firstName'].'</td>
    <td align="center" valign="middle">'.$tquery1.'</td>
    <td align="center" valign="middle">'.$tquery567.'</td>
    <td align="center">'.$tquery.'</td>
    <td align="center">'.$tquery2.'</td>
    <td align="center">'.$tquery3.'</td>
	 <td align="center"> '.$tquery4.'</td>
    <td align="center"> '.$tquery5.'</td>
    <td align="center">'.$tquery6.'</td>
    <td align="center">'.$tquery7.'</td>
    <td align="center">'.$tquery8.'</td>
    <td align="right">'.$suppliertotalcost_sum.'</td>
    <td align="right" >'. $gross.'</td>
    <td align="right" >'.$totalpax.'</td>
    <td align="right" >'.$nonights.'</td>
    </tr>';
    $totalsum='<tr style="font-size: 13px; background-color:#f1f1f1; font-weight:bold;">
    <td align="left" valign="middle"><strong>Total</strong></td>
    <td align="center" valign="middle">'.$tqueryTotal.'</td>
    <td align="center" valign="middle">'.$totalcreated.'</td>
    <td align="center">'.$confirmedqueryTotl.'</td>
    <td align="center">'.$revertedqueryTotal.'</td>
    <td align="center">'.$canceltotal.'</td>
    <td align="center">'.$assignedqueryTotal.'</td>
    <td align="center">'.$sentqueryTotal.'</td> <style>/* and id in (select queryId from "._VOUCHER_MASTER_." where emailsent=1)*/</style>
    <td align="center">'.$followQueryTotal.'</td>
    <td align="center">'.$lostqueryTotal.'</td>
    <td align="center">'.$tlbqueryTotal.'</td>
    <!--   <td align="center"></td>-->
    <td align="right">'.$salesqueryTotal.'</td>
    <td align="right" >'.$salesqueryGrossTotal.'</td>
    <td align="right" >'.$totalpaxTotal.'</td>
    <td align="right" >'.$nonightsTotal.'</td>
    </tr>';
	}
	$mailbody='<table border="1" cellpadding="4" cellspacing="0" bordercolor="#E6E6E6" class="table tablesorter gridtable sortable" id="example">'.$thead.''.$tablemedille.''.$totalsum.'</table>';
	$exeMailresult=send_template_mail($fromemail,$mailto,$subject,$mailbody);
	if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alertspopupopenClose();</script>
		<?php
		exit();
	}
}
 
// edit restaurant rate
if($_REQUEST['action']=="editRestaurantRate" && $_POST['DmcrestaurantRateId']!=''){
$DmcrestaurantRateId = $_POST['DmcrestaurantRateId'];
$mealPlanTypeId = $_POST['mealPlanType'];
$currencyId = $_POST['currencyId'];
$adultCostRest = $_POST['adultCostRest2'];
$childCostRest = $_POST['childCostRest2'];
$RestaurantGST = $_POST['RestaurantGST'];
$markupType = $_POST['markupType2'];
$markupCost = $_POST['markupCost2'];

$nameValue = 'mealPlanType="'.$mealPlanTypeId.'", currencyId="'.$currencyId.'", adultCost="'.$adultCostRest.'",childCost="'.$childCostRest.'",RestaurantGST="'.$RestaurantGST.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'"';
$where = 'id="'.$DmcrestaurantRateId.'"';

updatelisting('dmcRestaurantsMealPlanRate',$nameValue,$where);
$msgbox = 2;
?>
<script>
	parent.funloadinboundmealplanmaster();
	parent.alertspopupopenClose()
</script>
<?php
}

// dmc entrance manual
if(trim($_POST['action'])=='addEntrancePrice' && trim($_POST['entranceNameId'])!='' && trim($_POST['currencyId'])!=''){

	// if sic type
	$rs1=GetPageRecord('id',_DMC_ENTRANCE_RATE_MASTER_,' serviceid="'.$_REQUEST['entranceNameId'].'" and ( fromDate BETWEEN "'.date("Y-m-d", strtotime($_POST['fromDate'])).'" and "'.date("Y-m-d", strtotime($_POST['toDate'])).'" OR "'.date("Y-m-d", strtotime($_POST['fromDate'])).'" BETWEEN fromDate and toDate ) and marketType="'.$_REQUEST['marketType'].'" and supplierId="'.clean($_REQUEST['supplierId']).'" and currencyId="'.$_POST['currencyId'].'" and tarifType="'.$_POST['tarifType'].'"  and transferType="'.$_POST['transferType'].'" and nationalityType="'.$_POST['nationalityType'].'" order by ticketAdultCost asc');


	// if private type
	$rs2=GetPageRecord('id',_DMC_ENTRANCE_RATE_MASTER_,' serviceid="'.$_REQUEST['entranceNameId'].'" and ( fromDate BETWEEN "'.date("Y-m-d", strtotime($_POST['fromDate'])).'" and "'.date("Y-m-d", strtotime($_POST['toDate'])).'" OR "'.date("Y-m-d", strtotime($_POST['fromDate'])).'" BETWEEN fromDate and toDate ) and marketType="'.$_REQUEST['marketType'].'" and supplierId="'.clean($_REQUEST['supplierId']).'" and currencyId="'.$_POST['currencyId'].'" and tarifType="'.$_POST['tarifType'].'"  and transferType="'.$_POST['transferType'].'" and nationalityType="'.$_POST['nationalityType'].'" and vehicleId="'.$_POST['vehicleId'].'" order by ticketAdultCost asc');
	if((mysqli_num_rows($rs2)>0 && $_POST['transferType']==2) || ( mysqli_num_rows($rs1)>0 && $_POST['transferType']==1) ){
		?>
		<script>
		alert('Entrance rate already exist...!');
		</script>
		<?php
		exit();
	}else{
		$roomSupplierId=clean($_REQUEST['supplierId']);
		$nationalityType=clean($_REQUEST['nationalityType']);
		$marketType=clean($_REQUEST['marketType']);
		$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
		$toDate=date("Y-m-d", strtotime($_POST['toDate']));
		$entranceNameId=addslashes($_POST['entranceNameId']);
		$gstTax=addslashes($_POST['gstTax']);
		
		$tarifType=addslashes($_POST['tarifType']);
		$transferType=addslashes($_POST['transferType']);
		// SIC
		$adultCost=addslashes($_POST['adultCost']);
		$childCost=addslashes($_POST['childCost']);
		$infantCost=addslashes($_POST['infantCost']);

		// PVT
		$vehicleId=addslashes($_POST['vehicleId']);
		$vehicleCost=addslashes($_POST['vehicleCost']);
		
		$repCost=addslashes($_POST['repCost']);
		$markupType=addslashes($_POST['markupType']);
		$markupCost=addslashes($_POST['markupCost']);

		$ticketAdultCost=addslashes($_POST['ticketAdultCost']);
		$ticketchildCost=addslashes($_POST['ticketchildCost']);
		$ticketinfantCost=addslashes($_POST['ticketinfantCost']);
		$serviceid=addslashes($_POST['status']);
		$status=addslashes($_POST['status']);
		$currencyId=addslashes($_POST['currencyId']);
		$policy=addslashes($_POST['policy']);
		$termAndCondition=addslashes($_POST['termAndCondition']);
		$detail=addslashes($_POST['detail']);
		$dateAdded=time();
		$namevalue ='supplierId="'.$roomSupplierId.'",fromDate="'.$fromDate.'",policy="'.$policy.'",termAndCondition="'.$termAndCondition.'",detail="'.$detail.'",toDate="'.$toDate.'",entranceNameId="'.$entranceNameId.'",gstTax="'.$gstTax.'",tarifType="'.$tarifType.'",transferType="'.$transferType.'",vehicleId="'.$vehicleId.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",nationalityType="'.$nationalityType.'",marketType="'.$marketType.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",serviceid="'.$serviceid.'"';
		$lastid = addlistinggetlastid(_DMC_ENTRANCE_RATE_MASTER_,$namevalue);
		$msgbox = 1;
		?>
		<script>
		parent.funloadentrancemaster('<?php echo $roomSupplierId; ?>','<?php echo $currencyId; ?>');
		parent.setupbox('showpage.crm?module=entrancemaster&view=yes&entranceId=<?php echo encode($entranceNameId); ?>&alt=<?php echo $msgbox; ?>');
		</script>
		<?php
		exit();
	}
}

if(trim($_POST['action'])=='updatedmcEntranceRate' && trim($_POST['currencyId2'])!='' && trim($_POST['DmcEntranceRateId2'])!=''){

	$DmcEntranceRateId=clean($_REQUEST['DmcEntranceRateId2']);
	$entranceNameId=addslashes($_POST['entranceNameId2']);
	$status=addslashes($_POST['status2']);
	$currencyId=addslashes($_POST['currencyId2']);
	
	$gstTax=addslashes($_POST['gstTax2']);
	$tarifType=addslashes($_POST['tarifType2']);
	$transferType=addslashes($_POST['transferType2']);
	$markupCost=addslashes($_POST['markupCost2']);
	$markupType=addslashes($_POST['markupType2']);

	if($transferType == 1){
		// SIC
		$adultCost=addslashes($_POST['adultCost2']);
		$childCost=addslashes($_POST['childCost2']);
		$infantCost=addslashes($_POST['infantCost2']);

		$vehicleId=$vehicleCost=0;
	}else{
		// PVT
		$vehicleId=addslashes($_POST['vehicleId2']);
		$vehicleCost=addslashes($_POST['vehicleCost2']);
		
		$adultCost=$childCost=$infantCost=0;
	}

	$repCost=addslashes($_POST['repCost2']);

	$ticketAdultCost=addslashes($_POST['ticketAdultCost2']);
	$ticketchildCost=addslashes($_POST['ticketchildCost2']);
	$ticketinfantCost=addslashes($_POST['ticketinfantCost2']);

	$fromDate=clean($_POST['fromDate2']);
    $toDate=clean($_POST['toDate2']);
    $marketTypeId=clean($_REQUEST['marketType2']);
    $nationalityType=clean($_REQUEST['nationalityType2']);
    $supplierId=clean($_REQUEST['supplierId2']);
    $policy=clean($_REQUEST['policy2']);
    $termAndCondition=clean($_REQUEST['termAndCondition2']);
    $detail=clean($_REQUEST['detail2']);
	$dateAdded=time();
	$rs1=GetPageRecord('id',_DMC_ENTRANCE_RATE_MASTER_,' serviceid="'.$entranceNameId.'" and ( fromDate BETWEEN "'.date("Y-m-d", strtotime($fromDate)).'" and "'.date("Y-m-d", strtotime($toDate)).'" OR "'.date("Y-m-d", strtotime($fromDate)).'" BETWEEN fromDate and toDate ) and marketType="'.$marketTypeId.'"  and nationalityType="'.$nationalityType.'" and tarifType="'.$tarifType.'" and supplierId="'.$supplierId.'" and currencyId="'.$currencyId.'" and id!="'.$DmcEntranceRateId.'"');
	if(mysqli_num_rows($rs1)>0){ ?>
		<script>
		parent.alert('Entrance Rate already exist...!');
		</script>
		<?php
		exit();
	}else{
		$namevalue ='status="'.$status.'",fromDate="'.date('Y-m-d',strtotime($fromDate)).'",toDate="'.date('Y-m-d',strtotime($toDate)).'",policy="'.$policy.'",termAndCondition="'.$termAndCondition.'",detail="'.$detail.'",supplierId="'.$supplierId.'",marketType="'.$marketTypeId.'" ,nationalityType="'.$nationalityType.'" ,gstTax="'.$gstTax.'",currencyId="'.$currencyId.'",tarifType="'.$tarifType.'",transferType="'.$transferType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleId="'.$vehicleId.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",markupCost="'.$markupCost.'",markupType="'.$markupType.'"';
	 	$where='id="'.$DmcEntranceRateId.'"';
		$update = updatelisting(_DMC_ENTRANCE_RATE_MASTER_,$namevalue,$where);
		?>
		<script>
			parent.funloadentrancemaster();
			parent.$('#alertnotificationsmainbox').hide();
			parent.alertspopupopenClose();
		</script>
		<?php
		exit();
	}
}

// dmc transfer manual transferCostType
if(trim($_POST['action'])=='addTransferPrice' && trim($_POST['TransferSupplierId'])!='' && trim($_POST['fromDate'])!='' && trim($_POST['toDate'])!='' && trim($_POST['transferNameId'])!='' && trim($_POST['transferType'])!='' && trim($_POST['currencyId'])!=''){
	$TransferSupplierId=clean($_REQUEST['TransferSupplierId']);
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
	$toDate=date("Y-m-d", strtotime($_POST['toDate']));
	$transferNameId=addslashes($_POST['transferNameId']);

	$tarifType=addslashes($_POST['tarifType']);
	$transferType=addslashes($_POST['transferType']);
	// SIC
	$adultCost=addslashes($_POST['adultCost']);
	$childCost=addslashes($_POST['childCost']);
	$infantCost=addslashes($_POST['infantCost']);

	// PVT
	$transferCostType=addslashes($_POST['transferCostType']);
	$vehicleCost=addslashes($_POST['vehicleCost']);
	$distance=addslashes($_POST['distance']);

	$detail=addslashes($_POST['detail']);
	$serviceid=addslashes($_POST['serviceid']);
	$status=addslashes($_POST['status']);
	$currencyId=addslashes($_POST['currencyId']);
	$vehicleType=addslashes($_POST['vehicleType']);
	$vehicleModelId=addslashes($_POST['vehicleModelId']);

	$markupType=clean($_REQUEST['markupType']);
	$markupCost=clean($_REQUEST['markupCost']);
	$gstTax=clean($_REQUEST['gstTax']);
	$marketType=clean($_REQUEST['marketType']);
	if($_REQUEST['rateDestinationId'] == 'all_dest'){
		$rateDestinationId=0;
	}else{
		$rateDestinationId=addslashes($_REQUEST['rateDestinationId']);
	}
	$dateAdded=time();

	$namevalue ='supplierId="'.$TransferSupplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferNameId="'.$transferNameId.'",tarifType="'.$tarifType.'",transferType="'.$transferType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleTypeId="'.$vehicleType.'",vehicleCost="'.$vehicleCost.'",distance="'.$distance.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",detail="'.$detail.'",serviceid="'.$serviceid.'",vehicleModelId="'.$vehicleModelId.'",parkingFee="'.$_POST['parkingFee'].'",representativeEntryFee="'.$_POST['representativeEntryFee'].'",assistance="'.$_POST['assistance'].'",guideAllowance="'.$_POST['guideAllowance'].'",interStateAndToll="'.$_POST['interStateAndToll'].'",miscellaneous="'.$_POST['miscellaneous'].'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",gstTax="'.$gstTax.'",transferCostType="'.$transferCostType.'",marketType="'.$marketType.'",rateDestinationId="'.$rateDestinationId.'"';
	$lastid = addlistinggetlastid(_DMC_TRANSFER_RATE_MASTER_,$namevalue);
	$msgbox = 1;
 	?>
	<script>
	parent.$('#addnewuserbtn').show();
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.funloadtransportormasteraddrate('<?php echo $_POST['fromDate']; ?>','<?php echo $_POST['toDate']; ?>','<?php echo $currencyId; ?>','<?php echo $transferType; ?>');
	// ?module=packagetransfermaster&supplier=1&transferid=VG5wSlBRPT0=&view=yes
	parent.setupbox('showpage.crm?module=<?php echo $_REQUEST['module']; ?>&supplier=1&transferid=<?php echo encode($transferNameId); ?>&view=yes&alt=<?php echo $msgbox; ?>');
	</script>
	<?php
	exit();
}


if(trim($_POST['action'])=='updatedmctransferRate'  && trim($_POST['currencyId2'])!='' && trim($_POST['dmctransferrateId2'])!=''){
	$dmctransferrateId=clean($_REQUEST['dmctransferrateId2']);

	$supplierId=clean($_REQUEST['supplierId2']);
	$marketType=clean($_REQUEST['marketType2']);

	$fromDate=date("Y-m-d", strtotime($_POST['fromDate2']));
	$toDate=date("Y-m-d", strtotime($_POST['toDate2']));
	$vehicleType=addslashes($_POST['vehicleType2']);
	$vehicleModelId=addslashes($_POST['vehicleModelId2']);

	$tarifType=addslashes($_POST['tarifType2']);
	$transferType=addslashes($_POST['transferType2']);
	// SIC
	$adultCost=addslashes($_POST['adultCost2']);
	$childCost=addslashes($_POST['childCost2']);
	$infantCost=addslashes($_POST['infantCost2']);

	// PVT
	$transferCostType=clean($_REQUEST['transferCostType2']);
	$vehicleCost=addslashes($_POST['vehicleCost2']);
	$distance=addslashes($_POST['distance2']);

	$status=addslashes($_POST['status2']);
	$currencyId=addslashes($_POST['currencyId2']);
	$detail=addslashes($_POST['detail2']);

	$markupType=clean($_REQUEST['markupType2']);
	$markupCost=clean($_REQUEST['markupCost2']);
	$rateDestinationId=clean($_REQUEST['rateDestinationId2']);

	$dateAdded=time();

	$rs1=GetPageRecord('id',_DMC_TRANSFER_RATE_MASTER_,' transferNameId="'.$transferNameId2.'" and ( fromDate BETWEEN "'.date("Y-m-d", strtotime($fromDate)).'" and "'.date("Y-m-d", strtotime($toDate)).'" OR "'.date("Y-m-d", strtotime($fromDate)).'" BETWEEN fromDate and toDate ) and marketType="'.$marketType.'" and tarifType="'.$tarifType.'"  and transferType="'.$transferType.'" and supplierId="'.$supplierId.'" and currencyId="'.$currencyId.'" and id!="'.$dmctransferrateId.'"');
	if(mysqli_num_rows($rs1)>0){
		?>
		<script>
		alert('Transfer rate already exist...!');
		</script>
		<?php
	}else{
		$namevalue ='supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",vehicleTypeId="'.$vehicleType.'",vehicleCost="'.$vehicleCost.'",distance="'.$distance.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",transferType="'.$transferType.'",tarifType="'.$tarifType.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",detail="'.$detail.'",parkingFee="'.$_POST['parkingFee2'].'",representativeEntryFee="'.$_POST['representativeEntryFee2'].'",assistance="'.$_POST['assistance2'].'",guideAllowance="'.$_POST['guideAllowance2'].'",interStateAndToll="'.$_POST['interStateAndToll2'].'",miscellaneous="'.$_POST['miscellaneous2'].'",gstTax="'.$_POST['gstTax2'].'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",vehicleModelId="'.$vehicleModelId.'",marketType="'.$marketType.'",transferCostType="'.$transferCostType.'",rateDestinationId="'.$rateDestinationId.'"';
 		$where='id="'.$dmctransferrateId.'"';
		$update = updatelisting(_DMC_TRANSFER_RATE_MASTER_,$namevalue,$where);
		?>
		<script>
			parent.funloadtransportormasteraddrate();
			parent.$('#alertnotificationsmainbox').hide();
			parent.alertspopupopenClose();
		</script>
		<?php
	}
	exit();
}
 

// Add Ferry Price ================
if(trim($_POST['action'])=='addFerryPrice' && trim($_POST['ferryNameId'])!='' && trim($_POST['currencyId'])!=''){
 

	// $rs1=GetPageRecord('id','ferryRate',' ferryNameId="'.$_REQUEST['ferryNameId'].'" and ( fromDate BETWEEN "'.date("Y-m-d", strtotime($_POST['fromDate'])).'" and "'.date("Y-m-d", strtotime($_POST['toDate'])).'" OR "'.date("Y-m-d", strtotime($_POST['fromDate'])).'" BETWEEN fromDate and toDate ) and marketType="'.$_REQUEST['marketType'].'" and supplierId="'.clean($_REQUEST['supplierId']).'" and currencyId="'.$_POST['currencyId'].'" order by adultCost asc');
	// if(mysqli_num_rows($rs1)>0){
	// 	?>
	// 	<script>
	// 	alert('Ferry rate already exist...!');
	// 	parent.$('#pageloading').hide();
	// 	parent.$('#pageloader').hide();
	// 	 </script>
	// 	<?php
	// 	exit();
	// }else{
		$serviceID1=clean($_REQUEST['serviceid']);
		$ferrySupplierId=clean($_REQUEST['supplierId']);
		$marketType=clean($_REQUEST['marketType']);
		$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
		$toDate=date("Y-m-d", strtotime($_POST['toDate']));
		$ferryNameid=addslashes($_POST['ferryNameId']);
		$ferrySeat=addslashes($_POST['ferrySeat']);
		$adultCost=addslashes($_POST['ticketAdultCost']);
		$childCost=addslashes($_POST['ticketchildCost']);
		$infantCost=addslashes($_POST['ticketinfantCost']);
		$status=addslashes($_POST['status']);
		$currencyId=addslashes($_POST['currencyId']);
		$gstTax=addslashes($_POST['gstTax']);
		$misslaniouscost=addslashes($_POST['misslaniouscost']);
		$processingfee=addslashes($_POST['processingfee']);
		$termAndCondition=addslashes($_POST['termAndCondition']);
		$remarks=addslashes($_POST['remarks']);
		$markupType=addslashes($_POST['markupType']);
		$markupCost=addslashes($_POST['markupCost']);
		$dateAdded=time();
		$namevalue ='supplierId="'.$ferrySupplierId.'",serviceid="'.$serviceID1.'",fromDate="'.$fromDate.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remark="'.$remarks.'",toDate="'.$toDate.'",ferryNameId="'.$ferryNameid.'",marketType="'.$marketType.'",ferryClass="'.$ferrySeat.'",status="'.$status.'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",miscCost="'.$misslaniouscost.'",processingfee="'.$processingfee.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",deletestatus="'.$deletestatus.'"';
		$lastid = addlistinggetlastid('ferryRate',$namevalue);
		$msgbox = 1;
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.funloadFerrymaster('<?php echo $ferrySupplierId; ?>','<?php echo $currencyId; ?>');
		parent.setupbox('showpage.crm?module=ferryPricemaster&view=yes&ferryTransferId=<?php echo encode($serviceID1); ?>&alt=<?php echo $msgbox; ?>');
		</script>
		<?php
		exit();
	}
// }

// Update Ferry Price 
if(trim($_POST['action'])=='updateFerryRate' && trim($_POST['serviceId2'])!='' && trim($_POST['FerryRateId'])!=''){

	$FerryRateId=clean($_REQUEST['FerryRateId']);
	$serviceId2=clean($_REQUEST['serviceId2']);
	$ferryNameId2=addslashes($_POST['ferryNameId2']);
	$ferrySeat2=addslashes($_POST['ferrySeat2']);
	$gstSlab2=addslashes($_POST['gstSlab2']);
	$status2=addslashes($_POST['status2']);
	$currencyId2=addslashes($_POST['currencyId2']);
	$adultCost=addslashes($_POST['ticketAdultCost']);
	$childCost=addslashes($_POST['ticketchildCost']);
	$infantCost=addslashes($_POST['ticketinfantCost']);
	$Processingfe2=addslashes($_POST['Processingfe2']);
	$miscost2=addslashes($_POST['miscost2']);
	$fromDate=clean($_POST['fromDatevalidity']);
    $toDate=clean($_POST['toDatevalidity']);
    $marketTypeId2=clean($_REQUEST['marketTypeId2']);
    $FerrySupplierId2=clean($_REQUEST['FerrySupplierId2']);
    $remarks=clean($_REQUEST['remarks']);

    $markupType=addslashes($_POST['markupType2']);
		$markupCost=addslashes($_POST['markupCost2']);
	$dateAdded=time();

	// $rs1=GetPageRecord('id',ferryRate,' entranceNameId="'.$entranceNameId2.'" and ( fromDate BETWEEN "'.date("Y-m-d", strtotime($fromDate)).'" and "'.date("Y-m-d", strtotime($toDate)).'" OR "'.date("Y-m-d", strtotime($fromDate)).'" BETWEEN fromDate and toDate ) and marketType="'.$marketTypeId2.'"  and nationalityType="'.$nationalityType2.'" and supplierId="'.$activitySupplierId.'" and currencyId="'.$currencyId.'" and id!="'.$DmcEntranceRateId.'"');
	// if(mysqli_num_rows($rs1)>0){
	// 	?>
	// 	<script>
	// 	alert('Entrance rate already exist...!');
	// 	parent.$('#pageloading').hide();
	// 	parent.$('#pageloader').hide();
	// 	 </script>
	// 	<?php
	// 	exit();
	// }else{
		$namevalue2 ='supplierId="'.$FerrySupplierId2.'",serviceid="'.$serviceId2.'",fromDate="'.$fromDate.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remark="'.$remarks.'",toDate="'.$toDate.'",ferryNameId="'.$ferryNameId2.'",marketType="'.$marketTypeId2.'",ferryClass="'.$ferrySeat2.'",status="'.$status2.'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId2.'",gstTax="'.$gstSlab2.'",miscCost="'.$miscost2.'",processingfee="'.$Processingfe2.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",deletestatus="'.$deletestatus.'"';
	 	$where='id="'.$FerryRateId.'"';
		$update = updatelisting('ferryRate',$namevalue2,$where);
		?>
		<script>
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
			parent.funloadFerrymaster();
			parent.$('#alertnotificationsmainbox').hide();
			parent.alertspopupopenClose();
		</script>
		<?php
		exit();
	}
// delete ferry cost 
if($_REQUEST['action']=='deleteFerrycost' && $_REQUEST['id']!=''){
	$Id = $_REQUEST['id'];
	$deletsqli = "DELETE FROM `ferryRate` WHERE id= $Id ";
	$querysqli = mysqli_query(db(),$deletsqli);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.funloadFerrymaster();
	// parent.deleteFerrycost();
	</script>
	<?php
}

// ========================== Add Cruise Rate ===================================

if(trim($_POST['action'])=='addCruisePriceFromMaster' && trim($_POST['cruiseNameId'])!='' && trim($_POST['currencyId'])!=''){

	$serviceID=decode($_REQUEST['serviceId']);

	$cruiseSupplierId=clean($_REQUEST['supplierId']);

	$marketType=clean($_REQUEST['marketType']);

	$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));

	$toDate=date("Y-m-d", strtotime($_POST['toDate']));

	$cruiseNameId=addslashes($_POST['cruiseNameId']);

	$cabinType=addslashes($_POST['cabinType']);

	$tariffType=addslashes($_POST['tariffType']);

	$adultCost=addslashes($_POST['ticketAdultCost']);

	$childCost=addslashes($_POST['ticketchildCost']);

	$infantCost=addslashes($_POST['ticketinfantCost']);

	$status=addslashes($_POST['status']);

	$currencyId=addslashes($_POST['currencyId']);

	$gstTax=addslashes($_POST['gstTax']);

	$markupCost=addslashes($_POST['markupCost']);

	$markupType=addslashes($_POST['markupType']);

	$remarks=addslashes($_POST['remarks']);
	$cruiseDuration=addslashes($_POST['cruiseDuration']);
	$currencyId = ($currencyId>0) ? $currencyId : $baseCurrencyId;
	$currencyValue = getCurrencyVal($currencyId);
	$dateAdded=date();

	$namevalue ='supplierId="'.$cruiseSupplierId.'",serviceId="'.$serviceID.'",tariffTypeId="'.$tariffType.'",fromDate="'.$fromDate.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remark="'.$remarks.'",toDate="'.$toDate.'",cruiseNameId="'.$cruiseNameId.'",marketType="'.$marketType.'",currencyValue="'.$currencyValue.'",cabinTypeId="'.$cabinType.'",status="'.$status.'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",duration="'.$cruiseDuration.'"';

	$lastid = addlistinggetlastid('cruiseRateMaster',$namevalue);

	$msgbox = 1;

	?>

	<script>

	parent.$('#pageloading').hide();

	parent.$('#pageloader').hide();

	parent.funloadCruisemaster('<?php echo $serviceID; ?>','<?php echo $currencyId; ?>'); 

	</script>

	<?php

	exit();

}





if(trim($_POST['action'])=='updateCruiseMasterRate' && trim($_POST['cruiseNameId2'])!='' && trim($_POST['serviceId2'])!=''){



	$serviceId=$_REQUEST['serviceId2'];

	$cruiseSupplierId=clean($_REQUEST['cruiseSupplierId2']);

	$marketType=clean($_REQUEST['marketTypeId2']);

	$fromDate=date("Y-m-d", strtotime($_POST['fromDatevalidity']));

	$toDate=date("Y-m-d", strtotime($_POST['toDatevalidity']));

	$cruiseNameId=addslashes($_POST['cruiseNameId2']);

	$cabinType=addslashes($_POST['cabinType2']);

	$tariffType=addslashes($_POST['tariffType2']);

	$adultCost=addslashes($_POST['ticketAdultCost2']);

	$childCost=addslashes($_POST['ticketchildCost2']);

	$infantCost=addslashes($_POST['ticketinfantCost2']);

	$status=addslashes($_POST['status2']);

	$currencyId=addslashes($_POST['currencyId2']);

	$gstTax=addslashes($_POST['gstSlab2']);

	$markupCost=addslashes($_POST['markupCost2']);

	$markupType=addslashes($_POST['markupType2']);

	$remarks=addslashes($_POST['remarks2']);

	$cruiseRateId=addslashes($_POST['cruiseRateId']);

	$cruiseDuration=addslashes($_POST['cruiseDuration2']);

	$dateAdded=time();

	$namevalue ='supplierId="'.$cruiseSupplierId.'",tariffTypeId="'.$tariffType.'",fromDate="'.$fromDate.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remark="'.$remarks.'",toDate="'.$toDate.'",cruiseNameId="'.$cruiseNameId.'",marketType="'.$marketType.'",cabinTypeId="'.$cabinType.'",status="'.$status.'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",duration="'.$cruiseDuration.'"';

	 

	$where = 'id="'.$_POST['cruiseRateId'].'" and serviceId="'.$serviceId.'"';

	$lastid = updatelisting('cruiseRateMaster',$namevalue,$where);

	$msgbox = 1;

	?>

	<script>

	parent.$('#pageloading').hide();

	parent.$('#pageloader').hide();

	parent.funloadCruisemaster('<?php echo $serviceID; ?>','<?php echo $currencyId; ?>');

	parent.setupbox('showpage.crm?module=cruisemaster&view=yes&cruiseMasterKey=<?php echo encode($serviceId); ?>&alt=<?php echo $msgbox; ?>');

	</script>
	<?php
	exit();
}

if(trim($_REQUEST['action'])=='addCruisePriceforQuotaion' && trim($_REQUEST['cr_cruiseNameId2'])!='' && trim($_REQUEST['cr_currencyId2'])!='' && $_REQUEST['cr_cruiseServiceId2']!=''){



	$serviceID=$_REQUEST['cr_cruiseServiceId2'];

	$cruiseSupplierId=clean($_REQUEST['cr_supplierId2']);

	$marketType=clean($_REQUEST['cr_marketType2']);

	$fromDate=date("Y-m-d", strtotime($_REQUEST['cr_fromDatevalidity2']));

	$toDate=date("Y-m-d", strtotime($_REQUEST['cr_toDatevalidity2']));

	$cruiseNameId=addslashes($_REQUEST['cr_cruiseNameId2']);

	$cabinType=addslashes($_REQUEST['cr_cabinType2']);

	$tariffType=addslashes($_REQUEST['cr_tariffType2']);
	$adultCost = clean($_REQUEST['cr_adultCost2']);

	$adultPax = clean($_REQUEST['cr_adultPax2']);
	$childCost = clean($_REQUEST['cr_childCost2']);

	$childPax = clean($_REQUEST['cr_childPax2']);
	$gstTax=addslashes($_REQUEST['cr_gstTax2']);
	$infantCost = clean($_REQUEST['cr_infantCost2']);

	$infantPax = clean($_REQUEST['cr_infantPax2']);
	$cruiseDuration=addslashes($_REQUEST['cruiseDuration']);
	$currencyId=addslashes($_REQUEST['cr_currencyId2']);

	$currencyValue=addslashes($_REQUEST['cr_currencyValue2']);
	$markupCost=addslashes($_REQUEST['cr_markupCost2']);

	$markupType=addslashes($_REQUEST['cr_markupType2']);

	$remarks=addslashes($_REQUEST['cr_remark2']);
	$quotationId=addslashes($_REQUEST['cr_quotationId2']);

	$queryId=addslashes($_REQUEST['cr_queryId2']);

	$destinationId=addslashes($_REQUEST['cr_destinationId2']);

	$dayId=addslashes($_REQUEST['cr_dayId2']);

	// $masterRateId=addslashes($_REQUEST['cr_masterRateId2']);

	// $quotationRateId=addslashes($_REQUEST['cr_quotationRateId2']);

	$rateId=addslashes($_REQUEST['cr_rateid2']);

	$tableN=addslashes($_REQUEST['cr_tableN2']);
	$currencyId = ($currencyId>0) ? $currencyId : $baseCurrencyId;

	$dateAdded=date('Y-m-d');
	if($tableN==2 && $rateId>0){

		$namevalue ='supplierId="'.$cruiseSupplierId.'",serviceId="'.$serviceID.'",quotationId="'.$quotationId.'",dayId="'.$dayId.'",queryId="'.$queryId.'",destinationId="'.$destinationId.'",tariffTypeId="'.$tariffType.'",fromDate="'.$fromDate.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remark="'.$remarks.'",toDate="'.$toDate.'",cruiseNameId="'.$cruiseNameId.'",marketType="'.$marketType.'",currencyValue="'.$currencyValue.'",cabinTypeId="'.$cabinType.'",status="'.$status.'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';

		$where = 'id="'.$rateId.'"';

		$lastid = updatelisting(_QUOTATION_CRUISE_RATE_MASTER_,$namevalue,$where);

		$msgbox = 1;

	}else{ 

		$namevalue ='supplierId="'.$cruiseSupplierId.'",serviceId="'.$serviceID.'",quotationId="'.$quotationId.'",dayId="'.$dayId.'",rateId="'.$rateId.'",queryId="'.$queryId.'",destinationId="'.$destinationId.'",tariffTypeId="'.$tariffType.'",fromDate="'.$fromDate.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remark="'.$remarks.'",toDate="'.$toDate.'",cruiseNameId="'.$cruiseNameId.'",marketType="'.$marketType.'",currencyValue="'.$currencyValue.'",cabinTypeId="'.$cabinType.'",status="'.$status.'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",adultPax="'.$adultPax.'",childPax="'.$childPax.'",infantPax="'.$infantPax.'"';

		$lastid = addlistinggetlastid(_QUOTATION_CRUISE_RATE_MASTER_,$namevalue);

		$msgbox = 1;

	}

	?>

	<script>

	parent.$('#pageloading').hide();

	parent.$('#pageloader').hide();

	parent.loadsearchcruisefunction('<?php echo $serviceID; ?>','<?php echo $currencyId; ?>'); 

	</script>

	<?php

	exit();

}

//hotel add adddmc dmcroom
if(trim($_POST['action'])=='addHotelroomtariff' && trim($_POST['roomSupplierId'])!='' && trim($_POST['roomType'])!='' && trim($_POST['mealPlan'])!='' ){
	$teenRoom=clean($_POST['teenRoom']);
	$quadRoom=clean($_POST['quadRoom']);
	$sixBedRoom=clean($_POST['sixBedRoom']);
	$eightBedRoom=clean($_POST['eightBedRoom']);
	$tenBedRoom=clean($_POST['tenBedRoom']);
	$breakfastChild=clean($_POST['breakfastChild']);
	$lunchChild=clean($_POST['lunchChild']);
	$dinnerChild=clean($_POST['dinnerChild']);
	$roomSupplierId=clean($_REQUEST['roomSupplierId']);
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
	$toDate=date("Y-m-d", strtotime($_POST['toDate']));
	$roomType=addslashes($_POST['roomType']);
	$paxType=addslashes($_POST['paxType']);
	$mealPlan=addslashes($_POST['mealPlan']);
	$roomprice=addslashes($_POST['roomprice']);
	$status=addslashes($_POST['status']);
	$currencyId=addslashes($_POST['currencyId']);
	$singleoccupancy=addslashes($_POST['singleoccupancy']);
	$doubleoccupancy=addslashes($_POST['doubleoccupancy']);
	$tripleoccupancy=addslashes($_POST['tripleoccupancy']);
	$extraBed=addslashes($_POST['extraBed']);
	$childwithbed=addslashes($_POST['childwithbed']);
	$childwithoutbed=addslashes($_POST['childwithoutbed']);
	$breakfast=addslashes($_POST['breakfast']);
	$roomTAC=addslashes($_POST['roomTAC']);
	$TACType=addslashes($_POST['TACType']);
	$roomGST=addslashes($_POST['roomGST']);
	$mealGST=addslashes($_POST['mealGST']);
	$remarks=addslashes($_POST['remarks']);
	$lunch=addslashes($_POST['lunch']);
	// paxType
	$dinner=addslashes($_POST['dinner']);
	$serviceid=addslashes($_POST['serviceid']);
	$tarifType=addslashes($_POST['tarifType']);
	$seasonType=clean($_REQUEST['seasonType']);

	$seasonYear=clean($_REQUEST['seasonYear']);
	$marketType=clean($_REQUEST['marketType']);
	$markupType=clean($_REQUEST['markupType']);
	$markupCost=clean($_REQUEST['markupCost']);
 	$dateAdded=time(); 
	if($seasonType==3){  
	
		$rsRateDateList = ""; 
		$minDate = GetPageRecord('min(fromDate) as fromDate','seasonMaster','seasonNameId!="0" and deletestatus=0 ');
		$minFromDate = mysqli_fetch_array($minDate);
		$minfromd = $minFromDate['fromDate'];  
	   
		$maxDate = GetPageRecord('max(toDate) as toDate','seasonMaster','seasonNameId!="0" and deletestatus=0 ');
		$maxToDate = mysqli_fetch_array($maxDate);
		$maxtod = $maxToDate['toDate']; 
	   
		if($fromDate>=$minfromd && $toDate<=$maxtod){
			$errorFlag = 1;
			$sn1 = "";
			$sn1 = GetPageRecord('*','seasonMaster','seasonNameId!="0" and deletestatus=0 order by fromDate,toDate');
			while($seasonResult = mysqli_fetch_array($sn1)){ 

				$seasonFromDate = $seasonResult['fromDate'];
				$seasonToDate = $seasonResult['toDate'];
				$seasonId = $seasonResult['seasonNameId'];   
				
				if($fromDate>=$seasonFromDate && $toDate<=$seasonToDate){  // 1
				  $rsRateDateList.="SID=".$seasonId.",SFD=".$fromDate.",STD=".$toDate.'~';
				}elseif($fromDate>=$seasonFromDate && $fromDate<=$seasonToDate && $toDate>$seasonToDate){ // 2
				  $rsRateDateList.="SID=".$seasonId.",SFD=".$fromDate.",STD=".$seasonToDate.'~';   
				}elseif($fromDate<=$seasonFromDate && $toDate>=$seasonToDate){ // 3
					$rsRateDateList.="SID=".$seasonId.",SFD=".$seasonFromDate.",STD=".$seasonToDate.'~';
				}elseif($fromDate<$seasonFromDate && $toDate>=$seasonFromDate && $toDate<=$seasonToDate){ // 4
				  $rsRateDateList.="SID=".$seasonId.",SFD=".$seasonFromDate.",STD=".$toDate.'~';
				}else{ 
				  $rsRateDateList.='';
				} 
		  	}
		}else{
			$errorFlag=0;
		}
		
		$seasonSet = rtrim($rsRateDateList,"~");
		$dataSet = explode ("~",$seasonSet);
		if($errorFlag==1){
		foreach ($dataSet as $seasonSet2) {
			$seasonResult = explode(',', $seasonSet2); 
			$SID_a=explode('=',$seasonResult[0]);
			$seasonType=$SID_a[1]; 
			$SFD_a=explode('=',$seasonResult[1]);
			$newFromDate=$SFD_a[1]; 
			$STD_a=explode('=',$seasonResult[2]);
			$newToDate=$STD_a[1]; 
			$seasonType3=3;
			//*******************************************************************************************************************************************

			$rs=GetPageRecord('*',_DMC_ROOM_TARIFF_MASTER_,' supplierId="'.$roomSupplierId.'" and ( fromDate BETWEEN "'.$newFromDate.'" and "'.$newToDate.'" OR "'.$newFromDate.'" BETWEEN fromDate and toDate ) and  roomType="'.$roomType.'"  and  paxType="'.$paxType.'" and mealPlan="'.$mealPlan.'" and serviceid="'.$serviceid.'" and tarifType="'.$tarifType.'" and marketType="'.$marketType.'"'); 
			if(mysqli_num_rows($rs) == 0 ){
				$namevalue ='supplierId="'.$roomSupplierId.'",suplimentPrice="'.$suplimentPrice.'",fromDate="'.$newFromDate.'",toDate="'.$newToDate.'",sfromDate="'.$newFromDate.'",stoDate="'.$newToDate.'",paxType="'.$paxType.'",roomType="'.$roomType.'",mealPlan="'.$mealPlan.'",roomprice="'.$roomprice.'",childwithbed="'.$childwithbed.'",childwithoutbed="'.$childwithoutbed.'",extraadult="'.$extraadult.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",singleoccupancy="'.$singleoccupancy.'",doubleoccupancy="'.$doubleoccupancy.'",tripleoccupancy="'.$tripleoccupancy.'",extraBed="'.$extraBed.'",breakfast="'.$breakfast.'",roomTAC="'.$roomTAC.'",TACType="'.$TACType.'",roomGST="'.$roomGST.'",mealGST="'.$mealGST.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remarks="'.$remarks.'",lunch="'.$lunch.'",dinner="'.$dinner.'",serviceid="'.$serviceid.'",seasonType="'.$seasonType3.'",seasonYear="'.$seasonYear.'",tarifType="'.$tarifType.'",marketType="'.$marketType.'",sixBedRoom="'.$sixBedRoom.'",eightBedRoom="'.$eightBedRoom.'",tenBedRoom="'.$tenBedRoom.'",childBreakfast="'.$breakfastChild.'",childLunch="'.$lunchChild.'",childDinner="'.$dinnerChild.'",quadRoom="'.$quadRoom.'",teenRoom="'.$teenRoom.'"';
				$lastid = addlistinggetlastid(_DMC_ROOM_TARIFF_MASTER_,$namevalue);
				$msgbox = 1;
				// add rate additional requirenments
				$maxRecord = 1;
				while($maxRecord <= $_POST['maxRecord']) {
					$addtionalHotel=clean($_POST["addtionalHotel".$maxRecord]);
					$additionalGST=clean($_POST["additionalGST".$maxRecord]);
					$personwise=clean($_POST["personwise".$maxRecord]);
					$additionalCost=clean($_POST["additionalCost".$maxRecord]);
					$addHotelId=clean($_POST["addHotelId".$maxRecord]);
					$modifyBy=clean($_SESSION['userid']);
					$modifyDate=date('Y-m-d');
  					if($addtionalHotel!='' && $additionalCost!='' ){
						if($addHotelId!=''){
							$selectdoc='*';
							$wheredoc='id='.$addHotelId.'';
							$rsdoc=GetPageRecord($selectdoc,'dmcAdditionalHotelRate',$wheredoc);
							$countcontdoc=mysqli_num_rows($rsdoc);
							if($countcontdoc>0){
								while($documents=mysqli_fetch_array($rsdoc)){

									$allvaluedoc ='hotelId="'.$serviceid.'",rateId="'.$lastid.'",additionalName="'.$addtionalHotel.'",gsttax="'.$additionalGST.'",personWise="'.$personwise.'",additionalCost="'.$additionalCost.'",modifyDate="'.$modifyDate.'",modifyBy="'.$modifyBy.'",status="1"';
									$wheredocument='id='.$addHotelId.'';
									$updatecontactperson = updatelisting('dmcAdditionalHotelRate',$allvaluedoc,$wheredocument);
								}
							}
						}else{
							// added for updating end
							$allvaluephone ='hotelId="'.$serviceid.'",rateId="'.$lastid.'",additionalName="'.$addtionalHotel.'",gsttax="'.$additionalGST.'",personWise="'.$personwise.'",additionalCost="'.$additionalCost.'",dateAdded="'.$modifyDate.'",addedBy="'.$modifyBy.'",status="1"';
							$add = addlisting('dmcAdditionalHotelRate',$allvaluephone);
							$msgbox = 1;
						}
					}
				   $maxRecord++; 
				}
				?>
				<script>
				parent.$('#pageloading').hide();
				parent.$('#pageloader').hide();
				parent.funafterloadaddrete('<?php echo $roomSupplierId; ?>','<?php echo $_REQUEST['fromDate']; ?>','<?php echo $_REQUEST['toDate']; ?>','<?php echo $roomType; ?>','<?php echo $mealPlan; ?>','<?php echo $currencyId; ?>');
				// parent.setupbox('showpage.crm?module=packagehotelmaster&view=yes&hotelId=<?php echo encode($serviceid); ?>&alt=<?php echo $msgbox; ?>'); 
				</script> 
				<?php 
			} 
			else{ 
				?>
				<script>
				parent.$('#pageloading').hide();
				parent.$('#pageloader').hide();
				parent.alert('Hotel tariff of this duration is already exist.');
				parent.funafterloadaddrete('<?php echo $roomSupplierId; ?>','<?php echo $_REQUEST['fromDate']; ?>','<?php echo $_REQUEST['toDate']; ?>','<?php echo $roomType; ?>','<?php echo $mealPlan; ?>','<?php echo $currencyId; ?>');
				</script>
				<?php
			} 
 		}  
 		}
	} else{ 
	
		if($toDate > $fromDate ){  
			$rs=GetPageRecord('*',_DMC_ROOM_TARIFF_MASTER_,' supplierId="'.$roomSupplierId.'" and ( fromDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" OR "'.$fromDate.'" BETWEEN fromDate and toDate ) and  paxType="'.$paxType.'"  and  roomType="'.$roomType.'" and mealPlan="'.$mealPlan.'" and serviceid="'.$serviceid.'" and tarifType="'.$tarifType.'"  and marketType="'.$marketType.'"'); 
			if(mysqli_num_rows($rs) == 0 ){ 
				$namevalue ='supplierId="'.$roomSupplierId.'",suplimentPrice="'.$suplimentPrice.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",sfromDate="'.$fromDate.'",stoDate="'.$toDate.'",paxType="'.$paxType.'",roomType="'.$roomType.'",mealPlan="'.$mealPlan.'",roomprice="'.$roomprice.'",childwithbed="'.$childwithbed.'",childwithoutbed="'.$childwithoutbed.'",extraadult="'.$extraadult.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",singleoccupancy="'.$singleoccupancy.'",doubleoccupancy="'.$doubleoccupancy.'",tripleoccupancy="'.$tripleoccupancy.'",extraBed="'.$extraBed.'",breakfast="'.$breakfast.'",roomTAC="'.$roomTAC.'",TACType="'.$TACType.'",roomGST="'.$roomGST.'",mealGST="'.$mealGST.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remarks="'.$remarks.'",lunch="'.$lunch.'",dinner="'.$dinner.'",serviceid="'.$serviceid.'",seasonType="'.$seasonType.'",seasonYear="'.$seasonYear.'",tarifType="'.$tarifType.'",marketType="'.$marketType.'",sixBedRoom="'.$sixBedRoom.'",eightBedRoom="'.$eightBedRoom.'",tenBedRoom="'.$tenBedRoom.'",childBreakfast="'.$breakfastChild.'",childLunch="'.$lunchChild.'",childDinner="'.$dinnerChild.'",quadRoom="'.$quadRoom.'",teenRoom="'.$teenRoom.'"';
				$lastid = addlistinggetlastid(_DMC_ROOM_TARIFF_MASTER_,$namevalue);
				$msgbox = 1;
				// add rate additional requirenments
				while($maxRecord <= $_POST['maxRecord']) {
					$addtionalHotel=clean($_POST["addtionalHotel".$maxRecord]);
					$additionalGST=clean($_POST["additionalGST".$maxRecord]);
					$personwise=clean($_POST["personwise".$maxRecord]);
					$additionalCost=clean($_POST["additionalCost".$maxRecord]);
					$addHotelId=clean($_POST["addHotelId".$maxRecord]);
					$modifyBy=clean($_SESSION['userid']);
					$modifyDate=date('Y-m-d');
						
						if($addtionalHotel!='' && $additionalCost!='' ){

						if($addHotelId!=''){
							$selectdoc='*';
							$wheredoc='id='.$addHotelId.'';
							$rsdoc=GetPageRecord($selectdoc,'dmcAdditionalHotelRate',$wheredoc);
							$countcontdoc=mysqli_num_rows($rsdoc);
							if($countcontdoc>0){
								while($documents=mysqli_fetch_array($rsdoc)){

									$allvaluedoc ='hotelId="'.$serviceid.'",rateId="'.$lastid.'",additionalName="'.$addtionalHotel.'",gsttax="'.$additionalGST.'",personWise="'.$personwise.'",additionalCost="'.$additionalCost.'",modifyDate="'.$modifyDate.'",modifyBy="'.$modifyBy.'",status="1"';
									$wheredocument='id='.$addHotelId.'';
									$updatecontactperson = updatelisting('dmcAdditionalHotelRate',$allvaluedoc,$wheredocument);
								}
							}
						}else{
							// added for updating end
							$allvaluephone ='hotelId="'.$serviceid.'",rateId="'.$lastid.'",additionalName="'.$addtionalHotel.'",gsttax="'.$additionalGST.'",personWise="'.$personwise.'",additionalCost="'.$additionalCost.'",dateAdded="'.$modifyDate.'",addedBy="'.$modifyBy.'",status="1"';
							$add = addlisting('dmcAdditionalHotelRate',$allvaluephone);
							$msgbox = 1;
						}
					}
				   $maxRecord++; 
				}
				?> 
				<script> 
				parent.$('#pageloading').hide(); 
				parent.$('#pageloader').hide(); 
				parent.funafterloadaddrete('<?php echo $roomSupplierId; ?>','<?php echo $_REQUEST['fromDate']; ?>','<?php echo $_REQUEST['toDate']; ?>','<?php echo $roomType; ?>','<?php echo $mealPlan; ?>','<?php echo $currencyId; ?>');
				// parent.setupbox('showpage.crm?module=packagehotelmaster&view=yes&hotelId=<?php echo encode($serviceid); ?>&alt=<?php echo $msgbox; ?>');
				</script> 
				<?php 
			} else{ 
				?>
			<script>
				parent.$('#pageloading').hide();
				parent.$('#pageloader').hide();
				parent.alert('Hotel tariff of this duration is already exist.');
				parent.funafterloadaddrete('<?php echo $roomSupplierId; ?>','<?php echo $_REQUEST['fromDate']; ?>','<?php echo $_REQUEST['toDate']; ?>','<?php echo $roomType; ?>','<?php echo $mealPlan; ?>','<?php echo $currencyId; ?>');
				// parent.setupbox('showpage.crm?module=packagehotelmaster&view=yes&hotelId=<?php echo encode($serviceid); ?>&alt=<?php echo $msgbox; ?>');
				</script>
				<?php
			}
		} else{ ?>
			<script> 
			parent.$('#pageloading').hide(); 
			parent.$('#pageloader').hide(); 
			parent.alert('Invalid duration!!'); 
			parent.funafterloadaddrete('<?php echo $roomSupplierId; ?>','<?php echo $_REQUEST['fromDate']; ?>','<?php echo $_REQUEST['toDate']; ?>','<?php echo $roomType; ?>','<?php echo $mealPlan; ?>','<?php echo $currencyId; ?>');
			// module=packagehotelmaster&view=yes&hotelId=VG5wRk5VNVJQVDA9
			// parent.setupbox('showpage.crm?module=packagehotelmaster&view=yes&hotelId=<?php echo encode($serviceid); ?>&alt=<?php echo $msgbox; ?>');
			
			</script>
			<?php
		}
		exit();
	
	}
	

}

//hotel edit adddmc dmcroom
if(trim($_POST['action'])=='updatedmcHotelTariff' && trim($_POST['mealPlan2'])!='' && trim($_POST['currencyId2'])!='' && trim($_POST['tarifId2'])!=''){
	$teenRoom=clean($_REQUEST['teenRoom']);
	$quadRoom=clean($_REQUEST['quadRoom']);
	$sixBedRoom=clean($_REQUEST['sixBedRoom']);
	$eightBedRoom=clean($_REQUEST['eightBedRoom']);
	$tenBedRoom=clean($_REQUEST['tenBedRoom']);
	$breakfastChild=clean($_REQUEST['breakfastChild']);
	$lunchChild=clean($_REQUEST['lunchChild']);
	$dinnerChild=clean($_REQUEST['dinnerChild']);
	$tarifType=clean($_REQUEST['tarifType2']);
	$seasonType=clean($_REQUEST['seasonType2']);
	$seasonYear=clean($_REQUEST['seasonYear2']);
	$dmcHoteltariffId=clean($_REQUEST['tarifId2']);
	$serviceid=clean($_REQUEST['serviceid2']);
	$suplimentPrice=addslashes($_POST['suplimentPrice']);
	$suppid=clean($_REQUEST['suppid']);
	$mealPlan=addslashes($_POST['mealPlan2']);
	$extraadult=addslashes($_POST['extraadult']);
	$status=addslashes($_POST['status2']);
	$currencyId=addslashes($_POST['currencyId2']);
	$singleoccupancy=addslashes($_POST['singleoccupancy2']);
	$doubleoccupancy=addslashes($_POST['doubleoccupancy2']);
	$tripleoccupancy=addslashes($_POST['tripleoccupancy']);
	$extraBed=addslashes($_POST['extraBed2']);
	$childwithbed=addslashes($_POST['childwithbed2']);
	$childwithoutbed2=addslashes($_POST['childwithoutbed2']);
	$breakfast=addslashes($_POST['breakfast2']);
	$roomTAC=addslashes($_POST['roomTAC2']);
	$TACType=addslashes($_POST['TACType2']);
	$roomGST=addslashes($_POST['roomGST2']);
	$mealGST=addslashes($_POST['mealGST2']);
	$remarks=addslashes($_POST['remarks2']);
	$remarks=addslashes($_POST['remarks']);
	$lunch=addslashes($_POST['lunch2']);
	$dinner=addslashes($_POST['dinner2']);
	$roomType=addslashes($_POST['roomType']);
	$marketTypeId=clean($_REQUEST['marketTypeId2']);
	$activitySupplierId=clean($_REQUEST['activitySupplierId']);
	$dateid=trim($_POST['dateid']);
	$fromDate=date('Y-m-d',strtotime($_POST['fromDatevalidity']));
	$toDate=date('Y-m-d',strtotime($_POST['toDatevalidity']));
	$paxType2=clean($_REQUEST['paxType2']); 

	$markupType=clean($_REQUEST['markupType2']);
	$markupCost=clean($_REQUEST['markupCost2']);

	$dateAdded=time();
	if($toDate >= $fromDate ){
 			$rs=GetPageRecord('*',_DMC_ROOM_TARIFF_MASTER_,' supplierId="'.$roomSupplierId.'"  and ( fromDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" OR "'.$fromDate.'" BETWEEN fromDate and toDate ) and  roomType="'.$roomType.'" and mealPlan="'.$mealPlan.'" and tarifType="'.$tarifType.'" and marketType="'.$marketTypeId.'" and serviceid="'.$serviceid.'" and id!="'.$dmcHoteltariffId.'"');
		if(mysqli_num_rows($rs) == 0 ){
			$namevalue ='mealPlan="'.$mealPlan.'",roomType="'.$roomType.'",tarifType="'.$tarifType.'",seasonType="'.$seasonType.'",seasonYear="'.$seasonYear.'",suplimentPrice="'.$suplimentPrice.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",roomprice="'.$roomprice.'",childwithbed="'.$childwithbed.'",childwithoutbed="'.$childwithoutbed2.'",extraadult="'.$extraadult.'",status="'.$status.'",currencyId="'.$currencyId.'",singleoccupancy="'.$singleoccupancy.'",doubleoccupancy="'.$doubleoccupancy.'",tripleoccupancy="'.$tripleoccupancy.'",extraBed="'.$extraBed.'",breakfast="'.$breakfast.'",roomTAC="'.$roomTAC.'",TACType="'.$TACType.'",roomGST="'.$roomGST.'",mealGST="'.$mealGST.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",remarks="'.$remarks.'",lunch="'.$lunch.'",dinner="'.$dinner.'",supplierId="'.$activitySupplierId.'",marketType="'.$marketTypeId.'",remarks="'.$remarks.'",paxType="'.$paxType2.'",sfromDate="'.$newFromDate.'",stoDate="'.$newToDate.'",sixBedRoom="'.$sixBedRoom.'",eightBedRoom="'.$eightBedRoom.'",tenBedRoom="'.$tenBedRoom.'",childBreakfast="'.$breakfastChild.'",childLunch="'.$lunchChild.'",childDinner="'.$dinnerChild.'",quadRoom="'.$quadRoom.'",teenRoom="'.$teenRoom.'"';
            $where='id="'.$dmcHoteltariffId.'"';
			$update = updatelisting(_DMC_ROOM_TARIFF_MASTER_,$namevalue,$where);

			// add rate additional requirenments
			while($maxRecord <= $_POST['maxRecord2']) {
				$addtionalHotel=clean($_POST["addtionalHotel2".$maxRecord]);
				$additionalGST=clean($_POST["additionalGST2".$maxRecord]);
				$personwise=clean($_POST["personwise2".$maxRecord]);
				$additionalCost=clean($_POST["additionalCost2".$maxRecord]);
				$addHotelId=clean($_POST["addHotelId2".$maxRecord]);
				$modifyBy=clean($_SESSION['userid']);
				$modifyDate=time();
					
					if($addtionalHotel!='' && $additionalCost!='' ){

					if($addHotelId!=''){
						$selectdoc='*';
						$wheredoc='id='.$addHotelId.'';
						$rsdoc=GetPageRecord($selectdoc,'dmcAdditionalHotelRate',$wheredoc);
						$countcontdoc=mysqli_num_rows($rsdoc);
						if($countcontdoc>0){
							while($documents=mysqli_fetch_array($rsdoc)){

								$allvaluedoc ='hotelId="'.$serviceid.'",rateId="'.$dmcHoteltariffId.'",additionalName="'.$addtionalHotel.'",gsttax="'.$additionalGST.'",personWise="'.$personwise.'",additionalCost="'.$additionalCost.'",modifyDate="'.$modifyDate.'",modifyBy="'.$modifyBy.'",status="1"';
								$wheredocument='id='.$addHotelId.'';
								$updatecontactperson = updatelisting('dmcAdditionalHotelRate',$allvaluedoc,$wheredocument);
							}
						}
					}else{
						// added for updating end
						$allvaluephone ='hotelId="'.$serviceid.'",rateId="'.$dmcHoteltariffId.'",additionalName="'.$addtionalHotel.'",gsttax="'.$additionalGST.'",personWise="'.$personwise.'",additionalCost="'.$additionalCost.'",dateAdded="'.$modifyDate.'",addedBy="'.$modifyBy.'",status="1"';
						$add = addlisting('dmcAdditionalHotelRate',$allvaluephone);
					}
				}
			   $maxRecord++; 
			}
			?>
			<script>
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
			parent.funloadhotelmaster('<?php echo $suppid; ?>');
			parent.$('#alertnotificationsmainbox').hide();
			</script>
			<?php
		}else{
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alert('Hotel tariff of this duration is already exist.');
		parent.funloadhotelmaster('<?php echo $suppid; ?>');
		parent.$('#alertnotificationsmainbox').hide();
		</script>
		<?php
		}
	}else{
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.alert('Invalid duration!!');
	parent.funloadhotelmaster('<?php echo $suppid; ?>');
	parent.$('#alertnotificationsmainbox').hide();
	</script>
	<?php
	}
	exit();
}

if(trim($_POST['action'])=='addVisaRate'  && trim($_POST['visaTypeId'])!=''){
	$visaName = $_POST['visaName'];
	$visaTypeId = $_POST['visaTypeId'];
	$supplierId = $_POST['supplierId'];
	$countryId = $_POST['countryId'];
	$entryType = $_POST['entryType'];
	$validity = $_POST['validity'];
	$fromDate = $_POST['fromDate'];

	$fromDate = date('Y-m-d',strtotime($fromDate));
	$toDate = $_POST['toDate'];
	$toDate = date('Y-m-d',strtotime($toDate));

	$currencyId = $_POST['currencyId'];
	$adultCost = $_POST['adultCost'];
	$childCost = $_POST['childCost'];
	$infantCost = $_POST['infantCost'];
	$visaMarkup = $_POST['visaMarkup'];
	$processingFee = $_POST['processingFee'];
	$status = $_POST['status'];
	$serviceid = $_POST['serviceid'];
	$gstTax = $_POST['gstTax'];
	$vfsCharges = $_POST['vfsCharges'];
	$embassyFee = $_POST['embassyFee'];

	$dateAdded = time();
	 $nameValue = 'name="'.$visaName.'",vfsCharges="'.$vfsCharges.'",embassyFee="'.$embassyFee.'",visaTypeId="'.$visaTypeId.'",supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",markupType="'.$visaMarkup.'",processingFee="'.$processingFee.'",status="'.$status.'",countryId="'.$countryId.'",entryType="'.$entryType.'",
	 validity="'.$validity.'",serviceId="'.$serviceid.'",dateAdded="'.$dateAdded.'",modifyDate="'.$dateAdded.'"';

	 $add = addlisting('visaRateMaster',$nameValue);
	?>
	<script>
		parent.funloadVisaRate();

		$("#pageloader").hide();
		$("#pageloading").hide();
	</script>
	<?php

}


if(trim($_POST['action'])=='editVisaRate' && trim($_POST['visaNameId'])!='' && trim($_POST['supplierId2'])!=''){
	$tariffId = $_POST['visaNameId'];
	$visaName = $_POST['visaName2'];
	$visaTypeId = $_POST['visaTypeId2'];
	$supplierId = $_POST['supplierId2'];
	$fromDate = $_POST['fromDate2'];

	$entryType = $_POST['entryType'];
	$validity = $_POST['validity'];
	$countryId = $_POST['countryId'];




	$fromDate = date('Y-m-d',strtotime($fromDate));
	$toDate = $_POST['toDate2'];
	$toDate = date('Y-m-d',strtotime($toDate));

	$currencyId = $_POST['currencyId2'];
	$adultCost = $_POST['adultCost2'];
	$childCost = $_POST['childCost2'];
	$infantCost = $_POST['infantCost2'];
	$visaMarkup = $_POST['visaMarkup2'];
	$processingFee = $_POST['processingFee2'];
	$status = $_POST['status2'];
	
	$gstTax = $_POST['gstTax2'];
	$embassyFee = $_POST['embassyFee2'];
	$vfsCharges = $_POST['vfsCharges2'];
	


	$dateAdded = time();
	 $nameValue = 'name="'.$visaName.'",visaTypeId="'.$visaTypeId.'",entryType="'.$entryType.'",validity="'.$validity.'",countryId="'.$countryId.'",supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",markupType="'.$visaMarkup.'",processingFee="'.$processingFee.'",status="'.$status.'",embassyFee="'.$embassyFee.'",vfsCharges="'.$vfsCharges.'",dateAdded="'.$dateAdded.'",modifyDate="'.$dateAdded.'"';
	$where = 'id="'.$tariffId.'"';
	 $add = updatelisting('visaRateMaster',$nameValue,$where);
	?>
	<script>
		parent.alertspopupopenClose();
		parent.funloadVisaRate();
		
		$("#pageloader").hide();
		$("#pageloading").hide();
	</script>
	<?php

}

// Add and Edit Insurance Rate

if(trim($_POST['action'])=='addInsuranceRate' && trim($_POST['insuranceName'])!='' && trim($_POST['insuranceTypeId'])!=''){
	$insuranceName = $_POST['insuranceName'];
	$insuranceTypeId = $_POST['insuranceTypeId'];
	$supplierId = $_POST['supplierId'];
	$fromDate = $_POST['fromDate'];

	$fromDate = date('Y-m-d',strtotime($fromDate));
	$toDate = $_POST['toDate'];
	$toDate = date('Y-m-d',strtotime($toDate));

	$currencyId = $_POST['currencyId'];
	$adultCost = $_POST['adultCost'];
	$childCost = $_POST['childCost'];
	$infantCost = $_POST['infantCost'];
	$visaMarkup = $_POST['visaMarkup'];
	$processingFee = $_POST['processingFee'];
	$status = $_POST['status'];
	$serviceid = $_POST['serviceid'];
	$gstTax = $_POST['gstTax'];

	$dateAdded = time();
	 $nameValue = 'name="'.$insuranceName.'",insuranceTypeId="'.$insuranceTypeId.'",supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",markupType="'.$visaMarkup.'",processingFee="'.$processingFee.'",status="'.$status.'",serviceId="'.$serviceid.'",dateAdded="'.$dateAdded.'",modifyDate="'.$dateAdded.'"';

	 $add = addlisting('insuranceRateMaster',$nameValue);
	?>
	<script>
		parent.funloadInsuranceRate();

		$("#pageloader").hide();
		$("#pageloading").hide();
	</script>
	<?php

}


if(trim($_POST['action'])=='editInsuranceRate' && trim($_POST['insuranceNameId'])!='' && trim($_POST['supplierId2'])!=''){
	$tariffId = $_POST['insuranceNameId'];
	$InsuranceName2 = $_POST['InsuranceName2'];
	
	$insuranceTypeId2 = $_POST['insuranceTypeId2'];
	$supplierId = $_POST['supplierId2'];
	$fromDate = $_POST['fromDate2'];

	$fromDate = date('Y-m-d',strtotime($fromDate));
	$toDate = $_POST['toDate2'];
	$toDate = date('Y-m-d',strtotime($toDate));

	$currencyId = $_POST['currencyId2'];
	$adultCost = $_POST['adultCost2'];
	$childCost = $_POST['childCost2'];
	$infantCost = $_POST['infantCost2'];
	$visaMarkup = $_POST['visaMarkup2'];
	$processingFee = $_POST['processingFee2'];
	$status = $_POST['status2'];
	
	$gstTax = $_POST['gstTax2'];
	

	$dateAdded = time();
	 $nameValue = 'name="'.$InsuranceName2.'",insuranceTypeId="'.$insuranceTypeId2.'",supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",markupType="'.$visaMarkup.'",processingFee="'.$processingFee.'",status="'.$status.'",dateAdded="'.$dateAdded.'",modifyDate="'.$dateAdded.'"';
	$where = 'id="'.$tariffId.'"';
	 $add = updatelisting('insuranceRateMaster',$nameValue,$where);
	?>
	<script>
		parent.alertspopupopenClose();
		parent.funloadInsuranceRate();
		
		$("#pageloader").hide();
		$("#pageloading").hide();
	</script>
	<?php

}



// Add and Edit Passport Rate

if(trim($_POST['action'])=='addPassportRate' && trim($_POST['passportName'])!='' && trim($_POST['passportTypeId'])!=''){
	$passportName = $_POST['passportName'];
	$passportTypeId = $_POST['passportTypeId'];
	$supplierId = $_POST['supplierId'];
	$fromDate = $_POST['fromDate'];

	$fromDate = date('Y-m-d',strtotime($fromDate));
	$toDate = $_POST['toDate'];
	$toDate = date('Y-m-d',strtotime($toDate));

	$currencyId = $_POST['currencyId'];
	$adultCost = $_POST['adultCost'];
	$childCost = $_POST['childCost'];
	$infantCost = $_POST['infantCost'];
	$visaMarkup = $_POST['visaMarkup'];
	$processingFee = $_POST['processingFee'];
	$status = $_POST['status'];
	$serviceid = $_POST['serviceid'];
	$gstTax = $_POST['gstTax'];

	$dateAdded = time();
	 $nameValue = 'name="'.$passportName.'",passportTypeId="'.$passportTypeId.'",supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",markupType="'.$visaMarkup.'",processingFee="'.$processingFee.'",status="'.$status.'",serviceId="'.$serviceid.'",dateAdded="'.$dateAdded.'",modifyDate="'.$dateAdded.'"';

	 $add = addlisting('passportRateMaster',$nameValue);
	?>
	<script>
		parent.funloadPassportRate();

		$("#pageloader").hide();
		$("#pageloading").hide();
	</script>
	<?php
}

if(trim($_POST['action'])=='editPassportRate' && trim($_POST['passportNameId'])!='' && trim($_POST['supplierId2'])!=''){
	$tariffId = $_POST['passportNameId'];
	$passportName2 = $_POST['passportName2'];
	
	$passportTypeId2 = $_POST['passportTypeId2'];
	$supplierId = $_POST['supplierId2'];
	$fromDate = $_POST['fromDate2'];

	$fromDate = date('Y-m-d',strtotime($fromDate));
	$toDate = $_POST['toDate2'];
	$toDate = date('Y-m-d',strtotime($toDate));

	$currencyId = $_POST['currencyId2'];
	$adultCost = $_POST['adultCost2'];
	$childCost = $_POST['childCost2'];
	$infantCost = $_POST['infantCost2'];
	$visaMarkup = $_POST['visaMarkup2'];
	$processingFee = $_POST['processingFee2'];
	$status = $_POST['status2'];
	$gstTax = $_POST['gstTax2'];
	
	$dateAdded = time();
	$nameValue = 'name="'.$passportName2.'",passportTypeId="'.$passportTypeId2.'",supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",currencyId="'.$currencyId.'",gstTax="'.$gstTax.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",markupType="'.$visaMarkup.'",processingFee="'.$processingFee.'",status="'.$status.'",dateAdded="'.$dateAdded.'",modifyDate="'.$dateAdded.'"';
	$where = 'id="'.$tariffId.'"';
	$add = updatelisting('passportRateMaster',$nameValue,$where); ?>
	<script>
		parent.alertspopupopenClose();
		parent.funloadPassportRate();
		
		$("#pageloader").hide();
		$("#pageloading").hide();
	</script>
	<?php
}

//==========================START Import  Excel===========================
// hotel import new importfiles  
if (isset($_FILES['importfield']['name']) && trim($_POST['importpackagehotel']) == 'Y' ){
    require_once 'reader.php';
    date_default_timezone_set('Asia/Kolkata');
    $importpackagesightseeingModule = $_REQUEST['importpackagehotelModule']; 
    if (!empty($_FILES['importfield']['name'])){

        $file_name = $_FILES['importfield']['name'];
        $newfilez = formatUrl($file_name);
        $file_name = trim($newfilez).'.xls';
        $msg = '';
        $msg = $newfilez;
        errorlog($msg, $newfilez);
        $msg = '';
        $msg = $fullurl . "importfile/" . $file_name . " Copy this link to download file ";
        errorlog($msg, $newfilez);

        copy($_FILES['importfield']['tmp_name'], "importfile/" . $file_name);
        $data = new Spreadsheet_Excel_Reader();
        $data->setOutputEncoding('CP1251');
        $path = "importfile/" . $file_name;
        $data->read($path);
        $line = 0;
        $lineSuccess = 0;
        $lineFailed = 0;
        $lineExist = 0;
        $errorReport = '';
        $errorCount = 0;
        $rowno = 1;
	    $errorReportHeader = '<div><strong>Line No.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Error Report</strong></div><br>';
       
       	// DOMESTIC FORMAT 
       	if($hotelImportFormatType == 2){
	        for ($x = 2;$x <= count($data->sheets[0]["cells"]);$x++){
	            ++$rowno;
	            ++$line;
				$showErrorName = '';
	            $showErrorType = '';
	            
				$hotelName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
				$hotelDestination = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
				$SelfSupplier = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
				$supplierName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]);
				$paymentTerm = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][5]);
				$hotelCountry = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][6]);
				$hotelState = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][7]);
				$hotelCity = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][8]);
				$hotelAddress = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][9]);
				$pinCode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][10]);
				$gstn = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][11]);
				$divisionName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][12]);
				$contactPerson = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][13]);
				$designation = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][14]);
				$supplierPhone = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][15]);
				$supplierEmail2 = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][16]);
				$supplierEmailA = explode(',', $supplierEmail2);
				$supplierEmail = $supplierEmailA[0];
				$marketTypename = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][17]);
				$paxTypeN = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][18]);
				$tarifTypeN = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][19]);
				$seasonTypeN = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][20]);
				$roomType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][21]);
				$mealPlan = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][22]);
				$fromDates = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][23]);
				$toDates = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][24]);
				$fromDates = date("Y-m-d", strtotime($fromDates));
				$toDates = date("Y-m-d", strtotime($toDates));
				$currency = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][25]);
				$single = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][26]);
				$double = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][27]);
				$extraBedA = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][28]);
				$childwithbed = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][29]);
				$childwithoutbed = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][30]);
				$breakfastA = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][31]);
				$lunchA = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][32]);
				$dinnerA = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][33]);
				$breakfastC = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][34]);
				$lunchC = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][35]);
				$dinnerC = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][36]);
				$roomGST = getGstIdBySlab(cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][37]), "Hotel");
				$mealGST = getGstIdBySlab(cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][38]), "Restaurant");
				$roomTAC = preg_replace('/[^A-Za-z0-9\-]/', '', cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][39]));
				$remarks = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][40]);
				$hotelType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][41]);
				$hotelCategory = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][42]);
				$url = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][43]);
				$hotelChain = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][44]);
				$weekendName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][45]);
				$hoteldetail = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][46]);
				$hotelpolicy = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][47]);
				$hoteltermandcondition = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][48]);
	            $suppBookCode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][49]);

	            $rsRateDateList = ""; 
			    $minDate = GetPageRecord('min(fromDate) as fromDate','seasonMaster','seasonNameId!="0" and deletestatus=0  ');
			    $minFromDate = mysqli_fetch_array($minDate);
			    $minfromd = $minFromDate['fromDate'];  
			   
			    $maxDate = GetPageRecord('max(toDate) as toDate','seasonMaster','seasonNameId!="0" and deletestatus=0  ');
			    $maxToDate = mysqli_fetch_array($maxDate);
			    $maxtod = $maxToDate['toDate']; 
			   
			    if($fromDates>=$minfromd && $toDates<=$maxtod){
				  $errorFlag = 0;
				  $sn1 = "";
				  $sn1 = GetPageRecord('*','seasonMaster','seasonNameId!="0" and deletestatus=0 order by fromDate,toDate');
				  while($seasonResult = mysqli_fetch_array($sn1)){ 
					
				 	$seasonFromDate = $seasonResult['fromDate'];
					$seasonToDate = $seasonResult['toDate'];
					$seasonId = $seasonResult['seasonNameId']; 

					if($fromDates>=$seasonFromDate && $toDates<=$seasonToDate){  // 1
					  $rsRateDateList.="SID=".$seasonId.",SFD=".$fromDates.",STD=".$toDates.'~';
					  $errorFlag = 1;
					}elseif($fromDates>=$seasonFromDate && $fromDates<=$seasonToDate && $toDates>$seasonToDate){ // 2
					  $rsRateDateList.="SID=".$seasonId.",SFD=".$fromDates.",STD=".$seasonToDate.'~';  
					  $errorFlag = 1; 
					}elseif($fromDates<=$seasonFromDate && $toDates>=$seasonToDate){ // 3
					  $rsRateDateList.="SID=".$seasonId.",SFD=".$seasonFromDate.",STD=".$seasonToDate.'~';
					  $errorFlag = 1;
					}elseif($fromDates<$seasonFromDate && $toDates>=$seasonFromDate && $toDates<=$seasonToDate){ // 4
					  $rsRateDateList.="SID=".$seasonId.",SFD=".$seasonFromDate.",STD=".$toDates.'~';
					  $errorFlag = 1;
					}else{ 
					  $rsRateDateList.='';
					} 
				  }
				}else{
					$errorFlag=0;
				}   
				
	            
				if ($hotelName != '' && $hotelDestination != '' && $hotelCategory!='')
	            {
					 
					$seasonSet = rtrim($rsRateDateList,"~");
					$dataSet = explode ("~",$seasonSet); 
				
					$supplierType2 = 2;
					$marketTypeId=1;
					// echo 'UPPER(name)="'.trim(strtoupper($marketTypename)).'" order by name asc';
					$rsMkt = GetPageRecord('id','marketMaster',' UPPER(name)="'.trim(strtoupper($marketTypename)).'" order by name asc');
					{
						$resMarkt = mysqli_fetch_array($rsMkt);
						$marketTypeId = $resMarkt['id'];
					}   

					$hotelCategoryQuery = GetPageRecord('id',_HOTEL_CATEGORY_MASTER_,'UPPER(uploadKeyword)="'.trim(strtoupper($hotelCategory)).'"');
					if (mysqli_num_rows($hotelCategoryQuery) > 0)
					{
						$hotelCategoryD = mysqli_fetch_array($hotelCategoryQuery);
						$hotelCategoryId = $hotelCategoryD['id'];
					} else{
						$hotelCategoryId=0;
					}
					
					$hotelTypeQuery = GetPageRecord('id',_HOTEL_TYPE_MASTER_,' UPPER(uploadKeyword)="'.trim(strtoupper($hotelType)).'"');
					if (mysqli_num_rows($hotelTypeQuery) > 0)
					{
						$hotelTypeD = mysqli_fetch_array($hotelTypeQuery);
						$hotelTypeId = $hotelTypeD['id'];
					} else{
						$hotelTypeId=0;
						$msg = '';
						$msg = 'Row No-' . $rowno . '. Warning: Hotel Type Keyword does not exists...! - ' . date('d-m-Y h:ia');
						errorlog($msg, $newfilez); 
					}
					
					
				
	                $rsdivis = "";
	                $rsdivis = GetPageRecord('*','divisionMaster',' UPPER(name)="'.trim(strtoupper($divisionName)).'"');
	                if (mysqli_num_rows($rsdivis) < 1)
	                {
	                    $division = '2';
	                }else{
	                    $divisionD = mysqli_fetch_array($rsdivis);
	                    $division = $divisionD['id'];
	                }

	                $rscnt = '';
	                $rscnt = GetPageRecord('*',_DESTINATION_MASTER_,' UPPER(name)="'.trim(strtoupper($hotelDestination)).'"');
	                if (mysqli_num_rows($rscnt) < 1)
	                {
	                    $hotelDestination = '';
						$destId = 0;
						$msg = '';
	                    $msg = 'Row No-' . $rowno . '. Error: Destination does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                }else{
	                    $editresultds = mysqli_fetch_array($rscnt);
	                    $destId = $editresultds['id'];
	                    $hotelDestination = trim($editresultds['name']);
	                }

	                $rscnt = '';
	                $rscnt = GetPageRecord('*',_COUNTRY_MASTER_,' UPPER(name)="'.trim(strtoupper($hotelCountry)).'"');
	                if (mysqli_num_rows($rscnt) < 1)
	                {
	                    $hotelCountry = '';
	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: Country does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                }
	                else
	                {
	                    $countryData = mysqli_fetch_array($rscnt);
	                    $countryId = $countryData['id'];
	                    $hotelCountry = trim($countryData['name']);
	                }

	                $rscnt = '';
	                $rscnt = GetPageRecord('*', _STATE_MASTER_, 'UPPER(name)="'.trim(strtoupper($hotelState)).'"');
	                if (mysqli_num_rows($rscnt) < 1)
	                {
	                    $hotelState = '';
	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: State does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                } else {
	                    $stateData = mysqli_fetch_array($rscnt);
	                    $stateId = $stateData['id'];
	                    $hotelState = trim($stateData['name']);
	                }

	                $rscnt = '';
	                $rscnt = GetPageRecord('*',_CITY_MASTER_,'UPPER(name)="'.trim(strtoupper($hotelCity)).'"');
	                if (mysqli_num_rows($rscnt) < 1)
	                {
	                    $hotelCity = '';
	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: City does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                } else {
	                    $cityData = mysqli_fetch_array($rscnt);
	                    $cityId = $cityData['id'];
	                    $hotelCity = trim($cityData['name']);
	                }

					

	                $mealse = GetPageRecord('*', _MEAL_PLAN_MASTER_,'UPPER(name)="'.trim(strtoupper($mealPlan)).'"');
	                if (mysqli_num_rows($mealse) < 1)
	                {
	                    addlistinggetlastid(_MEAL_PLAN_MASTER_, 'name="'.trim($mealPlan). '",dateAdded="' . time() . '",addedBy="' . $_SESSION['userid'] . '"');
	                    $msg = '';
	                }
	 
	                $seasonYear = date('Y', strtotime($fromDates));

	                $rswkn = "";
	                $rswkn = GetPageRecord('id', 'weekendMaster', 'UPPER(name)="'.trim(strtoupper($weekendName)).'"');
	                if (mysqli_num_rows($rswkn) > 0)
	                {
	                    $resweekend = mysqli_fetch_array($rswkn);
	                    $weekendId = stripslashes($resweekend['id']);
	                    $weekendId2 = $resweekend['id'];
	                }
	                if (mysqli_num_rows($rswkn) == 0 && strlen($weekendName) > 0)
	                {
	                    $weekendId = 0;
	                    $weekendId2 = 0;

	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: Invalid Weekend name...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                }

	                $rschain = "";
	                $rschain = GetPageRecord('*', 'chainhotelmaster','UPPER(name)="'.trim(strtoupper($hotelChain)).'"');
	                if (mysqli_num_rows($rschain) > 0)
	                {
	                    $resChain = mysqli_fetch_array($rschain);
	                    $hotelChainId = stripslashes($resChain['id']);
	                }

	                if (mysqli_num_rows($rschain) == 0 && strlen($hotelChain) > 0)
	                {
	                    $rschain = GetPageRecord('*','chainhotelmaster','name="None"');
	                    $resChain = mysqli_fetch_array($rschain);
	                    $hotelChainId = stripslashes($resChain['id']);
	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: Hotel Chain does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                }
	                if (strtoupper($tarifTypeN) == strtoupper("Supplement")){
	                    $tarifType = 4;
	                }
	                else if (strtoupper($tarifTypeN) == strtoupper("Special Days")){
	                    $tarifType = 3;
	                }
	                else if (strtoupper($tarifTypeN) == strtoupper("Weekend")){
	                    $tarifType = 2;
	                }
	                else{
	                    $tarifType = 1;
	                }

	                if (strtoupper($paxTypeN) == strtoupper("FIT")){
	                    $paxType = 2;
	                }
	                else if (strtoupper($paxTypeN) == strtoupper("GIT")){
	                    $paxType = 1;
	                }
	                else{
	                    $paxType = 2;
	                }


					if (strtoupper($SelfSupplier) == 'YES' || strtoupper($SelfSupplier) == 'SELF')
					{
						$IsSupplier = 1;
						$supplierN = $hotelName;
					}
					else
					{
						$IsSupplier = 0;
						$supplierN = $supplierName;
					}
					// echo $supplierN.' - '.$IsSupplier.' - '.$supplierEmail.' | ';
	                $dateAdded = date('Y-m-d');
	                $lastId = $checkId = 0;

		            $rscnt2 = '';
		            $rscnt2 = GetPageRecord('*',_DESTINATION_MASTER_,' UPPER(name)="'.trim(strtoupper($hotelDestination)).'"');

	                if (date('Y-m-d', strtotime($toDates)) >= date('Y-m-d', strtotime($fromDates))) {

	                	// || date('Y', strtotime($fromDates)) < date('Y') || date('Y', strtotime($toDates)) < date('Y') 
	                    if ($hotelCountry == '' || $supplierEmail == '' || $hotelCategoryId == 0 || $marketTypeId == 0 || $roomGST == ''  || $mealGST == '' || $roomType == '' || mysqli_num_rows($rscnt2) < 1) {

				            if (mysqli_num_rows($rscnt2) < 1) {
	                            $showErrorName .= 'Hotel Destination,';
								$msg = '';
				                $msg = 'Row No-' . $rowno . '. Failed: Destination does not exits...! - ' . date('d-m-Y h:ia');
				                errorlog($msg, $newfilez);
				            }


							if ($roomGST == '') {
	                            $showErrorName .= 'Room GST,';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Room GST is not valid...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
							if ($mealGST == '') {
	                            $showErrorName .= 'Meal GST,';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Meal GST is not valid...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
	                        if ($supplierEmail == '') {
	                            $showErrorName .= 'Hotel Email,';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Hotel Email is not valid...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
							if ($hotelCategoryId == 0) {
								$showErrorName .= 'Hotel category keyword, ';
								$msg = '';
								$msg = 'Row No-' . $rowno . '.  Failed: Hotel Category keyword does not exist...! - ' . date('d-m-Y h:ia');
								errorlog($msg, $newfilez);
	                        }
							if ($marketTypeId == 0) {
								$showErrorName .= ' Market Type, ';
								$msg = '';
								$msg = 'Row No-' . $rowno . '.  Failed: Market Type does not exist...! - ' . date('d-m-Y h:ia');
								errorlog($msg, $newfilez);
	                        }
	                        if ($hotelCountry == '') {
	                            $showErrorType .= 'Hotel Country,';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Hotel Country does not exist...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
	                        if ($hotelDestination == '') {
	                            $showErrorType .= 'Hotel Destination';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Hotel Destination does not exist...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
	                        if ($roomType == '') {
	                            $showErrorType .= 'Room Type';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Room Type does not exist...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
	                        // if (date('Y', strtotime($fromDates)) < date('Y'))
	                        // {
	                        //     $showErrorType .= ' From Date ( ' . $fromDates . ' ) ';
	                        //     $msg = '';
	                        //     $msg = 'Row No-' . $rowno . '. Failed: Invalid from date of previous year...! - ' . date('d-m-Y h:ia');
	                        //     errorlog($msg, $newfilez);

	                        // }
	                        // if (date('Y', strtotime($toDates)) < date('Y'))
	                        // {
	                        //     $showErrorType .= ' To Date( ' . $toDates . ' ) ';

	                        //     $msg = '';
	                        //     $msg = 'Row No-' . $rowno . '. Failed: Invalid to date of previous year...! - ' . date('d-m-Y h:ia');
	                        //     errorlog($msg, $newfilez);
	                        // }
	                        $errorReport .= '<div>' . $line . '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error in&nbsp;' . $showErrorName . '&nbsp;&nbsp;&nbsp;' . $showErrorType . '</div>';

	                        $errorCount++;
	                        $lineFailed++;
	                    }
	                    else{
							// echo 'samaydin';
							$hotelrs1 = GetPageRecord('*',_ROOM_TYPE_MASTER_,'UPPER(name)="'.trim(strtoupper($roomType)).'"');
							$isroomType = mysqli_num_rows($hotelrs1);
							if ($isroomType > 0) {  
								$checkhotelEx = GetPageRecord('*', _PACKAGE_BUILDER_HOTEL_MASTER_, 'UPPER(hotelName)="'.trim(strtoupper($hotelName)).'" and UPPER(hotelCity)="'.trim(strtoupper($hotelDestination)).'"');
								$hotelfetch = mysqli_fetch_array($checkhotelEx);
								if (mysqli_num_rows($checkhotelEx) > 0) {
									/*==============================================EDIT=====================================================*/
									$rs2 = "";
									$rs2 = GetPageRecord('*',_PACKAGE_BUILDER_HOTEL_MASTER_,'UPPER(hotelName)="'.trim(strtoupper($hotelName)).'" and UPPER(hotelCity)="'.trim(strtoupper($hotelDestination)).'"');
									$counthotel = mysqli_fetch_array($rs2);
									$hotelroomType = $counthotel['roomType'];
									$rsroom = "";
									$rsroom = GetPageRecord('*',_ROOM_TYPE_MASTER_,'UPPER(name)="'.trim(strtoupper($roomType)).'"');
									$roomTypeId = mysqli_fetch_array($rsroom);
									$rsrh = GetPageRecord('*', _PACKAGE_BUILDER_HOTEL_MASTER_, ' 1 and FIND_IN_SET("' . $roomTypeId['id'] . '", roomType) and id="' . $counthotel['id'] . '"');
									$isexistshotel = mysqli_num_rows($rsrh);
									if ($isexistshotel == 0)
									{
										$rooms1 = $hotelroomType . ',' . $roomTypeId['id'];
										$rooms = ltrim(trim($rooms1) , ",");
									}
									else
									{
										$rooms = ltrim(trim($hotelroomType) , ",");
									}
									$namevalue = 'hotelName="' . $hotelName . '",contactPerson="' . $contactPerson . '",supplierPhone="' . $supplierPhone . '",roomType="' . $rooms . '",supplierEmail="' . $supplierEmail . '",hotelCountry="' . $hotelCountry . '",hotelCity="' . $hotelDestination . '",hotelAddress="' . $hotelAddress . '",hotelCategoryId="' . $hotelCategoryId. '",hotelTypeId="' . $hotelTypeId. '",gstn="' . $gstn . '",url="' . $url . '",status="1",hotelChain="' . $hotelChainId . '",supplier="' . $IsSupplier . '",policy="' . $hotelpolicy . '",hoteldetail="' . $hoteldetail . '",termAndCondition="' . $hoteltermandcondition . '",weekendDays="' . $weekendId2 . '"';
									updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, $namevalue, 'id="' . $hotelfetch['id'] . '"');

									$chkscp = checkduplicate('hotelContactPersonMaster', ' email="' . $supplierEmail . '"');
									if ($chkscp == 'no')
									{
										$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $hotelfetch['id'] . '",designation="' . $designation . '",phone="' . $supplierPhone . '",email="' . $supplierEmail . '",primaryvalue="1",division="' . $division . '"';
										
										addlisting('hotelContactPersonMaster', $scpmn);

										 
										$rs1 = "";
										$rs1 = GetPageRecord('*', _ADDRESS_MASTER_, ' addressParent="' . $hotelfetch['id'] . '" and addressType="hotel"');
										if (mysqli_num_rows($rs1) > 0)
										{
											$addrData = mysqli_fetch_array($rs1);
											$namevalue = 'countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1';
											updatelisting(_ADDRESS_MASTER_, $namevalue, "id='" . $addrData['id'] . "'");
										}
										else
										{
											$namevalue = 'addressParent="' . $hotelfetch['id'] . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="hotel"';
											addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);

										}
									}
									else
									{
										if (mysqli_num_rows(GetPageRecord('*', 'hotelContactPersonMaster', 'email="' . trim($supplierEmail) . '" and corporateId="' . $hotelfetch['id'] . '" and division!=3')) > 0  && $division != 3 )
										{
											$namevalue = 'contactPerson="' . $contactPerson . '",corporateId="' . $hotelfetch['id'] . '",designation="' . $designation . '",phone="' . $supplierPhone . '",email="' . $supplierEmail . '",primaryvalue="1",division="' . $division . '"';
											updatelisting('hotelContactPersonMaster', $namevalue, 'email="' . trim($supplierEmail) . '" and corporateId="' . $hotelfetch['id'] . '"');
											$rs1 = "";
											$rs1 = GetPageRecord('*', _ADDRESS_MASTER_, ' addressParent="' . $hotelfetch['id'] . '" and addressType="hotel"');
											if (mysqli_num_rows($rs1) > 0)
											{
												$addrData = mysqli_fetch_array($rs1);
												$namevalue = 'countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1';
												updatelisting(_ADDRESS_MASTER_, $namevalue, "id='" . $addrData['id'] . "'");
											}
											else
											{
												$namevalue = 'addressParent="' . $hotelfetch['id'] . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="hotel"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
											}
										}
										else
										{
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Warning: Hotel Contact Person email is already exist. - ' . date('d-m-Y h:ia');
											// errorlog($msg, $newfilez);
										}
									}

									if (strlen($supplierName) > 0 && $IsSupplier == 0) {
										$issup = "";
										$issup = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($supplierName) . '"');
										if (mysqli_num_rows($issup) > 0)
										{
											$issup1 = "";
											$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($supplierName) . '" and find_in_set("' . $destId . '",destinationId) ');
											if (mysqli_num_rows($issup1) > 0)
											{
												$lastIdData = mysqli_fetch_array($issup1);
												$lastId = $lastIdData['id'];
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, 'supplierId="' . $lastId . '"', 'id="' . $addid . '"');

											}
											else
											{
												$msg = $lastId = '';
												$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($supplierName) . ') is not register for destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);
												$lineFailed++;
											}
										}
										else
										{
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Failed: Supplier( ' . trim($supplierName) . ' ) does not exist - ' . date('d-m-Y h:ia');
											errorlog($msg, $newfilez);
											$lineFailed++;
										}
										$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, 'supplier="' . $IsSupplier . '",supplierId="' . $lastId . '"', 'id="' . $hotelfetch['id'] . '"');
									}
									elseif ($IsSupplier == 1) { 
										$issup0 = ""; 
										$issup0 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'UPPER(name)="'.trim(strtoupper($hotelName)).'"');
										if (mysqli_num_rows($issup0) > 0)
										{
	 
											//name exist
											$issup2 = "";
											$issup2 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'UPPER(name)="'.trim(strtoupper($hotelName)).'" and id in ( select corporateId from suppliercontactPersonMaster where email="' . encode($supplierEmail) . '" )');
											if (mysqli_num_rows($issup2) > 0)
											{
												//name & email exist
												$issup1 = "";
												$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="'.trim(strtoupper($hotelName)).'" and id in ( select corporateId from suppliercontactPersonMaster where email="' . encode($supplierEmail) . '" ) and find_in_set("' . $destId . '",destinationId) ');
												if (mysqli_num_rows($issup1) > 0)
												{
													//name & email & city exist true
													$lastIdData = mysqli_fetch_array($issup1);
													$lastId = $lastIdData['id'];

												}
												else
												{
													$msg = $lastId = '';
													$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
													errorlog($msg, $newfilez);
													$lineFailed++;
												}
											} else {
												
												//add supp
												$chkscp = checkduplicate('suppliercontactPersonMaster', ' email="' . encode($supplierEmail) . '" and corporateId>0 and primaryvalue=1 and division=3');				
												if($chkscp == 'yes' && $division != 3 ) {
													//update supplier to hotel
													$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
		
													//name & email exist
													$issup1 = "";

													$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="'.trim(strtoupper($hotelName)).'" and find_in_set("' . $destId . '",destinationId) ');
													if (mysqli_num_rows($issup1) > 0)
													{
														//name & email & city exist true
														$lastIdData = mysqli_fetch_array($issup1);
														$lastId = $lastIdData['id'];
														echo '1';
														$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
														addlisting('suppliercontactPersonMaster', $scpmn);

													}
													else {
														$msg = $lastId = '';
														$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for  the destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
														errorlog($msg, $newfilez);
														$lineFailed++;
													}
													
												} 
												else if($chkscp == 'no' ){
													//
													deleteRecord('suppliercontactPersonMaster','  email="' . encode($supplierEmail) . '" and corporateId=0 and primaryvalue=1');
													//update supplier to hotel
													$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
														
													//name & email exist
													$issup1 = "";
													$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="'.trim(strtoupper($hotelName)).'" and find_in_set("' . $destId . '",destinationId) ');
													if (mysqli_num_rows($issup1) > 0)
													{
														//name & email & city exist true
														$lastIdData = mysqli_fetch_array($issup1);
														$lastId = $lastIdData['id'];
														$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
														addlisting('suppliercontactPersonMaster', $scpmn);


													}
													else {
														$msg = $lastId = '';
														$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for  the destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
														errorlog($msg, $newfilez);
														$lineFailed++;
													}
												}
												else{
													$msg = $lastId = '';
													$msg = 'Row No-' . $rowno . '. Failed: Email is already exist 1 - ' . date('d-m-Y h:ia');
													errorlog($msg, $newfilez);
													$lineFailed++;
												}
												 
											}

										} else { 
											//add supp  if suppliername not exist
											$chkscp = checkduplicate('suppliercontactPersonMaster', ' email="' . encode($supplierEmail) . '"  and corporateId>0  and primaryvalue=1 and division=3');
											if ($chkscp == 'yes' && $division != 3 ) {
												
												$namevalue = 'name="' . trim($hotelName) . '",aliasname="'.trim($hotelName).'",contactPerson="' . $contactPerson . '",addedBy=' . $_SESSION['userid'] . ',dateAdded=' . $dateAdded . ',companyTypeId=1,supplierMainType=' . $supplierType2 . ',paymentTerm=1,agreement=0,destinationId="' . $destId . '"';
												$lastId = addlistinggetlastid(_SUPPLIERS_MASTER_, $namevalue);
												//update supplier to hotel
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
														
												$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
												addlisting('suppliercontactPersonMaster', $scpmn);

												$namevalue = 'addressParent="' . $lastId . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="supplier"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
												
											} 
											else if($chkscp == 'no' ){

												deleteRecord('suppliercontactPersonMaster','  email="' . encode($supplierEmail) . '" and corporateId=0 and primaryvalue=1');

												$namevalue = 'name="' . trim($hotelName) . '",aliasname="'.trim($hotelName).'",contactPerson="' . $contactPerson . '",addedBy=' . $_SESSION['userid'] . ',dateAdded=' . $dateAdded . ',companyTypeId=1,supplierMainType=' . $supplierType2 . ',paymentTerm=1,agreement=0,destinationId="' . $destId . '"';
												$lastId = addlistinggetlastid(_SUPPLIERS_MASTER_, $namevalue);
												//update supplier to hotel
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');

												$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
												addlisting('suppliercontactPersonMaster', $scpmn);

												$namevalue = 'addressParent="' . $lastId . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="supplier"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
												
											}
											else { 
												$msg = $lastId = '';
												$msg = 'Row No-' . $rowno . '. Failed: Email is already exist 2' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);
												$lineFailed++;
											} 
											
										}
									} 
									else {
										$msg = $lastId = '';
										$msg = 'Row No-' . $rowno . '. Failed: Invalid supplier details - ' . date('d-m-Y h:ia');
										errorlog($msg, $newfilez);
										$lineFailed++;
									}

									if ($lastId > 0 && $lastId != '')
									{

										$rs1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'id="' . $lastId . '"');
										$editresult = mysqli_fetch_array($rs1);
										
										$rsc = GetPageRecord('*', _QUERY_CURRENCY_MASTER_, 'name="' . $currency . '"');
										$rescurr = mysqli_fetch_array($rsc);
										
										$rsr = GetPageRecord('*', _ROOM_TYPE_MASTER_, 'name="' . $roomType . '"');
										$roomTypeId = mysqli_fetch_array($rsr);
										
										$rsrh = GetPageRecord('*', _PACKAGE_BUILDER_HOTEL_MASTER_, ' 1 and FIND_IN_SET("' . $roomTypeId['id'] . '",roomType) and status=1');
										$isexistshotel = mysqli_num_rows($rsrh);
										if ($isexistshotel == 0) {
											$rooms = $hotelroomType . ',' . $roomTypeId['id'];
											$namevalue = 'roomType="' . $rooms . '",supplierId="' . $lastId . '"';
											$where = 'id=' . $counthotel['id'] . '';
											$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, $namevalue, $where);
										}

										$rsm = GetPageRecord('*', _MEAL_PLAN_MASTER_, 'name="' . $mealPlan . '"');
										$mealPlanId = mysqli_fetch_array($rsm);
										$tarif = "";  
										if($errorFlag==1){ 
											
										

											foreach ($dataSet as $seasonSet2) {
											$seasonResult = explode(',', $seasonSet2);
											
											$SID_a=explode('=',$seasonResult[0]);
											$seasonType=$SID_a[1];

											$SFD_a=explode('=',$seasonResult[1]);
											$newFromDate=$SFD_a[1];

											$STD_a=explode('=',$seasonResult[2]);
											$newToDate=$STD_a[1];
											$tarif = GetPageRecord('*', _DMC_ROOM_TARIFF_MASTER_, ' supplierId="' . $editresult['id'] . '" and roomType="' . $roomTypeId['id'] . '" and mealPlan="' . $mealPlanId['id'] . '"  and ( fromDate BETWEEN "' . $newFromDate . '" and "' . $newToDate . '" OR "' . $newFromDate . '" BETWEEN fromDate and toDate ) and tarifType="' . $tarifType . '" and paxType="' . $paxType . '"  and marketType="' . $marketTypeId . '" and serviceid="' . $counthotel['id'] . '"');

											$roomratecount = mysqli_num_rows($tarif);
											if ($roomratecount < 1){
												// inserted 
											 	$namevalue = 'suppBookCode="' . $suppBookCode . '",supplierId="' . $editresult['id'] . '",fromDate="' . $newFromDate . '",toDate="' . $newToDate . '",sfromDate="' . $newFromDate . '",stoDate="' . $newToDate . '",roomType="' . $roomTypeId['id'] . '",mealPlan="' . $mealPlanId['id'] . '",status=1,addBy="' . $_SESSION['userid'] . '",dateAdded="' . $dateAdded . '",currencyId="' . $rescurr['id'] . '",serviceid="' . $counthotel['id'] . '",tarifType="' . $tarifType . '",paxType="' . $paxType . '",seasonType="' . $seasonType . '",singleoccupancy="' . $single . '",doubleoccupancy="' . $double . '",extraBed="' . $extraBedA . '",childwithbed="' . $childwithbed . '",childwithoutbed="' . $childwithoutbed . '",breakfast="' . $breakfastA . '",lunch="' . $lunchA . '",dinner="' . $dinnerA . '",childBreakfast="' . $breakfastC . '",childLunch="' . $lunchC . '",childDinner="' . $dinnerC . '",roomGST="' . $roomGST . '",mealGST="' . $mealGST . '",roomTAC="' . $roomTAC . '",remarks="' . $remarks . '",marketType="' . $marketTypeId . '",seasonYear="'.$seasonYear.'"';

												addlisting(_DMC_ROOM_TARIFF_MASTER_, $namevalue);
												$lineSuccess++;

											}
											else {
												//get id for update
												$rateresult = mysqli_fetch_array($tarif);
												//updated
											 	$namevaluaaae = 'suppBookCode="' . $suppBookCode . '",singleoccupancy="' . $single . '",doubleoccupancy="' . $double . '",extraBed="' . $extraBedA . '",childwithbed="' . $childwithbed . '",childwithoutbed="' . $childwithoutbed . '",breakfast="' . $breakfastA . '",lunch="' . $lunchA . '",dinner="' . $dinnerA . '",childBreakfast="' . $breakfastC . '",childLunch="' . $lunchC . '",childDinner="' . $dinnerC . '",roomGST="' . $roomGST . '",mealGST="' . $mealGST . '",roomTAC="' . $roomTAC . '",remarks="' . $remarks . '"';
												
												updatelisting(_DMC_ROOM_TARIFF_MASTER_, $namevaluaaae, 'id="' . $rateresult['id'] . '"');
												$lineExist++;
												$msg = '';
												$msg = 'Row No-' . $rowno . '. Updated: Record is updated...! - ' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);

											}
											}
										}
										if($errorFlag == 0){

											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Failed: Invalid Date Range('.trim($fromDates).'-'.trim($toDates).') Please Check Season Master  - ' . date('d-m-Y h:ia');
											errorlog($msg, $newfilez);
											$lineFailed++;

										}

									}

								}
								else {
									/*==============================================Add=====================================================*/
									$rsd = GetPageRecord('*', _DESTINATION_MASTER_, 'id="' . $destId . '"');
									$editresultd = mysqli_fetch_array($rscnt);

									$addid = '';
									$rsroom = GetPageRecord('*', _ROOM_TYPE_MASTER_, 'name="' . trim($roomType) . '"');
									$roomTypeId = mysqli_fetch_array($rsroom);
									
									// Monument Code genrated 
									$A = GetPageRecord('displayId',_PACKAGE_BUILDER_HOTEL_MASTER_,'displayId>0 order by displayId desc');
									$ddata = mysqli_fetch_assoc($A);
									$displayId = $ddata['displayId']+1;

									$namevalue = 'displayId="' . $displayId . '",hotelName="' . addslashes($hotelName) . '",contactPerson="' . addslashes($contactPerson) . '",supplierPhone="' . $supplierPhone . '",roomType="' . $roomTypeId['id'] . '",supplierEmail="' . $supplierEmail . '",hotelCountry="' . $hotelCountry . '",hotelCity="' . addslashes($hotelDestination) . '",hotelAddress="' . cleanNonAsciiCharactersInString($hotelAddress) . '",hotelCategoryId="' . $hotelCategoryId. '",hotelTypeId="' . $hotelTypeId. '",gstn="' . $gstn . '",url="' . $url . '",status="1",hotelChain="' . $hotelChainId . '",policy="' . addslashes($hotelpolicy) . '",hoteldetail="' . addslashes($hoteldetail) . '",termAndCondition="' . addslashes($hoteltermandcondition) . '",weekendDays="' . $weekendId . '"';
									$addid = addlistinggetlastid(_PACKAGE_BUILDER_HOTEL_MASTER_, $namevalue);

									$chkscp = checkduplicate('hotelContactPersonMaster', ' email="' . $supplierEmail . '" and primaryvalue=1');
									if ($chkscp == 'no')
									{
										$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $addid . '",designation="' . $designation . '",phone="' . $supplierPhone . '",email="' . $supplierEmail . '",primaryvalue="1",division="' . $division . '"';
										addlisting('hotelContactPersonMaster', $scpmn);

										$rs1 = "";
										
										$rs1 = GetPageRecord('*', _ADDRESS_MASTER_, ' addressParent="' . $addid . '" and addressType="hotel"');
										if (mysqli_num_rows($rs1) > 0)
										{
											$addrData = mysqli_fetch_array($rs1);
											$namevalue = 'countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1';
											updatelisting(_ADDRESS_MASTER_, $namevalue, "id='" . $addrData['id'] . "'");

										}
										else
										{
											$namevalue = 'addressParent="' . $addid . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="hotel"';
											addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);

										}
									}
									else {
										if (mysqli_num_rows(GetPageRecord('*', 'hotelContactPersonMaster', 'email="' . trim($supplierEmail) . '" and corporateId="' . $addid . '" and division!=3')) > 0 && $division != 3 ){
											$namevalue = 'contactPerson="' . $contactPerson . '",corporateId="' . $addid . '",designation="' . $designation . '",phone="' . $supplierPhone . '",email="' . $supplierEmail . '",primaryvalue="1",division="' . $division . '"';
												updatelisting('hotelContactPersonMaster', $namevalue, 'email="' . trim($supplierEmail) . '" and corporateId="' . $addid . '"');

											$rs1 = "";
											$rs1 = GetPageRecord('*', _ADDRESS_MASTER_, ' addressParent="' . $addid . '" and addressType="hotel"');
											if (mysqli_num_rows($rs1) > 0)
											{
												$addrData = mysqli_fetch_array($rs1);
												$namevalue = 'countryId="'. $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="'.$hotelAddress.'",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1';
												updatelisting(_ADDRESS_MASTER_, $namevalue, "id='" . $addrData['id'] . "'");

											}
											else
											{
												$namevalue = 'addressParent="' . $addid . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="hotel"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);

											}
										}
										else {
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Warning: Hotel Contact Person email is already exist. - ' . date('d-m-Y h:ia');
											// errorlog($msg, $newfilez);
										}

									}
									 
									
									if ($IsSupplier == 0 && strlen($supplierName) > 0)
									{
										$issup = "";
										$issup = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($supplierName) . '"');
										if (mysqli_num_rows($issup) > 0)
										{
											$issup1 = "";
											$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($supplierName) . '" and find_in_set("' . $destId . '",destinationId) ');
											if (mysqli_num_rows($issup1) > 0)
											{
												$lastIdData = mysqli_fetch_array($issup1);
												$lastId = $lastIdData['id'];
											}
											else
											{
												$msg = $lastId = '';
												$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($supplierName) . ') is not register for destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);
												$lineFailed++;
											}
										}
										else
										{
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Failed: Supplier( ' . trim($supplierName) . ' ) does not exist - ' . date('d-m-Y h:ia');
											errorlog($msg, $newfilez);
											$lineFailed++;
										}
									}
									elseif($IsSupplier == 1){
									
										$issup0 = "";
										$issup0 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" ');
										if (mysqli_num_rows($issup0) > 0)
										{
											//name exist
											$issup2 = "";
											$issup2 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" and id in ( select corporateId from suppliercontactPersonMaster where email="' . encode($supplierEmail) . '" )');
											if (mysqli_num_rows($issup2) > 0)
											{
												//name & email exist
												$issup1 = "";
												$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" and id in ( select corporateId from suppliercontactPersonMaster where email="' . encode($supplierEmail) . '" ) and find_in_set("' . $destId . '",destinationId) ');
												if (mysqli_num_rows($issup1) > 0)
												{
													//name & email & city exist true
													$lastIdData = mysqli_fetch_array($issup1);
													$lastId = $lastIdData['id'];
												}
												else
												{
													$msg = $lastId = '';
													$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
													errorlog($msg, $newfilez);
													$lineFailed++;
												}
											} 
											else {
												 
												//add supp
												$chkscp = checkduplicate('suppliercontactPersonMaster', ' email="' . encode($supplierEmail) . '" and corporateId>0 and primaryvalue=1 and division=3');				
												if($chkscp == 'yes' && $division != 3 ) {
													//update supplier to hotel
													$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
		
													//name & email exist
													$issup1 = "";
													$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" and find_in_set("' . $destId . '",destinationId) ');
													if (mysqli_num_rows($issup1) > 0)
													{
														//name & email & city exist true
														$lastIdData = mysqli_fetch_array($issup1);
														$lastId = $lastIdData['id'];
														$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
														addlisting('suppliercontactPersonMaster', $scpmn);

													}
													else {
														$msg = $lastId = '';
														$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for  the destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
														errorlog($msg, $newfilez);
														$lineFailed++;
													}
												} 
												else if($chkscp == 'no' ){
													deleteRecord('suppliercontactPersonMaster','  email="' . encode($supplierEmail) . '" and corporateId=0 and primaryvalue=1');
													//update supplier to hotel
													$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
														
													//name & email exist
													$issup1 = "";
													$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" and find_in_set("' . $destId . '",destinationId) ');
													if (mysqli_num_rows($issup1) > 0)
													{
														//name & email & city exist true
														$lastIdData = mysqli_fetch_array($issup1);
														$lastId = $lastIdData['id'];

														$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
														addlisting('suppliercontactPersonMaster', $scpmn);


													}
													else {
														$msg = $lastId = '';
														$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for  the destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
														errorlog($msg, $newfilez);
														$lineFailed++;
													}
												}
												else{
													$msg = $lastId = '';
													$msg = 'Row No-' . $rowno . '. Failed: Email is already exist ' . date('d-m-Y h:ia');
													errorlog($msg, $newfilez);
													$lineFailed++;
												}
												 
											}
										}
										else {
											//add supp 
											$chkscp = checkduplicate('suppliercontactPersonMaster', ' email="' . encode($supplierEmail) . '" and primaryvalue=1 and division=3');
											if($chkscp == 'yes' && $division != 3 ) {
												
												$namevalue = 'name="' . trim($hotelName) . '",aliasname="'.trim($hotelName).'",contactPerson="' . $contactPerson . '",addedBy=' . $_SESSION['userid'] . ',dateAdded=' . $dateAdded . ',companyTypeId=1,supplierMainType=' . $supplierType2 . ',paymentTerm=1,agreement=0,destinationId="' . $destId . '"';
												$lastId = addlistinggetlastid(_SUPPLIERS_MASTER_, $namevalue);
												//update supplier to hotel
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');

												$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
												addlisting('suppliercontactPersonMaster', $scpmn);

												$namevalue = 'addressParent="' . $lastId . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="supplier"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
												
											} else if($chkscp == 'no' ){
												$namevalue = 'name="' . trim($hotelName) . '",aliasname="'.trim($hotelName).'",contactPerson="' . $contactPerson . '",addedBy=' . $_SESSION['userid'] . ',dateAdded=' . $dateAdded . ',companyTypeId=1,supplierMainType=' . $supplierType2 . ',paymentTerm=1,agreement=0,destinationId="' . $destId . '"';
												$lastId = addlistinggetlastid(_SUPPLIERS_MASTER_, $namevalue);
												//update supplier to hotel
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');

												$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
												addlisting('suppliercontactPersonMaster', $scpmn);

												$namevalue = 'addressParent="' . $lastId . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="supplier"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
											}else{
												$msg = $lastId = '';
												$msg = 'Row No-' . $rowno . '. Failed: Email is already exist ' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);
												$lineFailed++;
											}
											
										}
									}
									else{
										$msg = $lastId = '';
										$msg = 'Row No-' . $rowno . '. Failed: Invalid supplier details - ' . date('d-m-Y h:ia');
										errorlog($msg, $newfilez);
										$lineFailed++;
									}

									if ($lastId != '' && $lastId > 0){
										//-----------------------Add Mobile---------
										$phone = $supplierPhone;
										$type = 1;
										$phoneprimary = 1;
										if ($phone != ''){
											$allvaluephone = 'phoneNo="' . $phone . '",phoneType="' . $type . '",primaryvalue="' . $phoneprimary . '",sectionType="suppliers", masterId="' . $lastId . '"';
											$add = addlisting(_PHONE_MASTER_, $allvaluephone);
										}
										//-----------------------Add Email---------------------------
										$email = $supplierEmail;
										$type = 1;
										$primaryvalue = 1;
										if($email != ''){
											$allvaluephone = 'email="' . $email . '",emailType="' . $type . '",primaryvalue="' . $primaryvalue . '",sectionType="suppliers",masterId="' . $lastId . '"';
											$add = addlisting(_EMAIL_MASTER_, $allvaluephone);
										}
										$rs1 = GetPageRecord('*', _PACKAGE_BUILDER_HOTEL_MASTER_, 'id="' . $addid . '"');
										$reshotelname = mysqli_fetch_array($rs1);
										$rs1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'id="' . $lastId . '"');
										$editresult = mysqli_fetch_array($rs1);
										$rsc = GetPageRecord('*', _QUERY_CURRENCY_MASTER_, 'name="' . $currency . '"');
										$rescurr = mysqli_fetch_array($rsc);
										$rsr = GetPageRecord('*', _ROOM_TYPE_MASTER_, 'name="' . $roomType . '"');
										$roomTypeId = mysqli_fetch_array($rsr);
										$rsm = GetPageRecord('*', _MEAL_PLAN_MASTER_, 'name="' . $mealPlan . '"');
										$mealPlanId = mysqli_fetch_array($rsm);

										if($errorFlag==1){ 
											foreach ($dataSet as $seasonSet2) {

												$seasonResult = explode(',', $seasonSet2);

												$SID_a=explode('=',$seasonResult[0]);
												$seasonType=$SID_a[1];

												$SFD_a=explode('=',$seasonResult[1]);
												$newFromDate=$SFD_a[1];

												$STD_a=explode('=',$seasonResult[2]);
												$newToDate=$STD_a[1];

												$namevalue = 'suppBookCode="' . $suppBookCode . '",supplierId="' . $lastId . '",fromDate="' . $newFromDate . '",toDate="' . $newToDate . '",sfromDate="' . $newFromDate . '",stoDate="' . $newToDate . '",roomType="' . $roomTypeId['id'] . '",mealPlan="' . $mealPlanId['id'] . '",status=1,addBy="' . $_SESSION['userid'] . '",dateAdded="' . $dateAdded . '",currencyId="' . $rescurr['id'] . '",serviceid="' . $reshotelname['id'] . '",tarifType="' . $tarifType . '",paxType="' . $paxType . '",seasonType="' . $seasonType . '",singleoccupancy="' . $single . '",doubleoccupancy="' . $double . '",extraBed="' . $extraBedA . '",childwithbed="' . $childwithbed . '",childwithoutbed="' . $childwithoutbed . '",breakfast="' . $breakfastA . '",lunch="' . $lunchA . '",dinner="' . $dinnerA . '",childBreakfast="' . $breakfastC . '",childLunch="' . $lunchC . '",childDinner="' . $dinnerC . '",roomGST="' . $roomGST . '",mealGST="' . $mealGST . '",roomTAC="' . $roomTAC . '",remarks="' . $remarks . '",marketType="' . $marketTypeId . '",seasonYear="'.$seasonYear.'"';
												addlisting(_DMC_ROOM_TARIFF_MASTER_, $namevalue);
												$lineSuccess++;
											}

										}
										if($errorFlag==0){
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Failed: Invalid Date Ranage Please Check Season Master - ' . date('d-m-Y h:ia');
											errorlog($msg, $newfilez);
											$lineFailed++;	
										}

									}
									else
									{
										//$msg='';
										//$msg='Row No-'.$rowno.'. Something went wronge with supplier! - '.date('d-m-Y h:ia');
										//errorlog($msg,$newfilez);
										//$lineFailed++;
										
									}
								}
							} else {
								$showErrorName .= 'Hotel roomtType does not exist';
								$errorReport .= '<div>' . $line . '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' . $showErrorName . '&nbsp;&nbsp;&nbsp;' . $isroomType . $roomType . '</div>';
								$msg = '';
								$msg = 'Row No-' . $rowno . '. Failed: Room Type does not exist.! - ' . date('d-m-Y h:ia');
								errorlog($msg, $newfilez);
								$lineFailed++;
							}
	                    }
	                }
	                else
	                {

	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Failed: Invalid duration from ' . date('d-m-Y', strtotime($fromDates)) . ' to ' . date('d-m-Y', strtotime($toDates));
	                    errorlog($msg, $newfilez);
	                    $lineFailed++;

	                }
	                
	            }
	            //else{ $lineFailed++; }
	            
	        }
   		}else{
   			// INTERNATIONAL FORMAT
	        for ($x = 2;$x <= count($data->sheets[0]["cells"]);$x++){
	            ++$rowno;
	            ++$line; ///// COUNT LINE -------------------------------------
	            // echo "<pre>";
	            // print_r($data->sheets[0]["cells"][$x]);
	            // exit;
				$showErrorName = '';
	            $showErrorType = '';
	            
				$hotelName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
				$hotelDestination = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
				$SelfSupplier = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
				$supplierName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]);
				$paymentTerm = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][5]);
				$hotelCountry = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][6]);
				$hotelState = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][7]);
				$hotelCity = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][8]);
				$hotelAddress = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][9]);
				$pinCode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][10]);
				$gstn = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][11]);
				$divisionName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][12]);
				$contactPerson = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][13]);
				$designation = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][14]);
				$supplierPhone = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][15]);
				$supplierEmail2 = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][16]);
				$supplierEmailA = explode(',', $supplierEmail2);
				$supplierEmail = $supplierEmailA[0];
				          
				$marketTypename = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][17]);
				$paxTypeN = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][18]);
				$tarifTypeN = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][19]);
				$seasonTypeN = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][20]);

				$roomType = trim(cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][21]));
				$mealPlan = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][22]);
				$fromDates = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][23]);
				$toDates = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][24]);

				$fromDates = date("Y-m-d", strtotime($fromDates));
				$toDates = date("Y-m-d", strtotime($toDates));
				$currency = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][25]);
				$single = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][26]);
				$double = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][27]);
				$extraBedA = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][28]);
				$childwithbed = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][29]);
				$childwithoutbed = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][30]);

				$quadRoom = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][31]);
				$teenBed = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][32]);
				$sixBed = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][33]);
				$eightBed = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][34]);
				$tenBed = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][35]);

				$breakfastA = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][36]);
				$lunchA = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][37]);
				$dinnerA = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][38]);
				$breakfastC = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][39]);
				$lunchC = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][40]);
				$dinnerC = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][41]);

				$roomGST = getGstIdBySlab(cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][42]), "Hotel");
				$mealGST = getGstIdBySlab(cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][43]), "Restaurant");
				$roomTAC = preg_replace('/[^A-Za-z0-9\-]/', '', cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][44]));
				$remarks = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][45]);
				$hotelType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][46]);
				$hotelCategory = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][47]);
				$url = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][48]);
				$hotelChain = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][49]);
				$weekendName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][50]);
				$hoteldetail = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][51]);
				$hotelpolicy = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][52]);
				$hoteltermandcondition = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][53]);
	            $suppBookCode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][54]);
	            
	            $rsRateDateList = ""; 
			    $minDate = GetPageRecord('min(fromDate) as fromDate','seasonMaster','seasonNameId!="0" and deletestatus=0  ');
			    $minFromDate = mysqli_fetch_array($minDate);
			    $minfromd = $minFromDate['fromDate'];  
			   
			    $maxDate = GetPageRecord('max(toDate) as toDate','seasonMaster','seasonNameId!="0" and deletestatus=0  ');
			    $maxToDate = mysqli_fetch_array($maxDate);
			    $maxtod = $maxToDate['toDate']; 
			   
			    if($fromDates>=$minfromd && $toDates<=$maxtod){
				  $errorFlag = 0;
				  $sn1 = "";
				  $sn1 = GetPageRecord('*','seasonMaster','seasonNameId!="0" and deletestatus=0 order by fromDate,toDate');
				  while($seasonResult = mysqli_fetch_array($sn1)){ 
					
				 	$seasonFromDate = $seasonResult['fromDate'];
					$seasonToDate = $seasonResult['toDate'];
					$seasonId = $seasonResult['seasonNameId']; 

					if($fromDates>=$seasonFromDate && $toDates<=$seasonToDate){  // 1
					  $rsRateDateList.="SID=".$seasonId.",SFD=".$fromDates.",STD=".$toDates.'~';
					  $errorFlag = 1;
					}elseif($fromDates>=$seasonFromDate && $fromDates<=$seasonToDate && $toDates>$seasonToDate){ // 2
					  $rsRateDateList.="SID=".$seasonId.",SFD=".$fromDates.",STD=".$seasonToDate.'~';  
					  $errorFlag = 1; 
					}elseif($fromDates<=$seasonFromDate && $toDates>=$seasonToDate){ // 3
					  $rsRateDateList.="SID=".$seasonId.",SFD=".$seasonFromDate.",STD=".$seasonToDate.'~';
					  $errorFlag = 1;
					}elseif($fromDates<$seasonFromDate && $toDates>=$seasonFromDate && $toDates<=$seasonToDate){ // 4
					  $rsRateDateList.="SID=".$seasonId.",SFD=".$seasonFromDate.",STD=".$toDates.'~';
					  $errorFlag = 1;
					}else{ 
					  $rsRateDateList.='';
					} 
				  }
				}else{
					$errorFlag=0;
				}   
				
	            
				if ($hotelName != '' && $hotelDestination != '' && $hotelCategory!='')
	            {
					 
					$seasonSet = rtrim($rsRateDateList,"~");
					$dataSet = explode ("~",$seasonSet); 
				
					$supplierType2 = 2;
					$marketTypeId=1;
					// echo 'UPPER(name)="'.trim(strtoupper($marketTypename)).'" order by name asc';
					$rsMkt = GetPageRecord('id','marketMaster',' UPPER(name)="'.trim(strtoupper($marketTypename)).'" order by name asc');
					{
						$resMarkt = mysqli_fetch_array($rsMkt);
						$marketTypeId = $resMarkt['id'];
					}   

					$hotelCategoryQuery = GetPageRecord('id',_HOTEL_CATEGORY_MASTER_,'UPPER(uploadKeyword)="'.trim(strtoupper($hotelCategory)).'"');
					if (mysqli_num_rows($hotelCategoryQuery) > 0)
					{
						$hotelCategoryD = mysqli_fetch_array($hotelCategoryQuery);
						$hotelCategoryId = $hotelCategoryD['id'];
					} else{
						$hotelCategoryId=0;
					}
					
					$hotelTypeQuery = GetPageRecord('id',_HOTEL_TYPE_MASTER_,' UPPER(uploadKeyword)="'.trim(strtoupper($hotelType)).'"');
					if (mysqli_num_rows($hotelTypeQuery) > 0)
					{
						$hotelTypeD = mysqli_fetch_array($hotelTypeQuery);
						$hotelTypeId = $hotelTypeD['id'];
					} else{
						$hotelTypeId=0;
						$msg = '';
						$msg = 'Row No-' . $rowno . '. Warning: Hotel Type Keyword does not exists...! - ' . date('d-m-Y h:ia');
						errorlog($msg, $newfilez); 
					}
					
					
				
	                $rsdivis = "";
	                $rsdivis = GetPageRecord('*','divisionMaster',' UPPER(name)="'.trim(strtoupper($divisionName)).'"');
	                if (mysqli_num_rows($rsdivis) < 1)
	                {
	                    $division = '2';
	                }else{
	                    $divisionD = mysqli_fetch_array($rsdivis);
	                    $division = $divisionD['id'];
	                }

	                $rscnt = '';
	                $rscnt = GetPageRecord('*',_DESTINATION_MASTER_,' UPPER(name)="'.trim(strtoupper($hotelDestination)).'"');
	                if (mysqli_num_rows($rscnt) < 1)
	                {
	                    $hotelDestination = '';
						$destId = 0;
						$msg = '';
	                    $msg = 'Row No-' . $rowno . '. Error: Destination does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                }else{
	                    $editresultds = mysqli_fetch_array($rscnt);
	                    $destId = $editresultds['id'];
	                    $hotelDestination = trim($editresultds['name']);
	                }

	                $rscnt = '';
	                $rscnt = GetPageRecord('*',_COUNTRY_MASTER_,' UPPER(name)="'.trim(strtoupper($hotelCountry)).'"');
	                if (mysqli_num_rows($rscnt) < 1)
	                {
	                    $hotelCountry = '';
	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: Country does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                }
	                else
	                {
	                    $countryData = mysqli_fetch_array($rscnt);
	                    $countryId = $countryData['id'];
	                    $hotelCountry = trim($countryData['name']);
	                }

	                $rscnt = '';
	                $rscnt = GetPageRecord('*', _STATE_MASTER_, 'UPPER(name)="'.trim(strtoupper($hotelState)).'"');
	                if (mysqli_num_rows($rscnt) < 1)
	                {
	                    $hotelState = '';
	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: State does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                } else {
	                    $stateData = mysqli_fetch_array($rscnt);
	                    $stateId = $stateData['id'];
	                    $hotelState = trim($stateData['name']);
	                }

	                $rscnt = '';
	                $rscnt = GetPageRecord('*',_CITY_MASTER_,'UPPER(name)="'.trim(strtoupper($hotelCity)).'"');
	                if (mysqli_num_rows($rscnt) < 1)
	                {
	                    $hotelCity = '';
	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: City does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                } else {
	                    $cityData = mysqli_fetch_array($rscnt);
	                    $cityId = $cityData['id'];
	                    $hotelCity = trim($cityData['name']);
	                }

					

	                $mealse = GetPageRecord('*', _MEAL_PLAN_MASTER_,'UPPER(name)="'.trim(strtoupper($mealPlan)).'"');
	                if (mysqli_num_rows($mealse) < 1)
	                {
	                    addlistinggetlastid(_MEAL_PLAN_MASTER_, 'name="'.trim($mealPlan). '",dateAdded="' . time() . '",addedBy="' . $_SESSION['userid'] . '"');
	                    $msg = '';
	                }
	 
	                $seasonYear = date('Y', strtotime($fromDates));

	                $rswkn = "";
	                $rswkn = GetPageRecord('id', 'weekendMaster', 'UPPER(name)="'.trim(strtoupper($weekendName)).'"');
	                if (mysqli_num_rows($rswkn) > 0)
	                {
	                    $resweekend = mysqli_fetch_array($rswkn);
	                    $weekendId = stripslashes($resweekend['id']);
	                    $weekendId2 = $resweekend['id'];
	                }
	                if (mysqli_num_rows($rswkn) == 0 && strlen($weekendName) > 0)
	                {
	                    $weekendId = 0;
	                    $weekendId2 = 0;

	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: Invalid Weekend name...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                }

	                $rschain = "";
	                $rschain = GetPageRecord('*', 'chainhotelmaster','UPPER(name)="'.trim(strtoupper($hotelChain)).'"');
	                if (mysqli_num_rows($rschain) > 0)
	                {
	                    $resChain = mysqli_fetch_array($rschain);
	                    $hotelChainId = stripslashes($resChain['id']);
	                }

	                if (mysqli_num_rows($rschain) == 0 && strlen($hotelChain) > 0)
	                {
	                    $rschain = GetPageRecord('*','chainhotelmaster','name="None"');
	                    $resChain = mysqli_fetch_array($rschain);
	                    $hotelChainId = stripslashes($resChain['id']);
	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Warning: Hotel Chain does not exits...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);
	                }
	                if (strtoupper($tarifTypeN) == strtoupper("Supplement")){
	                    $tarifType = 4;
	                }
	                else if (strtoupper($tarifTypeN) == strtoupper("Special Days")){
	                    $tarifType = 3;
	                }
	                else if (strtoupper($tarifTypeN) == strtoupper("Weekend")){
	                    $tarifType = 2;
	                }
	                else{
	                    $tarifType = 1;
	                }

	                if (strtoupper($paxTypeN) == strtoupper("FIT")){
	                    $paxType = 2;
	                }
	                else if (strtoupper($paxTypeN) == strtoupper("GIT")){
	                    $paxType = 1;
	                }
	                else{
	                    $paxType = 2;
	                }


					if (strtoupper($SelfSupplier) == 'YES' || strtoupper($SelfSupplier) == 'SELF')
					{
						$IsSupplier = 1;
						$supplierN = $hotelName;
					}
					else
					{
						$IsSupplier = 0;
						$supplierN = $supplierName;
					}
					// echo $supplierN.' - '.$IsSupplier.' - '.$supplierEmail.' | ';
	                $dateAdded = date('Y-m-d');
	                $lastId = $checkId = 0;

		            $rscnt2 = '';
		            $rscnt2 = GetPageRecord('*',_DESTINATION_MASTER_,' UPPER(name)="'.trim(strtoupper($hotelDestination)).'"');

	                if (date('Y-m-d', strtotime($toDates)) >= date('Y-m-d', strtotime($fromDates))) {

	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Info: Hotel Email['.$supplierEmail.'] is not valid...! - ' . date('d-m-Y h:ia');
	                    errorlog($msg, $newfilez);


	                	// || date('Y', strtotime($fromDates)) < date('Y') || date('Y', strtotime($toDates)) < date('Y') 
	                    if ($hotelCountry == '' || $supplierEmail == '' || $hotelCategoryId == 0 || $marketTypeId == 0 || $roomGST == ''  || $mealGST == '' || $roomType == '' || mysqli_num_rows($rscnt2) < 1) {

				            if (mysqli_num_rows($rscnt2) < 1) {
	                            $showErrorName .= 'Hotel Destination,';
								$msg = '';
				                $msg = 'Row No-' . $rowno . '. Failed: Destination does not exits...! - ' . date('d-m-Y h:ia');
				                errorlog($msg, $newfilez);
				            }


							if ($roomGST == '') {
	                            $showErrorName .= 'Room GST,';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Room GST is not valid...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
							if ($mealGST == '') {
	                            $showErrorName .= 'Meal GST,';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Meal GST is not valid...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
	                        if ($supplierEmail == '') {
	                            $showErrorName .= 'Hotel Email,';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Hotel Email is not valid...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
							if ($hotelCategoryId == 0) {
								$showErrorName .= 'Hotel category keyword, ';
								$msg = '';
								$msg = 'Row No-' . $rowno . '.  Failed: Hotel Category keyword does not exist...! - ' . date('d-m-Y h:ia');
								errorlog($msg, $newfilez);
	                        }
							if ($marketTypeId == 0) {
								$showErrorName .= ' Market Type, ';
								$msg = '';
								$msg = 'Row No-' . $rowno . '.  Failed: Market Type does not exist...! - ' . date('d-m-Y h:ia');
								errorlog($msg, $newfilez);
	                        }
	                        if ($hotelCountry == '') {
	                            $showErrorType .= 'Hotel Country,';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Hotel Country does not exist...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
	                        if ($hotelDestination == '') {
	                            $showErrorType .= 'Hotel Destination';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Hotel Destination does not exist...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
	                        if ($roomType == '') {
	                            $showErrorType .= 'Room Type';
	                            $msg = '';
	                            $msg = 'Row No-' . $rowno . '. Failed: Room Type does not exist...! - ' . date('d-m-Y h:ia');
	                            errorlog($msg, $newfilez);
	                        }
	                        // if (date('Y', strtotime($fromDates)) < date('Y'))
	                        // {
	                        //     $showErrorType .= ' From Date ( ' . $fromDates . ' ) ';
	                        //     $msg = '';
	                        //     $msg = 'Row No-' . $rowno . '. Failed: Invalid from date of previous year...! - ' . date('d-m-Y h:ia');
	                        //     errorlog($msg, $newfilez);

	                        // }
	                        // if (date('Y', strtotime($toDates)) < date('Y'))
	                        // {
	                        //     $showErrorType .= ' To Date( ' . $toDates . ' ) ';

	                        //     $msg = '';
	                        //     $msg = 'Row No-' . $rowno . '. Failed: Invalid to date of previous year...! - ' . date('d-m-Y h:ia');
	                        //     errorlog($msg, $newfilez);
	                        // }
	                        $errorReport .= '<div>' . $line . '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error in&nbsp;' . $showErrorName . '&nbsp;&nbsp;&nbsp;' . $showErrorType . '</div>';

	                        $errorCount++;
	                        $lineFailed++;
	                    }
	                    else{
							$hotelrs1 = GetPageRecord('*',_ROOM_TYPE_MASTER_,'UPPER(name)="'.trim(strtoupper($roomType)).'"');
							$isroomType = mysqli_num_rows($hotelrs1);
							if ($isroomType > 0) {
								$checkhotelEx = GetPageRecord('*', _PACKAGE_BUILDER_HOTEL_MASTER_, 'UPPER(hotelName)="'.trim(strtoupper($hotelName)).'" and UPPER(hotelCity)="'.trim(strtoupper($hotelDestination)).'"');
								$hotelfetch = mysqli_fetch_array($checkhotelEx);
								if (mysqli_num_rows($checkhotelEx) > 0) {
									/*==============================================EDIT=====================================================*/
									$rs2 = "";
									$rs2 = GetPageRecord('*',_PACKAGE_BUILDER_HOTEL_MASTER_,'UPPER(hotelName)="'.trim(strtoupper($hotelName)).'" and UPPER(hotelCity)="'.trim(strtoupper($hotelDestination)).'"');
									$counthotel = mysqli_fetch_array($rs2);
									$hotelroomType = $counthotel['roomType'];
									$rsroom = "";
									$rsroom = GetPageRecord('*',_ROOM_TYPE_MASTER_,'UPPER(name)="'.trim(strtoupper($roomType)).'"');
									$roomTypeId = mysqli_fetch_array($rsroom);
									$rsrh = GetPageRecord('*', _PACKAGE_BUILDER_HOTEL_MASTER_, ' 1 and FIND_IN_SET("' . $roomTypeId['id'] . '", roomType) and id="' . $counthotel['id'] . '"');
									$isexistshotel = mysqli_num_rows($rsrh);
									if ($isexistshotel == 0)
									{
										$rooms1 = $hotelroomType . ',' . $roomTypeId['id'];
										$rooms = ltrim(trim($rooms1) , ",");
									}
									else
									{
										$rooms = ltrim(trim($hotelroomType) , ",");
									}
									$namevalue = 'hotelName="' . $hotelName . '",contactPerson="' . $contactPerson . '",supplierPhone="' . $supplierPhone . '",roomType="' . $rooms . '",supplierEmail="' . $supplierEmail . '",hotelCountry="' . $hotelCountry . '",hotelCity="' . $hotelDestination . '",hotelAddress="' . $hotelAddress . '",hotelCategoryId="' . $hotelCategoryId. '",hotelTypeId="' . $hotelTypeId. '",gstn="' . $gstn . '",url="' . $url . '",status="1",hotelChain="' . $hotelChainId . '",supplier="' . $IsSupplier . '",policy="' . $hotelpolicy . '",hoteldetail="' . $hoteldetail . '",termAndCondition="' . $hoteltermandcondition . '",weekendDays="' . $weekendId2 . '"';
									updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, $namevalue, 'id="' . $hotelfetch['id'] . '"');

									$chkscp = checkduplicate('hotelContactPersonMaster', ' email="' . $supplierEmail . '"');
									if ($chkscp == 'no')
									{
										$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $hotelfetch['id'] . '",designation="' . $designation . '",phone="' . $supplierPhone . '",email="' . $supplierEmail . '",primaryvalue="1",division="' . $division . '"';
										
										addlisting('hotelContactPersonMaster', $scpmn);

										 
										$rs1 = "";
										$rs1 = GetPageRecord('*', _ADDRESS_MASTER_, ' addressParent="' . $hotelfetch['id'] . '" and addressType="hotel"');
										if (mysqli_num_rows($rs1) > 0)
										{
											$addrData = mysqli_fetch_array($rs1);
											$namevalue = 'countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1';
											updatelisting(_ADDRESS_MASTER_, $namevalue, "id='" . $addrData['id'] . "'");
										}
										else
										{
											$namevalue = 'addressParent="' . $hotelfetch['id'] . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="hotel"';
											addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);

										}
									}
									else
									{
										if (mysqli_num_rows(GetPageRecord('*', 'hotelContactPersonMaster', 'email="' . trim($supplierEmail) . '" and corporateId="' . $hotelfetch['id'] . '" and division!=3')) > 0  && $division != 3 )
										{
											$namevalue = 'contactPerson="' . $contactPerson . '",corporateId="' . $hotelfetch['id'] . '",designation="' . $designation . '",phone="' . $supplierPhone . '",email="' . $supplierEmail . '",primaryvalue="1",division="' . $division . '"';
											updatelisting('hotelContactPersonMaster', $namevalue, 'email="' . trim($supplierEmail) . '" and corporateId="' . $hotelfetch['id'] . '"');
											$rs1 = "";
											$rs1 = GetPageRecord('*', _ADDRESS_MASTER_, ' addressParent="' . $hotelfetch['id'] . '" and addressType="hotel"');
											if (mysqli_num_rows($rs1) > 0)
											{
												$addrData = mysqli_fetch_array($rs1);
												$namevalue = 'countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1';
												updatelisting(_ADDRESS_MASTER_, $namevalue, "id='" . $addrData['id'] . "'");
											}
											else
											{
												$namevalue = 'addressParent="' . $hotelfetch['id'] . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="hotel"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
											}
										}
										else
										{
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Warning: Hotel Contact Person email is already exist. - ' . date('d-m-Y h:ia');
											// errorlog($msg, $newfilez);
										}
									}

									if (strlen($supplierName) > 0 && $IsSupplier == 0) {
										$issup = "";
										$issup = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($supplierName) . '"');
										if (mysqli_num_rows($issup) > 0)
										{
											$issup1 = "";
											$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($supplierName) . '" and find_in_set("' . $destId . '",destinationId) ');
											if (mysqli_num_rows($issup1) > 0)
											{
												$lastIdData = mysqli_fetch_array($issup1);
												$lastId = $lastIdData['id'];
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, 'supplierId="' . $lastId . '"', 'id="' . $addid . '"');

											}
											else
											{
												$msg = $lastId = '';
												$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($supplierName) . ') is not register for destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);
												$lineFailed++;
											}
										}
										else
										{
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Failed: Supplier( ' . trim($supplierName) . ' ) does not exist - ' . date('d-m-Y h:ia');
											errorlog($msg, $newfilez);
											$lineFailed++;
										}
										$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, 'supplier="' . $IsSupplier . '",supplierId="' . $lastId . '"', 'id="' . $hotelfetch['id'] . '"');
									}
									elseif ($IsSupplier == 1) { 
										$issup0 = ""; 
										$issup0 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'UPPER(name)="'.trim(strtoupper($hotelName)).'"');
										if (mysqli_num_rows($issup0) > 0)
										{
	 
											//name exist
											$issup2 = "";
											$issup2 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'UPPER(name)="'.trim(strtoupper($hotelName)).'" and id in ( select corporateId from suppliercontactPersonMaster where email="' . encode($supplierEmail) . '" )');
											if (mysqli_num_rows($issup2) > 0)
											{
												//name & email exist
												$issup1 = "";
												$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="'.trim(strtoupper($hotelName)).'" and id in ( select corporateId from suppliercontactPersonMaster where email="' . encode($supplierEmail) . '" ) and find_in_set("' . $destId . '",destinationId) ');
												if (mysqli_num_rows($issup1) > 0)
												{
													//name & email & city exist true
													$lastIdData = mysqli_fetch_array($issup1);
													$lastId = $lastIdData['id'];

												}
												else
												{
													$msg = $lastId = '';
													$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
													errorlog($msg, $newfilez);
													$lineFailed++;
												}
											} else {
												
												//add supp
												$chkscp = checkduplicate('suppliercontactPersonMaster', ' email="' . encode($supplierEmail) . '" and corporateId>0 and primaryvalue=1 and division=3');				
												if($chkscp == 'yes' && $division != 3 ) {
													//update supplier to hotel
													$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
		
													//name & email exist
													$issup1 = "";

													$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="'.trim(strtoupper($hotelName)).'" and find_in_set("' . $destId . '",destinationId) ');
													if (mysqli_num_rows($issup1) > 0)
													{
														//name & email & city exist true
														$lastIdData = mysqli_fetch_array($issup1);
														$lastId = $lastIdData['id'];
														echo '1';
														$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
														addlisting('suppliercontactPersonMaster', $scpmn);

													}
													else {
														$msg = $lastId = '';
														$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for  the destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
														errorlog($msg, $newfilez);
														$lineFailed++;
													}
													
												} 
												else if($chkscp == 'no' ){
													//
													deleteRecord('suppliercontactPersonMaster','  email="' . encode($supplierEmail) . '" and corporateId=0 and primaryvalue=1');
													//update supplier to hotel
													$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
														
													//name & email exist
													$issup1 = "";
													$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="'.trim(strtoupper($hotelName)).'" and find_in_set("' . $destId . '",destinationId) ');
													if (mysqli_num_rows($issup1) > 0)
													{
														//name & email & city exist true
														$lastIdData = mysqli_fetch_array($issup1);
														$lastId = $lastIdData['id'];
														$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
														addlisting('suppliercontactPersonMaster', $scpmn);


													}
													else {
														$msg = $lastId = '';
														$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for  the destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
														errorlog($msg, $newfilez);
														$lineFailed++;
													}
												}
												else{
													$msg = $lastId = '';
													$msg = 'Row No-' . $rowno . '. Failed: Email is already exist 1 - ' . date('d-m-Y h:ia');
													errorlog($msg, $newfilez);
													$lineFailed++;
												}
												 
											}

										} else { 
											//add supp  if suppliername not exist
											$chkscp = checkduplicate('suppliercontactPersonMaster', ' email="' . encode($supplierEmail) . '"  and corporateId>0  and primaryvalue=1 and division=3');
											if ($chkscp == 'yes' && $division != 3 ) {
												
												$namevalue = 'name="' . trim($hotelName) . '",aliasname="'.trim($hotelName).'",contactPerson="' . $contactPerson . '",addedBy=' . $_SESSION['userid'] . ',dateAdded=' . $dateAdded . ',companyTypeId=1,supplierMainType=' . $supplierType2 . ',paymentTerm=1,agreement=0,destinationId="' . $destId . '"';
												$lastId = addlistinggetlastid(_SUPPLIERS_MASTER_, $namevalue);
												//update supplier to hotel
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
														
												$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
												addlisting('suppliercontactPersonMaster', $scpmn);

												$namevalue = 'addressParent="' . $lastId . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="supplier"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
												
											} 
											else if($chkscp == 'no' ){

												deleteRecord('suppliercontactPersonMaster','  email="' . encode($supplierEmail) . '" and corporateId=0 and primaryvalue=1');

												$namevalue = 'name="' . trim($hotelName) . '",aliasname="'.trim($hotelName).'",contactPerson="' . $contactPerson . '",addedBy=' . $_SESSION['userid'] . ',dateAdded=' . $dateAdded . ',companyTypeId=1,supplierMainType=' . $supplierType2 . ',paymentTerm=1,agreement=0,destinationId="' . $destId . '"';
												$lastId = addlistinggetlastid(_SUPPLIERS_MASTER_, $namevalue);
												//update supplier to hotel
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');

												$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
												addlisting('suppliercontactPersonMaster', $scpmn);

												$namevalue = 'addressParent="' . $lastId . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="supplier"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
												
											}
											else { 
												$msg = $lastId = '';
												$msg = 'Row No-' . $rowno . '. Failed: Email is already exist 2' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);
												$lineFailed++;
											} 
											
										}
									} 
									else {
										$msg = $lastId = '';
										$msg = 'Row No-' . $rowno . '. Failed: Invalid supplier details - ' . date('d-m-Y h:ia');
										errorlog($msg, $newfilez);
										$lineFailed++;
									}

									if ($lastId > 0 && $lastId != '')
									{

										$rs1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'id="' . $lastId . '"');
										$editresult = mysqli_fetch_array($rs1);
										
										$rsc = GetPageRecord('*', _QUERY_CURRENCY_MASTER_, 'name="' . $currency . '"');
										$rescurr = mysqli_fetch_array($rsc);
										
										$rsr = GetPageRecord('*', _ROOM_TYPE_MASTER_, 'name="' . $roomType . '"');
										$roomTypeId = mysqli_fetch_array($rsr);
										
										$rsrh = GetPageRecord('*', _PACKAGE_BUILDER_HOTEL_MASTER_, ' 1 and FIND_IN_SET("' . $roomTypeId['id'] . '",roomType) and status=1');
										$isexistshotel = mysqli_num_rows($rsrh);
										if ($isexistshotel == 0) {
											$rooms = $hotelroomType . ',' . $roomTypeId['id'];
											$namevalue = 'roomType="' . $rooms . '",supplierId="' . $lastId . '"';
											$where = 'id=' . $counthotel['id'] . '';
											$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, $namevalue, $where);
										}

										$rsm = GetPageRecord('*', _MEAL_PLAN_MASTER_, 'name="' . $mealPlan . '"');
										$mealPlanId = mysqli_fetch_array($rsm);
										$tarif = "";  
										if($errorFlag==1){ 
											
										

											foreach ($dataSet as $seasonSet2) {
											$seasonResult = explode(',', $seasonSet2);
											
											$SID_a=explode('=',$seasonResult[0]);
											$seasonType=$SID_a[1];

											$SFD_a=explode('=',$seasonResult[1]);
											$newFromDate=$SFD_a[1];

											$STD_a=explode('=',$seasonResult[2]);
											$newToDate=$STD_a[1];
											$tarif = GetPageRecord('*', _DMC_ROOM_TARIFF_MASTER_, ' supplierId="' . $editresult['id'] . '" and roomType="' . $roomTypeId['id'] . '" and mealPlan="' . $mealPlanId['id'] . '"  and ( fromDate BETWEEN "' . $newFromDate . '" and "' . $newToDate . '" OR "' . $newFromDate . '" BETWEEN fromDate and toDate ) and tarifType="' . $tarifType . '" and paxType="' . $paxType . '"  and marketType="' . $marketTypeId . '" and serviceid="' . $counthotel['id'] . '"');

											$roomratecount = mysqli_num_rows($tarif);
											if ($roomratecount < 1){
												// inserted 
											 	$namevalue = 'suppBookCode="' . $suppBookCode . '",supplierId="' . $editresult['id'] . '",fromDate="' . $newFromDate . '",toDate="' . $newToDate . '",sfromDate="' . $newFromDate . '",stoDate="' . $newToDate . '",roomType="' . $roomTypeId['id'] . '",mealPlan="' . $mealPlanId['id'] . '",status=1,addBy="' . $_SESSION['userid'] . '",dateAdded="' . $dateAdded . '",currencyId="' . $rescurr['id'] . '",serviceid="' . $counthotel['id'] . '",tarifType="' . $tarifType . '",paxType="' . $paxType . '",seasonType="' . $seasonType . '",singleoccupancy="' . $single . '",doubleoccupancy="' . $double . '",extraBed="' . $extraBedA . '",childwithbed="' . $childwithbed . '",childwithoutbed="' . $childwithoutbed . '",quadRoom="' . $quadRoom . '",teenRoom="' . $teenBed . '",sixBedRoom="' . $sixBed . '",eightBedRoom="' . $eightBed . '",tenBedRoom="' . $tenBed . '",breakfast="' . $breakfastA . '",lunch="' . $lunchA . '",dinner="' . $dinnerA . '",childBreakfast="' . $breakfastC . '",childLunch="' . $lunchC . '",childDinner="' . $dinnerC . '",roomGST="' . $roomGST . '",mealGST="' . $mealGST . '",roomTAC="' . $roomTAC . '",remarks="' . $remarks . '",marketType="' . $marketTypeId . '",seasonYear="'.$seasonYear.'"';

												addlisting(_DMC_ROOM_TARIFF_MASTER_, $namevalue);
												$lineSuccess++;

											}
											else {
												//get id for update
												$rateresult = mysqli_fetch_array($tarif);
												//updated
											 	$namevaluaaae = 'suppBookCode="' . $suppBookCode . '",singleoccupancy="' . $single . '",doubleoccupancy="' . $double . '",extraBed="' . $extraBedA . '",childwithbed="' . $childwithbed . '",childwithoutbed="' . $childwithoutbed . '",quadRoom="' . $quadRoom . '",teenRoom="' . $teenBed . '",sixBedRoom="' . $sixBed . '",eightBedRoom="' . $eightBed . '",tenBedRoom="' . $tenBed . '",breakfast="' . $breakfastA . '",lunch="' . $lunchA . '",dinner="' . $dinnerA . '",childBreakfast="' . $breakfastC . '",childLunch="' . $lunchC . '",childDinner="' . $dinnerC . '",roomGST="' . $roomGST . '",mealGST="' . $mealGST . '",roomTAC="' . $roomTAC . '",remarks="' . $remarks . '"';
												
												updatelisting(_DMC_ROOM_TARIFF_MASTER_, $namevaluaaae, 'id="' . $rateresult['id'] . '"');
												$lineExist++;
												$msg = '';
												$msg = 'Row No-' . $rowno . '. Updated: Record is updated...! - ' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);

											}
											}
										}
										if($errorFlag == 0){

											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Failed: Invalid Date Range('.trim($fromDates).'-'.trim($toDates).') Please Check Season Master  - ' . date('d-m-Y h:ia');
											errorlog($msg, $newfilez);
											$lineFailed++;

										}

									}

								}else {
									/*==============================================Add=====================================================*/
									$rsd = GetPageRecord('*', _DESTINATION_MASTER_, 'id="' . $destId . '"');
									$editresultd = mysqli_fetch_array($rscnt);

									$addid = '';
									$rsroom = GetPageRecord('*', _ROOM_TYPE_MASTER_, 'name="' . trim($roomType) . '"');
									$roomTypeId = mysqli_fetch_array($rsroom);
									
									// Monument Code genrated 
									$A = GetPageRecord('displayId',_PACKAGE_BUILDER_HOTEL_MASTER_,'displayId>0 order by displayId desc');
									$ddata = mysqli_fetch_assoc($A);
									$displayId = $ddata['displayId']+1;
									
									$namevalue = 'displayId="' . $displayId . '",hotelName="' . addslashes($hotelName) . '",contactPerson="' . addslashes($contactPerson) . '",supplierPhone="' . $supplierPhone . '",roomType="' . $roomTypeId['id'] . '",supplierEmail="' . $supplierEmail . '",hotelCountry="' . $hotelCountry . '",hotelCity="' . addslashes($hotelDestination) . '",hotelAddress="' . cleanNonAsciiCharactersInString($hotelAddress) . '",hotelCategoryId="' . $hotelCategoryId. '",hotelTypeId="' . $hotelTypeId. '",gstn="' . $gstn . '",url="' . $url . '",status="1",hotelChain="' . $hotelChainId . '",policy="' . addslashes($hotelpolicy) . '",hoteldetail="' . addslashes($hoteldetail) . '",termAndCondition="' . addslashes($hoteltermandcondition) . '",weekendDays="' . $weekendId . '"';
									$addid = addlistinggetlastid(_PACKAGE_BUILDER_HOTEL_MASTER_, $namevalue);

									$chkscp = checkduplicate('hotelContactPersonMaster', ' email="' . $supplierEmail . '" and primaryvalue=1');
									if ($chkscp == 'no')
									{
										$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $addid . '",designation="' . $designation . '",phone="' . $supplierPhone . '",email="' . $supplierEmail . '",primaryvalue="1",division="' . $division . '"';
										addlisting('hotelContactPersonMaster', $scpmn);

										$rs1 = "";
										
										$rs1 = GetPageRecord('*', _ADDRESS_MASTER_, ' addressParent="' . $addid . '" and addressType="hotel"');
										if (mysqli_num_rows($rs1) > 0)
										{
											$addrData = mysqli_fetch_array($rs1);
											$namevalue = 'countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1';
											updatelisting(_ADDRESS_MASTER_, $namevalue, "id='" . $addrData['id'] . "'");

										}
										else
										{
											$namevalue = 'addressParent="' . $addid . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="hotel"';
											addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);

										}
									}
									else {
										if (mysqli_num_rows(GetPageRecord('*', 'hotelContactPersonMaster', 'email="' . trim($supplierEmail) . '" and corporateId="' . $addid . '" and division!=3')) > 0 && $division != 3 ){
											$namevalue = 'contactPerson="' . $contactPerson . '",corporateId="' . $addid . '",designation="' . $designation . '",phone="' . $supplierPhone . '",email="' . $supplierEmail . '",primaryvalue="1",division="' . $division . '"';
												updatelisting('hotelContactPersonMaster', $namevalue, 'email="' . trim($supplierEmail) . '" and corporateId="' . $addid . '"');

											$rs1 = "";
											$rs1 = GetPageRecord('*', _ADDRESS_MASTER_, ' addressParent="' . $addid . '" and addressType="hotel"');
											if (mysqli_num_rows($rs1) > 0)
											{
												$addrData = mysqli_fetch_array($rs1);
												$namevalue = 'countryId="'. $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="'.$hotelAddress.'",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1';
												updatelisting(_ADDRESS_MASTER_, $namevalue, "id='" . $addrData['id'] . "'");

											}
											else
											{
												$namevalue = 'addressParent="' . $addid . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="hotel"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);

											}
										}
										else {
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Warning: Hotel Contact Person email is already exist. - ' . date('d-m-Y h:ia');
											// errorlog($msg, $newfilez);
										}

									}
									 
									
									if ($IsSupplier == 0 && strlen($supplierName) > 0)
									{
										$issup = "";
										$issup = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($supplierName) . '"');
										if (mysqli_num_rows($issup) > 0)
										{
											$issup1 = "";
											$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($supplierName) . '" and find_in_set("' . $destId . '",destinationId) ');
											if (mysqli_num_rows($issup1) > 0)
											{
												$lastIdData = mysqli_fetch_array($issup1);
												$lastId = $lastIdData['id'];
											}
											else
											{
												$msg = $lastId = '';
												$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($supplierName) . ') is not register for destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);
												$lineFailed++;
											}
										}
										else
										{
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Failed: Supplier( ' . trim($supplierName) . ' ) does not exist - ' . date('d-m-Y h:ia');
											errorlog($msg, $newfilez);
											$lineFailed++;
										}
									}
									elseif($IsSupplier == 1){
									
										$issup0 = "";
										$issup0 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" ');
										if (mysqli_num_rows($issup0) > 0)
										{
											//name exist
											$issup2 = "";
											$issup2 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" and id in ( select corporateId from suppliercontactPersonMaster where email="' . encode($supplierEmail) . '" )');
											if (mysqli_num_rows($issup2) > 0)
											{
												//name & email exist
												$issup1 = "";
												$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" and id in ( select corporateId from suppliercontactPersonMaster where email="' . encode($supplierEmail) . '" ) and find_in_set("' . $destId . '",destinationId) ');
												if (mysqli_num_rows($issup1) > 0)
												{
													//name & email & city exist true
													$lastIdData = mysqli_fetch_array($issup1);
													$lastId = $lastIdData['id'];

												}
												else
												{
													$msg = $lastId = '';
													$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
													errorlog($msg, $newfilez);
													$lineFailed++;
												}
											} 
											else {
												 
												//add supp
												$chkscp = checkduplicate('suppliercontactPersonMaster', ' email="' . encode($supplierEmail) . '" and corporateId>0 and primaryvalue=1 and division=3');				
												if($chkscp == 'yes' && $division != 3 ) {
													//update supplier to hotel
													$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
		
													//name & email exist
													$issup1 = "";
													$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" and find_in_set("' . $destId . '",destinationId) ');
													if (mysqli_num_rows($issup1) > 0)
													{
														//name & email & city exist true
														$lastIdData = mysqli_fetch_array($issup1);
														$lastId = $lastIdData['id'];
														$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
														addlisting('suppliercontactPersonMaster', $scpmn);

													}
													else {
														$msg = $lastId = '';
														$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for  the destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
														errorlog($msg, $newfilez);
														$lineFailed++;
													}
													
												} 
												else if($chkscp == 'no' ){
													deleteRecord('suppliercontactPersonMaster','  email="' . encode($supplierEmail) . '" and corporateId=0 and primaryvalue=1');
													//update supplier to hotel
													$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');
														
													//name & email exist
													$issup1 = "";
													$issup1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'name="' . trim($hotelName) . '" and find_in_set("' . $destId . '",destinationId) ');
													if (mysqli_num_rows($issup1) > 0)
													{
														//name & email & city exist true
														$lastIdData = mysqli_fetch_array($issup1);
														$lastId = $lastIdData['id'];

														$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
														addlisting('suppliercontactPersonMaster', $scpmn);


													}
													else {
														$msg = $lastId = '';
														$msg = 'Row No-' . $rowno . '. Failed: Supplier(' . trim($hotelName) . ') is not register for  the destination (' . $hotelDestination . ') - ' . date('d-m-Y h:ia');
														errorlog($msg, $newfilez);
														$lineFailed++;
													}
												}
												else{
													$msg = $lastId = '';
													$msg = 'Row No-' . $rowno . '. Failed: Email is already exist ' . date('d-m-Y h:ia');
													errorlog($msg, $newfilez);
													$lineFailed++;
												}
												 
												 
											}
										} 
										else {
											//add supp
											$chkscp = checkduplicate('suppliercontactPersonMaster', ' email="' . encode($supplierEmail) . '" and primaryvalue=1 and division=3');
											if($chkscp == 'yes' && $division != 3 ) {
												
												$namevalue = 'name="' . trim($hotelName) . '",aliasname="'.trim($hotelName).'",contactPerson="' . $contactPerson . '",addedBy=' . $_SESSION['userid'] . ',dateAdded=' . $dateAdded . ',companyTypeId=1,supplierMainType=' . $supplierType2 . ',paymentTerm=1,agreement=0,destinationId="' . $destId . '"';
												$lastId = addlistinggetlastid(_SUPPLIERS_MASTER_, $namevalue);
												//update supplier to hotel
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');

												$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
												addlisting('suppliercontactPersonMaster', $scpmn);

												$namevalue = 'addressParent="' . $lastId . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="supplier"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
												
											} else if($chkscp == 'no' ){
												$namevalue = 'name="' . trim($hotelName) . '",aliasname="'.trim($hotelName).'",contactPerson="' . $contactPerson . '",addedBy=' . $_SESSION['userid'] . ',dateAdded=' . $dateAdded . ',companyTypeId=1,supplierMainType=' . $supplierType2 . ',paymentTerm=1,agreement=0,destinationId="' . $destId . '"';
												$lastId = addlistinggetlastid(_SUPPLIERS_MASTER_, $namevalue);
												//update supplier to hotel
												$update = updatelisting(_PACKAGE_BUILDER_HOTEL_MASTER_, ' supplier=1', 'id="' . $addid . '"');

												$scpmn = 'contactPerson="' . $contactPerson . '",corporateId="' . $lastId . '",designation="' . $designation . '",phone="' . encode($supplierPhone) . '",email="' . encode($supplierEmail) . '",primaryvalue="1",division="' . $division . '"';
												addlisting('suppliercontactPersonMaster', $scpmn);

												$namevalue = 'addressParent="' . $lastId . '",countryId="' . $countryId . '",stateId="' . $stateId . '",cityId="' . $cityId . '",address="' . $hotelAddress . '",pinCode="' . $pinCode . '",gstn="' . $gstn . '",primaryAddress=1,addressType="supplier"';
												addlistinggetlastid(_ADDRESS_MASTER_, $namevalue);
											}else{
												$msg = $lastId = '';
												$msg = 'Row No-' . $rowno . '. Failed: Email is already exist ' . date('d-m-Y h:ia');
												errorlog($msg, $newfilez);
												$lineFailed++;
											}
											
										}
									}
									else{
										$msg = $lastId = '';
										$msg = 'Row No-' . $rowno . '. Failed: Invalid supplier details - ' . date('d-m-Y h:ia');
										errorlog($msg, $newfilez);
										$lineFailed++;
									}

									if ($lastId != '' && $lastId > 0){
										//-----------------------Add Mobile---------------------------
										$phone = $supplierPhone;
										$type = 1;
										$phoneprimary = 1;
										if ($phone != '')
										{
											$allvaluephone = 'phoneNo="' . $phone . '",phoneType="' . $type . '",primaryvalue="' . $phoneprimary . '",sectionType="suppliers", masterId="' . $lastId . '"';
											$add = addlisting(_PHONE_MASTER_, $allvaluephone);
										}
										//-----------------------Add Email---------------------------
										$email = $supplierEmail;
										$type = 1;
										$primaryvalue = 1;
										if($email != ''){
											$allvaluephone = 'email="' . $email . '",emailType="' . $type . '",primaryvalue="' . $primaryvalue . '",sectionType="suppliers",masterId="' . $lastId . '"';
											$add = addlisting(_EMAIL_MASTER_, $allvaluephone);
										}
										$rs1 = GetPageRecord('*', _PACKAGE_BUILDER_HOTEL_MASTER_, 'id="' . $addid . '"');
										$reshotelname = mysqli_fetch_array($rs1);
										$rs1 = GetPageRecord('*', _SUPPLIERS_MASTER_, 'id="' . $lastId . '"');
										$editresult = mysqli_fetch_array($rs1);
										$rsc = GetPageRecord('*', _QUERY_CURRENCY_MASTER_, 'name="' . $currency . '"');
										$rescurr = mysqli_fetch_array($rsc);
										$rsr = GetPageRecord('*', _ROOM_TYPE_MASTER_, 'name="' . $roomType . '"');
										$roomTypeId = mysqli_fetch_array($rsr);
										$rsm = GetPageRecord('*', _MEAL_PLAN_MASTER_, 'name="' . $mealPlan . '"');
										$mealPlanId = mysqli_fetch_array($rsm);

										if($errorFlag==1){ 
											foreach ($dataSet as $seasonSet2) {

												$seasonResult = explode(',', $seasonSet2);

												$SID_a=explode('=',$seasonResult[0]);
												$seasonType=$SID_a[1];

												$SFD_a=explode('=',$seasonResult[1]);
												$newFromDate=$SFD_a[1];

												$STD_a=explode('=',$seasonResult[2]);
												$newToDate=$STD_a[1];

												$namevalue = 'suppBookCode="' . $suppBookCode . '",supplierId="' . $lastId . '",fromDate="' . $newFromDate . '",toDate="' . $newToDate . '",sfromDate="' . $newFromDate . '",stoDate="' . $newToDate . '",roomType="' . $roomTypeId['id'] . '",mealPlan="' . $mealPlanId['id'] . '",status=1,addBy="' . $_SESSION['userid'] . '",dateAdded="' . $dateAdded . '",currencyId="' . $rescurr['id'] . '",serviceid="' . $reshotelname['id'] . '",tarifType="' . $tarifType . '",paxType="' . $paxType . '",seasonType="' . $seasonType . '",singleoccupancy="' . $single . '",doubleoccupancy="' . $double . '",extraBed="' . $extraBedA . '",childwithbed="' . $childwithbed . '",childwithoutbed="' . $childwithoutbed . '",quadRoom="' . $quadRoom . '",teenRoom="' . $teenBed . '",sixBedRoom="' . $sixBed . '",eightBedRoom="' . $eightBed . '",tenBedRoom="' . $tenBed . '",breakfast="' . $breakfastA . '",lunch="' . $lunchA . '",dinner="' . $dinnerA . '",childBreakfast="' . $breakfastC . '",childLunch="' . $lunchC . '",childDinner="' . $dinnerC . '",roomGST="' . $roomGST . '",mealGST="' . $mealGST . '",roomTAC="' . $roomTAC . '",remarks="' . $remarks . '",marketType="' . $marketTypeId . '",seasonYear="'.$seasonYear.'"';
												addlisting(_DMC_ROOM_TARIFF_MASTER_, $namevalue);
												$lineSuccess++;
											}

										}
										if($errorFlag==0){
											$msg = $lastId = '';
											$msg = 'Row No-' . $rowno . '. Failed: Invalid Date Ranage Please Check Season Master - ' . date('d-m-Y h:ia');
											errorlog($msg, $newfilez);
											$lineFailed++;	
										}

									}
									else
									{
										//$msg='';
										//$msg='Row No-'.$rowno.'. Something went wronge with supplier! - '.date('d-m-Y h:ia');
										//errorlog($msg,$newfilez);
										//$lineFailed++;
										
									}
								}
							} else {
								$showErrorName .= 'Hotel roomtType does not exist';
								$errorReport .= '<div>' . $line . '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' . $showErrorName . '&nbsp;&nbsp;&nbsp;' . $roomType . '</div>';
								$msg = '';
								$msg = 'Row No-' . $rowno . '. Failed: Room Type('.trim(strtoupper($roomType)).') does not exist.![UPPER(name)="'.trim(strtoupper($roomType)).'] - ' . date('d-m-Y h:ia');
								errorlog($msg, $newfilez);
								$lineFailed++;
							}
	                    }
	                }
	                else
	                {

	                    $msg = '';
	                    $msg = 'Row No-' . $rowno . '. Failed: Invalid duration from ' . date('d-m-Y', strtotime($fromDates)) . ' to ' . date('d-m-Y', strtotime($toDates));
	                    errorlog($msg, $newfilez);
	                    $lineFailed++;

	                }
	                
	            }
	            //else{ $lineFailed++; }
	            
	        }
       	}

    }
	?>
	<script type="text/javascript">
	<?php 
	if ($errorReport != '') {
		$msg = '';
		$msg = 'Total Records List. - ' . $line . ' - Success Entry(' . $lineSuccess . '), Failed Entry(' . $lineFailed . '), Updated Entry(' . $lineExist . ')_' . date('d-m-Y h:ia');
		errorlog($msg, $newfilez);
		?> 	///// ERROR REPORT -------------------------------------
		parent.alertspopupopen('action=foundduplicaterecored&moduleName=<?php echo $importpackagesightseeingModule; ?>&errorCount=<?php echo $errorCount; ?>','600px','auto');
		setTimeout( function(){
		parent.$('#dupplicaterecoreddlist').html('<?php echo $errorReportHeader . $errorReport . "<p>" . $msg . "</p>"; ?>');
		}  , 1000 );
		<?php
	}
	else {
		$msg = '';
		$msg = 'Total Records List. - ' . $line . ' - Success Entry(' . $lineSuccess . ' ), Failed Entry(' . $lineFailed . '), Duplicate Entry(' . $lineExist . ')_' . date('d-m-Y h:ia');
		errorlog($msg, $newfilez);
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&moduleName=<?php echo $importpackagesightseeingModule; ?>','600px','auto');
		<?php
	} ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
    <?php
}

if(isset($_FILES['importfield']['name']) && trim($_POST['importpackagetransfer'])=='Y'){
	require_once 'reader.php';
	$fileTime=date('H:i:s');
	$importpackagesightseeingModule = $_REQUEST['importpackagetransferModule'];   
	if(!empty($_FILES['importfield']['name'])){

		$folderName = 'log_transfer';
	    $newfilez = formatUrl($_FILES['importfield']['name']); // log file to store textin it
	    $file_name = trim($newfilez).'.xls'; // rename xls file to same as log file + .xls
	    $msg = '';
	    $msg = $newfilez;
	    importErrorlog($msg, $newfilez,$folderName);
	    $msg = '';
	    $msg = $fullurl . "importfile/" . $file_name . " Copy this link to download file ";
	    importErrorlog($msg, $newfilez,$folderName);
	    copy($_FILES['importfield']['tmp_name'], "importfile/" . $file_name);

		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		$path="importfile/".$file_name;
		$data->read($path);
		$line=0;
		$lineSuccess=0;
		$lineFailed=0;
		$lineExist=0;
		$errorReport='';
		$errorCount=0;
		$errorReportHeader='<div><strong>Line No.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Error Report</strong></div><br>';    ///// GET ERROR -------------------------------------
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++){
			$showErrorName='';
			$showErrorType='';   ///// EMPTY VARIABLE  -------------------------------------
			$transferName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
			$transferCity = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
			$transferDetail = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
			$transferTypeName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]);
			$supplier = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][5]);
			
			$fromDate = '';
			$fromDate = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][6])));
			if($fromDate=='1970-01-01'){
				$fromDate='';
				$excel_date = $data->sheets[0]["cells"][$x][6];
				$unix_date = ($excel_date - 25569) * 86400;
				$excel_date = 25569 + ($unix_date / 86400);
				$unix_date = ($excel_date - 25569) * 86400;
				$dateaa = gmdate("Y-m-d", $unix_date);
				$fromDate=$dateaa;
			}
			$toDate='';
			$toDate = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][7])));
			if($toDate=='1970-01-01'){
				$toDate='';
				$excel_date1 = $data->sheets[0]["cells"][$x][7];
				$unix_date1 = ($excel_date1 - 25569) * 86400;
				$excel_date1 = 25569 + ($unix_date1 / 86400);
				$unix_date1 = ($excel_date1 - 25569) * 86400;
				$date1 = gmdate("Y-m-d", $unix_date1);
				$toDate=$date1;
			} 
		    $tarifType= cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][8]);
		    $transferType= cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][9]);
			$currency = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][10]);
			$vehicleType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][11]);
			$rateDestination = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][12]);
			$gstTaxId = getGstIdBySlab(cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][13]),"Transfer");
			$adultCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][14]);
			$childCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][15]);
			$infantCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][16]);
			$vehicleCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][17]);
			$parkingFee = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][18]);
			$representativeEntryFee = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][19]);
			$assistance = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][20]);
			$guideAllowance = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][21]);
			$interStateAndToll = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][22]);
			$miscellaneous = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][23]);
			$remarks = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][24]);
            $suppBookCode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][25]);
 
			$rsvt=GetPageRecord('id','vehicleTypeMaster','UPPER(name)="'.trim(strtoupper($vehicleType)).'"');
			if(mysqli_num_rows($rsvt)>0){
				$resvahicleType=mysqli_fetch_array($rsvt);
				$vehicleTypeId=$resvahicleType['id'];
			}

			if (strtoupper($tarifType) == 'NORMAL' || $tarifType == '') {  $tarifTypeId = 1;  }else{  $tarifTypeId = 2; }
			if (strtoupper($transferType) == 'SIC' || $transferType == '') { $transferTypeId = 1;  }elseif(strtoupper($transferType) == 'PRIVATE' || strtoupper($transferType) == 'PVT'){ $transferTypeId = 2; }


			$rsMkt2=GetPageRecord('id','transferTypeMaster',' UPPER(name)="'.strtoupper($transferTypeName).'" order by name asc');
			$transferCategoryId=1;
			if(mysqli_num_rows($rsMkt2)>0){
				$resMarkt2=mysqli_fetch_array($rsMkt2);
				$transferCategoryId = $resMarkt2['id'];
			}
			$dateAdded=time();
			$costTypeid='';
			if($transferName!='' && $transferCity!=''){
				$costTypeid=2;

				$whereDest='';
				$transferCityArr = explode(',',$transferCity);

				$destId = '';
				if(strtoupper($transferCity) == 'ALL' && count($transferCityArr) < 2 ){
					$destId = 0;
				}else{
					foreach($transferCityArr as $val){
						$rs1=GetPageRecord('*',_DESTINATION_MASTER_,'UPPER(name)="'.strtoupper($val).'" and status=1');
						while($destinationresult=mysqli_fetch_array($rs1)){
							$whereDest.=' and FIND_IN_SET("'.$destinationresult['id'].'", destinationId) ';
							$destId.=$destinationresult['id'].',';
						}
					}
				}

				$ratedestId=0;
				$rs11=GetPageRecord('*',_DESTINATION_MASTER_,'UPPER(name)="'.strtoupper($rateDestination).'" and status=1');
				if(strtoupper($rateDestination) == 'ALL'){
					$ratedestId = 0;
				}elseif(mysqli_num_rows($rs11)>0){
					$ratedest=mysqli_fetch_array($rs11);
					$ratedestId=$ratedest['id'];
				}else{
					$ratedestId = 0;
				}
				

				$selectc='*';
				$wherec='UPPER(name)="'.$currency.'"';
				$rsc=GetPageRecord($selectc,_QUERY_CURRENCY_MASTER_,$wherec);
				$rescurr=mysqli_fetch_array($rsc);
				$transrs1=GetPageRecord('*',_PACKAGE_BUILDER_TRANSFER_MASTER,' 1 and transferName="'.$transferName.'" and transferCategory="transfer" '.$whereDest.' ');
				$transCount=mysqli_num_rows($transrs1);
				if($transferName=='' || $transferCity==''){   ///// VALIDATE -------------------------------------
					if($transferName==''){
						$msg='';
						$msg='Row No-'.$line.'. Transfer Name is empty...! - '.date('d-m-Y h:ia');
						//transfer_errorlog
						importErrorlog($msg, $newfilez,$folderName);
						$showErrorName.='Transfer Name,';
					}  
					if($transferCity==''){
						$msg='';
						$msg='Row No-'.$line.'. Transfer City is empty...! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
						$showErrorType.='Transfer City';
					}
					$errorReport.='<div>'.$line.'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error in&nbsp;'.$showErrorName.'&nbsp;&nbsp;&nbsp;'.$showErrorType.'</div>';
					$lineFailed++;
				}else{
					if($transCount>0){
						$transfetch=mysqli_fetch_array($transrs1);
						$transferId = $transfetch['id'];
						$rs1=GetPageRecord('id',_SUPPLIERS_MASTER_,' UPPER(name)="'.trim(strtoupper($supplier)).'" and transferType=5 '.$whereDest.'');
						$resSup=mysqli_fetch_array($rs1);
						$rsv=GetPageRecord('id','vehicleTypeMaster',' id="'.$vehicleTypeId.'"');
						if((mysqli_num_rows($rsv)>0 && $transferTypeId==2) || $transferTypeId==1){
							$resvahicle=mysqli_fetch_array($rsv);

							$rs3sdf1=GetPageRecord('*',_DMC_TRANSFER_RATE_MASTER_,'transferNameId="'.$transferId.'" and tarifType="'.$tarifTypeId.'" and transferType="'.$transferTypeId.'" and ( fromDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" OR "'.$fromDate.'" BETWEEN fromDate and toDate ) and vehicleTypeId="'.$resvahicle['id'].'"'); 
							if(mysqli_num_rows($rs3sdf1)<1){
								$namevalue ='suppBookCode="'.$suppBookCode.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferNameId="'.$transferId.'",detail="'.$remarks.'",vehicleModelId="'.$resvahicle['id'].'",currencyId="'.$rescurr['id'].'",supplierId="'.$resSup['id'].'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleCost="'.$vehicleCost.'",serviceid="'.$transferId.'",dateAdded="'.$dateAdded.'",parkingFee="'.$parkingFee.'",representativeEntryFee="'.$representativeEntryFee.'",assistance="'.$assistance.'",guideAllowance="'.$guideAllowance.'",interStateAndToll="'.$interStateAndToll.'",miscellaneous="'.$miscellaneous.'",gstTax="'.$gstTaxId.'",vehicleTypeId="'.$resvahicle['id'].'",transferCostType="'.$costTypeid.'",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",marketType="'.$marketTypeId.'",rateDestinationId="'.$ratedestId.'"';
								addlisting(_DMC_TRANSFER_RATE_MASTER_,$namevalue);
								$lineSuccess++;
							}else{
								$transRateD=mysqli_fetch_array($rs3sdf1);
								$namevalue ='suppBookCode="'.$suppBookCode.'",detail="'.$remarks.'",currencyId="'.$rescurr['id'].'",supplierId="'.$resSup['id'].'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleCost="'.$vehicleCost.'",dateAdded="'.$dateAdded.'",parkingFee="'.$parkingFee.'",representativeEntryFee="'.$representativeEntryFee.'",assistance="'.$assistance.'",guideAllowance="'.$guideAllowance.'",interStateAndToll="'.$interStateAndToll.'",miscellaneous="'.$miscellaneous.'",gstTax="'.$gstTaxId.'",vehicleTypeId="'.$resvahicle['id'].'",transferCostType="'.$costTypeid.'",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",marketType="'.$marketTypeId.'",rateDestinationId="'.$ratedestId.'"';
								updatelisting(_DMC_TRANSFER_RATE_MASTER_, $namevalue, 'id="' . $transRateD['id'] . '"');
								
								$msg='';
								$msg='Row No-'.$line.'. Updated - '.$transferName.' , Rate are updated.! - '.date('d-m-Y h:ia');
								importErrorlog($msg, $newfilez,$folderName);
								$lineExist++;
							}
						}else{
							$msg='';
							$msg='Row No-'.$line.'. Failed - '.$vehicle.' doesnt exist...! - '.date('d-m-Y h:ia');
							importErrorlog($msg, $newfilez,$folderName);
							$lineFailed++;
						} 
					}else{ 
						/*----------------------------------------ADD------------------------------------------------*/
						$rs1=GetPageRecord('*',_SUPPLIERS_MASTER_,' UPPER(name)="'.trim(strtoupper($supplier)).'" and transferType=5 '.$whereDest.'');
						$editresult=mysqli_fetch_array($rs1);
						$lastid ='';
						$namevalue ='transferName="'.$transferName.'",transferDetail="'.$transferDetail.'",transferType="'.$transferCategoryId.'",destinationId="'.rtrim($destId,',').'",status="1",transferCategory="transfer" ';
						$lastid = addlistinggetlastid(_PACKAGE_BUILDER_TRANSFER_MASTER,$namevalue);

						$rs1=GetPageRecord('*',_PACKAGE_BUILDER_TRANSFER_MASTER,'id='.$lastid.' and status=1 ');
						$restransfername=mysqli_fetch_array($rs1);
						$rsv='';
						$rsv=GetPageRecord('*','vehicleTypeMaster','id="'.$vehicleTypeId.'"');
						if((mysqli_num_rows($rsv)>0 && $transferTypeId==2) || $transferTypeId==1){
							$resvahicle=mysqli_fetch_array($rsv);

							$namevalue ='suppBookCode="'.$suppBookCode.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferNameId="'.$restransfername['id'].'",detail="'.$information.'",currencyId="'.$rescurr['id'].'",supplierId="'.$editresult['id'].'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleCost="'.$vehicleCost.'",serviceid="'.$restransfername['id'].'",dateAdded="'.$dateAdded.'",parkingFee="'.$parkingFee.'",representativeEntryFee="'.$representativeEntryFee.'",assistance="'.$assistance.'",guideAllowance="'.$guideAllowance.'",interStateAndToll="'.$interStateAndToll.'",miscellaneous="'.$miscellaneous.'",gstTax="'.$gstTaxId.'",vehicleTypeId="'.$resvahicle['id'].'",transferCostType="'.$costTypeid.'",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",marketType="'.$marketTypeId.'",rateDestinationId="'.$ratedestId.'"';
							addlisting(_DMC_TRANSFER_RATE_MASTER_,$namevalue);
							$lineSuccess++;
						}else{
							$msg='';
							$msg='Row No-'.$line.'. Failed - '.$vehicle.' doesnt exist...! - '.date('d-m-Y h:ia');
							importErrorlog($msg, $newfilez,$folderName);
							$lineFailed++;
						} 
					}
				}
				$line++; ///// COUNT LINE -------------------------------------
			}
			//else{ $lineFailed++; }
		}
		//for loop ends
	} ?>
 	<script>
	<?php
	if($errorReport!=''){    ///// ERROR REPORT -------------------------------------
		?>
		parent.alertspopupopen('action=foundduplicaterecored&moduleName=<?php echo $importpackagesightseeingModule; ?>&errorCount=<?php echo $errorCount; ?>','600px','auto');
		setTimeout( function(){
		parent.$('#dupplicaterecoreddlist').html('<?php echo $errorReportHeader.$errorReport; ?>');
		  }  , 1000 );
		<?php
	} else {
		$msg='';
		$msg='Import Status. - '.$line.' (Total Records) - Success('.round($lineSuccess).'), Failed('.$lineFailed.'), Updated('.$lineExist.'), _'.date('d-m-Y h:ia');
		importErrorlog($msg, $newfilez,$folderName);
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&moduleName=<?php echo $importpackagesightseeingModule; ?>','600px','auto');
		<?php
	} ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
 	<?php
}
 
if(isset($_FILES['importfield']['name']) && trim($_POST['importpackagetransPort'])=='Y'){
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php';
	$fileTime=date('H:i:s');
	$importpackagesightseeingModule = $_REQUEST['importpackagetransPortModule']; // GET MODULE -------------------------------------
	if(!empty($_FILES['importfield']['name'])){
    	$file_name=$_FILES['importfield']['name'];
    	copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
    	$data = new Spreadsheet_Excel_Reader();
    	$data->setOutputEncoding('CP1251');
    	$path="importfile/".$file_name;
    	$data->read($path);
    	$line=0;
    	$lineSuccess=0;
    	$lineFailed=0;
    	$errorReport='';
    	$errorCount=0;
    	$errorReportHeader='<div><strong>Line No.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Error Report</strong></div><br>';    ///// GET ERROR -------------------------------------
    	for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
    		$showErrorName='';
    		$showErrorType='';   ///// EMPTY VARIABLE  -------------------------------------
    		$transferName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
    		$transferDetail = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
    		$transferTypeName = trim($data->sheets[0]["cells"][$x][3]);
    		$transferCity = trim($data->sheets[0]["cells"][$x][4]);
    		$supplier = trim($data->sheets[0]["cells"][$x][5]);
    		$currency = trim($data->sheets[0]["cells"][$x][6]);
    		$fromDate = '';
    		$fromDate = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][7])));
    		if($fromDate=='1970-01-01'){
    			$fromDate='';
    			$excel_date = $data->sheets[0]["cells"][$x][7];
    			$unix_date = ($excel_date - 25569) * 86400;
    			$excel_date = 25569 + ($unix_date / 86400);
    			$unix_date = ($excel_date - 25569) * 86400;
    			$dateaa = gmdate("Y-m-d", $unix_date);
    			$fromDate=$dateaa;
    		}
    		$toDate='';
    		$toDate = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][8])));
    		if($toDate=='1970-01-01'){
    			$toDate='';
    			$excel_date1 = $data->sheets[0]["cells"][$x][8];
    			$unix_date1 = ($excel_date1 - 25569) * 86400;
    			$excel_date1 = 25569 + ($unix_date1 / 86400);
    			$unix_date1 = ($excel_date1 - 25569) * 86400;
    			$date1 = gmdate("Y-m-d", $unix_date1);
    			$toDate=$date1;
    		}
    
    		$transferCostType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][9]);
    		$vehicleType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][10]);
    		// $vehicleName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][11]);
    		$rateDestination = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][11]);
    		$gstTaxId = getGstIdBySlab(cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][12]),"Transfer");
    		$vehiclecost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][13]);
    		$parkingFee = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][14]);
    		$representativeEntryFee = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][15]);
    		$assistance = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][16]);
    		$guideAllowance = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][17]);
    		$interStateAndToll = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][18]);
    		$miscellaneous = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][19]);
    		$remarks = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][20]);
            $suppBookCode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][21]);
    
    		$dateAdded=time();
    		$costTypeid='';
    		if($transferName!='' && $transferCity!=''){
    			if(strtoupper($transferCostType)=="PER DAY"){
    				 $costTypeid=1;
    			}elseif(strtoupper($transferCostType)=="PACKAGE"){
    				 $costTypeid=2;
    			}else{
    				$costTypeid=1;
    			}
    
    
    			$rsvt=GetPageRecord('id','vehicleTypeMaster','UPPER(name)="'.trim(strtoupper($vehicleType)).'"');
    			if(mysqli_num_rows($rsvt)>0){
    				$resvahicleType=mysqli_fetch_array($rsvt);
    				$vehicleTypeId=$resvahicleType['id'];
    			}else{
    				$vehicleTypeId=1;
    			}
    
    			$rsMkt2=GetPageRecord('id','transferTypeMaster','UPPER(name)="'.trim(strtoupper($transferTypeName)).'" order by name asc');
    			$transferTypeId=1;
    			if(mysqli_num_rows($rsMkt2)>0){
    				$resMarkt2=mysqli_fetch_array($rsMkt2);
    				$transferTypeId = $resMarkt2['id'];
    			}
				 
				$ratedestId=0;
				$rs11=GetPageRecord('*',_DESTINATION_MASTER_,'UPPER(name)="'.strtoupper($rateDestination).'" and status=1');
				if(strtoupper($rateDestination) == 'ALL'){
					$ratedestId = 0;
				}elseif(mysqli_num_rows($rs11)>0){
					$ratedest=mysqli_fetch_array($rs11);
					$ratedestId=$ratedest['id'];
				}else{
					$ratedestId = 0;
				}

				$whereDest='';
				$transferCityArr = explode(',',$transferCity);
				
				if(strtoupper($transferCity) == 'ALL' && count($transferCityArr) < 2 ){
					$destId = 0;
				}else{
					foreach($transferCityArr as $val){
						$rs1=GetPageRecord('*',_DESTINATION_MASTER_,'UPPER(name)="'.strtoupper($val).'" and status=1');
						while($destinationresult=mysqli_fetch_array($rs1)){
							$whereDest.=' and FIND_IN_SET("'.$destinationresult['id'].'", destinationId) ';
							$destId.=$destinationresult['id'].',';
						}
					}
				}
 
    			$selectc='*';
    			$wherec='name="'.$currency.'"';
    			$rsc=GetPageRecord($selectc,_QUERY_CURRENCY_MASTER_,$wherec);
    			$rescurr=mysqli_fetch_array($rsc);
    			$transrs1=GetPageRecord('*',_PACKAGE_BUILDER_TRANSFER_MASTER,' 1 and transferName="'.$transferName.'" and transferCategory="transportation" '.$whereDest.' ');
    			$transCount=mysqli_num_rows($transrs1);
    			if($transferName=='' || $transferCity==''){   ///// VALIDATE -------------------------------------
    				if($transferName==''){
    					$msg='';
    					$msg='Row No-'.$line.'. Transport Name is empty...! - '.date('d-m-Y h:ia');
    					//transporterrorlog
    					transporterrorlog($msg,$fileTime);
    					$showErrorName.='Transport Name,';
    				}
    			
    				if($transferCity==''){
    					$msg='';
    					$msg='Row No-'.$line.'. Transport City is empty...! - '.date('d-m-Y h:ia');
    					transporterrorlog($msg,$fileTime);
    					$showErrorType.='Transport City';
    				}
    				$errorReport.='<div>'.$line.'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error in&nbsp;'.$showErrorName.'&nbsp;&nbsp;&nbsp;'.$showErrorType.'</div>';
    			}else{
    				if($transCount>0){
    					$transfetch=mysqli_fetch_array($transrs1);
    					$transferId = $transfetch['id'];
    					$rs1=GetPageRecord('id',_SUPPLIERS_MASTER_,'name="'.$supplier.'" and transferType=5');
    					if(mysqli_num_rows($rs1)>0){
    						$resSup=mysqli_fetch_array($rs1);
    						$rsv=GetPageRecord('id','vehicleTypeMaster','id="'.$vehicleTypeId.'" ');
    						if(mysqli_num_rows($rsv)>0){
    							$resvahicle=mysqli_fetch_array($rsv);
    							
    							$rs3sdf1=GetPageRecord('*',_DMC_TRANSFER_RATE_MASTER_,'transferNameId="'.$transferId.'" and transferCostType="'.$costTypeid.'" and supplierId="'.$resSup['id'].'" and ( fromDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" OR "'.$fromDate.'" BETWEEN fromDate and toDate ) and vehicleTypeId="'.$resvahicle['id'].'" ');
    							if(mysqli_num_rows($rs3sdf1)<1){
    								$namevalue ='suppBookCode="'.$suppBookCode.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferType=2,transferNameId="'.$transferId.'",detail="'.$remarks.'",vehicleModelId="'.$resvahicle['id'].'",currencyId="'.$rescurr['id'].'",supplierId="'.$resSup['id'].'",vehicleCost="'.$vehiclecost.'",serviceid="'.$transferId.'",dateAdded="'.$dateAdded.'",parkingFee="'.$parkingFee.'",representativeEntryFee="'.$representativeEntryFee.'",assistance="'.$assistance.'",guideAllowance="'.$guideAllowance.'",interStateAndToll="'.$interStateAndToll.'",miscellaneous="'.$miscellaneous.'",gstTax="'.$gstTaxId.'",vehicleTypeId="'.$resvahicle['id'].'",transferCostType="'.$costTypeid.'",rateDestinationId="'.$ratedestId.'"';
    								addlisting(_DMC_TRANSFER_RATE_MASTER_,$namevalue);
    								$lineSuccess++;
    							}else{
    								$transRateD=mysqli_fetch_array($rs3sdf1);
    							
    								$namevalue ='suppBookCode="'.$suppBookCode.'",transferType=2,detail="'.$remarks.'",currencyId="'.$rescurr['id'].'",supplierId="'.$resSup['id'].'",vehicleCost="'.$vehiclecost.'",dateAdded="'.$dateAdded.'",parkingFee="'.$parkingFee.'",representativeEntryFee="'.$representativeEntryFee.'",assistance="'.$assistance.'",guideAllowance="'.$guideAllowance.'",interStateAndToll="'.$interStateAndToll.'",miscellaneous="'.$miscellaneous.'",gstTax="'.$gstTaxId.'",vehicleTypeId="'.$resvahicle['id'].'",transferCostType="'.$costTypeid.'",rateDestinationId="'.$ratedestId.'"';
    								updatelisting(_DMC_TRANSFER_RATE_MASTER_, $namevalue, 'id="' . $transRateD['id'] . '"');
    								
    								$msg='';
    								$msg='Row No-'.$line.'. Updated - '.$transferName.' , Rate are updated.! - '.date('d-m-Y h:ia');
    								transporterrorlog($msg,$fileTime);
    								$lineExist++;
    							}
    						}else{
    							$msg='';
    							$msg='Row No-'.$line.'. Failed - '.$vehicleName.' or Vehicle Type - '.$vehicleType.' doesnt exist...! - '.date('d-m-Y h:ia');
    							transporterrorlog($msg,$fileTime);
    							$lineFailed++;
    						}
    					}else{
    						$msg='';
    						$msg='Row No-'.$line.'. Failed - '.$supplier.' Supplier Name/Destination is not exist. ! - '.date('d-m-Y h:ia');
    						transporterrorlog($msg,date('h:i:s'));
    						$lineFailed++;
    					}
    				}else{ 
    					/*----------------------------------------ADD------------------------------------------------*/
    					$rs1=GetPageRecord('*',_SUPPLIERS_MASTER_,'name="'.$supplier.'" and transferType=5');
    					if(mysqli_num_rows($rs1)>0){
    						$editresult=mysqli_fetch_array($rs1);
    						$lastid ='';
    						$namevalue ='transferName="'.$transferName.'",transferDetail="'.$transferDetail.'",transferType="'.$transferTypeId.'",destinationId="'.rtrim($destId,',').'",status="1",transferCategory="transportation" ';
    						$lastid = addlistinggetlastid(_PACKAGE_BUILDER_TRANSFER_MASTER,$namevalue);
    						$rs1=GetPageRecord('*',_PACKAGE_BUILDER_TRANSFER_MASTER,'id='.$lastid.' and status=1 ');
    						$restransfername=mysqli_fetch_array($rs1);
    						$rsv='';
    						$rsv=GetPageRecord('*','vehicleTypeMaster','id="'.$vehicleTypeId.'"');
    						if(mysqli_num_rows($rsv)>0){
    							$resvahicle=mysqli_fetch_array($rsv);
    							
    							$namevalue ='suppBookCode="'.$suppBookCode.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferType=2,transferNameId="'.$restransfername['id'].'",detail="'.$information.'",vehicleModelId="'.$resvahicle['id'].'",currencyId="'.$rescurr['id'].'",supplierId="'.$editresult['id'].'",vehicleCost="'.$vehiclecost.'",serviceid="'.$restransfername['id'].'",dateAdded="'.$dateAdded.'",parkingFee="'.$parkingFee.'",representativeEntryFee="'.$representativeEntryFee.'",assistance="'.$assistance.'",guideAllowance="'.$guideAllowance.'",interStateAndToll="'.$interStateAndToll.'",miscellaneous="'.$miscellaneous.'",gstTax="'.$gstTaxId.'",vehicleTypeId="'.$resvahicle['id'].'",transferCostType="'.$costTypeid.'",rateDestinationId="'.$ratedestId.'"';
    							addlisting(_DMC_TRANSFER_RATE_MASTER_,$namevalue);
    							$lineSuccess++;
    						}else{
    							$msg='';
    							$msg='Row No-'.$line.'. Failed - '.$vehicleName.' or Vehicle Type - '.$vehicleType.' doesnt exist...! - '.date('d-m-Y h:ia');
    							transporterrorlog($msg,$fileTime);
    							$lineFailed++;
    						}
    					}else{
    						$msg='';
    						$msg='Row No-'.$line.'. Failed - '.$supplier.' doesnt exist...! - '.date('d-m-Y h:ia');
    						transporterrorlog($msg,$fileTime);
    						$lineFailed++;
    					}
    				}
    			}
    			$line++; ///// COUNT LINE -------------------------------------
    		}
    		else{ $lineFailed++; }
    	}
    	//for loop ends
	} ?>
 	<script>
	<?php
	if($errorReport!=''){    ///// ERROR REPORT -------------------------------------
		?>
		parent.alertspopupopen('action=foundduplicaterecored&moduleName=<?php echo $importpackagesightseeingModule; ?>&errorCount=<?php echo $errorCount; ?>','600px','auto');
		setTimeout( function(){
		parent.$('#dupplicaterecoreddlist').html('<?php echo $errorReportHeader.$errorReport; ?>');
		  }  , 1000 );
		<?php
	} else {
		$msg='';
		$msg='Import Status. - '.$line.' - Failed('.$lineFailed.'), Updated('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		transporterrorlog($msg,$fileTime);
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&moduleName=<?php echo $importpackagesightseeingModule; ?>','600px','auto');
		<?php
	} ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
 	<?php
}

if(isset($_FILES['importfield']['name']) && trim($_POST['importpackageentrance'])=='Y'){
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php';
	$fileTime=date('H:i:s');
	$duplicaterecored.='';
	$importpackageentranceModule = trim($_POST['importpackageentranceModule']);
	if(!empty($_FILES['importfield']['name'])){

		$folderName = 'log_entrance';
	    $newfilez = formatUrl($_FILES['importfield']['name']); // log file to store textin it
	    $file_name = trim($newfilez).'.xls'; // rename xls file to same as log file + .xls
	    $msg = '';
	    $msg = $newfilez;
	    importErrorlog($msg, $newfilez,$folderName);
	    $msg = '';
	    $msg = $fullurl . "importfile/" . $file_name . " Copy this link to download file ";
	    importErrorlog($msg, $newfilez,$folderName);
	    copy($_FILES['importfield']['tmp_name'], "importfile/" . $file_name);

		$rowno=0;
		$lineSuccess=0;
		$lineExist=0;
		$lineFailed=0;
		$errorReport='';
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		$path="importfile/".$file_name;
		$data->read($path);
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) { 
			$rowno++;
			$entranceName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
			$entranceCity = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
			$tptType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
			$supplier = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]); 
			$fromDates='';
 			$fromDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][5])));
			if($fromDates=='1970-01-01'){
				$fromDates='';
				$excel_date = $data->sheets[0]["cells"][$x][5];
				$unix_date = ($excel_date - 25569) * 86400; 
				$excel_date = 25569 + ($unix_date / 86400);
				$unix_date = ($excel_date - 25569) * 86400; 
				$dateaa = gmdate("Y-m-d", $unix_date);
				$fromDates=$dateaa;
			}
			$toDates='';
			$toDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][6])));
			if($toDates=='1970-01-01'){
				$toDates='';
				$excel_date1 = $data->sheets[0]["cells"][$x][6];
				$unix_date1 = ($excel_date1 - 25569) * 86400; 
				$excel_date1 = 25569 + ($unix_date1 / 86400);
				$unix_date1 = ($excel_date1 - 25569) * 86400; 
				$date1 = gmdate("Y-m-d", $unix_date1);
				$toDates=$date1;
			} 
			// $marketType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][7]); 
			$nationalityType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][7]); 
			$tarifType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][8]); 
			$transferType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][9]); 
			$currencyName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][10]);
			
			$ticketAdultCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][11]); 
			$ticketchildCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][12]); 
			$ticketinfantCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][13]); 

			$adultTransferCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][14]); 
			$childTransferCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][15]); 
			$infantTransferCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][16]); 

			$vehicleName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][17]); 
			$vehicleCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][18]); 
			$repCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][19]); 
    		$gstTaxId = getGstIdBySlab(trim($data->sheets[0]["cells"][$x][20]),"Entrance");
			$status = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][21]);
			$daysname = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][22]);
			$entranceDetail = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][23]);
			$suppBookCode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][24]);
			
			if($daysname!=''){
				$finaldaysnameArr = explode(",",$daysname);
				foreach($finaldaysnameArr as $finaldaysname){
					//echo ' deleteStatus=0 and name ="'.$finaldaysname.'" order by name asc';
					$rs=GetPageRecord('name','weekendDaysMaster',' deleteStatus=0 and UPPER(name) = "'.trim(strtoupper($finaldaysname)).'" order by name asc');
					$resListing=mysqli_fetch_array($rs);
					$daysFullName.= $resListing['name'].",";
				}
			}else{
				$daysFullName='';
			}
 			
			$nationalityTypeId = 0;
			if (strtoupper($nationalityType) == 'LOCAL') {  $nationalityTypeId = 1;  }
			else if (strtoupper($nationalityType) == 'FOREIGN') {  $nationalityTypeId = 2;  }
			else if (strtoupper($nationalityType) == 'BIMSTEC') {  $nationalityTypeId = 3;  }
			else{ $nationalityTypeId = 0; }


			if (strtoupper($tarifType) == 'NORMAL' || $tarifType == '') {  $tarifTypeId = 1;  }
			else{  $tarifTypeId = 2; }

			$transferTypeId = $tptTypeId = 0;
			if (strtoupper($tptType) == 'SIC') {  $tptTypeId = 1;  }
			elseif(strtoupper($tptType) == 'PVT' || strtoupper($tptType) == 'PRIVATE'){  $tptTypeId = 2; }
			elseif(strtoupper($tptType) == 'TICKET ONLY'){  $tptTypeId = 3; }
			else{  $tptTypeId = 0; }

			if (strtoupper($transferType) == 'SIC') {  $transferTypeId = 1;  }
			elseif(strtoupper($transferType) == 'PVT' || strtoupper($transferType) == 'PRIVATE'){  $transferTypeId = 2; }
			elseif(strtoupper($transferType) == 'TICKET ONLY'){  $transferTypeId = 3; }
			else{ $transferTypeId = $tptTypeId;  } // if service is not BOTH type then default is as Service Type



			if (strtoupper($status) == 'ACTIVE' || $status == '1' || $status == '' ) {  $statusc = 1;  }
			if (strtoupper($status) == 'INACTIVE' || $status == '0'){ $statusc = 0; }
			$dateAdded=time();
			$whereDest=' ';
			if($entranceName!='' && $entranceCity!=''){
				if($nationalityTypeId!=0){

					$rs1=GetPageRecord('*',_DESTINATION_MASTER_,' UPPER(name)="'.strtoupper($entranceCity).'" ');
					$destinationData=mysqli_fetch_array($rs1);
					if($destinationData['id']==0){
						$cityId = addlistinggetlastid(_DESTINATION_MASTER_,'name="'.strtoupper($entranceCity).'"');
					}else{
						$cityId=$destinationData['id']; 
						$entranceCity=$destinationData['name'];
					}

					$whereDest=' and FIND_IN_SET("'.$cityId.'", destinationId) ';

					// $msg='';
					// $msg='Row No-'.$rowno.'. Info: EntranceCity ['.trim(strtoupper($entranceCity)).']=>['.$destinationData['id'].']=>['.$entranceCity.']! - '.date('d-m-Y h:ia');
					// importErrorlog($msg, $newfilez,$folderName);


					$entrQuery = GetPageRecord('*',_PACKAGE_BUILDER_ENTRANCE_MASTER_,'entranceName="'.$entranceName.'" and entranceCity="'.$entranceCity.'"');
				 	if(mysqli_num_rows($entrQuery) > 0){
				 		//update code

						$entraceData = mysqli_fetch_array($entrQuery);
						$namevalue ='entranceDetail="'.$entranceDetail.'",status="'.$statusc.'",tptType="'.$tptTypeId.'",closeDaysname="'.rtrim($daysFullName,",").'"';
						updatelisting(_PACKAGE_BUILDER_ENTRANCE_MASTER_,$namevalue,'id = "'.$entraceData['id'].'"');
 
						$rsc=GetPageRecord('*',_QUERY_CURRENCY_MASTER_,'name="'.trim($currencyName).'" and deletestatus=0');
						$rescurr=mysqli_fetch_array($rsc);
						$currencyId = $rescurr['id'];
						if(mysqli_num_rows($rsc)>0 && $currencyId > 0){

							if($transferTypeId>0){

								$rsv=GetPageRecord('*','vehicleTypeMaster',' UPPER(name)="'.strtoupper($vehicleName).'" ');
								if((mysqli_num_rows($rsv)>0 && $transferTypeId == 2) || ($transferTypeId == 1 || $transferTypeId == 3)){
									$resvahicle=mysqli_fetch_array($rsv);

									if($transferTypeId == 1 ){
										$adultTransferCost = $adultTransferCost;
										$childTransferCost = $childTransferCost;

										$vehicleId = $vehicleCost = 0;
									}elseif($transferTypeId == 2) {
										$vehicleId = $resvahicle['id'];
										$vehicleCost = $vehicleCost;

										$adultTransferCost = $childTransferCost = 0;
									}
									

									// Define the WHERE clause for destination ID
									$whereDest = ' and FIND_IN_SET("' . $cityId . '", destinationId) ';
									$issup = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="' . strtoupper($supplier) . '"' . $whereDest . ' and deletestatus=0 and entranceType=4 order by id desc ');
									if (mysqli_num_rows($issup) > 0) {
									    $lastIdData = mysqli_fetch_array($issup);
									    $supplierId = $lastIdData['id'];
									} else {
										$supplierId = 0;
									    $issup2 = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="' . strtoupper($supplier) . '" and deletestatus=0 order by id desc ');
									    if (mysqli_num_rows($issup2) > 0) {
									        // Supplier found without the specified destination, update destination
									        $lastIdData2 = mysqli_fetch_array($issup2);
									        $supplierId = $lastIdData2['id'];
									        $destinationId2 = $lastIdData2['destinationId'] . ',' . $cityId;
									        updatelisting(_SUPPLIERS_MASTER_, 'entranceType=4,destinationId="' . $destinationId2 . '"', ' id="' . $supplierId . '"');
									    } 
									}

									if(!empty($supplierId)){
										if( $ticketAdultCost > 0){ 

											$rs1=GetPageRecord('id',_DMC_ENTRANCE_RATE_MASTER_,'entranceNameId="'.$entraceData['id'].'"  and ( fromDate BETWEEN "'.$fromDates.'" and "'.$toDates.'" OR "'.$fromDates.'" BETWEEN fromDate and toDate ) and nationalityType="'.$nationalityTypeId.'" and tarifType="'.$tarifTypeId.'" and transferType="'.$transferTypeId.'" and supplierId="'.$supplierId.'" and currencyId="'.$currencyId.'"'); 
											if(mysqli_num_rows($rs1)<1){ 
												$namevalue2 ='suppBookCode="'.$suppBookCode.'",supplierId="'.$supplierId.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",entranceNameId="'.$entraceData['id'].'",serviceid="'.$entraceData['id'].'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultTransferCost.'",childCost="'.$childTransferCost.'",infantCost="'.$infantTransferCost.'",vehicleId="'.$vehicleId.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",gstTax="'.$gstTaxId.'",currencyId="'.$currencyId.'",status="1",nationalityType="'.$nationalityTypeId.'",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
												addlisting(_DMC_ENTRANCE_RATE_MASTER_,$namevalue2);
												$lineSuccess++;
											}else{
												$namevalue2 ='suppBookCode="'.$suppBookCode.'",supplierId="'.$supplierId.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultTransferCost.'",childCost="'.$childTransferCost.'",infantCost="'.$infantTransferCost.'",vehicleId="'.$vehicleId.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",gstTax="'.$gstTaxId.'",currencyId="'.$currencyId.'",status="1",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",nationalityType="'.$nationalityTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
												$dmcData = mysqli_fetch_assoc($rs1);
												updatelisting(_DMC_ENTRANCE_RATE_MASTER_,$namevalue2,'id = "'.$dmcData['id'].'"');
												$lineExist++;
											}
										}else{
											$msg='';
											$msg='Row No-'.$rowno.'. Failed: Entrance - '.trim($entranceName).', all rates are blanks...! - '.date('d-m-Y h:ia');
											importErrorlog($msg, $newfilez,$folderName);
											$lineFailed++;
										}
									}else{
										$msg='';
										$msg='Row No-'.$rowno.'. Failed: Supplier Name - '.trim($supplier).' does not exist! - '.date('d-m-Y h:ia');
										importErrorlog($msg, $newfilez,$folderName);
										$lineFailed++;
									}
								}else{
									$msg='';
									$msg='Row No-'.$rowno.'. Failed - Vehicle Type '.$vehicle.' doesnt exist...! - '.date('d-m-Y h:ia');
									importErrorlog($msg, $newfilez,$folderName);
									$lineFailed++;
								}
							}else{
								$msg='';
								$msg='Row No-'.$rowno.'. Failed - Invalid Transfer Type - '.date('d-m-Y h:ia');
								importErrorlog($msg, $newfilez,$folderName);
								$lineFailed++;
							}

						}else{
							$msg='';
							$msg='Row No-'.$rowno.'. Failed: Currency - '.trim($currency).' not exist...! - '.date('d-m-Y h:ia');
							importErrorlog($msg, $newfilez,$folderName);
							$lineFailed++;
						}
					}else{
						// Monument Code genrated 
						$A = GetPageRecord('displayId',_PACKAGE_BUILDER_ENTRANCE_MASTER_,'displayId>0 order by displayId desc');
						$ddata = mysqli_fetch_assoc($A);
						$displayId = $ddata['displayId']+1;

					  	$namevalue ='displayId="'.$displayId.'",entranceName="'.$entranceName.'",entranceCity="'.$entranceCity.'",tptType="'.$tptTypeId.'",entranceDetail="'.$entranceDetail.'",status="'.$statusc.'",closeDaysname="'.rtrim($daysFullName,",").'"';
						$lastid = addlistinggetlastid(_PACKAGE_BUILDER_ENTRANCE_MASTER_,$namevalue);

						$rsc=GetPageRecord('*',_QUERY_CURRENCY_MASTER_,' name="'.trim($currencyName).'" and deletestatus=0');
						$rescurr=mysqli_fetch_array($rsc);
						$currencyId = $rescurr['id'];
						if(mysqli_num_rows($rsc)>0 && $currencyId > 0){
							if($transferTypeId>0){

								$rsv=GetPageRecord('*','vehicleTypeMaster',' UPPER(name)="'.strtoupper($vehicleName).'" ');
								if((mysqli_num_rows($rsv)>0 && $transferTypeId == 2) || ($transferTypeId == 1 || $transferTypeId == 3)){
									$resvahicle=mysqli_fetch_array($rsv);
									$vehicleId = $resvahicle['id'];
									

									// Define the WHERE clause for destination ID
									$whereDest = ' and FIND_IN_SET("' . $cityId . '", destinationId) ';
									$issup = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="' . strtoupper($supplier) . '"' . $whereDest . ' and deletestatus=0 and entranceType=4 order by id desc ');
									if (mysqli_num_rows($issup) > 0) {
									    $lastIdData = mysqli_fetch_array($issup);
									    $supplierId = $lastIdData['id'];
									} else {
										$supplierId = 0;
									    $issup2 = GetPageRecord('*', _SUPPLIERS_MASTER_, ' UPPER(name)="' . strtoupper($supplier) . '" and deletestatus=0 order by id desc ');
									    if (mysqli_num_rows($issup2) > 0) {
									        // Supplier found without the specified destination, update destination
									        $lastIdData2 = mysqli_fetch_array($issup2);
									        $supplierId = $lastIdData2['id'];
									        $destinationId2 = $lastIdData2['destinationId'] . ',' . $cityId;
									        updatelisting(_SUPPLIERS_MASTER_, 'entranceType=4,destinationId="' . $destinationId2 . '"', ' id="' . $supplierId . '"');
									    } 
									}

									if(!empty($supplierId)){

										if($ticketAdultCost > 0){   

											$namevalue2 ='suppBookCode="'.$suppBookCode.'",supplierId="'.$supplierId.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",entranceNameId="'.$lastid.'",serviceid="'.$lastid.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultTransferCost.'",childCost="'.$childTransferCost.'",infantCost="'.$infantTransferCost.'",vehicleId="'.$vehicleId.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",gstTax="'.$gstTaxId.'",currencyId="'.$currencyId.'",status="1",marketType="'.$marketTypeId.'",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",nationalityType="'.$nationalityTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"'; 

											addlisting(_DMC_ENTRANCE_RATE_MASTER_,$namevalue2);
											$lineSuccess++; 
										}else{
											$msg='';
											$msg='Row No-'.$rowno.'. Failed: Entrance- '.trim($entranceName).', all rates are blanks...! - '.date('d-m-Y h:ia');
											importErrorlog($msg, $newfilez,$folderName);
											$lineFailed++;
										}
									}else{
										$msg='';
										$msg='Row No-'.$rowno.'. Failed: Supplier Name- '.trim($supplier).' does not exist..! - '.date('d-m-Y h:ia');
										importErrorlog($msg, $newfilez,$folderName);
										$lineFailed++;
									}
								}else{
									$msg='';
									$msg='Row No-'.$rowno.'. Failed - Vehicle Type '.$vehicle.' doesnt exist...! - '.date('d-m-Y h:ia');
									importErrorlog($msg, $newfilez,$folderName);
									$lineFailed++;
								}
							}else{
								$msg='';
								$msg='Row No-'.$rowno.'. Failed - Invalid Transfer Type - '.date('d-m-Y h:ia');
								importErrorlog($msg, $newfilez,$folderName);
								$lineFailed++;
							}
						}else{
							$msg='';
							$msg='Row No-'.$rowno.'. Failed: Currency - '.trim($currencyName).' does not exist...! - '.date('d-m-Y h:ia');
							importErrorlog($msg, $newfilez,$folderName);
							$lineFailed++;
						}
					}
				}else{
					$msg='';
					$msg='Row No-'.$rowno.'. Failed: Invalid Nationality Type ...! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
					$lineFailed++;
				}
			}
		}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
 	<?php 
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Updated('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg, $newfilez,$folderName);
	?>
	parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importpackageentranceModule; ?>','600px','auto');
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
if(isset($_FILES['importfield']['name']) && trim($_POST['importotherActivity'])=='Y'){
	
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php';
	$fileTime=date('H:i:s');
	$duplicaterecored.='';
	$importimportotherActivityModule = trim($_POST['importimportotherActivityModule']);
	if(!empty($_FILES['importfield']['name'])){
		
		$folderName = 'log_sightseeing';
	    $newfilez = formatUrl($_FILES['importfield']['name']); // log file to store textin it
	    $file_name = trim($newfilez).'.xls'; // rename xls file to same as log file + .xls
	    $msg = '';
	    $msg = $newfilez;
	    importErrorlog($msg, $newfilez,$folderName);
	    $msg = '';
	    $msg = $fullurl . "importfile/" . $file_name . " Copy this link to download file ";
	    importErrorlog($msg, $newfilez,$folderName);
	    copy($_FILES['importfield']['tmp_name'], "importfile/" . $file_name);

		$rowno=0;
		$lineSuccess=0;
		$lineExist=0;
		$lineFailed=0;
		$errorReport='';
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		$path="importfile/".$file_name;
		$data->read($path);
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) { 
			$rowno++;
			$sightseeingName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
			$sightseeingCity = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
			$tptType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
			$supplier = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]); 
			$fromDates='';
 			$fromDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][5])));
			if($fromDates=='1970-01-01'){
				$fromDates='';
				$excel_date = $data->sheets[0]["cells"][$x][5];
				$unix_date = ($excel_date - 25569) * 86400; 
				$excel_date = 25569 + ($unix_date / 86400);
				$unix_date = ($excel_date - 25569) * 86400; 
				$dateaa = gmdate("Y-m-d", $unix_date);
				$fromDates=$dateaa;
			}
			$toDates='';
			$toDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][6])));
			if($toDates=='1970-01-01'){
				$toDates='';
				$excel_date1 = $data->sheets[0]["cells"][$x][6];
				$unix_date1 = ($excel_date1 - 25569) * 86400; 
				$excel_date1 = 25569 + ($unix_date1 / 86400);
				$unix_date1 = ($excel_date1 - 25569) * 86400; 
				$date1 = gmdate("Y-m-d", $unix_date1);
				$toDates=$date1;
			} 
			// $marketType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][7]); 
			$nationalityType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][7]); 
			$tarifType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][8]); 
			$transferType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][9]); 
			$currencyName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][10]);
			
			$ticketAdultCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][11]); 
			$ticketchildCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][12]); 
			$ticketinfantCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][13]); 

			$adultTransferCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][14]); 
			$childTransferCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][15]); 
			$infantTransferCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][16]); 
			
			$vehicleType = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][17]); 
			$vehicleCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][18]); 
			$repCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][19]); 
    		$gstTaxId = getGstIdBySlab(trim($data->sheets[0]["cells"][$x][20]),"Entrance");
			$status = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][21]);
			// $daysname = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][22]);
			$sightseeingDetail = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][22]);
			$suppBookCode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][23]);
			
 			
			$nationalityTypeId = 0;
			if (strtoupper($nationalityType) == 'LOCAL') {  $nationalityTypeId = 1;  }
			else if (strtoupper($nationalityType) == 'FOREIGN') {  $nationalityTypeId = 2;  }
			else if (strtoupper($nationalityType) == 'BIMSTEC') {  $nationalityTypeId = 3;  }
			else{ $nationalityTypeId = 0; }


			if (strtoupper($tarifType) == 'NORMAL' || $tarifType == '') {  $tarifTypeId = 1;  }
			else{  $tarifTypeId = 2; }

			$transferTypeId = $tptTypeId = 0;
			if (strtoupper($tptType) == 'SIC') {  $tptTypeId = 1;  }
			elseif(strtoupper($tptType) == 'PVT' || strtoupper($tptType) == 'PRIVATE'){  $tptTypeId = 2; }
			elseif(strtoupper($tptType) == 'VIP'){  $tptTypeId = 3; }
			elseif(strtoupper($tptType) == 'TICKET ONLY'){  $tptTypeId = 4; }
			elseif(strtoupper($tptType) == 'ALL' || strtoupper($tptType) == ''){  $tptTypeId = 0; }
			else{  $tptTypeId = 0; }

			if (strtoupper($transferType) == 'SIC') {  $transferTypeId = 1;  }
			elseif(strtoupper($transferType) == 'PVT' || strtoupper($transferType) == 'PRIVATE'){  $transferTypeId = 2; }
			elseif(strtoupper($transferType) == 'VIP'){  $transferTypeId = 3; }
			elseif(strtoupper($transferType) == 'TICKET ONLY'){  $transferTypeId = 4; }
			elseif($tptTypeId == 0 && $transferTypeId == 0){  $transferTypeId = 0; } // do not accept rate
			else{  $transferTypeId = $tptTypeId;  } // if service is not BOTH type then default is as Service Type



			if (strtoupper($status) == 'ACTIVE' || $status == '1' || $status == '' ) {  $statusc = 1;  }
			if (strtoupper($status) == 'INACTIVE' || $status == '0'){ $statusc = 0; }
			$dateAdded=time();
			$whereDest=' ';
			if($sightseeingName!='' && $sightseeingCity!=''){
				if($nationalityTypeId!=0){

					$rs1=GetPageRecord('*',_DESTINATION_MASTER_,' UPPER(name)="'.strtoupper($sightseeingCity).'" ');
					$destinationData=mysqli_fetch_array($rs1);
					$whereDest=' and FIND_IN_SET("'.$destinationData['id'].'", destinationId) ';
					$sightseeingCity=$destinationData['name'];
					$cityId=$destinationData['id']; 

					$entrQuery = GetPageRecord('*','packageBuilderotherActivityMaster','otherActivityName="'.$sightseeingName.'" and otherActivityCity="'.$sightseeingCity.'"');
				 	if(mysqli_num_rows($entrQuery) > 0){
				 		//update code
						$activityData = mysqli_fetch_array($entrQuery);
						 $namevalue ='otherActivityDetail="'.$sightseeingDetail.'",status="'.$statusc.'",transferType="'.$tptTypeId.'"';
						updatelisting('packageBuilderotherActivityMaster',$namevalue,'id = "'.$activityData['id'].'"');

						$rsc=GetPageRecord('*',_QUERY_CURRENCY_MASTER_,'name="'.trim($currencyName).'" and deletestatus=0');
						$rescurr=mysqli_fetch_array($rsc);
						$currencyId = $rescurr['id'];
						if(mysqli_num_rows($rsc)>0 && $currencyId > 0){

							if($transferTypeId == $tptTypeId || $tptTypeId==0){

								$rsv=GetPageRecord('*','vehicleTypeMaster',' UPPER(name)="'.strtoupper($vehicleType).'" ');
								if((mysqli_num_rows($rsv)>0 && $transferTypeId == 2 || $transferTypeId == 3) || $transferTypeId == 1 || $transferTypeId == 4){
									$resvahicle=mysqli_fetch_array($rsv);

									if($transferTypeId == 1 ){
										$adultTransferCost = $adultTransferCost;
										$childTransferCost = $childTransferCost;

										$vehicleTypeId = $vehicleCost = 0;
									}elseif($transferTypeId == 2 || $transferTypeId == 3 ){
										$vehicleTypeId = $resvahicle['id'];
										$vehicleCost = $vehicleCost;

										$adultTransferCost = $childTransferCost = 0;
									}

									$issup=GetPageRecord('*',_SUPPLIERS_MASTER_,' UPPER(name)="'.strtoupper($supplier).'" '.$whereDest.' and deletestatus=0 and activityType=3 order by id desc ');
									if(mysqli_num_rows($issup)>0){
										$lastIdData = mysqli_fetch_array($issup);
										$supplierId = $lastIdData['id'];
										if( $ticketAdultCost > 0){ 

											$rs1=GetPageRecord('id','dmcotherActivityRate','otherActivityNameId="'.$activityData['id'].'"  and ( fromDate BETWEEN "'.$fromDates.'" and "'.$toDates.'" OR "'.$fromDates.'" BETWEEN fromDate and toDate ) and nationality="'.$nationalityTypeId.'" and tarifType="'.$tarifTypeId.'" and transferType="'.$transferTypeId.'" and supplierId="'.$supplierId.'" and currencyId="'.$currencyId.'" and vehicleId="'.$vehicleTypeId.'",'); 
											if(mysqli_num_rows($rs1)<1){ 
												$namevalue2 ='suppBookCode="'.$suppBookCode.'",supplierId="'.$supplierId.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",otherActivityNameId="'.$activityData['id'].'",serviceid="'.$activityData['id'].'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultTransferCost.'",childCost="'.$childTransferCost.'",infantCost="'.$infantTransferCost.'",vehicleId="'.$vehicleTypeId.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",gstTax="'.$gstTaxId.'",currencyId="'.$currencyId.'",status="1",nationality="'.$nationalityTypeId.'",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
												addlisting('dmcotherActivityRate',$namevalue2);
												$lineSuccess++;
											}else{
												 $namevalue2 ='suppBookCode="'.$suppBookCode.'",supplierId="'.$supplierId.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultTransferCost.'",childCost="'.$childTransferCost.'",infantCost="'.$infantTransferCost.'",vehicleId="'.$vehicleTypeId.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",gstTax="'.$gstTaxId.'",currencyId="'.$currencyId.'",status="1",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",nationality="'.$nationalityTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
												$dmcData = mysqli_fetch_array($rs1);
												updatelisting('dmcotherActivityRate',$namevalue2,'id = "'.$dmcData['id'].'"');
												$lineExist++;
											}
										}else{
											$msg='';
											$msg='Row No-'.$rowno.'. Failed: Sightseeing - '.trim($sightseeingName).', all rates are blanks...! - '.date('d-m-Y h:ia');
											importErrorlog($msg, $newfilez,$folderName);
											$lineFailed++;
										}
									}else{
										$msg='';
										$msg='Row No-'.$rowno.'. Failed: Supplier - '.trim($supplier).' does not exist / Not register for this destination...! - '.date('d-m-Y h:ia');
										importErrorlog($msg, $newfilez,$folderName);
										$lineFailed++;
									}
								}else{
									$msg='';
									$msg='Row No-'.$rowno.'. Failed - Vehicle Name '.$vehicle.' doesnt exist...! - '.date('d-m-Y h:ia');
									importErrorlog($msg, $newfilez,$folderName);
									$lineFailed++;
								}
							}else{
								$msg='';
								$msg='Row No-'.$rowno.'. Failed - Transfer Type should be same as Service Type - '.date('d-m-Y h:ia');
								importErrorlog($msg, $newfilez,$folderName);
								$lineFailed++;
							}

						}else{
							$msg='';
							$msg='Row No-'.$rowno.'. Failed: Currency - '.trim($currency).' not exist...! - '.date('d-m-Y h:ia');
							importErrorlog($msg, $newfilez,$folderName);
							$lineFailed++;
						}
					}else{
						// Add Code tptType
						
						// Monument Code genrated 
						$A = GetPageRecord('displayId','packageBuilderotherActivityMaster','displayId>0 order by displayId desc');
						$ddata = mysqli_fetch_assoc($A);
						$displayId = $ddata['displayId']+1;

					  	$namevalue ='displayId="'.$displayId.'",otherActivityName="'.$sightseeingName.'",otherActivityCity="'.$sightseeingCity.'",transferType="'.$tptTypeId.'",otherActivityDetail="'.$sightseeingDetail.'",status="'.$statusc.'"';
						$lastid = addlistinggetlastid('packageBuilderotherActivityMaster',$namevalue);

						$rsc=GetPageRecord('*',_QUERY_CURRENCY_MASTER_,' UPPER(name)="'.strtoupper(trim($currencyName)).'" and deletestatus=0');
						$rescurr=mysqli_fetch_array($rsc);
						$currencyId = $rescurr['id'];
						if(mysqli_num_rows($rsc)>0 && $currencyId > 0){
							if($transferTypeId == $tptTypeId || $tptTypeId==0){

								$rsv=GetPageRecord('*','vehicleTypeMaster',' UPPER(name)="'.strtoupper($vehicleType).'" ');
								if((mysqli_num_rows($rsv)>0 && $transferTypeId == 2 || $transferTypeId == 3) || ($transferTypeId == 1 || $transferTypeId == 4) ){
									$resvahicle=mysqli_fetch_array($rsv);
									$vehicleTypeId = $resvahicle['id'];
									

									$issup=GetPageRecord('*',_SUPPLIERS_MASTER_,' UPPER(name)="'.strtoupper($supplier).'" '.$whereDest.' and deletestatus=0 and activityType=3 order by id desc ');
									if(mysqli_num_rows($issup)>0){
										$lastIdData = mysqli_fetch_array($issup);
										$supplierId = $lastIdData['id'];
										if($ticketAdultCost > 0){   

											$namevalue2 ='suppBookCode="'.$suppBookCode.'",supplierId="'.$supplierId.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",otherActivityNameId="'.$lastid.'",serviceid="'.$lastid.'",ticketAdultCost="'.$ticketAdultCost.'",ticketchildCost="'.$ticketchildCost.'",ticketinfantCost="'.$ticketinfantCost.'",adultCost="'.$adultTransferCost.'",childCost="'.$childTransferCost.'",infantCost="'.$infantTransferCost.'",vehicleId="'.$vehicleTypeId.'",vehicleCost="'.$vehicleCost.'",repCost="'.$repCost.'",gstTax="'.$gstTaxId.'",currencyId="'.$currencyId.'",status="1",marketType="'.$marketTypeId.'",tarifType="'.$tarifTypeId.'",transferType="'.$transferTypeId.'",nationality="'.$nationalityTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"'; 

											addlisting('dmcotherActivityRate',$namevalue2);
											$lineSuccess++; 
										}else{
											$msg='';
											$msg='Row No-'.$rowno.'. Failed: Sightseeing- '.trim($sightseeingName).', all rates are blanks...! - '.date('d-m-Y h:ia');
											importErrorlog($msg, $newfilez,$folderName);
											$lineFailed++;
										}
									}else{
										$msg='';
										$msg='Row No-'.$rowno.'. Failed: Supplier - '.trim($supplier).' does not exist / Not register for this destination...! - '.date('d-m-Y h:ia');
										importErrorlog($msg, $newfilez,$folderName);
										$lineFailed++;
									}
								}else{
									$msg='';
									$msg='Row No-'.$rowno.'. Failed - Vehicle Name '.$vehicle.' doesnt exist...! - '.date('d-m-Y h:ia');
									importErrorlog($msg, $newfilez,$folderName);
									$lineFailed++;
								}
							}else{
								$msg='';
								$msg='Row No-'.$rowno.'. Failed - Transfer Type should be same as Service Type - '.date('d-m-Y h:ia');
								importErrorlog($msg, $newfilez,$folderName);
								$lineFailed++;
							}
						}else{
							$msg='';
							$msg='Row No-'.$rowno.'. Failed: Currency - '.trim($currencyName).' does not exist...! - '.date('d-m-Y h:ia');
							importErrorlog($msg, $newfilez,$folderName);
							$lineFailed++;
						}
					}
				}else{
					$msg='';
					$msg='Row No-'.$rowno.'. Failed: Invalid Nationality Type ...! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
					$lineFailed++;
				}
			}
		}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
 	<?php 
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Updated('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg, $newfilez,$folderName);
	?>
	parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importimportotherActivityModule; ?>','600px','auto');
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
// sightseeing import code end
if(isset($_FILES['importfield']['name']) && trim($_POST['importsubjectMaster'])=='Y'){
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php';
	$fileTime=date('H:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){
		$importpackageentranceModule = trim($_POST['importsubjectMasteModule']);
		$file_name=$_FILES['importfield']['name'];
		copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
		$rowno=0;
		$lineSuccess=0;
		$lineFailed=0;
		$errorReport='';
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		$path="importfile/".$file_name;
		$data->read($path);
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
			++$rowno;
			$showErrorName='';
			$itineraryTitle = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
			$itineraryDesc = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
			$fromDestinationId = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
			$toDestinationId = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]);
			$transferMode = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][5]);
			$status = trim($data->sheets[0]["cells"][$x][6]);
			if ($status == 'Active') {  $statusc = 1;  }
			if ($status == 'Inactive' || $status == ''){ $statusc = 0; }
			$whereDest='';
			if($fromDestinationId!=''){
				$rs1=GetPageRecord('*',_DESTINATION_MASTER_,'name="'.trim($fromDestinationId).'" and status=1');
				$destinationData=mysqli_fetch_array($rs1);
				$whereDest=' and FIND_IN_SET("'.$destinationData['id'].'", destinationId) ';
				$entranceCity=$destinationData['name'];
				$cityId=$destinationData['id'];
			}
			if($toDestinationId!=''){
				$rs1=GetPageRecord('*',_DESTINATION_MASTER_,'name="'.trim($toDestinationId).'" and status=1');
				$destinationData2=mysqli_fetch_array($rs1);
				$whereDest=' and FIND_IN_SET("'.$destinationData2['id'].'", destinationId) ';
				$toCity=$destinationData2['name'];
				$tocityId=$destinationData2['id'];
			}
			$dateAdded=time();
			if(date('Y', strtotime($fromDates))<date('Y')){
				$msg='';
				$msg='Row No-'.$rowno.'. From Date '.$fromDates.' is not valid...! - '.date('d-m-Y h:ia');
				errorlog($msg,$newfilez,'itineraryTitle_log');
			}
			if(date('Y', strtotime($toDates))<date('Y')){
			$msg='';
			$msg='Row No-'.$rowno.'. To Date '.$toDates.' is not valid...! - '.date('d-m-Y h:ia');
			errorlog($msg,$newfilez,'itineraryTitle_log');
			}
		    if($itineraryTitle=='' || $itineraryDesc==''  || $cityId=='' || $tocityId=='' || $statusc=='' || date('Y', strtotime($fromDates))<date('Y') || date('Y', strtotime($toDates))<date('Y') ){
		    if($itineraryTitle==''){ $showErrorName.='Title Name,';
				$msg='';
				$msg='Row No-'.$rowno.'. Title Name is not valid...! - '.date('d-m-Y h:ia');
				errorlog($msg,$newfilez,'itineraryTitle_log');
			 }
			 if($itineraryDesc==''){ $showErrorName.='Description ,';
				$msg='';
				$msg='Row No-'.$rowno.'. Description is not valid...! - '.date('d-m-Y h:ia');
				errorlog($msg,$newfilez,'itineraryTitle_log');
			 }
		     if($cityId==''){ $showErrorName.='From Destinatino,';
				$msg='';
				$msg='Row No-'.$rowno.'. From Destinatino is not valid...! - '.date('d-m-Y h:ia');
			 	errorlog($msg,$newfilez,'itineraryTitle_log');
			 }
			 if($tocityId==''){ $showErrorName.='To Destinatino,';
				 $msg='';
				 $msg='Row No-'.$rowno.'. To Destinatino is not valid...! - '.date('d-m-Y h:ia');
			 	errorlog($msg,$newfilez,'itineraryTitle_log');
			 }
		    if($statusc==''){ $showErrorName.='Status Name,';
				$msg='';
				$msg='Row No-'.$rowno.'. Status Name is not valid...! - '.date('d-m-Y h:ia');
				errorlog($msg,$newfilez,'itineraryTitle_log');
			 }
			}
			$rs1="";
			$rs1=GetPageRecord('id','iti_subjectmaster','otherTitle="'.$itineraryTitle.'"');
		    if(mysqli_num_rows($rs1) > 0){
				$iti_info_Data=mysqli_fetch_array($rs1);
				$namevalue='description="'.$itineraryDesc.'",fromDestinationId="'.$cityId.'",toDestinationId="'.$tocityId.'",transferMode="'.$transferMode.'",status="'.$statusc.'"';
				$update = updatelisting('iti_subjectmaster',$namevalue,'id="'.$iti_info_Data['id'].'"');
		    	$msg='';
		    	$msg='Row No-'.$rowno.'. Itinerary information is updated successfully! - '.date('d-m-Y h:ia');
		    	errorlogssx($msg,$fileTime,'itineraryTitle_log'); 
		    	$lineExist++;
		    }
		    if($itineraryTitle!='' && mysqli_num_rows($rs1) < 1){
				$namevalue='otherTitle="'.$itineraryTitle.'",description="'.$itineraryDesc.'",fromDestinationId="'.$cityId.'",toDestinationId="'.$tocityId.'",transferMode="'.$transferMode.'",status="'.$statusc.'"';
				addlistinggetlastid('iti_subjectmaster',$namevalue);
				$lineSuccess++;
		    }
		    //$rowno++;
		}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php if($duplicaterecored!=''){
		$msg='';
		$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		errorlog($msg,$fileTime,'itineraryTitle_log');
		?>
		parent.alertspopupopen('action=foundduplicaterecoreds&pagename=<?php echo $importpackageentranceModule; ?>','600px','auto');
	<?php } else {
		$msg='';
		$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		errorlog($msg,$fileTime,'itineraryTitle_log');
		?>
		parent.alertspopupopen('action=foundduplicaterecoreds&done=1&pagename=<?php echo $importpackageentranceModule; ?>','600px','auto');
	<?php } ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
if(isset($_FILES['importfield']['name']) && trim($_POST['importdescriptionMaster'])=='Y'){
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php';
	$fileTime=date('H:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){
	$importpackageentranceModule = trim($_POST['importdescriptionMasteModule']);
	$file_name=$_FILES['importfield']['name'];
	copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
	$rowno=0;
	$lineSuccess=0;
	$lineFailed=0;
	$errorReport='';
	$data = new Spreadsheet_Excel_Reader();
	$data->setOutputEncoding('CP1251');
	$path="importfile/".$file_name;
	$data->read($path);
	for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
		++$rowno;
		$showErrorName='';
		$name = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
		$fromDestinationId = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
		$toDestinationId = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
		$status = $data->sheets[0]["cells"][$x][4];
		$fromDates='';
		$fromDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][5])));
		if($fromDates=='1970-01-01'){
		$fromDates='';
			$excel_date = $data->sheets[0]["cells"][$x][5];
			$unix_date = ($excel_date - 25569) * 86400;
			$excel_date = 25569 + ($unix_date / 86400);
			$unix_date = ($excel_date - 25569) * 86400;
			$dateaa = gmdate("Y-m-d", $unix_date);
			$fromDates=$dateaa;
		}
		$toDates='';
	  	$toDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][6])));
		if($toDates=='1970-01-01'){
		$toDates='';
			$excel_date1 = $data->sheets[0]["cells"][$x][6];
			$unix_date1 = ($excel_date1 - 25569) * 86400;
			$excel_date1 = 25569 + ($unix_date1 / 86400);
			$unix_date1 = ($excel_date1 - 25569) * 86400;
			$date1 = gmdate("Y-m-d", $unix_date1);
			$toDates=$date1;
		}
		if ($status == 'Active') {  $statusc = 1;  }
		if ($status == 'Inactive' || $status == ''){ $statusc = 0; }
		    $whereDest='';
		    if($fromDestinationId!=''){
		    $rs1=GetPageRecord('*',_DESTINATION_MASTER_,'name="'.trim($fromDestinationId).'" and status=1');
			$destinationData=mysqli_fetch_array($rs1);
			$whereDest=' and FIND_IN_SET("'.$destinationData['id'].'", destinationId) ';
			$entranceCity=$destinationData['name'];
			$cityId=$destinationData['id'];
		    }if($toDestinationId!=''){
		    $rs1=GetPageRecord('*',_DESTINATION_MASTER_,'name="'.trim($toDestinationId).'" and status=1');
			$destinationData2=mysqli_fetch_array($rs1);
			$whereDest=' and FIND_IN_SET("'.$destinationData2['id'].'", destinationId) ';
			$toCity=$destinationData2['name'];
			$tocityId=$destinationData2['id'];
		    }
		$dateAdded=time();
		if(date('Y', strtotime($fromDates))<date('Y')){
		$msg='';
		$msg='Row No-'.$rowno.'. From Date '.$fromDates.' is not valid...! - '.date('d-m-Y h:ia');
		errorlog($msg,$newfilez,'description_log');
		}
		if(date('Y', strtotime($toDates))<date('Y')){
		$msg='';
		$msg='Row No-'.$rowno.'. To Date '.$toDates.' is not valid...! - '.date('d-m-Y h:ia');
		errorlogd($msg,$newfilez,'description_log');
		}
	    if($name=='' || $cityId=='' || $tocityId=='' || $statusc=='' || date('Y', strtotime($fromDates))<date('Y') || date('Y', strtotime($toDates))<date('Y') ){
	    if($name==''){ $showErrorName.='Itinerary Title,';
		$msg='';
		$msg='Row No-'.$rowno.'. Itinerary Title is not valid...! - '.date('d-m-Y h:ia');
		errorlogd($msg,$newfilez,'description_log');
		 }
		 if($cityId==''){ $showErrorName.='From Destinatino,';
		$msg='';
		$msg='Row No-'.$rowno.'. From Destinatino is not valid...! - '.date('d-m-Y h:ia');
		errorlogd($msg,$newfilez,'description_log');
		 }
		 if($tocityId==''){ $showErrorName.='To Destinatino,';
		 $msg='';
		 $msg='Row No-'.$rowno.'. To Destinatino is not valid...! - '.date('d-m-Y h:ia');
		 errorlogd($msg,$newfilez,'description_log');
		 }
	    if($statusc==''){ $showErrorName.='Status Name,';
		$msg='';
		$msg='Row No-'.$rowno.'. Status Name is not valid...! - '.date('d-m-Y h:ia');
		errorlogd($msg,$newfilez,'description_log');
		 }
	}
	$where='description="'.$name.'"';
	$addnewyes = checkduplicate('itineraryDescriptionMaster',$where);
	if($addnewyes=='yes'){
	$duplicaterecored.='<div>'.clean($name).'</div>';
	$lineFailed++;
	}
	if($name!='' && $addnewyes=='no'){
		$namevalue ='description="'.$name.'",fromDestinationId="'.$cityId.'",toDestinationId="'.$tocityId.'",status="'.$statusc.'"';
		$lastid = addlisting('itineraryDescriptionMaster',$namevalue);
		$lineSuccess++;
	}
	}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php if($duplicaterecored!=''){
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	errorlogd($msg,$fileTime,'description_log');
	?>
	parent.alertspopupopen('action=foundduplicaterecoredd&pagename=<?php echo $importpackageentranceModule; ?>','600px','auto');
	<?php } else {
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	errorlogd($msg,$fileTime,'description_log');
	?>
	parent.alertspopupopen('action=foundduplicaterecoredd&done=1&pagename=<?php echo $importpackageentranceModule; ?>','600px','auto');
	<?php } ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
if(isset($_FILES['importfield']['name']) && trim($_POST['importguidMaster'])=='Y'){  
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php';
	$fileTime=date('h:i:s');
	if(!empty($_FILES['importfield']['name'])){
		$importguidMasterModule = trim($_POST['importguidMasterModule']);
		$file_name=$_FILES['importfield']['name'];
	    copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
	    $rowno=0;
	    $lineSuccess=0;
	    $lineFailed=0;
	    $lineExist=0;
	    $errorReport='';
	    $data = new Spreadsheet_Excel_Reader();
	    $data->setOutputEncoding('CP1251');
	    $path="importfile/".$file_name;
	    $data->read($path);
	    for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
	    	++$rowno;
	    	$guideName= cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
		    $serviceTypes = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
		    $phoneno = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
	        $emaiaddress = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]);
		    $address = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][5]);
		    $destination = explode(',',cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][6])); 					   
		    $statuss= trim($data->sheets[0]["cells"][$x][7]);
		    if($statuss=='Active'){

               $status = '1';
		    }else{
		       $status = '0';
		    }
		    if($serviceTypes=='Guide'){ 
               $serviceType = '0';
		    }elseif($serviceTypes=='Porter'){
		       $serviceType = '1';
		    }else{
		       $serviceType = '';	
		    }
		    $destinationlist = '';
            foreach ($destination as $destinationname) {
            	$issup=GetPageRecord('*',_DESTINATION_MASTER_,' name="'.trim($destinationname).'" order by id desc ');
		        $lastIdData = mysqli_fetch_array($issup);
                $destinationlist.= $lastIdData['id'].',';
            }
            $destinationId=rtrim($destinationlist,',');
		    if($guideName!=''){
               $where='name="'.$guideName.'"';
			   $addnewyesn = checkduplicate(_GUIDE_MASTER_,$where);
			   if($addnewyesn=='yes'){
			   	 $msg='';
	    		 $msg='Row No-'.$rowno.'. Guide already exist.! - '.date('d-m-Y h:ia');
	    		  importErrorlog($msg,$fileTime,'guide_log');
	    		  $lineExist++;
			   }
		    }else{
		    	$msg='';
				$msg='Row No-'.$rowno.'. Guide- '.trim($guideName).', Guide Field are blanks...! - '.date('d-m-Y h:ia');
				importErrorlog($msg,$fileTime,'guide_log');
				$lineFailed++;
		    }
		    if($emaiaddress!=''){
               $where='email="'.$emaiaddress.'"';
			   $addnewyese = checkduplicate(_GUIDE_MASTER_,$where);
			   if($addnewyese=='yes'){
			   	 $msg='';
	    		 $msg='Row No-'.$rowno.'. Email Address already exist.! - '.date('d-m-Y h:ia');
	    		  importErrorlog($msg,$fileTime,'guide_log');
	    		  $lineExist++;
			   }
		    }
		    if($addnewyesn=='no' && $addnewyese=='no'){
               $namevalue ='name="'.$guideName.'",email="'.$emaiaddress.'",serviceType="'.$serviceType.'",phone="'.$phoneno.'",address="'.$address.'",destinationList="'.$destinationId.'",status="'.$status.'"';
               $lastid = addlisting(_GUIDE_MASTER_,$namevalue);
               $lineSuccess++; 
		    }
	    }
	}?>

	<script>
		parent.$('#importfield').remove();
		parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');

	 	<?php 
		$msg='';
		$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'guide_log');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importguidMasterModule; ?>','600px','auto');

	 
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		</script>

	<?php 

}
if(isset($_FILES['importfield']['name']) && trim($_POST['importguidsubMaster'])=='Y'){
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php';
	$fileTime=date('h:i:s');
	if(!empty($_FILES['importfield']['name'])){
		$importguidsubMasterModule = trim($_POST['importguidsubMasterModule']);
		$file_name=$_FILES['importfield']['name'];
	    copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
	    $rowno=1;
	    $lineSuccess=0;
	    $lineFailed=0;
	    $lineExist=0;
	    $errorReport='';
	    $data = new Spreadsheet_Excel_Reader();
	    $data->setOutputEncoding('CP1251');
	    $path="importfile/".$file_name;
	    $data->read($path);
	    for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
	    	++$rowno;
	    	$serviceName= cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
		    $suplierName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
		    $fromDates='';
			$fromDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][3])));
			if($fromDates=='1970-01-01'){
				$fromDates='';
				$excel_date = $data->sheets[0]["cells"][$x][4];
				$unix_date = ($excel_date - 25569) * 86400;
				$excel_date = 25569 + ($unix_date / 86400);
				$unix_date = ($excel_date - 25569) * 86400;
				$dateaa = gmdate("Y-m-d", $unix_date);
				$fromDates=$dateaa;
			}
			$toDates='';
			$toDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][4])));
			if($toDates=='1970-01-01'){
				$toDates='';
				$excel_date1 = $data->sheets[0]["cells"][$x][5];
				$unix_date1 = ($excel_date1 - 25569) * 86400;
				$excel_date1 = 25569 + ($unix_date1 / 86400);
				$unix_date1 = ($excel_date1 - 25569) * 86400;
				$date1 = gmdate("Y-m-d", $unix_date1);
				$toDates=$date1;
			} 
			$serviceTypes = trim($data->sheets[0]["cells"][$x][5]);
			if($serviceTypes=='Guide'){
               $serviceType = '0';
		    }elseif($serviceTypes=='Porter'){
		       $serviceType = '1';
		    }else{
		       $serviceType = '';	
		    }
		    $guideCost = trim($data->sheets[0]["cells"][$x][6]);
		    $currency = trim($data->sheets[0]["cells"][$x][7]);
		    // $marketType = $data->sheets[0]["cells"][$x][8];
            $maxpax = trim($data->sheets[0]["cells"][$x][8]);
            $daysname = $data->sheets[0]["cells"][$x][9];
            $universalcosts = $data->sheets[0]["cells"][$x][10];
            if($universalcosts=='No'){
                $universalcost=='1';
            }
            if($universalcosts=='Yes'){
                $universalcost=='0';
            }
            if($universalcosts=='No'){
               $guideName = $data->sheets[0]["cells"][$x][11];	
            }

            if($daysname=='Half Day' || $daysname=='halfday' || $daysname=='half day'){
               $daysname = 'halfday';
		    }else{
		       $daysname = 'fullday';
		    }
		    
		    $statuss= trim($data->sheets[0]["cells"][$x][12]);
		    if($statuss=='Active'){
               $status = '1';
		    }else{
		       $status = '0';
		    }
			// $rsMkt=GetPageRecord('id','marketMaster','name="'.trim($marketType).'" order by name asc');
			// $marketTypeId=1;
			// if(mysqli_num_rows($rsMkt)>0){
			// 	$resMarkt=mysqli_fetch_array($rsMkt);
			// 	$marketTypeId = $resMarkt['id'];
			// }
			if($serviceName!=''){
               $gserviceQuery = GetPageRecord('*',_GUIDE_SUB_CAT_MASTER_,'name="'.$serviceName.'"');
               if(mysqli_num_rows($gserviceQuery) > 0){
               	  $guideServiceData = mysqli_fetch_array($gserviceQuery);
               	  $namevalue ='name="'.$serviceName.'",status="1"';
				  updatelisting(_GUIDE_SUB_CAT_MASTER_,$namevalue,'id = "'.$guideServiceData['id'].'"');
				  $rsc=GetPageRecord('*',_QUERY_CURRENCY_MASTER_,'name="'.trim($currency).'"');
				  $rescurr=mysqli_fetch_array($rsc);
				  $currencyId = $rescurr['id'];
				  if(mysqli_num_rows($rsc)>0 && $currencyId > 0 ){ 
				  	$issup=GetPageRecord('*',_SUPPLIERS_MASTER_,' name="'.trim($suplierName).'"  and deletestatus=0  order by id desc ');
				  	if(mysqli_num_rows($issup)>0){
				  		$lastIdData = mysqli_fetch_array($issup);
						$supplierId = $lastIdData['id'];
						if($guideCost>0){
							$rs1=GetPageRecord('id','dmcGuidePorterRate','serviceid="'.$guideServiceData['id'].'"  and ( fromDate BETWEEN "'.$fromDates.'" and "'.$toDates.'" OR "'.$fromDates.'" BETWEEN fromDate and toDate ) and currencyId="'.$currencyId.'"'); 
							if(mysqli_num_rows($rs1)<1){
								$namevalue2 ='supplierId="'.$supplierId.'",dayType="'.$daysname.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",serviceid="'.$guideServiceData['id'].'",price="'.$guideCost.'",currencyId="'.$currencyId.'",status="1",marketType="'.$marketTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
									addlisting('dmcGuidePorterRate',$namevalue2);
									$lineSuccess++;
							}else{
									$namevalue2 ='supplierId="'.$supplierId.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",serviceid="'.$guideServiceData['id'].'",price="'.$guideCost.'",currencyId="'.$currencyId.'",status="1",marketType="'.$marketTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
									$dmcData = mysqli_fetch_array($rs1);
									updatelisting('dmcGuidePorterRate',$namevalue2,'id = "'.$dmcData['id'].'"');
									$lineExist++;
							}
						}else{
							$msg='';
								$msg='Row No-'.$rowno.'. Guide/Porter Service- '.trim($serviceName).', all rates are blanks...! - '.date('d-m-Y h:ia');
								importErrorlog($msg,$fileTime,'guidesub_log');
								$lineFailed++;
						}
				  	}else{
							$msg='';
							$msg='Row No-'.$rowno.'. Supplier - '.trim($suplierName).' not exist...! - '.date('d-m-Y h:ia');
							importErrorlog($msg,$fileTime,'guidesub_log');
							$lineFailed++;
						}
				  }else{
						$msg='';
						$msg='Row No-'.$rowno.'. Currency - '.trim($currency).' not exist...! - '.date('d-m-Y h:ia');
						importErrorlog($msg,$fileTime,'guidesub_log');
						$lineFailed++;
					}
               }else{
               	$namevalue ='name="'.$serviceName.'",status="1",createdBy="'.$_SESSION['userid'].'"';
				$lastid = addlistinggetlastid(_GUIDE_SUB_CAT_MASTER_,$namevalue);
				$rsc=GetPageRecord('*',_QUERY_CURRENCY_MASTER_,'name="'.trim($currency).'"');
				$rescurr=mysqli_fetch_array($rsc);
				$currencyId = $rescurr['id'];
				if(mysqli_num_rows($rsc)>0 && $currencyId > 0){
					$issup=GetPageRecord('*',_SUPPLIERS_MASTER_,' name="'.trim($suplierName).'" and deletestatus=0  order by id desc ');
					if(mysqli_num_rows($issup)>0){
					    $lastIdData = mysqli_fetch_array($issup);
						$supplierId = $lastIdData['id'];
							if($guideCost > 0){  
								$namevalue2 ='supplierId="'.$supplierId.'",dayType="'.$daysname.'",fromDate="'.$fromDates.'",toDate="'.$toDates.'",serviceid="'.$lastid.'",price="'.$guideCost.'",currencyId="'.$currencyId.'",status="1",marketType="'.$marketTypeId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
								addlisting('dmcGuidePorterRate',$namevalue2);
								$lineSuccess++; 
							}else{
								$msg='';
								$msg='Row No-'.$rowno.'. Guide/Porter- '.trim($serviceName).', all rates are blanks...! - '.date('d-m-Y h:ia');
								importErrorlog($msg,$fileTime,'guidesub_log');
								$lineFailed++;
							}
						}else{
							$msg='';
							$msg='Row No-'.$rowno.'. Supplier - '.trim($suplierName).' not exist...! - '.date('d-m-Y h:ia');
							importErrorlog($msg,$fileTime,'guidesub_log');
							$lineFailed++;
						}
				}else{
						$msg='';
						$msg='Row No-'.$rowno.'. Currency - '.trim($currency).' not exist...! - '.date('d-m-Y h:ia');
						importErrorlog($msg,$fileTime,'guidesub_log');
						$lineFailed++;
					}
               }
               $rowno++;
			}
	    }
	} ?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php 
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg,$fileTime,'guidesub_log');
	?>
	parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importguidsubMasterModule; ?>','600px','auto');
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php 
}

if(isset($_FILES['importfield']['name']) && trim($_POST['importdriverMaster'])=='Y'){
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php';
	$fileTime=date('H:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){
	$importpackageentranceModule = trim($_POST['importdriverMasteModule']);
	$file_name=$_FILES['importfield']['name'];
	copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
	$rowno=0;
	$lineSuccess=0;
	$lineFailed=0;
	$lineExist=0;
	$errorReport='';
	$data = new Spreadsheet_Excel_Reader();
	$data->setOutputEncoding('CP1251');
	$path="importfile/".$file_name;
	$data->read($path);
	for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
		++$rowno;
		$showErrorName='';
		$name = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
		$phone = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
		$vehcileName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
		$countryId = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]);
		$passport = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][5]);
		$whatsAppNo = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][6]);
		$licenseNo = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][7]);
		$vehcileCapacity = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][8]);
		$status = $data->sheets[0]["cells"][$x][9];
		$fromDates='';
		$fromDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][10])));
		if($fromDates=='1970-01-01'){
		$fromDates='';
			$excel_date = $data->sheets[0]["cells"][$x][10];
			$unix_date = ($excel_date - 25569) * 86400;
			$excel_date = 25569 + ($unix_date / 86400);
			$unix_date = ($excel_date - 25569) * 86400;
			$dateaa = gmdate("Y-m-d", $unix_date);
			$fromDates=$dateaa;
		}
		$toDates='';
	  	$toDates = date("Y-m-d", strtotime(trim($data->sheets[0]["cells"][$x][11])));
		if($toDates=='1970-01-01'){
		$toDates='';
			$excel_date1 = $data->sheets[0]["cells"][$x][11];
			$unix_date1 = ($excel_date1 - 25569) * 86400;
			$excel_date1 = 25569 + ($unix_date1 / 86400);
			$unix_date1 = ($excel_date1 - 25569) * 86400;
			$date1 = gmdate("Y-m-d", $unix_date1);
			$toDates=$date1;
		}
		$whereDest='';
		if($countryId!=''){
		$rs1=GetPageRecord('*',_COUNTRY_MASTER_,'name="'.trim($countryId).'" and status=1');
		$countryData=mysqli_fetch_array($rs1);
		$whereDest=' and FIND_IN_SET("'.$countryData['id'].'", countryId) ';
		$countryName=$countryData['name'];
		$countryId=$countryData['id'];
		}
		if ($status == 'Active') {  $statusc = 1;  }
		if ($status == 'Inactive' || $status == ''){ $statusc = 0; }
		$dateAdded=time();
		if(date('Y', strtotime($fromDates))<date('Y')){
		$msg='';
		$msg='Row No-'.$rowno.'. From Date '.$fromDates.' is not valid...! - '.date('d-m-Y h:ia');
		errorlog($msg,$newfilez);
		}
		if(date('Y', strtotime($toDates))<date('Y')){
		$msg='';
		$msg='Row No-'.$rowno.'. To Date '.$toDates.' is not valid...! - '.date('d-m-Y h:ia');
		errorlog($msg,$newfilez);
		}
	    if($name=='' || $phone=='' || $vehcileName=='' || $countryId=='' || $passport=='' || $whatsAppNo=='' || $licenseNo=='' || $vehcileCapacity=='' || $statusc=='' || date('Y', strtotime($fromDates))<date('Y') || date('Y', strtotime($toDates))<date('Y') ){
	    if($name==''){ $showErrorName.='Name,';
		 $msg='';
		 $msg='Row No-'.$rowno.'. Name is not valid...! - '.date('d-m-Y h:ia');
		 errorlog($msg,$newfilez,'driver_log');
	     $lineFailed++;
		 }
		 if($phone==''){ $showErrorName.='Phone Number,';
		 $msg='';
		 $msg='Row No-'.$rowno.'. Phone Number is not valid...! - '.date('d-m-Y h:ia');
		 errorlog($msg,$newfilez,'driver_log');
	     $lineFailed++;
		 }
		 if($vehcileName==''){ $showErrorName.='Vehcile Name,';
		 $msg='';
		 $msg='Row No-'.$rowno.'. Vehcile Name is not valid...! - '.date('d-m-Y h:ia');
		 errorlog($msg,$newfilez,'driver_log');
	     $lineFailed++;
		 }
		 /*if($countryId==''){ $showErrorName.='Country Name,';
		 $msg='';
		 $msg='Row No-'.$rowno.'. Country Name is not valid...! - '.date('d-m-Y h:ia');
		 errorlog($msg,$newfilez,'driver_log');
	     $lineFailed++;
		 }*/
		 if($whatsAppNo==''){ $showErrorName.='Whatsapp Number,';
		 $msg='';
		 $msg='Row No-'.$rowno.'. Whatsapp Number is not valid...! - '.date('d-m-Y h:ia');
		 errorlog($msg,$newfilez,'driver_log');
	     $lineFailed++;
		 }
	     if($statusc==''){ $showErrorName.='Status Name,';
		 $msg='';
		 $msg='Row No-'.$rowno.'. Status Name is not valid...! - '.date('d-m-Y h:ia');
		 errorlog($msg,$newfilez);
	     $lineFailed++;
		 }
	}
	$where='name="'.$name.'"';
	$addnewyes = checkduplicate(_DRIVER_MASTER_MASTER_,$where);
	if($addnewyes=='yes'){
	$duplicaterecored.='<div>'.clean($name).'</div>';
	$lineFailed++;
	}
	if($name!='' && $addnewyes=='no'){
	$namevalue ='name="'.$name.'",mobile="'.$phone.'",vehcileName="'.$vehcileName.'",countryId="'.$countryId.'",passportNo="'.$passport.'",whatsappNo="'.$whatsAppNo.'",licenseNo="'.$licenseNo.'",vehcileCapacity="'.$vehcileCapacity.'",status="'.$statusc.'"';
	addlisting(_DRIVER_MASTER_MASTER_,$namevalue);
	$lineSuccess++;
	}
	}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php if($duplicaterecored!=''){
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	errorlogdr($msg,$fileTime,'driver_log');
	?>
	parent.alertspopupopen('action=foundduplicaterecoreddriver&pagename=<?php echo $importpackageentranceModule; ?>','600px','auto');
	<?php } else {
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	errorlogdr($msg,$fileTime,'driver_log');
	?>
	parent.alertspopupopen('action=foundduplicaterecoreddriver&done=1&pagename=<?php echo $importpackageentranceModule; ?>','600px','auto');
	<?php } ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
} 


if(isset($_FILES['importfield']['name']) && trim($_POST['importAirlineMaster'])=='Y'){ 
	date_default_timezone_set('Asia/Kolkata');
	require_once 'reader.php'; 
	$duplicaterecored.=''; 
	$importAirlineMasterModule = trim($_POST['importAirlineMasterModule']);
	if(!empty($_FILES['importfield']['name'])){

		$folderName = 'log_airline';
	    $newfilez = formatUrl($_FILES['importfield']['name']); // log file to store textin it
	    $file_name = trim($newfilez).'.xls'; // rename xls file to same as log file + .xls
	    $msg = '';
	    $msg = $newfilez;
	    importErrorlog($msg, $newfilez,$folderName);
	    $msg = '';
	    $msg = $fullurl . "importfile/" . $file_name . " Copy this link to download file ";
	    importErrorlog($msg, $newfilez,$folderName);
	    copy($_FILES['importfield']['tmp_name'], "importfile/" . $file_name);

		///// GET ERROR -------------------------------------
		$errorReportHeader='<div><strong>Line No.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Error Report</strong></div><br>';    	
	    $rowno=0;
	    $lineSuccess=0;
	    $lineFailed=0;
	    $lineExist=0;
	    $errorReport='';
	    $data = new Spreadsheet_Excel_Reader();
	    $data->setOutputEncoding('CP1251');
	    $path="importfile/".$file_name;
	    $data->read($path);
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
			++$rowno;
			$showErrorName='';
			$flightName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][1]);
			$flightImage = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
			$flightNumber = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
			$flightClass = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]);
			$fromDestination = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][5]);
			$toDestination = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][6]);
			$supplierName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][7]);
			$currencyName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][8]);

			$adultCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][9]);
			$adultTax = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][10]);

			$childCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][11]);
			$childTax = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][12]);

			$infantCost = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][13]);
			$infantTax = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][14]);
			$gstTax = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][15]);

			$baggageAllowance = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][16]);
			$cancelationPolicy = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][17]);
			$remarks = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][18]);
			$status = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][19]);

			if (strtoupper($status) == 'INACTIVE' || strtoupper($status) == 'IN ACTIVE' || strtoupper($status) == 'IN-ACTIVE'){
				$statusc = 0;
			} else{
				$statusc = 1;
			}

			$rsFD = GetPageRecord('id,name','destinationMaster','UPPER(name)="'.strtoupper($fromDestination).'"');
			$fromDestD = mysqli_fetch_assoc($rsFD);
			$fromDestId = $fromDestD['id'];

			$rsTD = GetPageRecord('id,name','destinationMaster','UPPER(name)="'.strtoupper($toDestination).'"');
			$toDestD = mysqli_fetch_assoc($rsTD);
			$toDestId = $toDestD['id'];

			$rsSP = GetPageRecord('id,name','suppliersMaster','UPPER(name)="'.strtoupper($supplierName).'"');
			$supplierD = mysqli_fetch_assoc($rsSP);
			$supplierId = $supplierD['id'];
			
			$gstId = getGstIdBySlab($gstTax,'Airlines');
			$flightClass = str_replace(' ','_',$flightClass);

			if($flightName=='' || $currencyName=='' || $flightNumber=='' || $adultCost=='' || $flightClass==''){
				if($flightName==''){ $showErrorName.='Flight Name,';
					$msg='';
					$msg='Row No-'.$rowno.'. Flight Name is not valid...! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
				}
				if($currencyName==''){ $showErrorName.='Currency,';
					$msg='';
					$msg='Row No-'.$rowno.'. Currency Field is empty...! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
				}
				if($flightNumber==''){ $showErrorName.='Flight Number,';
					$msg='';
					$msg='Row No-'.$rowno.'. Flight Number is empty...! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
				}
				if($adultCost==''){ $showErrorName.='Adult Cost,';
					$msg='';
					$msg='Row No-'.$rowno.'. Adult Cost is empty! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
				}

				if($flightClass==''){ $showErrorName.='Flight Class,';
					$msg='';
					$msg='Row No-'.$rowno.'. Flight Class is empty! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
				}
			}else{

				$flightQuery='';
				$flightQuery=GetPageRecord('*',_PACKAGE_BUILDER_AIRLINES_MASTER_,' UPPER(flightName) = "'.strtoupper($flightName).'" and deletestatus=0');
				if(mysqli_num_rows($flightQuery)>0){
					$flightData = mysqli_fetch_array($flightQuery);
					// $namevalue ='flightName="'.$flightName.'",status="1"';
					// updatelisting(_PACKAGE_BUILDER_AIRLINES_MASTER_,$namevalue,'id = "'.$flightData['id'].'"');
					$rsc='';
					$rsc=GetPageRecord('*',_QUERY_CURRENCY_MASTER_,' UPPER(name) = "'.strtoupper($currencyName).'" and status=1');
					$rescurr=mysqli_fetch_array($rsc);
					$currencyId = $rescurr['id'];
					if(mysqli_num_rows($rsc)>0 && $currencyId > 0 ){  
						if($adultCost>0){

							$airlineRateQuery=GetPageRecord('id','dmcAirlineMasterRate','serviceid="'.$flightData['id'].'" and flightClass="'.ucwords($flightClass).'" and flightNumber="'.$flightNumber.'" and currencyId="'.$currencyId.'"'); 
							if(mysqli_num_rows($airlineRateQuery)<1){
								$namevalue2 ='adultCost="'.$adultCost.'",adultTax="'.$adultTax.'",totalAdultCost="'.($adultCost+$adultTax).'",childCost="'.$childCost.'",childTax="'.$childTax.'",totalChildCost="'.($childCost+$childTax).'",flightNumber="'.$flightNumber.'",infantCost="'.$infantCost.'",infantTax="'.$infantTax.'",totalInfantCost="'.($infantCost+$infantTax).'",baggageAllowance="'.$baggageAllowance.'",remarks="'.$remarks.'",currencyId="'.$currencyId.'",flightClass="'.ucwords($flightClass).'",fromDestination="'.$fromDestId.'",toDestination="'.$toDestId.'",supplierId="'.$supplierId.'",status="'.$statusc.'",cancellationPolicy="'.$cancelationPolicy.'",gstTax="'.$gstId.'",serviceid="'.$flightData['id'].'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
								addlisting('dmcAirlineMasterRate',$namevalue2);
								$lineSuccess++;
							}else{
								$namevalue2 ='adultCost="'.$adultCost.'",adultTax="'.$adultTax.'",totalAdultCost="'.($adultCost+$adultTax).'",childCost="'.$childCost.'",childTax="'.$childTax.'",totalChildCost="'.($childCost+$childTax).'",flightNumber="'.$flightNumber.'",infantCost="'.$infantCost.'",infantTax="'.$infantTax.'",totalInfantCost="'.($infantCost+$infantTax).'",baggageAllowance="'.$baggageAllowance.'",remarks="'.$remarks.'",flightClass="'.ucwords($flightClass).'",fromDestination="'.$fromDestId.'",toDestination="'.$toDestId.'",supplierId="'.$supplierId.'",status="'.$statusc.'",cancellationPolicy="'.$cancelationPolicy.'",gstTax="'.$gstId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
								$airlineRateData = mysqli_fetch_array($airlineRateQuery);
								updatelisting('dmcAirlineMasterRate',$namevalue2,'id = "'.$airlineRateData['id'].'"');
								$lineExist++;
							}
						}else{
							$msg='';
							$msg='Row No-'.$rowno.'. Airline Name - '.trim($flightName).', all rates are blanks...! - '.date('d-m-Y h:ia');
							importErrorlog($msg,$newfilez,$folderName);
							$lineFailed++;
						}
					}else{
						$msg='';
						$msg='Row No-'.$rowno.'. Currency - '.trim($currencyName).' does not exist...! - '.date('d-m-Y h:ia');
						importErrorlog($msg,$newfilez,$folderName);
						$lineFailed++;
					}
				}else{
					$namevalue ='flightName="'.$flightName.'",flightImage="'.$flightImage.'",status=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
					$lastId = addlistinggetlastid(_PACKAGE_BUILDER_AIRLINES_MASTER_,$namevalue);

					$rsc='';
					$rsc=GetPageRecord('*',_QUERY_CURRENCY_MASTER_,' UPPER(name) = "'.strtoupper($currencyName).'" and status=1');
					$rescurr=mysqli_fetch_array($rsc);
					$currencyId = $rescurr['id'];

					if(mysqli_num_rows($rsc)>0 && $currencyId > 0){
						if($adultCost > 0){  
							$namevalue2 ='flightNumber="'.$flightNumber.'",currencyId="'.$currencyId.'",adultCost="'.$adultCost.'",adultTax="'.$adultTax.'",totalAdultCost="'.($adultCost+$adultTax).'",childCost="'.$childCost.'",childTax="'.$childTax.'",totalChildCost="'.($childCost+$childTax).'",serviceid="'.$lastId.'",infantCost="'.$infantCost.'",infantTax="'.$infantTax.'",totalInfantCost="'.($infantCost+$infantTax).'",baggageAllowance="'.$baggageAllowance.'",flightClass="'.ucwords($flightClass).'",fromDestination="'.$fromDestId.'",toDestination="'.$toDestId.'",supplierId="'.$supplierId.'",remarks="'.$remarks.'",status="'.$statusc.'",cancellationPolicy="'.$cancelationPolicy.'",gstTax="'.$gstId.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
							addlisting('dmcAirlineMasterRate',$namevalue2);
							$lineSuccess++; 
						}else{
							$msg='';
							$msg='Row No-'.$rowno.'. Airline Name - '.trim($flightName).', Adult Cost is empty...! - '.date('d-m-Y h:ia');
							importErrorlog($msg,$newfilez,$folderName);
							$lineFailed++;
						}
					}else{
						$msg='';
						$msg='Row No-'.$rowno.'. Currency - '.trim($currencyName).' does not exist...! - '.date('d-m-Y h:ia');
						importErrorlog($msg,$newfilez,$folderName);
						$lineFailed++;
					}
				}
			}
		}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php 
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg,$newfilez,$folderName);
	?>
	parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importAirlineMasterModule; ?>','600px','auto');
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
	
}
if(isset($_FILES['importfield']['name']) && trim($_POST['importtrainmaster'])=='Y'){
	require_once 'reader.php';
	$newfilez=date('H:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){
	$file_name=$_FILES['importfield']['name'];
	copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
	$data = new Spreadsheet_Excel_Reader();
	$data->setOutputEncoding('CP1251');
	$path="importfile/".$file_name;
	$data->read($path);
	$rowno=1;
	$errorReportHeader='<div><strong>Line No.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Error Report</strong></div><br>';    ///// GET ERROR -------------------------------------
	for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
		++$rowno;
		$showErrorName='';
		$trainName = $data->sheets[0]["cells"][$x][2];
		$status = $data->sheets[0]["cells"][$x][3];
		if ($status == 'Active') {
			$statusc = 1;
		}if ($status == 'Inactive'){
			$statusc = 0;
		} 
		if($trainName=='' || $statusc=='' ){
			if($trainName==''){ $showErrorName.='Train Name,';
				$msg='';
				$msg='Row No-'.$rowno.'. Train Name is not valid...! - '.date('d-m-Y h:ia');
				errorlogss($msg,$newfilez);
	 		}
			if($statusc==''){ $showErrorName.='Status Name,';
				$msg='';
				$msg='Row No-'.$rowno.'. Status Name is not valid...! - '.date('d-m-Y h:ia');
				errorlogss($msg,$newfilez);
			 }
		}
		$where='trainName="'.$trainName.'"';
		$addnewyes = checkduplicate(_PACKAGE_BUILDER_TRAINS_MASTER_,$where);
		if($addnewyes=='yes'){
			$duplicaterecored.='<div>Duplicate: '.clean($trainName).'</div>';
		}
		if($trainName!='' && $addnewyes=='no'){
			$namevalue ='trainName="'.$trainName.'",status="'.$statusc.'"';
			$lastid = addlisting(_PACKAGE_BUILDER_TRAINS_MASTER_,$namevalue);
		}
	}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php if($duplicaterecored!=''){ ?>
	parent.alertspopupopen('action=foundduplicaterecored&pagename=trainmaster','600px','auto'); 
	setTimeout( function(){
		parent.$('#dupplicaterecoreddlist').html('<?php echo $duplicaterecored; ?>');
	}  , 1000 );
	<?php } else { ?>
	parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=trainmaster','600px','auto');
	<?php } ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
if(isset($_FILES['importfield']['name']) && trim($_POST['importdestinationMaster'])=='Y'){
	require_once 'reader.php';
	$fileTime=date('h:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){
	$file_name=$_FILES['importfield']['name'];
	$importdestinationMasteModule = trim($_POST['importdestinationMasteModule']);
	copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
	$rowno=0;
	$lineSuccess=0;
	$lineFailed=0;
	$lineExist=0;
	$errorReport='';
	$data = new Spreadsheet_Excel_Reader();
	$data->setOutputEncoding('CP1251');
	$path="importfile/".$file_name;
	$data->read($path);
	for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
		++$rowno;
		$showErrorName='';
		$srnumber = trim($data->sheets[0]["cells"][$x][1]);
		$counrtyName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][2]);
		$destinationName = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][3]);
		$description = cleanNonAsciiCharactersInString($data->sheets[0]["cells"][$x][4]);
		$status = trim($data->sheets[0]["cells"][$x][5]);
		if ($status == 'Active' || $status == 'active' || $status == '') {
		$statusc = 1;
		}
		if ($status == 'Inactive'){
		$statusc = 0;
		}
		$dateAdded=time();
		if($destinationName=='' || $counrtyName==''){
			if($destinationName==''){ 
				$msg='';
				$msg='Row No-'.$rowno.'. Destination is required...! - '.date('d-m-Y h:ia');
				importErrorlog($msg,$fileTime,'log_destinatin');
				$lineFailed++;
			}
			if($counrtyName==''){ 
				$msg='';
				$msg='Row No-'.$rowno.' Country Name is required..! - '.date('d-m-Y h:ia');
				importErrorlog($msg,$fileTime,'log_destinatin');
				$lineFailed++;
			}
		}
		$rs1d=GetPageRecord('*','countryMaster','name="'.trim($counrtyName).'"'); 
		$resCountry=mysqli_fetch_array($rs1d);
		$countryId = $resCountry['id'];
		$where='name="'.$destinationName.'"';
		$addnewyes = checkduplicate(_DESTINATION_MASTER_,$where);
		if($addnewyes=='yes'){
			$msg='';
			$msg='Row No-'.$rowno.'. '.$destinationName.' already exist.! - '.date('d-m-Y h:ia');
			importErrorlog($msg,$fileTime,'log_destinatin');
			$lineExist++;
		}
		if($destinationName!='' && $addnewyes=='no'){
			$namevalue ='name="'.$destinationName.'",description="'.$description.'",countryId="'.$countryId.'",status="'.$statusc.'"';
			$lastid = addlisting(_DESTINATION_MASTER_,$namevalue);
			$lineSuccess++;
		}
		}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php if($duplicaterecored!=''){
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg,$fileTime,'log_destinatin');
	?>
	parent.alertspopupopen('action=foundduplicaterecored&pagename=<?php echo $importdestinationMasteModule; ?>','600px','auto');
	<?php } else {
	$msg='';
	$msg='File Uploaded Successfully. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg,$fileTime,'log_destinatin');
	?>
	parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importdestinationMasteModule; ?>','600px','auto');
	<?php } ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
// Import Destination language start
if(isset($_FILES['importfieldlan']['name']) && trim($_POST['importdestinationLanguageMaster'])=='Y'){
	require_once 'reader.php';
	$fileTime=date('h:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfieldlan']['name'])){
	$file_name=$_FILES['importfieldlan']['name'];
	$importdestinationLanguageMasteModule = trim($_POST['importdestinationLanguageMasteModule']);
	copy($_FILES['importfieldlan']['tmp_name'],"importfile/".$file_name);
	$rowno=0;
	$lineSuccess=0;
	$lineFailed=0;
	$lineExist=0;
	$errorReport='';
	$data = new Spreadsheet_Excel_Reader();
	$data->setOutputEncoding('UTF-8');
	$data->setUTFEncoder('mb');
	$path="importfile/".$file_name;
	$data->read($path);
	for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
	++$rowno;
	$showErrorName='';
	$destinationName = htmlentities(($data->sheets[0]["cells"][$x][1]));
	if($destinationName == ''){	
		$destinationName = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][1]));
	}
	$lang01 = htmlentities(($data->sheets[0]["cells"][$x][2]));
	$lang02 = htmlentities(($data->sheets[0]["cells"][$x][3]));
	$lang03 = htmlentities(($data->sheets[0]["cells"][$x][4]));
	$lang04 = htmlentities(($data->sheets[0]["cells"][$x][5]));
	$lang05 = htmlentities(($data->sheets[0]["cells"][$x][6]));
	$lang06 = htmlentities(($data->sheets[0]["cells"][$x][7]));
	$lang07 = htmlentities(($data->sheets[0]["cells"][$x][8]));
	$lang08 = htmlentities(($data->sheets[0]["cells"][$x][9]));
	$lang09 = htmlentities(($data->sheets[0]["cells"][$x][10]));
	$lang10 = htmlentities(($data->sheets[0]["cells"][$x][11]));
	$status = htmlentities(($data->sheets[0]["cells"][$x][12]));
	if ($status == 'Active' || $status == 'active' || $status == '') {
	$statusc = 1;
	}
	if ($status == 'Inactive'){
	$statusc = 0;
	}
	$dateAdded=time();
		if($destinationName==''){ 
			$msg='';
			$msg='Row No-'.$rowno.'. Destination is required...! - '.date('d-m-Y h:ia');
			importErrorlog($msg,$fileTime,'log_destinatin');
			$lineFailed++;	
	}
	$where1='name="'.clean($destinationName).'"';
	$rs=GetPageRecord('*',_DESTINATION_MASTER_,$where1);
	$destinationresult=mysqli_fetch_array($rs);
	$destinationId = $destinationresult['id'];
	$where='destinationId="'.$destinationId.'"';
	$addnewyes = checkduplicate('destinationLanguageMaster',$where);
	if($addnewyes=='yes'){
		// $msg='';
		// $msg='Row No-'.$rowno.'. '.$destinationName.' already exist.! - '.date('d-m-Y h:ia');
		// importErrorlog($msg,$fileTime,'log_destinatin');
		// $lineExist++;
		$namevalue ='destinationId="'.clean($destinationId).'",lang_01="'.clean($lang01).'",lang_02="'.clean($lang02).'",lang_03="'.clean($lang03).'",lang_04="'.clean($lang04).'",lang_05="'.clean($lang05).'",lang_06="'.clean($lang06).'",lang_07="'.clean($lang07).'",lang_08="'.clean($lang08).'",lang_09="'.clean($lang09).'",lang_10="'.clean($lang10).'",status="'.clean($statusc).'"';
		$lastid = updatelisting('destinationLanguageMaster',$namevalue,$where);
		$lineSuccess++;
	}
	if($destinationId!='' && $addnewyes=='no'){
		$namevalue ='destinationId="'.clean($destinationId).'",lang_01="'.clean($lang01).'",lang_02="'.clean($lang02).'",lang_03="'.clean($lang03).'",lang_04="'.clean($lang04).'",lang_05="'.clean($lang05).'",lang_06="'.clean($lang06).'",lang_07="'.clean($lang07).'",lang_08="'.clean($lang08).'",lang_09="'.clean($lang09).'",lang_10="'.clean($lang10).'",status="'.clean($statusc).'"';
		$lastid = addlisting('destinationLanguageMaster',$namevalue);
		$lineSuccess++;
	}	
	}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfieldlan" type="file" id="importfieldlan" accept="application/vnd.ms-excel" onchange="submitimportfromlan();" />');
	<?php if($duplicaterecored!=''){
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg,$fileTime,'log_destinatin');
	?>
	parent.alertspopupopen('action=foundduplicaterecored&pagename=<?php echo $importdestinationLanguageMasteModule; ?>','600px','auto');
	<?php } else {
	$msg='';
	$msg='File Uploaded Successfully. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg,$fileTime,'log_destinatin');
	?>
	parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importdestinationLanguageMasteModule; ?>','600px','auto');
	<?php } ?>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}
// itinerary language import start
if(isset($_FILES['importfieldlan']['name']) && trim($_POST['importsubjectLanguageMaster'])=='Y'){
	require_once 'reader.php'; 
	$fileTime=date('H:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfieldlan']['name'])){
		$file_name=$_FILES['importfieldlan']['name'];
		$importsubjectLanguageMasteModule = trim($_POST['importsubjectLanguageMasteModule']);
		copy($_FILES['importfieldlan']['tmp_name'],"importfile/".$file_name);
		$rowno=0;
		$lineSuccess=0;
		$lineFailed=0;
		$lineExist=0;
		$updateCount=0;
		$errorReport='';
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('UTF-8');
		$data->setUTFEncoder('mb');
		$path="importfile/".$file_name;
		$data->read($path);
		count($data->sheets[0]["cells"]);
		 for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {

			++$rowno;
			$showErrorName='';
			$itineraryNo = htmlentities(($data->sheets[0]["cells"][$x][1]));			
			if($itineraryNo == ''){	
				$itineraryNo = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][1]));
			}

			$titleAndDesArray = array();


			$langTitle1 = htmlentities(($data->sheets[0]["cells"][$x][2]));
			if($langTitle1 == ''){	
				$langTitle1 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][2]));
			}
			$langDesc1 = htmlentities(($data->sheets[0]["cells"][$x][3]));
			if($langDesc1 == ''){	
				$langDesc1 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][3]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle1, 'description'=>$langDesc1));

			$langTitle2 = htmlentities(($data->sheets[0]["cells"][$x][4]));
			if($langTitle2 == ''){	
				$langTitle2 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][4]));
			}
			$langDesc2 = htmlentities(($data->sheets[0]["cells"][$x][5]));
			if($langDesc2 == ''){	
				$langDesc2 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][5]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle2, 'description'=>$langDesc2));

			$langTitle3 = htmlentities(($data->sheets[0]["cells"][$x][6]));
			if($langTitle3 == ''){	
				$langTitle3 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][6]));
			}
			$langDesc3 = htmlentities(($data->sheets[0]["cells"][$x][7]));
			if($langDesc3 == ''){	
				$langDesc3 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][7]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle3, 'description'=>$langDesc3));

			$langTitle4 = htmlentities(($data->sheets[0]["cells"][$x][8]));
			if($langTitle4 == ''){	
				$langTitle4 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][8]));
			}
			$langDesc4 = htmlentities(($data->sheets[0]["cells"][$x][9]));
			if($langDesc4 == ''){	
				$langDesc4 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][9]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle4, 'description'=>$langDesc4));


			$langTitle5 = htmlentities(($data->sheets[0]["cells"][$x][10]));
			if($langTitle5 == ''){	
				$langTitle5 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][10]));
			}
			$langDesc5 = htmlentities(($data->sheets[0]["cells"][$x][11]));
			if($langDesc5 == ''){	
				$langDesc5 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][11]));
			}			

			$v= array_push($titleAndDesArray, array('title'=>$langTitle5, 'description'=>$langDesc5));


			$langTitle6 = htmlentities(($data->sheets[0]["cells"][$x][12]));
			if($langTitle6 == ''){	
				$langTitle6 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][12]));
			}
			$langDesc6 = htmlentities(($data->sheets[0]["cells"][$x][13]));
			if($langDesc6 == ''){	
				$langDesc6 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][13]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle6, 'description'=>$langDesc6));


			$langTitle7 = htmlentities(($data->sheets[0]["cells"][$x][14]));
			if($langTitle7 == ''){	
				$langTitle7 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][14]));
			}
			$langDesc7 = htmlentities(($data->sheets[0]["cells"][$x][15]));
			if($langDesc7 == ''){	
				$langDesc7 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][15]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle7, 'description'=>$langDesc7));

			$langTitle8 = htmlentities(($data->sheets[0]["cells"][$x][16]));
			if($langTitle8 == ''){	
				$langTitle8 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][16]));
			}
			$langDesc8 = htmlentities(($data->sheets[0]["cells"][$x][17]));
			if($langDesc8 == ''){	
				$langDesc8 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][17]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle8, 'description'=>$langDesc8));

			$langTitle9 = htmlentities(($data->sheets[0]["cells"][$x][18]));
			if($langTitle9 == ''){	
				$langTitle9 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][18]));
			}
			$langDesc9 = htmlentities(($data->sheets[0]["cells"][$x][19]));
			if($langDesc9 == ''){	
				$langDesc9 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][19]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle9, 'description'=>$langDesc9));

			$langTitle10 = htmlentities(($data->sheets[0]["cells"][$x][20]));
			if($langTitle10 == ''){	
				$langTitle10 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][20]));
			}
			$langDesc10 = htmlentities(($data->sheets[0]["cells"][$x][21]));
			if($langDesc10 == ''){	
				$langDesc10 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][21]));
			}

			$v= array_push($titleAndDesArray, array('title'=>$langTitle10, 'description'=>$langDesc10));

			$status = trim($data->sheets[0]["cells"][$x][22]);
			if ($status == 'Active' || $status == 'active' || $status == '') {
				$statusc = 1;
			}
			if ($status == 'Inactive'){
				$statusc = 0;
			}
			
			$dateAdded=time();
			$txt.='Itinerary No:'.$itineraryNo;
			if($itineraryNo==''){ 
				$msg='';
				$msg='Row No-'.$rowno.'. Error - Itinerary No is required...! - '.date('d-m-Y h:ia');
				importErrorlog($msg,$fileTime,'log_activity');
				$lineFailed++;	
			}else{
				$subjectId=ltrim(substr(clean(html_entity_decode($itineraryNo)),2),"0");
				// echo "<br>";
				// echo $rowno;
    			echo $where1=' id="'.$subjectId.'"';
    			$rs=GetPageRecord('*','iti_subjectmaster',$where1);
    			$ItineraryRows=mysqli_num_rows($rs);
    			$itineraryresult=mysqli_fetch_array($rs);
    			$ItineraryId = $itineraryresult['id'];
    		
    			$where2=' subjectId="'.$ItineraryId.'"';

    			if ($ItineraryRows==0 || $ItineraryRows=='') {
    				$msg='';
    				$msg='Row No-'.$rowno.'. Error - Itinerary '.$itineraryNo.'  is not Exist...! - '.date('d-m-Y h:ia');
    				importErrorlog($msg,$fileTime,'log_activity');
    				$lineFailed++;	 
    			}else{
    				$addnewyes = checkduplicate('subjectLanguageMaster',$where2);
    				if($addnewyes=='yes'){ 
						
						$k=1;
    					foreach ($titleAndDesArray as $key => $value) {
    						
    					$where2=' subjectId="'.$ItineraryId.'" and languageId="'.$k.'"';

    					$namevalue ='subjectId="'.$ItineraryId.'",languageId="'.$k.'",title="'.clean($value['title']).'",description="'.clean($value['description']).'",status=1';
    					$update = updatelisting('subjectLanguageMaster',$namevalue,$where2);
    					$k++;
    					}

    					$msg='';
    					$msg='Row No-'.$rowno.'. Updated - '.$itineraryNo.' details updated .! - '.date('d-m-Y h:ia');
    					importErrorlog($msg,$fileTime,'log_activity');
    					$lineExist++;
    				}else{
						$k=1;
    					foreach ($titleAndDesArray as $key => $value) {

						 $where2=' subjectId="'.$ItineraryId.'" and languageId="'.$k.'"';				
    				    $namevalue ='subjectId="'.$ItineraryId.'",languageId="'.$k.'",title="'.clean($value['title']).'",description="'.clean($value['description']).'",status=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
     					$lastid = addlisting('subjectLanguageMaster',$namevalue);
     					$k++;
     					}

     					$msg='';
    					$msg='Row No-'.$rowno.'. Inserted - '.$itineraryNo.' details inserted .! - '.date('d-m-Y h:ia');
    					importErrorlog($msg,$fileTime,'log_activity');
    					$lineSuccess++;
    				}	
    			}
    		}
		}
	}

	?>
	<script>
	parent.$('#importfieldlan').remove();
		parent.$('#filefieldhere').append('<input name="importfieldlan" type="file" id="importfieldlan" accept="application/vnd.ms-excel" onchange="submitimportfromlan();" />');
		<?php if($duplicaterecored!=''){
		$msg='';
		$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Updated('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'log_activity');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&pagename=<?php echo $importsubjectLanguageMasteModule; ?>','600px','auto');
		<?php } else {
		$msg='';
		$msg='File Uploaded Successfully. - '.$rowno.' - Failed('.$lineFailed.'), Updated('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'log_activity');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importsubjectLanguageMasteModule; ?>','600px','auto');
		<?php } ?>
	</script>
	<?php
} 

// itinerary language import end
if(isset($_FILES['importfieldlan']['name']) && trim($_POST['importActivityLanguageMaster'])=='Y'){
	require_once 'reader.php'; 
	$fileTime=date('H_i_s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfieldlan']['name'])){
		$file_name=$fileTime.'-'.$_FILES['importfieldlan']['name'];
		$importActivityLanguageMasteModule = trim($_POST['importActivityLanguageMasteModule']);
		copy($_FILES['importfieldlan']['tmp_name'],"importfile/".$file_name);
		$rowno=0;
		$lineSuccess=0;
		$lineFailed=0;
		$lineExist=0;
		$updateCount=0;
		$errorReport='';
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('UTF-8');
		$data->setUTFEncoder('mb');
		$path="importfile/".$file_name;
		$data->read($path); 
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
			++$rowno;
			$showErrorName='';

			$activityName = htmlentities(($data->sheets[0]["cells"][$x][1]));
			if($activityName == ''){	
				$activityName = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][1]));
			}
			$destinationName = htmlentities(($data->sheets[0]["cells"][$x][2]));
			if($destinationName == ''){	
				$destinationName = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][2]));
			}
			$lang01 = htmlentities(($data->sheets[0]["cells"][$x][3]));
			if($lang01 == ''){	
				$lang01 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][3]));
			}

			$lang02 = htmlentities(($data->sheets[0]["cells"][$x][4]));
			if($lang02 == ''){	
				$lang02 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][4]));
			}
			$lang03 = htmlentities(($data->sheets[0]["cells"][$x][5]));
			if($lang03 == ''){	
				$lang03 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][5]));
			}
			$lang04 = htmlentities(($data->sheets[0]["cells"][$x][6])); 
			if($lang04 == ''){	
				$lang04 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][6]));
			}
			$lang05 = htmlentities(($data->sheets[0]["cells"][$x][7]));
			if($lang05 == ''){	
				$lang05 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][7]));
			}
			$lang06 = htmlentities(($data->sheets[0]["cells"][$x][8]));
			if($lang06 == ''){	
				$lang06 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][8]));
			}
			$lang07 = htmlentities(($data->sheets[0]["cells"][$x][9]));
			if($lang07 == ''){	
				$lang07 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][9]));
			}
			$lang08 = htmlentities(($data->sheets[0]["cells"][$x][10]));
			if($lang08 == ''){	
				$lang08 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][10]));
			}
			$lang09 = htmlentities(($data->sheets[0]["cells"][$x][11]));
			if($lang09 == ''){	
				$lang09 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][11]));
			}
			$lang10 = htmlentities(($data->sheets[0]["cells"][$x][12]));
			if($lang10 == ''){	
				$lang10 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][12]));
			}
			$status = trim($data->sheets[0]["cells"][$x][13]);
			if ($status == 'Active' || $status == 'active' || $status == '') {
				$statusc = 1;
			}
			if ($status == 'Inactive'){
				$statusc = 0;
			}
			$dateAdded=time();
			if($activityName==''){ 
				$msg='';
				$msg='Row No-'.$rowno.'. Error - Activity Name is required...! - '.date('d-m-Y h:ia');
				importErrorlog($msg,$fileTime,'log_activity');
				$lineFailed++;	
			}else{
				echo "<br>";
				echo $rowno;
    			echo $where1=' UPPER(otherActivityName)="'.clean(strtoupper(html_entity_decode($activityName))).'"';
    			$rs=GetPageRecord('*',_PACKAGE_BUILDER_OTHER_ACTIVITY_MASTER_,$where1);
    			$ActivityRows=mysqli_num_rows($rs);
    			$activityresult=mysqli_fetch_array($rs);
    			$ActivityId = $activityresult['id'];
    		
    			$where2=' UPPER(name)="'.clean(strtoupper(html_entity_decode($destinationName))).'"';
    			$rs2=GetPageRecord('*',_DESTINATION_MASTER_,$where2);
    			$destinationresult=mysqli_fetch_array($rs2);
    			$destinationId = $destinationresult['id'];
    			$where='ActivityId="'.$ActivityId.'"';
    			if ($ActivityRows==0 || $ActivityRows=='') {
    				$msg='';
    				$msg='Row No-'.$rowno.'. Error - Activity '.$activityName.'  is not Exist...! - '.date('d-m-Y h:ia');
    				importErrorlog($msg,$fileTime,'log_activity');
    				$lineFailed++;	 
    			}else{
    				$addnewyes = checkduplicate('activityLanguageMaster',$where);
    				if($addnewyes=='yes'){ 
    					$namevalue ='lang_01="'.stripslashes(clean($lang01)).'",lang_02="'.clean($lang02).'",lang_03="'.clean($lang03).'",lang_04="'.clean($lang04).'",lang_05="'.clean($lang05).'",lang_06="'.clean($lang06).'",lang_07="'.clean($lang07).'",lang_08="'.clean($lang08).'",lang_09="'.clean($lang09).'",lang_10="'.clean($lang10).'",status=1';
    					$update = updatelisting('activityLanguageMaster',$namevalue,$where);
    					$msg='';
    					$msg='Row No-'.$rowno.'. Updated - '.$activityName.' details updated .! - '.date('d-m-Y h:ia');
    					importErrorlog($msg,$fileTime,'log_activity');
    					$lineExist++;
    				}else{
    				    $namevalue ='ActivityId="'.$ActivityId.'",destinationId="'.$destinationId.'",lang_01="'.stripslashes(clean($lang01)).'",lang_02="'.clean($lang02).'",lang_03="'.clean($lang03).'",lang_04="'.clean($lang04).'",lang_05="'.clean($lang05).'",lang_06="'.clean($lang06).'",lang_07="'.clean($lang07).'",lang_08="'.clean($lang08).'",lang_09="'.clean($lang09).'",lang_10="'.clean($lang10).'",status=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
     					$lastid = addlisting('activityLanguageMaster',$namevalue);
    					$lineSuccess++;
    				}	
    			}
    		}
		}
	}
	?>
	<script>
	parent.$('#importfieldlan').remove();
		parent.$('#filefieldhere').append('<input name="importfieldlan" type="file" id="importfieldlan" accept="application/vnd.ms-excel" onchange="submitimportfromlan();" />');
		<?php if($duplicaterecored!=''){
		$msg='';
		$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Updated('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'log_activity');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&pagename=<?php echo $importActivityLanguageMasteModule; ?>','600px','auto');
		<?php } else {
		$msg='';
		$msg='File Uploaded Successfully. - '.$rowno.' - Failed('.$lineFailed.'), Updated('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'log_activity');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importActivityLanguageMasteModule; ?>','600px','auto');
		<?php } ?>
	</script>
	<?php
} 
// Activity Language import ends
if(isset($_FILES['importfieldlan']['name']) && trim($_POST['importEnrouteLanguageMaster'])=='Y'){
 	require_once 'reader.php';
	$fileTime=date('h:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfieldlan']['name'])){
		$file_name=$_FILES['importfieldlan']['name'];
		$importEnrouteLanguageMaster = trim($_POST['importEnrouteLanguageMasteModule']);
		copy($_FILES['importfieldlan']['tmp_name'],"importfile/".$file_name);
		$rowno=0;
		$lineSuccess=0;
		$lineFailed=0;
		$lineExist=0;
		$errorReport='';
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		$path="importfile/".$file_name;
		$data->read($path);
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
			++$rowno;
			$showErrorName='';
			$enrouteName = trim($data->sheets[0]["cells"][$x][1]);
			$destinationName = trim($data->sheets[0]["cells"][$x][2]);
			$lan1 = trim($data->sheets[0]["cells"][$x][3]);
			$lang01 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan1);
			$lan2 = trim($data->sheets[0]["cells"][$x][4]);
			$lang02 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan2);
			$lan3 = trim($data->sheets[0]["cells"][$x][5]);
			$lang03 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan3);
			$lan4 = trim($data->sheets[0]["cells"][$x][6]);
			$lang04 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan4);
			$lan5 = trim($data->sheets[0]["cells"][$x][7]);
			$lang05 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan5);
			$lan6 = trim($data->sheets[0]["cells"][$x][8]);
			$lang06 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan6);
			$lan7 = trim($data->sheets[0]["cells"][$x][9]);
			$lang07 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan7);
			$lan8 = trim($data->sheets[0]["cells"][$x][10]);
			$lang08 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan8);
			$lan9 = trim($data->sheets[0]["cells"][$x][11]);
			$lang09 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan9);
			$lan10 = trim($data->sheets[0]["cells"][$x][12]);
			$lang10 = str_replace( array( '\'', '"',',' , ';', '<', '>' ), ' ', $lan10);
			$status = trim($data->sheets[0]["cells"][$x][13]);
			if ($status == 'Active' || $status == 'active' || $status == '') {
				$statusc = 1;
			}
			if ($status == 'Inactive'){
				$statusc = 0;
			}
			$dateAdded=time();
			if($enrouteName==''){ 
				$msg='';
				$msg='Row No-'.$rowno.'. Enroute Name is required...! - '.date('d-m-Y h:ia');
				importErrorlog($msg,$fileTime,'log_activity');
				$lineFailed++;	
			}
			$where1='enrouteName="'.$enrouteName.'"';
			$rs=GetPageRecord('*',_PACKAGE_BUILDER_ENROUTE_MASTER_,$where1);
			$enrouteresult=mysqli_fetch_array($rs);
			$enrouteId = $enrouteresult['id'];
			$where1='name="'.$destinationName.'"';
			$rs=GetPageRecord('*',_DESTINATION_MASTER_,$where1);
			$destinationresult=mysqli_fetch_array($rs);
			$destinationId = $destinationresult['id'];
			$where='enrouteId="'.$enrouteId.'"';
			$addnewyes = checkduplicate('enrouteLanguageMaster',$where);
			if($addnewyes=='yes'){
				$namevalue ='lang_01="'.$lang01.'",lang_02="'.$lang02.'",lang_03="'.$lang03.'",lang_04="'.$lang04.'",lang_05="'.$lang05.'",lang_06="'.$lang06.'",lang_07="'.$lang07.'",lang_08="'.$lang08.'",lang_09="'.$lang09.'",lang_10="'.$lang10.'",status="'.$statusc.'"';
				$update = updatelisting('enrouteLanguageMaster',$namevalue,$where);
				$msg='';
				$msg='Row No-'.$rowno.'. '.$enrouteName.' already exist.! - '.date('d-m-Y h:ia');
				importErrorlog($msg,$fileTime,'log_activity');
				$lineExist++;
			}
			if($enrouteId!='' && $addnewyes=='no'){
				$namevalue ='enrouteId="'.$enrouteId.'",destinationId="'.$destinationId.'",lang_01="'.$lang01.'",lang_02="'.$lang02.'",lang_03="'.$lang03.'",lang_04="'.$lang04.'",lang_05="'.$lang05.'",lang_06="'.$lang06.'",lang_07="'.$lang07.'",lang_08="'.$lang08.'",lang_09="'.$lang09.'",lang_10="'.$lang10.'",status="'.$statusc.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
				$lastid = addlisting('enrouteLanguageMaster',$namevalue);
				$lineSuccess++;
			}	
		}
	}
	?>
	<script>
		parent.$('#importfieldlan').remove();
		parent.$('#filefieldhere').append('<input name="importfieldlan" type="file" id="importfieldlan" accept="application/vnd.ms-excel" onchange="submitimportfromlan();" />');
		<?php if($duplicaterecored!=''){
		$msg='';
		$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'log_enroute');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&pagename=<?php echo $importEnrouteLanguageMaster; ?>','600px','auto');
		<?php } else {
		$msg='';
		$msg='File Uploaded Successfully. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'log_enroute');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importEnrouteLanguageMaster; ?>','600px','auto');
		<?php } ?>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
	</script>
	<?php
}
if(isset($_FILES['importfieldlan']['name']) && trim($_POST['importEntranceLanguageMaster'])=='Y'){
	require_once 'reader.php';
	$fileTime=date('h:i:s');
	$duplicaterecored.='';
	if(!empty($_FILES['importfieldlan']['name'])){
		$file_name=$_FILES['importfieldlan']['name'];
		$importEntranceLanguageMasteModule = trim($_POST['importEntranceLanguageMasteModule']);
		copy($_FILES['importfieldlan']['tmp_name'],"importfile/".$file_name);
		$rowno=0;
		$lineSuccess=0;
		$lineFailed=0;
		$lineExist=0;
		$errorReport='';
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('UTF-8');
		$data->setUTFEncoder('mb');
		$path="importfile/".$file_name;
		$data->read($path);
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
			++$rowno;
			$showErrorName='';
			$entranceName = htmlentities(($data->sheets[0]["cells"][$x][1]));
			if($entranceName == ''){	
				$entranceName = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][1]));
			}
			$destinationName = htmlentities(($data->sheets[0]["cells"][$x][2]));
			if($destinationName==''){
				$destinationName = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][2]));
			}
			$lang01 = htmlentities(($data->sheets[0]["cells"][$x][3]));
			if($lang01==''){
				$lang01 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][3]));
			}
			$lang02 = htmlentities(($data->sheets[0]["cells"][$x][4]));
			if($lang02==''){
				$lang02 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][4]));
			}

			$lang03 = htmlentities(($data->sheets[0]["cells"][$x][5]));
			if($lang03==''){
				$lang03 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][5]));
			}
			$lang04 = htmlentities(($data->sheets[0]["cells"][$x][6]));
			if($lang04==''){
				$lang04 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][6]));
			}
			$lang05 = htmlentities(($data->sheets[0]["cells"][$x][7]));
			if($lang05==''){
				$lang05 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][7]));
			}
			$lang06 = htmlentities(($data->sheets[0]["cells"][$x][8]));
			if($lang06==''){
				$lang06 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][8]));
			}
			$lang07 = htmlentities(($data->sheets[0]["cells"][$x][9]));
			if($lang07==''){
				$lang07 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][9]));
			}
			$lang08 = htmlentities(($data->sheets[0]["cells"][$x][10]));
			if($lang08==''){
				$lang08 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][10]));
			}
			$lang09 = htmlentities(($data->sheets[0]["cells"][$x][11]));
			if($lang09==''){
				$lang09 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][11]));
			}
			$lang10 = htmlentities($data->sheets[0]["cells"][$x][12]);
			if($lang10==''){
				$lang10 = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][12]));
			}
			$status = htmlentities($data->sheets[0]["cells"][$x][13]);
			if($status==''){
				$status = htmlentities(utf8_encode($data->sheets[0]["cells"][$x][13]));
			}
			if ($status == 'Active' || $status == 'active' || $status == '') {
			$statusc = 1;
			}
			if ($status == 'Inactive'){
			$statusc = 0;
			}
			$dateAdded=time();
				if($entranceName==''){ 
					$msg='';
					$msg='Row No-'.$rowno.'. Entrance Name  is required...! - '.date('d-m-Y h:ia');
					importErrorlog($msg,$fileTime,'log_activity');
					$lineFailed++;	
			}
			$where1='name="'.$destinationName.'"';
			$rs=GetPageRecord('*',_DESTINATION_MASTER_,$where1);
			$destinationresult=mysqli_fetch_array($rs);
			$destinationId = $destinationresult['id'];
			$where1='entranceName="'.$entranceName.'" and entranceCity="'.$destinationName.'"';
			$rs=GetPageRecord('*',_PACKAGE_BUILDER_ENTRANCE_MASTER_,$where1);
			$entranceresult=mysqli_fetch_array($rs);
			$entranceId = $entranceresult['id'];
			$where='entranceId="'.$entranceId.'"';
			$addnewyes = checkduplicate('entranceLanguageMaster',$where);
			if($entranceId!='' && $addnewyes=='yes'){
				$namevalue ='destinationId="'.$destinationId.'",lang_01="'.stripslashes(clean($lang01)).'",lang_02="'.clean($lang02).'",lang_03="'.$lang03.'",lang_04="'.$lang04.'",lang_05="'.$lang05.'",lang_06="'.$lang06.'",lang_07="'.$lang07.'",lang_08="'.$lang08.'",lang_09="'.$lang09.'",lang_10="'.$lang10.'",status="'.$statusc.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
		        $where='entranceId="'.$entranceId.'"';
				$updatedate = updatelisting('entranceLanguageMaster',$namevalue,$where);
				$msg='';
				$msg='Row No-'.$rowno.'. '.$entranceName.' already exist.! - '.date('d-m-Y h:ia');
				importErrorlog($msg,$fileTime,'log_entrance');
				$lineExist++;
			}
			if($entranceId!='' && $addnewyes=='no'){
				$namevalue ='entranceId="'.$entranceId.'",destinationId="'.$destinationId.'",lang_01="'.stripslashes(clean($lang01)).'",lang_02="'.clean($lang02).'",lang_03="'.$lang03.'",lang_04="'.$lang04.'",lang_05="'.$lang05.'",lang_06="'.$lang06.'",lang_07="'.$lang07.'",lang_08="'.$lang08.'",lang_09="'.$lang09.'",lang_10="'.$lang10.'",status="'.$statusc.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
				$lastid = addlisting('entranceLanguageMaster',$namevalue);
				$lineSuccess++;
			}	
		}
	}
	?>
	<script>
		parent.$('#importfieldlan').remove();
		parent.$('#filefieldhere').append('<input name="importfieldlan" type="file" id="importfieldlan" accept="application/vnd.ms-excel" onchange="submitimportfromlan();" />');
		<?php if($duplicaterecored!=''){
		$msg='';
		$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'log_entrance');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&pagename=<?php echo $importEntranceLanguageMasteModule; ?>','600px','auto');
		<?php } else {
		$msg='';
		$msg='File Uploaded Successfully. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
		importErrorlog($msg,$fileTime,'log_entrance');
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=<?php echo $importEntranceLanguageMasteModule; ?>','600px','auto');
		<?php } ?>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
	</script>
	<?php
}

if(isset($_FILES['importfield']['name']) && trim($_POST['importsupplierexcel'])=='Y'){
	 function replaceAll($text){ 
		$text = strtolower(htmlentities($text)); 
		$text = str_replace(get_html_translation_table(), "-", $text);
		$text = str_replace(" ", "", $text);
		$text = preg_replace("/[-]+/i", "-", $text);
		return $text;
	} 
	require_once 'reader.php'; 
	$fileTime=date('H_i_s');
	// $importpackagesightseeingModule = $_REQUEST['importpackagesightseeingModule']; 
	$importSupplierModule = $_REQUEST['importSupplierModule'];     
	///// GET MODULE -------------------------------------
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){
		
		$file_name = $_FILES['importfield']['name'];
        $newfilez = formatUrl($file_name);
        $file_name = trim($newfilez).'.xls';

        $msg = '';
        $msg = $newfilez;
        importErrorlog($msg, $newfilez, 'Supplier_Log');

        $msg = '';
        $msg = $fullurl . "importfile/" . $file_name . " Copy this link to download file ";
        importErrorlog($msg, $newfilez, 'Supplier_Log');

		copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);

		$errorReport='';
		$errorCount=1;
		$errorReportHeader='<div><strong>Line No.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Error Report</strong></div><br>';   
		
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		
		$path="importfile/".$file_name;
		if (file_exists($path)) {
			$data->read($path);
			$lineSuccess=0;
			$lineFailed=0; 
			$lineExist=0;
			$rowno=0;
			for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
				++$rowno;
				$showErrorName.='';
				$showErrorType='';
				///// EMPTY VARIABLE  -------------------------------------
				$name = trim($data->sheets[0]["cells"][$x][1]);
				$gstn = trim($data->sheets[0]["cells"][$x][2]);
				$destinationCountry = (trim($data->sheets[0]["cells"][$x][3]));  
				$destinationId = (trim($data->sheets[0]["cells"][$x][4]));  
				$countryId = (trim($data->sheets[0]["cells"][$x][5]));
				$stateId = (trim($data->sheets[0]["cells"][$x][6]));
				$cityId = (trim($data->sheets[0]["cells"][$x][7]));
				$address1 = (trim($data->sheets[0]["cells"][$x][8]));
				$pinCode = replaceAll(trim($data->sheets[0]["cells"][$x][9]));  
				$division11 = (trim($data->sheets[0]["cells"][$x][10]));
				$contactPerson1 = (trim($data->sheets[0]["cells"][$x][11]));
				$designation1 = (trim($data->sheets[0]["cells"][$x][12]));
				$countryCode1 = replaceAll(trim($data->sheets[0]["cells"][$x][13]));
				$mobile1 = replaceAll(trim($data->sheets[0]["cells"][$x][14]));
				$email1 = replaceAll(trim($data->sheets[0]["cells"][$x][15]));
				$division12 = (trim($data->sheets[0]["cells"][$x][16]));
				$contactPerson2 = (trim($data->sheets[0]["cells"][$x][17]));
				$designation2 = (trim($data->sheets[0]["cells"][$x][18]));
				$countryCode2 = replaceAll(trim($data->sheets[0]["cells"][$x][19]));
				$mobile2 = replaceAll(trim($data->sheets[0]["cells"][$x][20]));
				$email2 = replaceAll(trim($data->sheets[0]["cells"][$x][21]));
				$division13 = (trim($data->sheets[0]["cells"][$x][22]));
				$contactPerson3 = (trim($data->sheets[0]["cells"][$x][23]));
				$designation3 = (trim($data->sheets[0]["cells"][$x][24]));
				$countryCode3 = replaceAll(trim($data->sheets[0]["cells"][$x][25]));
				$mobile3 = replaceAll(trim($data->sheets[0]["cells"][$x][26]));
				$email3 = replaceAll(trim($data->sheets[0]["cells"][$x][27])); 
				$hotel = (trim($data->sheets[0]["cells"][$x][28]));
				$airline = (trim($data->sheets[0]["cells"][$x][29]));
				$transfer = (trim($data->sheets[0]["cells"][$x][30]));
				$activity = (trim($data->sheets[0]["cells"][$x][31]));
				$retaurant = (trim($data->sheets[0]["cells"][$x][32]));
				$entrance = (trim($data->sheets[0]["cells"][$x][33]));
				$guide = (trim($data->sheets[0]["cells"][$x][34]));
				$train = (trim($data->sheets[0]["cells"][$x][35]));
				$other = (trim($data->sheets[0]["cells"][$x][36]));
				$paymentTerm = (trim($data->sheets[0]["cells"][$x][37]));

				$divDataq1=GetPageRecord('*',_DIVISION_MASTER_,'name="'.$division11.'"');
				$divData1=mysqli_fetch_array($divDataq1);
				$division1 = $divData1['id'];

				$divDataq2=GetPageRecord('*',_DIVISION_MASTER_,'name="'.$division12.'"');
				$divData2=mysqli_fetch_array($divDataq2);
				$division2 = $divData2['id'];

				$divDataq3=GetPageRecord('*',_DIVISION_MASTER_,'name="'.$division13.'"');
				$divData3=mysqli_fetch_array($divDataq3);
				$division3 = $divData3['id'];
						
				if($paymentTerm == 'Cash' || $paymentTerm == 'cash'){ $paymentTermId = 1; } else{ $paymentTermId = 2; }
		 		if($hotel=='yes' || $hotel=='Yes' || $hotel=='YES'){ $hotel='1'; } else { $hotel='0'; }
				if($airline=='yes' || $airline=='Yes' || $airline=='YES'){ $airline='7'; } else { $airline='0'; }
				if($transfer=='yes' || $transfer=='Yes' || $transfer=='YES'){ $transfer='5'; } else { $transfer='0'; }
				if($activity=='yes' || $activity=='Yes' || $activity=='YES'){ $activity='3'; } else { $activity='0'; }
				if($retaurant=='yes' || $retaurant=='Yes' || $retaurant=='YES'){ $retaurant='6'; } else { $retaurant='0'; }
				if($entrance=='yes' || $entrance=='Yes' || $entrance=='YES'){ $entrance='4'; } else { $entrance='0'; }
				if($guide=='yes' || $guide=='Yes' || $guide=='YES'){ $guide='2'; } else { $guide='0'; }
				if($train=='yes' || $train=='Yes' || $train=='YES'){ $train='8'; } else { $train='0'; }
				if($other=='yes' || $other=='Yes' || $other=='YES'){ $other='13'; } else { $other='0'; }
				$dateAdded=time();

	            $divDataq1=GetPageRecord('*',_DIVISION_MASTER_,'name="'.$division11.'"');
				$divData1=mysqli_fetch_array($divDataq1);
				$division1 = $divData1['id'];

				$divDataq2=GetPageRecord('*',_DIVISION_MASTER_,'name="'.$division12.'"');
				$divData2=mysqli_fetch_array($divDataq2);
				$division2 = $divData2['id'];

				$divDataq3=GetPageRecord('*',_DIVISION_MASTER_,'name="'.$division13.'"');
				$divData3=mysqli_fetch_array($divDataq3);
				$division3 = $divData3['id'];



				///// VALIDATE -------------------------------------
				$showErrorName='';
				$showErrorType='';
				
				$rs111=GetPageRecord('*',_COUNTRY_MASTER_,'UPPER(name)="'.trim(strtoupper($destinationCountry)).'" and deletestatus=0');
				if(mysqli_num_rows($rs111)>0){
				$countrydest=mysqli_fetch_array($rs111);
				$countryDestId = $countrydest['id'];

				$rscnt22 = GetPageRecord('*',_DESTINATION_MASTER_,'countryId="'.trim($countryDestId).'" and deletestatus=0 and status=1 and name!="" order by id asc');
				$destData = mysqli_fetch_assoc($rscnt22);
				$destinationId = $destData['name'];

				}
				
	   			$rscnt2 = '';
		        $rscnt2 = GetPageRecord('*',_DESTINATION_MASTER_,' UPPER(name)="'.trim(strtoupper($destinationId)).'"');


				if($name=='' || $email1=='' || $destinationId=='' || mysqli_num_rows($rscnt2) < 1){ 


					if (mysqli_num_rows($rscnt2) < 1){
	                    $showErrorName .= 'Supplier Destination does not exits,';
						$msg = '';
		                $msg = 'Row No-' . $rowno . '. Failed: Destination does not exits...! - ' . date('d-m-Y h:ia');
		                importErrorlog($msg, $newfilez, 'Supplier_Log');
		            }

					if($name==''){
						$showErrorName.='Company Name is Empty,';
						$msg='';
						$msg='Row No-'.$rowno.'. Company Name is Empty...! - '.date('d-m-Y h:ia');
						importErrorlog($msg,$newfilez,'Supplier_Log');
					}
					if($email1==''){
						$showErrorType.='Email is Empty,';
						$msg='';
						$msg='Row No-'.$rowno.'. Email is Empty....! - '.date('d-m-Y h:ia');
						importErrorlog($msg,$newfilez,'Supplier_Log');
					}
					if($destinationId==''){
						$showErrorType.='Destination,';
						$msg='';
						$msg='Row No-'.$rowno.'. Destination is Empty...! - '.date('d-m-Y h:ia');
						importErrorlog($msg,$newfilez,'Supplier_Log');
					} 
					$duplicaterecored.='<div>'.$rowno.'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error in&nbsp;'.$showErrorName.'&nbsp;&nbsp;&nbsp;'.$showErrorType.'</div>';
					$errorCount++;
				}else{
	 				$rs1='';
	 				$where='UPPER(name)="'.strtoupper($name).'" and deletestatus=0';
					$rs1=GetPageRecord('*',_SUPPLIERS_MASTER_,$where);
					if(mysqli_num_rows($rs1) > 0){
						$supplierdata=mysqli_fetch_array($rs1); 
						$rs1='';
						$rs1=GetPageRecord('*',_COUNTRY_MASTER_,'name="'.$countryId.'"');
						$countrygetresult=mysqli_fetch_array($rs1);
						$rs1='';
						$rs1=GetPageRecord('*',_STATE_MASTER_,'name="'.$stateId.'"');
						$stategetresult=mysqli_fetch_array($rs1);
						$rs1='';
						$rs1=GetPageRecord('*',_CITY_MASTER_,'name="'.$cityId.'"');
						$citygetresult=mysqli_fetch_array($rs1);
						$rs1='';
						$rs1=GetPageRecord('*',_HOTEL_CATEGORY_MASTER_,'uploadKeyword="'.$companyCategory.'"');
						$sarrating=mysqli_fetch_array($rs1);
						$rs1='';
						$destinationId = explode(',',$destinationId);
						$destId='';
						if($countryDestId>0){
							$rs1=GetPageRecord('*',_DESTINATION_MASTER_,'name!="" and deletestatus=0 and status=1 and countryId="'.$countryDestId.'"');
							while($destinationresult=mysqli_fetch_array($rs1)){
								$destId.=$destinationresult['id'].',';
								$destinationWise = 1;
							}
						}else{
							$destinationWise=0;
						foreach($destinationId as $val){
							//echo 'name="'.trim($val).'"';
							$rs1=GetPageRecord('*',_DESTINATION_MASTER_,'UPPER(name)="'.trim(strtoupper($val)).'"');
							if(mysqli_num_rows($rs1) > 0){
								$destinationresult=mysqli_fetch_array($rs1);
								$destId.=$destinationresult['id'].',';
								
							}
						}
					}
						$supplierMainType=2;
						$lastid = $supplierdata['id'];
						$namevalue ='companyTypeId="'.$hotel.'",name="'.$name.'",aliasname="'.addslashes($name).'",gstn="'.$gstn.'",contactPerson="'.$contactPerson1.'",countryId="'.$countrygetresult['id'].'",stateId="'.$stategetresult['id'].'",cityId="'.$citygetresult['id'].'",address1="'.$address1.'",address2="'.$address2.'",address3="'.$address3.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",pinCode="'.$pinCode.'",destinationId="'.$destId.'",destinationlist="'.$destinationresult['id'].'",locationMap="'.$locationmap.'",categoryId="'.$sarrating['id'].'",airlinesType="'.$airline.'",transferType="'.$transfer.'",activityType="'.$activity.'",mealType="'.$retaurant.'",otherType="'.$other.'",supplierMainType="'.$supplierMainType.'",paymentTerm="'.$paymentTermId.'",entranceType="'.$entrance.'",guideType="'.$guide.'",trainType="'.$train.'",destinationWise="'.$destinationWise.'",countryWise="'.$countryDestId.'"';
						updatelisting(_SUPPLIERS_MASTER_,$namevalue,"id='".$supplierdata['id']."'");
						$msg='';
						$msg='Row No-'.$rowno.'. Duplicate: '.$name.' is updated...! - '.date('d-m-Y h:ia');
						importErrorlog($msg,$newfilez,'Supplier_Log');
						$lineExist++;
						//check for address
						$rs1="";
						$rs1=GetPageRecord('*',_ADDRESS_MASTER_,' addressParent="'.$lastid.'" and addressType="supplier"');
						if(mysqli_num_rows($rs1) > 0){
							$addrData=mysqli_fetch_array($rs1);
	 						$namevalue ='addressParent="'.$lastid.'",countryId="'.$countrygetresult['id'].'",stateId="'.$stategetresult['id'].'",cityId="'.$citygetresult['id'].'",address="'.$address1.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",primaryAddress=1,addressType="supplier"';
							updatelisting(_ADDRESS_MASTER_,$namevalue,"id='".$addrData['id']."'");
						}else{
							$namevalue ='addressParent="'.$lastid.'",countryId="'.$countrygetresult['id'].'",stateId="'.$stategetresult['id'].'",cityId="'.$citygetresult['id'].'",address="'.$address1.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",primaryAddress=1,addressType="supplier"';
							addlistinggetlastid(_ADDRESS_MASTER_,$namevalue);
						}
						//EMAILS
						if($email1!=''){
							//check for address
							$rs1=""; 
							$rs1=GetPageRecord('*','suppliercontactPersonMaster',' email="' . encode($email1) . '" and primaryvalue=1 and division=3');
							if(mysqli_num_rows($rs1) > 0){
							    $addrData=mysqli_fetch_array($rs1);
								if($addrData['corporateId'] == $lastid){ 
									$namevalue ='contactPerson="'.$contactPerson1.'",corporateId="'.$lastid.'",phone="'.encode($mobile1).'",designation="'.$designation1.'",countryCode="'.$countryCode1.'",division="'.$division1.'",email="'.encode($email1).'",primaryvalue="1"';
									updatelisting('suppliercontactPersonMaster',$namevalue,"id='".$addrData['id']."'");
								}else{
									$msg='';
									$msg='Row No-'.$rowno.'. Duplicate: '.$email1.' is already exist...! - '.date('d-m-Y h:ia');
									importErrorlog($msg,$newfilez,'Supplier_Log');
		 						}
							}else{
								$namevalue ='contactPerson="'.$contactPerson1.'",corporateId="'.$lastid.'",phone="'.encode($mobile1).'",designation="'.$designation1.'",countryCode="'.$countryCode1.'",division="'.$division1.'",email="'.encode($email1).'",primaryvalue="1"';
								addlistinggetlastid('suppliercontactPersonMaster',$namevalue);
							} 
						}
						if($email2!=''){
							//check for address
							$rs1="";
							$rs1=GetPageRecord('*','suppliercontactPersonMaster',' email="' . encode($email2) . '" and primaryvalue=0 and division=3');
							if(mysqli_num_rows($rs1) > 0){
								$addrData=mysqli_fetch_array($rs1);
								if($addrData['corporateId'] == $lastid){ 
									$namevalue ='contactPerson="'.$contactPerson2.'",corporateId="'.$lastid.'",phone="'.encode($mobile2).'",designation="'.$designation2.'",countryCode="'.$countryCode2.'",division="'.$division2.'",email="'.encode($email2).'",primaryvalue="0"';
									updatelisting('suppliercontactPersonMaster',$namevalue,"id='".$addrData['id']."'");
								}else{
									$msg='';
									$msg='Row No-'.$rowno.'. Duplicate: '.$email2.' is already exist...! - '.date('d-m-Y h:ia');
									importErrorlog($msg,$newfilez,'Supplier_Log');
		 						}
							}else{ 
								$namevalue ='contactPerson="'.$contactPerson2.'",corporateId="'.$lastid.'",phone="'.encode($mobile2).'",designation="'.$designation2.'",countryCode="'.$countryCode2.'",division="'.$division2.'",email="'.encode($email2).'",primaryvalue="0"';
								addlistinggetlastid('suppliercontactPersonMaster',$namevalue);
							} 
						}
						if($email3!=''){
							//check for address
							$rs1="";
							$rs1=GetPageRecord('*','suppliercontactPersonMaster',' email="' . encode($email3) . '" and primaryvalue=0 and division=3');
							if(mysqli_num_rows($rs1) > 0){
								$addrData=mysqli_fetch_array($rs1); 
								if($addrData['corporateId'] == $lastid){
								 	$namevalue ='contactPerson="'.$contactPerson3.'",corporateId="'.$lastid.'",phone="'.encode($mobile3).'",designation="'.$designation3.'",countryCode="'.$countryCode3.'",division="'.$division3.'",email="'.encode($email3).'",primaryvalue="0"';
									updatelisting('suppliercontactPersonMaster',$namevalue,"id='".$addrData['id']."'");
								}else{
									$msg='';
									$msg='Row No-'.$rowno.'. Duplicate: '.$email3.' is already exist...! - '.date('d-m-Y h:ia');
									importErrorlog($msg,$newfilez,'Supplier_Log');
		 						}
							}else{
								$namevalue ='contactPerson="'.$contactPerson3.'",corporateId="'.$lastid.'",phone="'.encode($mobile3).'",designation="'.$designation3.'",countryCode="'.$countryCode3.'",division="'.$division3.'",email="'.encode($email3).'",primaryvalue="0"';
								addlistinggetlastid('suppliercontactPersonMaster',$namevalue);
							} 
						}
					}else{
						$countrygetresult='';
						$rs1=GetPageRecord('*',_COUNTRY_MASTER_,'name="'.$countryId.'"');
						$countrygetresult=mysqli_fetch_array($rs1);
						$stategetresult='';
						$rs1=GetPageRecord('*',_STATE_MASTER_,'name="'.$stateId.'"');
						$stategetresult=mysqli_fetch_array($rs1);
						$citygetresult='';
						$rs1=GetPageRecord('*',_CITY_MASTER_,'name="'.$cityId.'"');
						$citygetresult=mysqli_fetch_array($rs1);
						$sarrating='';
						$rs1=GetPageRecord('*',_HOTEL_CATEGORY_MASTER_,'name="'.$companyCategory.'"');
						$sarrating=mysqli_fetch_array($rs1);
						$destinationresult='';
						$destinationId = explode(',',$destinationId);
						$destId='';
						if($countryDestId>0){
							$rs1=GetPageRecord('*',_DESTINATION_MASTER_,'name!="" and deletestatus=0 and status=1 and countryId="'.$countryDestId.'"');
							while($destinationresult=mysqli_fetch_array($rs1)){
								$destId.=$destinationresult['id'].',';
								$destinationWise = 1;
							}
						}else{
							$destinationWise = 0;
						foreach($destinationId as $val){
							//echo 'name="'.trim($val).'"';
							$rs1=GetPageRecord('*',_DESTINATION_MASTER_,'name="'.trim($val).'"');
							if(mysqli_num_rows($rs1) > 0){
								$destinationresult=mysqli_fetch_array($rs1);
								$destId.=$destinationresult['id'].',';
							}
						}
					}
						$supplierMainType=2;
						$lastid = ''; 
						$namevalue ='companyTypeId="'.$hotel.'",name="'.$name.'",aliasname="'.$name.'",gstn="'.$gstn.'",contactPerson="'.$contactPerson1.'",countryId="'.$countrygetresult['id'].'",stateId="'.$stategetresult['id'].'",cityId="'.$citygetresult['id'].'",address1="'.$address1.'",address2="'.$address2.'",address3="'.$address3.'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",pinCode="'.$pinCode.'",destinationId="'.$destId.'",destinationlist="'.$destinationresult['id'].'",locationMap="'.$locationmap.'",categoryId="'.$sarrating['id'].'",airlinesType="'.$airline.'",transferType="'.$transfer.'",activityType="'.$activity.'",mealType="'.$retaurant.'",otherType="'.$other.'",supplierMainType="'.$supplierMainType.'",paymentTerm="'.$paymentTermId.'",entranceType="'.$entrance.'",guideType="'.$guide.'",trainType="'.$train.'",destinationWise="'.$destinationWise.'",countryWise="'.$countryDestId.'"';
						$lastid = addlistinggetlastid(_SUPPLIERS_MASTER_,$namevalue);
						$supplierNumber = 'S'.str_pad($lastid, 6, '0', STR_PAD_LEFT);
						updatelisting(_SUPPLIERS_MASTER_,'supplierNumber="'.$supplierNumber.'"','id="'.$lastid.'"');
						$lineSuccess++;
						$namevalue ='addressParent="'.$lastid.'",countryId="'.$countrygetresult['id'].'",stateId="'.$stategetresult['id'].'",cityId="'.$citygetresult['id'].'",address="'.$address1.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",primaryAddress=1,addressType="supplier"';
						addlistinggetlastid(_ADDRESS_MASTER_,$namevalue);
						//EMAILS
						if($email1!=''){
							//check for address
							$rs1="";
							echo "suppliercontactPersonMaster";
							$rs1=GetPageRecord('*','suppliercontactPersonMaster',' email="' . encode($email1) . '" and primaryvalue=1 and division=3');
							if(mysqli_num_rows($rs1) < 1){
								echo $namevalue ='contactPerson="'.$contactPerson1.'",corporateId="'.$lastid.'",phone="'.encode($mobile1).'",designation="'.$designation1.'",countryCode="'.$countryCode1.'",division="'.$division1.'",email="'.encode($email1).'",primaryvalue="1"';
								addlistinggetlastid('suppliercontactPersonMaster',$namevalue);
							} else{
								$msg='';
								$msg='Row No-'.$rowno.'. Duplicate: '.$email1.' is already exist...! - '.date('d-m-Y h:ia');
								importErrorlog($msg,$newfilez,'Supplier_Log');
	 						}
						}
						if($email2!=''){
							//check for address
							$rs1="";
							$rs1=GetPageRecord('*','suppliercontactPersonMaster',' email="' . encode($email2) . '" and primaryvalue=1 and division=3');
							if(mysqli_num_rows($rs1) < 1){
								$namevalue ='contactPerson="'.$contactPerson2.'",corporateId="'.$lastid.'",phone="'.encode($mobile2).'",designation="'.$designation2.'",countryCode="'.$countryCode2.'",division="'.$division2.'",email="'.encode($email2).'",primaryvalue="0"';
								addlistinggetlastid('suppliercontactPersonMaster',$namevalue);
							} else{
								$msg='';
								$msg='Row No-'.$rowno.'. Duplicate: '.$email1.' is already exist...! - '.date('d-m-Y h:ia');
								importErrorlog($msg,$newfilez,'Supplier_Log');
	 						}
						}
						if($email3!=''){
							//check for address
							$rs1="";
							$rs1=GetPageRecord('*','suppliercontactPersonMaster',' email="' . encode($email3) . '" and primaryvalue=1 and division=3');
							if(mysqli_num_rows($rs1) < 1){
								$namevalue ='contactPerson="'.$contactPerson3.'",corporateId="'.$lastid.'",phone="'.encode($mobile3).'",designation="'.$designation3.'",countryCode="'.$countryCode3.'",division="'.$division3.'",email="'.encode($email3).'",primaryvalue="0"';
								addlistinggetlastid('suppliercontactPersonMaster',$namevalue);
							} else{
								$msg='';
								$msg='Row No-'.$rowno.'. Duplicate: '.$email1.' is already exist...! - '.date('d-m-Y h:ia');
								importErrorlog($msg,$newfilez,'Supplier_Log');
	 						}
						}
					}
				}
	 		}	
	 	}else{
	 		$msg = '';
	        $msg = $fullurl . "importfile/" . $file_name . " , Not Uploaded Successfully ";
	        importErrorlog($msg, $newfilez, 'Supplier_Log');
	        ?>
			<script>
			parent.$('#importfield').remove();
			parent.alert('Failed to upload the file.!');
			</script>
			<?php
			exit;
	 	}
 		//endloop
	} 
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php  
	$msg='';
	$msg='Import Status. - '.$rowno.' - Failed('.$lineFailed.'), Duplicate('.$lineExist.'), Success('.round($lineSuccess).')_'.date('d-m-Y h:ia');
	importErrorlog($msg,$newfilez,'Supplier_Log');  
	?>
	parent.alertspopupopen('action=foundduplicaterecored&done=1&pagename=suppliers&moduleName=<?php echo $importpackagesightseeingModule; ?>&errorCount=<?php echo $errorCount; ?>','600px','auto');
	</script>
	<?php
} 

if(isset($_FILES['importfield']['name']) && trim($_POST['importCorporateExcel'])=='Y'){
	require_once 'reader.php';
	date_default_timezone_set('Asia/Kolkata');
	$importCorporateModule = $_REQUEST['importCorporateModule'];   ///// GET MODULE -------------------------------------
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){

		$folderName = 'log_corporate';
	    $newfilez = formatUrl($_FILES['importfield']['name']); // log file to store textin it
	    $file_name = trim($newfilez).'.xls'; // rename xls file to same as log file + .xls
	    $msg = '';
	    $msg = $newfilez;
	    importErrorlog($msg, $newfilez,$folderName);
	    $msg = '';
	    $msg = $fullurl . "importfile/" . $file_name . " Copy this link to download file ";
	    importErrorlog($msg, $newfilez,$folderName);
	    copy($_FILES['importfield']['tmp_name'], "importfile/" . $file_name);

		$line=1;
		$errorReport='';
		$errorCount=1;
		$errorReportHeader='<div><strong>Line No.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Error Report</strong></div><br>';    ///// GET ERROR -------------------------------------
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		$path="importfile/".$file_name;
		$data->read($path);
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
			$busitype=0;
			$showErrorName='';
			$showErrorType='';   ///// EMPTY VARIABLE  -------------------------------------
			$companyTypeId = trim($data->sheets[0]["cells"][$x][1]);
			$name = trim($data->sheets[0]["cells"][$x][2]);
			$gstn = trim($data->sheets[0]["cells"][$x][3]);
			$assignTo = trim($data->sheets[0]["cells"][$x][4]);
			$contactPerson = trim($data->sheets[0]["cells"][$x][5]);
			$contactPersonDivision = trim($data->sheets[0]["cells"][$x][6]);
			$contactPersonDesignation = trim($data->sheets[0]["cells"][$x][7]);
			$contactPersonCountrycode = trim($data->sheets[0]["cells"][$x][8]);
			$mobile1 = trim($data->sheets[0]["cells"][$x][9]);
			$email1 = trim($data->sheets[0]["cells"][$x][10]);
			$countryId = trim($data->sheets[0]["cells"][$x][11]);
			$stateId = trim($data->sheets[0]["cells"][$x][12]);
			$cityId = trim($data->sheets[0]["cells"][$x][13]);
			$address1 = trim($data->sheets[0]["cells"][$x][14]);
			$pinCode = trim($data->sheets[0]["cells"][$x][15]);
			$companyCategory = trim($data->sheets[0]["cells"][$x][16]);
			$bussinessType = trim($data->sheets[0]["cells"][$x][17]);
			$marketType = trim($data->sheets[0]["cells"][$x][18]);
			$nationalityType = trim($data->sheets[0]["cells"][$x][19]);

			$rs1xs=GetPageRecord('id','marketMaster','name="'.$marketType.'"');
			if(mysqli_num_rows($rs1xs)>0){
				$resMarket=mysqli_fetch_array($rs1xs);
				$marketType=$resMarket['id'];
			}

			$bstypegetresult='';
			$select11='*';
			$where1='UPPER(name)="'.strtoupper($bussinessType).'"';
			$rs144=GetPageRecord($select11,'businessTypeMaster',$where1);
			$bstypegetresult=mysqli_fetch_array($rs144);
			$busityp = $bstypegetresult['id'];


			$dateAdded=time();
			$where='email="'.$email1.'" and sectionType="corporate" ';
			$checkEmail = checkduplicate(_EMAIL_MASTER_,$where);
			///// VALIDATE -------------------------------------
			if($name=='' || $busityp=='' || $companyTypeId=='' || $email1=='' || $assignTo=='' || $checkEmail=='yes' || $companyCategory==''){
				if($checkEmail=='yes'){ $showErrorName= $email1.' is Already Exists,'; }
				if($name==''){ $showErrorName.='Company Name is Empty,'; }
				if($busityp==''){ $showErrorType.='Bussiness Type,'; }
				if($companyTypeId==''){ $showErrorType.='Company Type,'; }
				if($email1==''){ $showErrorType.='Email is Empty,'; }
				if($assignTo==''){ $showErrorType.='Sales Person,'; }
				if($companyCategory==''){ $showErrorType.='Category,'; }
					$duplicaterecored.='<div>'.$line.'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error in&nbsp;'.$showErrorName.'&nbsp;&nbsp;&nbsp;'.$showErrorType.'</div>';
					$errorCount++;
			}
			if($name!='' && $email1!='' && $checkEmail=='no'  && $busityp!='' && $companyTypeId!='' && $assignTo!='' && $companyCategory!=''){
				$assigngetresult='';
				$pieces = explode(" ", $assignTo);
				$fname =  $pieces[0];
				$lname =  $pieces[1];
				$select1='*';
				$where1='firstName="'.$fname.'" and lastName="'.$lname.'"';
				$rs1=GetPageRecord($select1,_USER_MASTER_,$where1);
				$assigngetresult=mysqli_fetch_array($rs1);
				if($assigngetresult['id']!=''){
					$assignTo=$assigngetresult['id'];
				} else {
					$assignTo=37;
				}
				$countrygetresult='';
				$select1='*';
				$where1='name="'.$countryId.'"';
				$rs1=GetPageRecord($select1,_COUNTRY_MASTER_,$where1);
				$countrygetresult=mysqli_fetch_array($rs1);
				$stategetresult='';
				$select1='*';
				$where1='name="'.$stateId.'"';
				$rs1=GetPageRecord($select1,_STATE_MASTER_,$where1);
				$stategetresult=mysqli_fetch_array($rs1);
				$citygetresult='';
				$select1='*';
				$where1='name="'.$cityId.'"';
				$rs1=GetPageRecord($select1,_CITY_MASTER_,$where1);
				$citygetresult=mysqli_fetch_array($rs1);
				$companytypegetresult='';
				$select1='*';
				$where1='name="'.$companyTypeId.'"';
				$rs1=GetPageRecord($select1,_COMPANY_TYPE_MASTER_,$where1);
				$companytypegetresult=mysqli_fetch_array($rs1);
				
				$companyCategoryId='';
				if(strtoupper($companyCategory)=='BIG'){ $companyCategoryId=1; }
				if(strtoupper($companyCategory)=='MEDIUM'){ $companyCategoryId=2; }
				if(strtoupper($companyCategory)=='SMALL'){ $companyCategoryId=3; }
				
				$nationalityTypeId = 1;
				if (strtoupper($nationalityType) == 'LOCAL') {  $nationalityTypeId = 1;  }
				else if (strtoupper($nationalityType) == 'FOREIGN') {  $nationalityTypeId = 2;  }
				else if (strtoupper($nationalityType) == 'BIMSTEC') {  $nationalityTypeId = 3;  }
				else{ $nationalityTypeId = 1; }



				// if($bussinessType=='Corporate' || $bussinessType=='corporate'){ $busitype='1'; }
				// if($bussinessType=='B2B' || $bussinessType=='b2b'){ $busitype='2'; }
				
				// if($contactPersonDivision=='Accounts' || $contactPersonDivision=='accounts' || $contactPersonDivision=='Account' || $contactPersonDivision=='account'){ $contactPersonDivision='2'; }
				// if($contactPersonDivision=='Operations' || $contactPersonDivision=='operations' || $contactPersonDivision=='Operation' || $contactPersonDivision=='operation'){ 
				// 	$contactPersonDivision='3'; 
				// }
				if($contactPersonDivision=='Sales' || $contactPersonDivision=='sales' || $contactPersonDivision=='Sale' || $contactPersonDivision=='sale'){ 				
					$contactPersonDivision='1'; 
				}

				$divisionId= 0;
				$rs1=GetPageRecord('*',_DIVISION_MASTER_,' UPPER(name)="'.strtoupper($divisionName).'"');
				$divisionD=mysqli_fetch_array($rs1);
				$divisionId= $divisionD['id'];


				if($companyCategoryId==''){
					$companyCategoryId=2;
				}
				$rs1='';
				$rs1=GetPageRecord('id',_CORPORATE_MASTER_,' name="'.addslashes($name).'" ');
				if(mysqli_num_rows($rs1)==0){

					$lastid ='';
					$namevalue ='companyTypeId="'.$companytypegetresult['id'].'",name="'.addslashes($name).'",gstn="'.$gstn.'",assignTo="'.$assignTo.'",contactPerson="'.addslashes($contactPerson).'",countryId="'.$countrygetresult['id'].'",stateId="'.$stategetresult['id'].'",cityId="'.$citygetresult['id'].'",address1="'.addslashes($address1).'",address2="'.addslashes($address2).'",address3="'.addslashes($address3).'",addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",pinCode="'.$pinCode.'",nationality="'.$nationalityTypeId.'",companyCategory="'.$companyCategoryId.'",bussinessType="'.$busitype.'",marketType="'.$marketType.'"';
					$lastid = addlistinggetlastid(_CORPORATE_MASTER_,$namevalue);

					$namevaluecontactPerson ='contactPerson="'.$contactPerson.'",corporateId="'.$lastid.'",designation="'.$contactPersonDesignation.'",countryCode="'.$contactPersonCountrycode.'",phone="'.encode($mobile1).'",email="'.encode($email1).'",primaryvalue="1",deletestatus="0",division="'.$divisionId.'"';
					$lastid22 = addlistinggetlastid('contactPersonMaster',$namevaluecontactPerson);

					$namevalue ='addressParent="'.$lastid.'",countryId="'.$countrygetresult['id'].'",stateId="'.$stategetresult['id'].'",cityId="'.$citygetresult['id'].'",address="'.addslashes($address1).'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",primaryAddress=1,addressType="corporate"';
					addlistinggetlastid(_ADDRESS_MASTER_,$namevalue);

					$msg='';
					$msg='Row No-'.$rowno.'. Success: '.addslashes($name).' has been added.! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
				}else{
					$showErrorName.=' Duplicate : "'.addslashes($name).'" agent name already exist.!'; 
					$duplicaterecored.='<div>'.$line.'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error in&nbsp;'.$showErrorName.'</div>';
					$errorCount++;

					$msg='';
					$msg='Row No-'.$rowno.'. Duplicate : '.addslashes($name).' agent already exist.! - '.date('d-m-Y h:ia');
					importErrorlog($msg, $newfilez,$folderName);
				}
			}
			$line++; ///// COUNT LINE -------------------------------------
		}
	}
	?>
	<script>
	parent.$('#importfield').remove();
	parent.$('#filefieldhere').append('<input name="importfield" type="file" id="importfield" accept="application/vnd.ms-excel" onchange="submitimportfrom();" />');
	<?php 
	if($duplicaterecored!=''){ ?>
		parent.alertspopupopen('action=foundduplicaterecored&moduleName=<?php echo $importCorporateModule; ?>&errorCount=<?php echo $errorCount; ?>','600px','auto');
		setTimeout( function(){
		parent.$('#dupplicaterecoreddlist').html('<?php echo $errorReportHeader.$duplicaterecored; ?>');
		  }  , 1000 );
		<?php 
	} else { ?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&moduleName=<?php echo $importCorporateModule; ?>&errorCount=<?php echo $errorCount; ?>','600px','auto');
		<?php 
	} 
	?>
	//parent.setupbox('showpage.crm?module=corporate');
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	</script>
	<?php
}


/*=================B2C/GUEST EXCEL IMPORT START==============*/
if(isset($_FILES['importfield']['name']) && trim($_POST['importB2CExcel'])=='Y'){
	require_once 'reader.php';
	date_default_timezone_set('Asia/Kolkata');
	$importContactModule = $_REQUEST['importContactModule'];   ///// GET MODULE -------------------------------------
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){

		$folderName = 'log_contacts';
	    $newfilez = formatUrl($_FILES['importfield']['name']); // log file to store textin it
	    $file_name = trim($newfilez).'.xls'; // rename xls file to same as log file + .xls
	    $msg = '';
	    $msg = $newfilez;
	    importErrorlog($msg, $newfilez,$folderName);
	    $msg = '';
	    $msg = $fullurl . "importfile/" . $file_name . " Copy this link to download file ";
	    importErrorlog($msg, $newfilez,$folderName);
	    copy($_FILES['importfield']['tmp_name'], "importfile/" . $file_name);

		$rowno=0;
	    $lineSuccess=0;
	    $lineFailed=0;
	    $lineExist=0;
	    $errorReport='';
		$errorReportHeader='<div><strong>Line No.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Error Report</strong></div><br>';    ///// GET ERROR -------------------------------------
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		$path="importfile/".$file_name;
		$data->read($path);
		for ($x = 3; $x <= count($data->sheets[0]["cells"]); $x++) {
			++$rowno;

			$showErrorName='';   ///// EMPTY VARIABLE  ----------------

			$tourId      = trim($data->sheets[0]["cells"][$x][1]);
			$contactType = trim($data->sheets[0]["cells"][$x][2]);
			$nationality = trim($data->sheets[0]["cells"][$x][3]);
			$nameTitle   = trim($data->sheets[0]["cells"][$x][4]);
			$firstName   = trim($data->sheets[0]["cells"][$x][5]);
			$middleName  = trim($data->sheets[0]["cells"][$x][6]);
			$lastName    = trim($data->sheets[0]["cells"][$x][7]);
			$genderName  = trim($data->sheets[0]["cells"][$x][8]);
			$dateOfBirth = trim($data->sheets[0]["cells"][$x][9]);
			$annivsrDate = trim($data->sheets[0]["cells"][$x][10]);
			$marketType  = trim($data->sheets[0]["cells"][$x][11]);
			$salesPerson = trim($data->sheets[0]["cells"][$x][12]);
			$isCovidVaci = trim($data->sheets[0]["cells"][$x][13]);
			$isNewsletter= trim($data->sheets[0]["cells"][$x][14]);

			$phoneType   = trim($data->sheets[0]["cells"][$x][15]);
			$phoneCode   = trim($data->sheets[0]["cells"][$x][16]);
			$phoneNumber = trim($data->sheets[0]["cells"][$x][17]);
			$emailType   = trim($data->sheets[0]["cells"][$x][18]);
			$emailAddres = trim($data->sheets[0]["cells"][$x][19]);

			$phoneType2  = trim($data->sheets[0]["cells"][$x][20]);
			$phoneCode2  = trim($data->sheets[0]["cells"][$x][21]);
			$phoneNumber2= trim($data->sheets[0]["cells"][$x][22]);
			$emailType2  = trim($data->sheets[0]["cells"][$x][23]);
			$emailAddres2= trim($data->sheets[0]["cells"][$x][24]);
			
			$countryName = trim($data->sheets[0]["cells"][$x][25]);
			$stateName   = trim($data->sheets[0]["cells"][$x][26]);
			$cityName    = trim($data->sheets[0]["cells"][$x][27]);
			$address     = trim($data->sheets[0]["cells"][$x][28]);
			$pinCode     = trim($data->sheets[0]["cells"][$x][29]);
			
			$emer_contactName    = trim($data->sheets[0]["cells"][$x][30]);
			$emer_contactRelation= trim($data->sheets[0]["cells"][$x][31]);
			$emer_contactNumber  = trim($data->sheets[0]["cells"][$x][32]);
			
			$status      = trim($data->sheets[0]["cells"][$x][33]);
			$remarks     = trim($data->sheets[0]["cells"][$x][34]);


			// filter var designationId==================================================
			$birthDate = date('Y-m-d');
			if($dateOfBirth!=''){
				$birthDate = date('Y-m-d',strtotime($dateOfBirth));
			}
			$anniversaryDate = date('Y-m-d');
			if($annivsrDate!=''){
				$anniversaryDate = date('Y-m-d',strtotime($annivsrDate));
			}
			$marketTypeId = 0;
			$mkTQuery=GetPageRecord('id','marketMaster','UPPER(name)="'.strtoupper($marketType).'"');
			if(mysqli_num_rows($mkTQuery)>0){
				$marketData=mysqli_fetch_array($mkTQuery);
				$marketTypeId=$marketData['id'];
			}

			if(strtoupper($isCovidVaci)=='YES'){ $isCovidVaci=1; }
			if(strtoupper($isNewsletter)=='YES'){ $isNewsletter=1; }

			$contactTypeId='';
			if(strtoupper($contactType)=='EMPLOYEE' || strtoupper($contactType)=='EMPLOYEES'){ $contactTypeId=1; }
			if(strtoupper($contactType)=='GUEST' || strtoupper($contactType)=='GUEST LIST'){ $contactTypeId=3; }
			if(strtoupper($contactType)=='B2C'){ $contactTypeId=2; }

			$phoneTypeId = 0;
			$phoneQuery=GetPageRecord('id',_PHONE_TYPE_MASTER_,'UPPER(name)="'.strtoupper($phoneType).'"');
			if(mysqli_num_rows($phoneQuery)>0){
				$phoneData=mysqli_fetch_array($phoneQuery);
				$phoneTypeId=$phoneData['id'];
			}

			$phoneTypeId2 = 0;
			$phoneQuery2=GetPageRecord('id',_PHONE_TYPE_MASTER_,'UPPER(name)="'.strtoupper($phoneType2).'"');
			if(mysqli_num_rows($phoneQuery2)>0){
				$phoneData2=mysqli_fetch_array($phoneQuery2);
				$phoneTypeId2=$phoneData2['id'];
			}
				
			$emailTypeId = 0;
			$emailQuery=GetPageRecord('id',_EMAIL_TYPE_MASTER_,'UPPER(name)="'.strtoupper($emailType).'"');
			if(mysqli_num_rows($emailQuery)>0){
				$emailData=mysqli_fetch_array($emailQuery);
				$emailTypeId=$emailData['id'];
			}

			$emailTypeId2 = 0;
			$emailQuery2=GetPageRecord('id',_EMAIL_TYPE_MASTER_,'UPPER(name)="'.strtoupper($emailType2).'"');
			if(mysqli_num_rows($emailQuery2)>0){
				$emailData2=mysqli_fetch_array($emailQuery2);
				$emailTypeId2=$emailData2['id'];
			}

			$rs1= '';
			$rs1=GetPageRecord('*','nationalityMaster',' UPPER(name)="'.strtoupper($nationality).'"');
			if(mysqli_num_rows($rs1)>0){
				$nationalityData=mysqli_fetch_array($rs1);
				$nationalityId= $nationalityData['id'];
			}
			$rs1= '';
			$rs1=GetPageRecord('*',_COUNTRY_MASTER_,' UPPER(name)="'.strtoupper($countryName).'"');
			if(mysqli_num_rows($rs1)>0){
				$countryData=mysqli_fetch_array($rs1);
				$countryId= $countryData['id'];
			}
			$rs1= '';
			$rs1=GetPageRecord('*',_STATE_MASTER_,' UPPER(name)="'.strtoupper($stateName).'"');
			if(mysqli_num_rows($rs1)>0){
				$stateData=mysqli_fetch_array($rs1);
				$stateId= $stateData['id'];
			}
			$rs1= '';
			$rs1=GetPageRecord('*',_CITY_MASTER_,' UPPER(name)="'.strtoupper($cityName).'"');
			if(mysqli_num_rows($rs1)>0){
				$cityData=mysqli_fetch_array($rs1);
				$cityId= $cityData['id'];
			}
	 
			$nameTitleId= 0;
			$nameTitleQuery=GetPageRecord('*',_NAME_TITLE_MASTER_,' UPPER(name)="'.strtoupper($nameTitle).'"');
			if(mysqli_num_rows($nameTitleQuery)>0){
				$nameTitleD=mysqli_fetch_array($nameTitleQuery);
				$nameTitleId= $nameTitleD['id'];
			}
			if(strtoupper($status)=='ACTIVE' || strtoupper($status)=='YES'){ $statusId=1; }

			$modifyBy=$_SESSION['userid'];
			$dateAdded=time();
			$where='email="'.$emailAddres.'" and sectionType="contacts" ';
			$checkEmail = checkduplicate(_EMAIL_MASTER_,$where);
			//  || $checkEmail=='yes'
			///// VALIDATE -------------------------------------
			if($firstName=='' || $lastName=='' || $contactType=='' || $contactTypeId=='' || $genderName==''){
				if($checkEmail=='yes'){ $showErrorName= $emailAddres.' is Already Exists,'; }
				if($firstName==''){ $showErrorName.='First Name is Empty,'; }
				if($lastName==''){ $showErrorName.='Last Name is Empty,'; }
				if($contactType==''){ $showErrorName.='Type is Empty,'; }
				if($contactTypeId==''){ $showErrorName.='Type is Invalid,'; }
				if($genderName==''){ $showErrorName.='Gender is Empty,'; }
					$duplicaterecored.='<div>'.$line.'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error in&nbsp;'.$showErrorName.'&nbsp;&nbsp;&nbsp</div>';
					$errorCount++;
			}else{

				$salesPersonD='';
				$pieces = explode(" ", $salesPerson);
				$fname =  $pieces[0];
				$lname =  $pieces[1];
				$select1='*';
				$where1='UPPER(firstName)="'.strtoupper($fname).'" and UPPER(lastName)="'.strtoupper($lname).'"';
				$rs1=GetPageRecord($select1,_USER_MASTER_,$where1);
				$salesPersonD=mysqli_fetch_array($rs1);
				if($salesPersonD['id']!=''){
					$salesPersonId=$salesPersonD['id'];
				} else {
					$salesPersonId=37;
				}

				$discardErr = 0;
				if($contactTypeId == 3){ //guest
					if($tourId==''){
						$discardErr = 1;
						$msg='';
						$msg='Row No-'.$rowno.'. Failed : Tour Id does not exist! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
					}
				}
				if($contactTypeId == 2){ // b2c and emp
					if($marketTypeId==''){
						$discardErr = 1;
						$msg='';
						$msg='Row No-'.$rowno.'. Failed : Market Type does not exist! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
					}
					if($salesPersonId==''){
						$discardErr = 1;
						$msg='';
						$msg='Row No-'.$rowno.'. Failed : Sales Person does not exist! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
					}
					if($isCovidVaci==''){
						$msg='';
						$msg='Row No-'.$rowno.'. Warning : Should have covid vaccinated! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
					}
				}
				if($contactTypeId == 1){ // emp and emp
					if($marketTypeId==''){
						$discardErr = 1;
						$msg='';
						$msg='Row No-'.$rowno.'. Failed : Market Type does not exist! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
					}
					if($salesPersonId==''){
						$discardErr = 1;
						$msg='';
						$msg='Row No-'.$rowno.'. Failed : Sales Person does not exist! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
					}
					if($isCovidVaci==''){
						$msg='';
						$msg='Row No-'.$rowno.'. Warning : Should have covid vaccinated! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
					}
				}

				// moving to add and update 
				$contactsQuery='';
				$contactsQuery=GetPageRecord('id',_CONTACT_MASTER_,' UPPER(firstName)="'.strtoupper($firstName).'" and UPPER(lastName)="'.strtoupper($lastName).'" and contactType="'.$contactTypeId.'" ');
				if(mysqli_num_rows($contactsQuery)==0){
					
					if($discardErr == 0){

						$lastid =''; 
						$namevalue ='tourId="'.$tourId.'",contactType="'.$contactTypeId.'",nationality="'.$nationalityId.'",contacttitleId="'.$nameTitleId.'",gender="'.$genderName.'",firstName="'.$firstName.'",middleName="'.$middleName.'",lastName="'.$lastName.'",anniversaryDate="'.$anniversaryDate.'",birthDate="'.$birthDate.'",marketType="'.$marketTypeId.'",Newsletter="'.$isNewsletter.'",CovidVaccin="'.$isCovidVaci.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",assignTo="'.$salesPersonId.'",address1="'.$address.'",address2="'.$address2.'",address3="'.$address3.'",addedBy="'.$modifyBy.'",dateAdded="'.$dateAdded.'",modifyBy="'.$modifyBy.'",modifyDate="'.$dateAdded.'",pinCode="'.$pinCode.'",pinzip="'.$pinCode.'",facebook="'.$facebook.'",twitter="'.$twitter.'",linkedIn="'.$linkedIn.'",emergencyName="'.$emer_contactName.'",emergencyRelation="'.$emer_contactRelation.'",emergencyContact="'.$emer_contactNumber.'",status="'.$statusId.'",remark1="'.$remarks.'"';
						$lastid = addlistinggetlastid(_CONTACT_MASTER_,$namevalue);
						$lineSuccess++;

						if($address!=''){
							$namevalue ='addressParent="'.$lastid.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address="'.$address.'",pinCode="'.$pinCode.'",primaryAddress=1,addressType="contacts"';
							addlistinggetlastid(_ADDRESS_MASTER_,$namevalue);
						}
						if($emailAddres!=''){
							$namevalue ='masterId="'.$lastid.'",email="'.$emailAddres.'",emailType="'.$emailTypeId.'",sectionType="contacts",primaryvalue=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
							$EID = addlistinggetlastid(_EMAIL_MASTER_,$namevalue);
						}
						if($emailAddres2!=''){
							$namevalue ='masterId="'.$lastid.'",email="'.$emailAddres2.'",emailType="'.$emailTypeId2.'",sectionType="contacts",primaryvalue=0,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
							$EID2 = addlistinggetlastid(_EMAIL_MASTER_,$namevalue);
						} 
						if($phoneNumber!=''){
							$namevalue ='masterId="'.$lastid.'",phoneNo="'.$phoneNumber.'",phoneType="'.$phoneTypeId.'",EID="'.$EID.'",sectionType="contacts",primaryvalue=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
							addlistinggetlastid(_PHONE_MASTER_,$namevalue);
						}
						if($phoneNumber2!=''){
							$namevalue ='masterId="'.$lastid.'",phoneNo="'.$phoneNumber2.'",phoneType="'.$phoneTypeId2.'",EID="'.$EID2.'",sectionType="contacts",primaryvalue=0,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
							addlistinggetlastid(_PHONE_MASTER_,$namevalue);
						} 
					}else{
						$lineFailed++;
					}

				}else{
					$contactsData=mysqli_fetch_array($contactsQuery);

					if($discardErr == 0){

						$updateId = $contactsData['id']; 

						$namevalue ='tourId="'.$tourId.'",nationality="'.$nationalityId.'",gender="'.$genderName.'",anniversaryDate="'.$anniversaryDate.'",birthDate="'.$birthDate.'",marketType="'.$marketTypeId.'",Newsletter="'.$isNewsletter.'",CovidVaccin="'.$isCovidVaci.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",assignTo="'.$salesPersonId.'",address1="'.$address.'",address2="'.$address2.'",address3="'.$address3.'",modifyBy="'.$modifyBy.'",modifyDate="'.$dateAdded.'",pinCode="'.$pinCode.'",pinzip="'.$pinCode.'",facebook="'.$facebook.'",twitter="'.$twitter.'",linkedIn="'.$linkedIn.'",emergencyName="'.$emer_contactName.'",emergencyRelation="'.$emer_contactRelation.'",emergencyContact="'.$emer_contactNumber.'",status="'.$statusId.'",remark1="'.$remarks.'"';

						$where = 'id = "'.$updateId.'"';
						$update = updatelisting(_CONTACT_MASTER_,$namevalue,$where);

						$msg='';
						$msg='Row No-'.$rowno.'. Updated : '.addslashes($firstName.' '.$lastName).', Data is updated.! - '.date('d-m-Y h:ia');
						importErrorlog($msg, $newfilez,$folderName);
						$lineExist++;

						//check for address
						if($address!=''){
							$rs1="";
							$rs1=GetPageRecord('*',_ADDRESS_MASTER_,' addressParent="'.$updateId.'" and addressType="contacts"');
							if(mysqli_num_rows($rs1) > 0){
								$addrData=mysqli_fetch_array($rs1);
		 						$namevalue ='countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address="'.$address.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",primaryAddress=1,addressType="contacts"';
								updatelisting(_ADDRESS_MASTER_,$namevalue,"id='".$addrData['id']."'");
							}else{
								$namevalue ='addressParent="'.$updateId.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",address="'.$address.'",pinCode="'.$pinCode.'",gstn="'.$gstn.'",primaryAddress=1,addressType="contacts"';
								addlistinggetlastid(_ADDRESS_MASTER_,$namevalue);
							}
						}
						//EMAILS
						if($emailAddres!=''){
							//check for address
							$emailQuery=""; 
							$emailQuery=GetPageRecord('*',_EMAIL_MASTER_,' email="' . trim($emailAddres) . '"');
							if(mysqli_num_rows($emailQuery) > 0){
							    $emailData=mysqli_fetch_array($emailQuery);
							    $EID = $emailData['id'];
								$namevalue ='emailType="'.$emailTypeId.'",primaryvalue=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
								updatelisting(_EMAIL_MASTER_,$namevalue,"id='".$EID."'");
							}else{
								$namevalue ='masterId="'.$updateId.'",email="'.$emailAddres.'",emailType="'.$emailTypeId.'",sectionType="contacts",primaryvalue=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
								$EID = addlistinggetlastid(_EMAIL_MASTER_,$namevalue);
							} 
						}
						if($emailAddres2!=''){
							//check for address
							$emailQuery=""; 
							$emailQuery=GetPageRecord('*',_EMAIL_MASTER_,' email="' . trim($emailAddres2) . '"');
							if(mysqli_num_rows($emailQuery) > 0){
							    $emailData2=mysqli_fetch_array($emailQuery);
							    $EID2 = $emailData2['id'];

								$namevalue ='emailType="'.$emailTypeId2.'",primaryvalue=0,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
								updatelisting(_EMAIL_MASTER_,$namevalue,"id='".$EID2."'");
							}else{
								$namevalue ='masterId="'.$updateId.'",email="'.$emailAddres2.'",emailType="'.$emailTypeId2.'",sectionType="contacts",primaryvalue=0,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
								$EID2 = addlistinggetlastid(_EMAIL_MASTER_,$namevalue);
							} 
						}


						if($phoneNumber!=''){
							//check for 
							$phQuery=""; 
							$phQuery=GetPageRecord('*',_PHONE_MASTER_,' phoneNo="' . trim($phoneNumber) . '"');
							if(mysqli_num_rows($phQuery) > 0){
							    $phoneData=mysqli_fetch_array($phQuery);

								$namevalue ='phoneType="'.$phoneTypeId.'",EID="'.$EID.'",primaryvalue=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
								updatelisting(_PHONE_MASTER_,$namevalue,"id='".$phoneData['id']."'");
								
							}else{
								$namevalue ='masterId="'.$updateId.'",phoneNo="'.$phoneNumber.'",phoneType="'.$phoneTypeId.'",EID="'.$EID.'",sectionType="contacts",primaryvalue=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
								addlistinggetlastid(_PHONE_MASTER_,$namevalue);
							} 
						}


						if($phoneNumber2!=''){
							//check for 
							$phQuery=""; 
							$phQuery=GetPageRecord('*',_PHONE_MASTER_,' phoneNo="' . trim($phoneNumber2) . '"');
							if(mysqli_num_rows($phQuery) > 0){
							    $phoneData2=mysqli_fetch_array($phQuery);

								$namevalue ='phoneType="'.$phoneTypeId2.'",EID="'.$EID2.'",primaryvalue=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
								updatelisting(_PHONE_MASTER_,$namevalue,"id='".$phoneData2['id']."'");
								
							}else{
								$namevalue2 ='masterId="'.$updateId.'",phoneNo="'.$phoneNumber2.'",phoneType="'.$phoneTypeId2.'",EID="'.$EID2.'",sectionType="contacts",primaryvalue=1,addedBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'"';
								addlistinggetlastid(_PHONE_MASTER_,$namevalue2);
							} 
						}
					
					}else{
						$lineFailed++;
					}

					
				}
			}
		}
	}
	?> 
	<script type="text/javascript">
	<?php 
	if ($errorReport != '') {
		$msg = '';
		$msg = 'Total Records List. - ' . $rowno . ' - Success Entry(' . $lineSuccess . '), Failed Entry(' . $lineFailed . '), Updated Entry(' . $lineExist . ')_' . date('d-m-Y h:ia');
		importErrorlog($msg, $newfilez,$folderName);
		?> 	///// ERROR REPORT -------------------------------------
		parent.alertspopupopen('action=foundduplicaterecored&moduleName=<?php echo $importContactModule; ?>&errorCount=<?php echo $errorCount; ?>','600px','auto');
		setTimeout( function(){
			parent.$('#dupplicaterecoreddlist').html('<?php echo $errorReportHeader . $errorReport . "<p>" . $msg . "</p>"; ?>');
		}  , 1000 );
		<?php
	}
	else {
		$msg = '';
		$msg = 'Total Records List. - ' . $rowno . ' - Success Entry(' . $lineSuccess . ' ), Failed Entry(' . $lineFailed . '), Updated Entry(' . $lineExist . ')_' . date('d-m-Y h:ia');
		importErrorlog($msg, $newfilez,$folderName);
		?>
		parent.alertspopupopen('action=foundduplicaterecored&done=1&moduleName=<?php echo $importContactModule; ?>','600px','auto');
		<?php
	} ?>
	</script>
    <?php
}
 
if(isset($_FILES['importfield']['name']) && trim($_POST['importexcelguestlist'])=='Y' && trim($_POST['queryId'])!=''){
	require_once 'reader.php';
	$duplicaterecored.='';
	if(!empty($_FILES['importfield']['name'])){
		$file_name=$_FILES['importfield']['name'];
		copy($_FILES['importfield']['tmp_name'],"importfile/".$file_name);
		$data = new Spreadsheet_Excel_Reader();
		$data->setOutputEncoding('CP1251');
		$path="importfile/".$file_name;
		$data->read($path);
		for ($x = 2; $x <= count($data->sheets[0]["cells"]); $x++) {
			// print_r($data->sheets[0]["cells"]);die();
			$title = trim($data->sheets[0]["cells"][$x][1]);
			$firstName = trim($data->sheets[0]["cells"][$x][2]);
			$lastName = trim($data->sheets[0]["cells"][$x][3]);
			$age = trim($data->sheets[0]["cells"][$x][4]);
			$gender = trim($data->sheets[0]["cells"][$x][5]);
			$mealPreference = trim($data->sheets[0]["cells"][$x][6]);
			$specilaassistance = trim($data->sheets[0]["cells"][$x][7]);
			$seatPreference = trim($data->sheets[0]["cells"][$x][8]);

			$countryName = trim($data->sheets[0]["cells"][$x][9]);
			$select1 = 'id';
			$where1 = ' name like "'.$countryName.'" limit 1 ';
			$rs1=GetPageRecord($select1,'countryMaster',$where1);
			$editresult=mysqli_fetch_array($rs1);

			$address = trim($data->sheets[0]["cells"][$x][9]);
			$dateAdded = time();
			$namevalue ='queryId="'.$_REQUEST['queryId'].'",title="'.$title.'",fname="'.$firstName.'",countryId="'.$editresult['id'].'",lname="'.$lastName.'",age="'.$age.'",gender="'.$gender.'",mealPreference="'.$mealPreference.'",special_assist="'.$specilaassistance.'",seatPreference="'.$seatPreference.'",address="'.addslashes($address).'",addDate="'.$dateAdded.'",addBy="'.$_SESSION['userid'].'"';
			addlisting('guestList',$namevalue);
		}
	}
	?>
	<script>
	parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo encode($_REQUEST['queryId']); ?>&guestlist=1');
	</script>
	<?php
}



//==========================END Import  Excel===========================

//end of the import block
if(trim($_POST['action'])=='hotelBreakupSaveCost'  && trim($_POST['tariffId'])!=''){
	  
	$tariffId=decode($_REQUEST['tariffId']);
	$rs=GetPageRecord('*','quotationHotelRateMaster',' id="'.$tariffId.'" ');
	if($tariffId > 0 && mysqli_num_rows($rs)>0 && $_REQUEST['tblNum'] == 2){

		//$dmcData2 = mysqli_fetch_array($rs);
		$namevalue ='singleoccupancy="'.$_POST['singleoccupancy'].'",remarks="'.$_POST['remarks'].'",doubleoccupancy="'.$_POST['doubleoccupancy'].'",extraBed="'.$_POST['extraoccupancy'].'",childwithbed="'.$_POST['childwithbed'].'",childwithoutbed="'.$_POST['childwithoutbed'].'",roomGST="'.$_POST['roomGST'].'",mealGST="'.$_POST['mealGST'].'",roomTAC="'.$_POST['roomTAC'].'",markupType="'.$_POST['markupType'].'",markupCost="'.$_POST['markupCost'].'",breakfast="'.$_POST['breakfast'].'",lunch="'.$_POST['lunch'].'",dinner="'.$_POST['dinner'].'",childDinner="'.$_POST['childDinner'].'",childLunch="'.$_POST['childLunch'].'",childBreakfast="'.$_POST['childBreakfast'].'",quadRoom="'.$_POST['quadRoom'].'",teenRoom="'.$_POST['teenRoom'].'",sixBedRoom="'.$_POST['sixBedRoom'].'",eightBedRoom="'.$_POST['eightBedRoom'].'",tenBedRoom="'.$_POST['tenBedRoom'].'"';
 		$where='id="'.$tariffId.'"';
		$update = updatelisting('quotationHotelRateMaster',$namevalue,$where);

	}else{

		$rs="";
		$rs=GetPageRecord('*',_DMC_ROOM_TARIFF_MASTER_,' id="'.$tariffId.'" ');
		$dmcData1 = mysqli_fetch_array($rs);
		// paxType 
		$namevalue ='tariffId="'.$dmcData1['id'].'",quotationId="'.$_REQUEST['quotationId'].'",marketType="'.$dmcData1['marketType'].'",fromDate="'.$dmcData1['fromDate'].'",toDate="'.$dmcData1['toDate'].'",roomType="'.$dmcData1['roomType'].'",mealPlan="'.$dmcData1['mealPlan'].'",singleoccupancy="'.$_POST['singleoccupancy'].'",doubleoccupancy="'.$_POST['doubleoccupancy'].'",tripleoccupancy=0,status="1",paxType="'.$dmcData1['paxType'].'",supplierId="'.$dmcData1['supplierId'].'",serviceid="'.$dmcData1['serviceid'].'",tarifType="'.$dmcData1['tarifType'].'",seasonType="'.$dmcData1['seasonType'].'",extraBed="'.$_POST['extraoccupancy'].'",childwithbed="'.$_POST['childwithbed'].'",childwithoutbed="'.$_POST['childwithoutbed'].'",roomGST="'.$_POST['roomGST'].'",mealGST="'.$_POST['mealGST'].'",roomTAC="'.$_POST['roomTAC'].'",remarks="'.$_POST['remarks'].'",currencyId="'.$dmcData1['currencyId'].'",markupType="'.$_POST['markupType'].'",markupCost="'.$_POST['markupCost'].'",breakfast="'.$_POST['breakfast'].'",lunch="'.$_POST['lunch'].'",dinner="'.$_POST['dinner'].'",childDinner="'.$_POST['childDinner'].'",childLunch="'.$_POST['childLunch'].'",childBreakfast="'.$_POST['childBreakfast'].'",quadRoom="'.$_POST['quadRoom'].'",teenRoom="'.$_POST['teenRoom'].'",sixBedRoom="'.$_POST['sixBedRoom'].'",eightBedRoom="'.$_POST['eightBedRoom'].'",tenBedRoom="'.$_POST['tenBedRoom'].'"';
		$lastid = addlistinggetlastid('quotationHotelRateMaster',$namevalue); 

 	}
	 
	?>
	<script>
	parent.$('#viewinfo').hide();
	<?php if($_REQUEST['hotelQuoteId']>0){ ?>
	parent.loadSearchSupplementRoom(<?php echo $_REQUEST['hotelQuoteId'];?>);
	<?php }else{ ?>
	parent.loadsearchhotelfunction('');
	<?php } ?>
	</script>
	<?php
	exit();
}

if(trim($_POST['action'])=='transportationSaveCost'  && trim($_POST['transferRateId'])!=''){
	$dmctransferrateId=decode($_REQUEST['transferRateId']); 
	$dateAdded=time();
	$namevalue ='vehicleCost="'.$_POST['vehicleCost'].'",parkingFee="'.$_POST['parkingFee'].'",representativeEntryFee="'.$_POST['representativeEntryFee'].'",assistance="'.$_POST['assistance'].'",guideAllowance="'.$_POST['guideAllowance'].'",interStateAndToll="'.$_POST['interStateAndToll'].'",miscellaneous="'.$_POST['miscellaneous'].'",capacity="'.$_POST['capacity'].'",gstTax="'.$_POST['gstTax'].'"';
 	$where='id="'.$dmctransferrateId.'"';
	$update = updatelisting('quotationTransferRateMaster',$namevalue,$where);
	?>
	<script>
	parent.$('#viewinfo').hide();
	parent.loadsearchtransferfunction();
	</script>
<?php
exit();
}

if(trim($_REQUEST['action'])=='savelunchHotel'  && trim($_REQUEST['quotationId'])!=''){
		$quotationId=($_REQUEST['quotationId']);
		$supplierId=($_REQUEST['supplierId']);
		$lunchquoteId=($_REQUEST['lunchquoteId']);
		$namevalue ='complimentaryLunch="'.$_REQUEST['lunch'].'"';
		$where=' supplierId="'.$supplierId.'" and quotationId = "'.$quotationId.'" and id="'.$lunchquoteId.'" ';
		$update = updatelisting('quotationHotelMaster',$namevalue,$where);
		if($_REQUEST['lunch'] == 1){
			$msg = "Lunch Included!";
		}else{
			$msg = "Lunch Excluded!";
		}
		?>
		<script>
		warningalert('<?php echo $msg; ?>');
		loadquotationmainfile();
		</script>
		<?php
}

if($_POST['action']=='tourdetails' && trim($_POST['editId'])!=''){  
	$editId=$_POST['editId']; 
	$tourManagerId=addslashes($_POST['tourManagerId']); 
	$namevalue ='tourManager="'.$tourManagerId.'"'; 
  	$where='id="'.$editId.'"'; 
    $update = updatelisting('queryMaster',$namevalue,$where);   
?> 
<script> 
parent.location.reload(); 
</script> 
<?php 
}

if(trim($_REQUEST['action'])=='savehoteldescription'  && trim($_REQUEST['quotationId'])!=''){
	$quotationId=($_REQUEST['quotationId']);
	$supplierId=($_REQUEST['supplierId']);
	$namevalue ='hotelDescription="'.$_REQUEST['hoteldetails'].'"';
	$where=' supplierId="'.$supplierId.'" and quotationId = "'.$quotationId.'" ';
	$update = updatelisting('quotationHotelMaster',$namevalue,$where);
	if($_REQUEST['hoteldetails'] == 1){
		$msg = "Hotel Description Included!";
	}else{
		$msg = "Hotel Description Excluded!";
	}
	?>
	<script>
	warningalert('<?php echo $msg; ?>');
	loadquotationmainfile();
	</script>
	<?php
}


// Started save and show payment info
if(trim($_REQUEST['action'])=='saveShowPaymentInfo'  && trim($_REQUEST['quotationId'])!=''){
	// die("hhdhd");
	$quotationId=($_REQUEST['quotationId']);
	// $schduleId=($_REQUEST['scheduleId']);
	$namevalue ='paymentshow="'.$_REQUEST['paymentshow'].'"';
	$where=' id="'.$quotationId.'" ';
	$update = updatelisting('quotationMaster',$namevalue,$where);
	if($_REQUEST['paymentshow'] == 1){
		$msg = "Show Payment Information!";
	}else{
		$msg = "Hide Payment Information!";
	}
	?>
	<script>
	warningalert('<?php echo $msg; ?>');
	loadquotationmainfile();
	</script>
	<?php
}
// Ended save and show payment info

if(trim($_REQUEST['action'])=='savedinnerHotel'  && trim($_REQUEST['quotationId'])!=''){
		$quotationId=($_REQUEST['quotationId']);
		$supplierId=($_REQUEST['supplierId']);
		$dinnerquoteId=($_REQUEST['dinnerquoteId']);
		$namevalue ='complimentaryDinner="'.$_REQUEST['dinner'].'"';
		$where=' supplierId="'.$supplierId.'" and quotationId = "'.$quotationId.'" and id="'.$dinnerquoteId.'" ';
		$update = updatelisting('quotationHotelMaster',$namevalue,$where);
		if($_REQUEST['dinner'] == 1){
			$msg = "Dinner Included!";
		}else{
			$msg = "Dinner Excluded!";
		}
		?>
		<script>
		warningalert('<?php echo $msg; ?>');
		loadquotationmainfile();
		</script>
		<?php
}

// Save breakfast hotel
if(trim($_REQUEST['action'])=='saveBreakfastHotel'  && trim($_REQUEST['quotationId'])!=''){

	$quotationId=($_REQUEST['quotationId']);
	$supplierId=($_REQUEST['supplierId']);
	$breakfastquotId=($_REQUEST['breakfastquotId']);
	$namevalue ='complimentaryBreakfast="'.$_REQUEST['breakfast'].'"';
	$where=' supplierId="'.$supplierId.'" and quotationId = "'.$quotationId.'" and id = "'.$breakfastquotId.'"';
	$update = updatelisting('quotationHotelMaster',$namevalue,$where);
	if($_REQUEST['breakfast'] == 1){
		$msg = "Breakfast Included!";
	}else{
		$msg = "Breakfast Excluded!";
	}
	?>
	<script>
	warningalert('<?php echo $msg; ?>');
	loadquotationmainfile();
	</script>
	<?php

}

// Save child Lunch hotel
if(trim($_REQUEST['action'])=='saveChildLunchHotel'  && trim($_REQUEST['quotationId'])!=''){
	$quotationId=($_REQUEST['quotationId']);
	$supplierId=($_REQUEST['supplierId']);
	$childLunchquotId=($_REQUEST['childLunchquotId']);
	$namevalue ='isChildLunch="'.$_REQUEST['childlunch'].'"';
	$where=' supplierId="'.$supplierId.'" and quotationId = "'.$quotationId.'" and id = "'.$childLunchquotId.'"';
	$update = updatelisting('quotationHotelMaster',$namevalue,$where);
	if($_REQUEST['childlunch'] == 1){
		$msg = "Child Lunch Included!";
	}else{
		$msg = "Child Lunch Excluded!";
	}
	
	?>
	<script>
	warningalert('<?php echo $msg; ?>');
	loadquotationmainfile();
	</script>
	<?php
}

// Save child Dinner hotel
if(trim($_REQUEST['action'])=='saveChildDinnerHotel'  && trim($_REQUEST['quotationId'])!=''){
	$quotationId=($_REQUEST['quotationId']);
	$supplierId=($_REQUEST['supplierId']);
	$childDinnerquotId=($_REQUEST['childDinnerquotId']);
	$namevalue ='isChildDinner="'.$_REQUEST['childdinner'].'"';
	$where=' supplierId="'.$supplierId.'" and quotationId = "'.$quotationId.'" and id = "'.$childDinnerquotId.'"';
	$update = updatelisting('quotationHotelMaster',$namevalue,$where);
	if($_REQUEST['childdinner'] == 1){
		$msg = "Child Dinner Included!";
	}else{
		$msg = "Child Dinner Excluded!";
	}

	?>
	<script>
	warningalert('<?php echo $msg; ?>');
	loadquotationmainfile();
	</script>
	<?php
}

	// Save child Breakfast hotel
if(trim($_REQUEST['action'])=='saveChildBreakfastHotel'  && trim($_REQUEST['quotationId'])!=''){
	$quotationId=($_REQUEST['quotationId']);
	$supplierId=($_REQUEST['supplierId']);
	$childBreakfastquotId=($_REQUEST['childBreakfastquotId']);
	$namevalue ='isChildBreakfast="'.$_REQUEST['childbreakfast'].'"';
	$where=' supplierId="'.$supplierId.'" and quotationId = "'.$quotationId.'" and id = "'.$childBreakfastquotId.'"';
	$update = updatelisting('quotationHotelMaster',$namevalue,$where);
	if($_REQUEST['childbreakfast'] == 1){
		$msg = "Child Breakfast Included!";
	}else{
		$msg = "Child Breakfast Excluded!";
	}

	?>
	<script>
	warningalert('<?php echo $msg; ?>');
	loadquotationmainfile();
	</script>
	<?php

}
	?>

<?php



if(trim($_POST['action'])=='saveHotelNewCost'  && trim($_POST['serviceid'])!='' ){
	$teenRoom=clean($_POST['teenRoom']);
	$quadRoom=clean($_POST['quadRoom']);
	$sixBedRoom=clean($_POST['sixBedRoom']);
	$eightBedRoom=clean($_POST['eightBedRoom']);
	$tenBedRoom=clean($_POST['tenBedRoom']);
	$breakfastChild=clean($_POST['breakfastChild']);
	$lunchChild=clean($_POST['lunchChild']);
	$dinnerChild=clean($_POST['dinnerChild']);
	$roomSupplierId=clean($_POST['roomSupplierId']);
	$fromDate=date("Y-m-d", strtotime($_POST['fromDate']));
	$toDate=date("Y-m-d", strtotime($_POST['toDate']));
	$roomType=addslashes($_POST['roomType']);
	$mealPlan=addslashes($_POST['mealPlan']);
	$roomprice=addslashes($_POST['roomprice']);
	$status=addslashes($_POST['status']);
	$currencyId=addslashes($_POST['currencyId']);
	$currencyValue=addslashes($_POST['currencyValue']);
	$singleoccupancy=addslashes($_POST['singleoccupancy']);
	$doubleoccupancy=addslashes($_POST['doubleoccupancy']);
	$tripleoccupancy=addslashes($_POST['tripleoccupancy']);
	$extraBed=addslashes($_POST['extraBed']);
	$childwithbed=addslashes($_POST['childwithbed']);
	$childwithoutbed=addslashes($_POST['childwithoutbed']);
	$breakfast=addslashes($_POST['breakfast']);
	$roomTAC=addslashes($_POST['roomTAC']);
	$TACType=addslashes($_POST['TACTypeQ']);
	$roomGST=addslashes($_POST['roomGST']);
	$mealGST=addslashes($_POST['mealGST']);
	$remarks=addslashes($_POST['remarks']); 
	$extraadult=addslashes($_POST['extraadult']);
	$lunch=addslashes($_POST['lunch']);
	$dinner=addslashes($_POST['dinner']);
	$serviceid=addslashes($_POST['serviceid']);
	$tariffId=addslashes($_POST['tariffId']);
	$tarifType=addslashes($_POST['tarifType']);
	$quotationId=addslashes($_POST['quotationId']);
	$seasonType=clean($_POST['seasonType']);
	$paxType=clean($_POST['paxType']);
	$markupType=clean($_POST['markupType']);
	$markupCost=clean($_POST['markupCost']);
	$dateAdded=time();
	$rs1="";
	$rs1=GetPageRecord('*',_QUOTATION_MASTER_,' id="'.$quotationId.'"');
	$quotationData = mysqli_fetch_array($rs1);
	$rs1=GetPageRecord('*',_QUERY_MASTER_,' id="'.$quotationData['queryId'].'"'); 
	$queryData = mysqli_fetch_array($rs1); 
	$quotationData['queryId'];
	$marketId = getQueryMaketType($quotationData['queryId']); 
	if($marketId<1){
		$marketId = 1;
	}

	if(trim($_POST['editId'])!='' && trim($_POST['editId'])>0 && $quotationId!=''){
		//provisino to edit for this quotation
		$namevalue ='fromDate="'.$fromDate.'",toDate="'.$toDate.'",roomType="'.$roomType.'",mealPlan="'.$mealPlan.'",childwithbed="'.$childwithbed.'",singleoccupancy="'.$singleoccupancy.'",doubleoccupancy="'.$doubleoccupancy.'",childwithoutbed="'.$childwithoutbed.'",extraadult="'.$extraadult.'",lunch="'.$lunch.'",dinner="'.$dinner.'",roomprice="'.$roomprice.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status="1",supplierId="'.$roomSupplierId.'",serviceid="'.$serviceid.'",tarifType="'.$tarifType.'",seasonType="'.$seasonType.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",breakfast="'.$breakfast.'",marketType="'.$marketId.'",extraBed="'.$extraBed.'",roomGST="'.$roomGST.'",mealGST="'.$mealGST.'",roomTAC="'.$roomTAC.'",TACType="'.$TACType.'",remarks="'.$remarks.'",paxType="'.$paxType.'",sixBedRoom="'.$sixBedRoom.'",eightBedRoom="'.$eightBedRoom.'",tenBedRoom="'.$tenBedRoom.'",childBreakfast="'.$breakfastChild.'",childLunch="'.$lunchChild.'",childDinner="'.$dinnerChild.'",quadRoom="'.$quadRoom.'",teenRoom="'.$teenRoom.'"';
		$where='id="'.trim($_POST['editId']).'" and quotationId="'.$quotationId.'"';
		updatelisting('quotationHotelRateMaster',$namevalue,$where);
	}elseif($tariffId !="" && $tariffId >0 && trim($_POST['editId']) == 0){
	 	//provisino to add from dmc for this quotation paxType
	 	$namevalue ='tariffId="'.$tariffId.'",quotationId="'.$quotationId.'",marketType="'.$marketId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",roomType="'.$roomType.'",mealPlan="'.$mealPlan.'",childwithbed="'.$childwithbed.'",singleoccupancy="'.$singleoccupancy.'",doubleoccupancy="'.$doubleoccupancy.'",childwithoutbed="'.$childwithoutbed.'",extraadult="'.$extraadult.'",lunch="'.$lunch.'",dinner="'.$dinner.'",roomprice="'.$roomprice.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status="1",supplierId="'.$roomSupplierId.'",serviceid="'.$serviceid.'",tarifType="'.$tarifType.'",seasonType="'.$seasonType.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",breakfast="'.$breakfast.'",extraBed="'.$extraBed.'",roomGST="'.$roomGST.'",mealGST="'.$mealGST.'",roomTAC="'.$roomTAC.'",TACType="'.$TACType.'",remarks="'.$remarks.'",paxType="'.$paxType.'",sixBedRoom="'.$sixBedRoom.'",eightBedRoom="'.$eightBedRoom.'",tenBedRoom="'.$tenBedRoom.'",childBreakfast="'.$breakfastChild.'",childLunch="'.$lunchChild.'",childDinner="'.$dinnerChild.'",quadRoom="'.$quadRoom.'",teenRoom="'.$teenRoom.'"';
		$lastid = addlistinggetlastid('quotationHotelRateMaster',$namevalue);
	}else{
	 	//provisino to add new for this quotation
		$namevalue ='tariffId="'.$tariffId.'",quotationId="'.$quotationId.'",marketType="'.$marketId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",roomType="'.$roomType.'",mealPlan="'.$mealPlan.'",childwithbed="'.$childwithbed.'",singleoccupancy="'.$singleoccupancy.'",doubleoccupancy="'.$doubleoccupancy.'",childwithoutbed="'.$childwithoutbed.'",extraadult="'.$extraadult.'",lunch="'.$lunch.'",dinner="'.$dinner.'",roomprice="'.$roomprice.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",status="1",supplierId="'.$roomSupplierId.'",serviceid="'.$serviceid.'",tarifType="'.$tarifType.'",seasonType="'.$seasonType.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",breakfast="'.$breakfast.'",extraBed="'.$extraBed.'",roomGST="'.$roomGST.'",mealGST="'.$mealGST.'",roomTAC="'.$roomTAC.'",TACType="'.$TACType.'",remarks="'.$remarks.'",paxType="'.$paxType.'",sixBedRoom="'.$sixBedRoom.'",eightBedRoom="'.$eightBedRoom.'",tenBedRoom="'.$tenBedRoom.'",childBreakfast="'.$breakfastChild.'",childLunch="'.$lunchChild.'",childDinner="'.$dinnerChild.'",quadRoom="'.$quadRoom.'",teenRoom="'.$teenRoom.'"';
		$lastid = addlistinggetlastid('quotationHotelRateMaster',$namevalue);
	}
	if($_REQUEST['isRoomSupp'] == 1 && $_REQUEST['hotelQuoteId']!=''){
	?>
	<script>
	parent.$('#viewinfo').hide();
	parent.loadSearchSupplementRoom('<?php echo $_REQUEST['hotelQuoteId']; ?>');
	</script>
	<?php
	}else{
	?>
	<script>
	parent.$('#viewinfo').hide();
	parent.loadsearchhotelfunction('');
	</script>
	<?php
	}
	exit();
}

if($_REQUEST['action']=='removecontactperson' && $_REQUEST['deleteId']!=''){
	$sql_del="delete from contactPersonMaster where id='".$_REQUEST['deleteId']."'";
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
}

// Choosee suppliment seriveces start
if($_REQUEST['action']=='chooseSupplimentServices' && $_REQUEST['queryId']!='' && $_REQUEST['quotationId']!=''){
	
	$rsAct=GetPageRecord('*','quotationAdditionalMaster',' quotationId="'.$_REQUEST['quotationId'].'" order by id desc');
	while($additionalData=mysqli_fetch_array($rsAct)){
		$arr = explode(',', $_POST['additionalId'.$additionalData['id']]);
		if($arr[0]>0 && $arr[3]=='Activity'){
			$dmcroommastermain='';
			$rs11=GetPageRecord('*','dmcotherActivityRate','id="'.$additionalData['additionalId'].'" and status=1 order by maxpax asc');
			if(mysqli_num_rows($rs11)>0){
				$dmcroommastermain=mysqli_fetch_array($rs11);
			}
			$lastid=0;
			$lastid = addlistinggetlastid(_QUOTATION_OTHER_ACTIVITY_MASTER_,'activityCost="'.$additionalData['adultCost'].'",maxpax="1",quotationId="'.$_REQUEST['quotationId'].'",fromDate="'.date('Y-m-d', strtotime($arr[1])).'",toDate="'.date('Y-m-d', strtotime($arr[1])).'",perPaxCost="'.$additionalData['adultCost'].'",otherActivityName="'.$dmcroommastermain['otherActivityNameId'].'",otherActivityCity="'.getDestination($arr[2]).'",queryId="'.$_REQUEST['queryId'].'",dateotherActivity="'.date('Y-m-d', strtotime($arr[1])).'",currencyId="'.strip($dmcroommastermain['currencyId']).'"');
	 		$namevalue1 ='serviceId="'.$lastid.'",serviceType="activity", dayId="'.$arr[0].'",startDate="'.date('Y-m-d', strtotime($arr[1])).'",endDate="'.date('Y-m-d', strtotime($arr[1])).'",queryId="'.$_REQUEST['queryId'].'",quotationId="'.$_REQUEST['quotationId'].'",startTime="'.date('Y-m-d H:i:s').'",endTime="'.date('Y-m-d H:i:s').'",srn="'.$arr[0].'"';
			addlisting('quotationItinerary',$namevalue1);
			mysqli_query(db(),"delete from quotationAdditionalMaster where id='".$additionalData['id']."'") or die(mysqli_error(db()));
		}
		if($arr[0]>0 && $arr[3]=='Guide'){
			$dmcroommastermain='';
			$rs11=GetPageRecord('*','dmcGuidePorterRate','id="'.$additionalData['additionalId'].'"');
			if(mysqli_num_rows($rs11)>0){
			$dmcroommastermain=mysqli_fetch_array($rs11);
			}
			$lastid=0;
			$lastid = addlistinggetlastid(_QUOTATION_GUIDE_MASTER_,'fromDate="'.date('Y-m-d', strtotime($arr[1])).'",toDate="'.date('Y-m-d', strtotime($arr[1])).'",serviceType="0",destinationId="'.$arr[2].'",guideId="'.$dmcroommastermain['serviceid'].'",paxRange="'.$dmcroommastermain['paxRange'].'",dayType="'.$dmcroommastermain['dayType'].'",price="'.$additionalData['adultCost'].'",queryId="'.$_REQUEST['queryId'].'",quotationId="'.$_REQUEST['quotationId'].'",totalDays=1,isGuestType=1,perDaycost="'.$additionalData['adultCost'].'"');
			
			addlisting('quotationItinerary','serviceId="'.$lastid.'",serviceType="guide", dayId="'.$arr[0].'",startDate="'.date('Y-m-d', strtotime($arr[1])).'",endDate="'.date('Y-m-d', strtotime($arr[1])).'",queryId="'.$_REQUEST['queryId'].'",quotationId="'.$_REQUEST['quotationId'].'",startTime="'.date('Y-m-d H:i:s').'",endTime="'.date('Y-m-d H:i:s').'",srn="'.$arr[0].'"');
			mysqli_query(db(),"delete from quotationAdditionalMaster where id='".$additionalData['id']."'") or die(mysqli_error(db()));
		}
		if($arr[0]>0 && $arr[3]=='Entrance'){
			$dmcroommastermain=$additionalData['entranceId'];
			$currencyId = $baseCurrencyId;
			$rs11=GetPageRecord('*',_DMC_ENTRANCE_RATE_MASTER_,'id="'.$additionalData['additionalId'].'"');
			if(mysqli_num_rows($rs11)>0){
				$dmcroommastermain=mysqli_fetch_array($rs11);
				$currencyId = $dmcroommastermain['currencyId'];
			}
			$lastid=0;
			$lastid = addlistinggetlastid(_QUOTATION_ENTRANCE_MASTER_,'fromDate="'.date('Y-m-d', strtotime($arr[1])).'",toDate="'.date('Y-m-d', strtotime($arr[1])).'",destinationId="'.$arr[2].'",entranceNameId="'.$additionalData['entranceId'].'",entranceType="0",vehicleId="'.$dmcroommastermain['vehicleId'].'",vehicleCost="'.$dmcroommastermain['vehicleCost'].'",currencyId="'.$currencyId.'",ticketAdultCost="'.$additionalData['adultCost'].'",ticketchildCost="'.$additionalData['childCost'].'",ticketinfantCost="'.$additionalData['infantCost'].'",queryId="'.$_REQUEST['queryId'].'",quotationId="'.$_REQUEST['quotationId'].'",supplierId="'.$dmcroommastermain['supplierId'].'",dmcId="'.$dmcroommastermain['id'].'"');
			addlisting('quotationItinerary','serviceId="'.$lastid.'",serviceType="entrance", dayId="'.$arr[0].'",startDate="'.date('Y-m-d', strtotime($arr[1])).'",endDate="'.date('Y-m-d', strtotime($arr[1])).'",queryId="'.$_REQUEST['queryId'].'",quotationId="'.$_REQUEST['quotationId'].'",startTime="'.date('Y-m-d H:i:s').'",endTime="'.date('Y-m-d H:i:s').'",srn="'.$arr[0].'"');
			mysqli_query(db(),"delete from quotationAdditionalMaster where id='".$additionalData['id']."'") or die(mysqli_error(db()));
		}
		$quoteQuery = 'saveQuotaiton="1"';
		$edit = updatelisting(_QUOTATION_MASTER_,$quoteQuery,'id="'.($_REQUEST['quotationId']).'"');
	}
	
	$update=updatelisting(_QUOTATION_MASTER_,'status=2,finalcategory=0,isPaymentRequest=0','id="'.$_REQUEST['old_quotationId'].'"'); 
	mysqli_query(db(),'delete from quotationAdditionalMaster where  quotationId="'.$_REQUEST['quotationId'].'"') or die(mysqli_error(db()));
	
	// updatelisting('quotationHotelMaster','isHotelSupplement=0,isRoomSupplement=0','quotationId="'.($_REQUEST['quotationId']).'"');
	// $edit = updatelisting(_QUOTATION_MASTER_,'deletestatusDuplicate="0"','id="'.($_REQUEST['quotationId']).'"');
	?>
	<script>
	parent.window.location.href='frmaction.php?action=selectedquotations&status=1&queryid=<?php echo $_REQUEST['queryId']; ?>&id=<?php echo $_REQUEST['quotationId']; ?>';
	</script>
	<?php
	exit();
} 

// choos suppliment serivices
if(trim($_POST['action'])=='addTransferPriceforQuotaion' && trim($_POST['TransferSupplierId3'])!='' && trim($_POST['fromDatetrn3'])!='' && trim($_POST['toDatetrn3'])!='' && trim($_POST['transferNameId3'])!='' && trim($_POST['transferType3'])!='' && trim($_POST['quotationId3'])!=''  && trim($_POST['currencyId3'])!=''  && trim($_POST['currencyValue3'])!='' ){

	$currencyId=clean($_REQUEST['currencyId3']);
	$currencyValue=clean($_REQUEST['currencyValue3']);

	$supplierId=clean($_REQUEST['TransferSupplierId3']);
	$fromDate=date("Y-m-d", strtotime($_POST['fromDatetrn3']));
	$toDate=date("Y-m-d", strtotime($_POST['toDatetrn3']));
	$transferNameId=addslashes($_POST['transferNameId3']);
	
	$tarifType=addslashes($_POST['tarifType3']);
	$transferType=addslashes($_POST['transferType3']);
	$marketType=addslashes($_POST['marketType3']);

  	$vehicleCost=addslashes($_POST['vehicleCost3']);

  	$adultCost=addslashes($_POST['adultCost3']);
  	$childCost=addslashes($_POST['childCost3']);
  	$infantCost=addslashes($_POST['infantCost3']);
  	$tariffId3=addslashes($_POST['tariffId3']);
  	$tableN3=addslashes($_POST['tableN3']);


	$detail=addslashes($_POST['detail3']);
	$quotationId=addslashes($_POST['quotationId3']);
	$queryId=addslashes($_POST['queryId3']);
	$serviceid=addslashes($_POST['transferNameId3']);
	$status=addslashes($_POST['status3']);
	$capacity=addslashes($_POST['capacity3']);
	$vehicleType=addslashes($_POST['vehicleType3']);
	$vehicleModelId=addslashes($_POST['vehicleModelId3']);
	$transferCostType=addslashes($_POST['transferCostType3']);
	$markupType=addslashes($_POST['markupType']);
	$markupCost=addslashes($_POST['markupCost']);
	$dateAdded=time();


	$namevalue ='supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferNameId="'.$transferNameId.'",tarifType="'.$tarifType.'",transferType="'.$transferType.'",marketType="'.$marketType.'",capacity="'.$capacity.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleTypeId="'.$vehicleType.'",vehicleModelId="'.$vehicleModelId.'",vehicleCost="'.$vehicleCost.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",detail="'.$detail.'",serviceid="'.$serviceid.'",quotationId="'.$quotationId.'",parkingFee="'.$_POST['parkingFee3'].'",representativeEntryFee="'.$_POST['representativeEntryFee3'].'",assistance="'.$_POST['assistance3'].'",guideAllowance="'.$_POST['guideAllowance3'].'",interStateAndToll="'.$_POST['interStateAndToll3'].'",miscellaneous="'.$_POST['miscellaneous3'].'",gstTax="'.$_POST['gstTax3'].'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",transferCostType="'.$_POST['transferCostType33'].'",serviceType="transfer"';
	if(trim($tariffId3) > 0 && $tableN3 == 2){
		$update = updatelisting('quotationTransferRateMaster',$namevalue,'id="'.$tariffId3.'"'); 
	}else{
    	$namevalue ='tariffId="'.$tariffId3.'",supplierId="'.$supplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferNameId="'.$transferNameId.'",tarifType="'.$tarifType.'",transferType="'.$transferType.'",marketType="'.$marketType.'",capacity="'.$capacity.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleTypeId="'.$vehicleType.'",vehicleModelId="'.$vehicleModelId.'",vehicleCost="'.$vehicleCost.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",detail="'.$detail.'",serviceid="'.$serviceid.'",quotationId="'.$quotationId.'",parkingFee="'.$_POST['parkingFee3'].'",representativeEntryFee="'.$_POST['representativeEntryFee3'].'",assistance="'.$_POST['assistance3'].'",guideAllowance="'.$_POST['guideAllowance3'].'",interStateAndToll="'.$_POST['interStateAndToll3'].'",miscellaneous="'.$_POST['miscellaneous3'].'",gstTax="'.$_POST['gstTax3'].'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",transferCostType="'.$_POST['transferCostType33'].'",serviceType="transfer"';
		$lastid = addlistinggetlastid('quotationTransferRateMaster',$namevalue);
	} 
 	?>
	<script>
	parent.loadsearchtransferfunction();
	</script>
	<?php
	exit();
}

if(trim($_POST['action'])=='addTransPortationPriceforQuotaion' && trim($_POST['TransferSupplierId'])!='' && trim($_POST['fromDatetrn'])!='' && trim($_POST['toDatetrn'])!='' && trim($_POST['transferNameId'])!='' && trim($_POST['quotationId'])!='' && trim($_POST['currencyId3'])!=''  && trim($_POST['currencyValue3'])!=''){

	$currencyId=clean($_REQUEST['currencyId3']);
	$currencyValue=clean($_REQUEST['currencyValue3']);

	$roomSupplierId=clean($_REQUEST['TransferSupplierId']);
	$fromDate=date("Y-m-d", strtotime($_POST['fromDatetrn']));
	$toDate=date("Y-m-d", strtotime($_POST['toDatetrn']));
	$transferNameId=addslashes($_POST['transferNameId']);
	$transferType=addslashes($_POST['transferType']);
  	$vehicleCost=addslashes($_POST['vehicleCost']);
  	$distance=addslashes($_POST['distance']);
  	$adultCost=addslashes($_POST['adultCost']);
  	$childCost=addslashes($_POST['childCost']);
  	$infantCost=addslashes($_POST['infantCost']);
	$detail=addslashes($_POST['detail']);
	$capacity=addslashes($_POST['capacity']);
	$serviceid=addslashes($_POST['serviceid']);
	$tariffId=addslashes($_POST['tariffId']);
	$tableN=addslashes($_POST['tableN']);
	$gstTaxttpt=addslashes($_POST['gstTaxttpt']);

	$status=addslashes($_POST['status']);
	$vehicleType=addslashes($_POST['vehicleType']);
	$quotationId=addslashes($_POST['quotationId']);
	$vehicleModelId=addslashes($_POST['vehicleModelId']);
	$transferCostType=addslashes($_POST['transferCostType']);
	$markupType=addslashes($_POST['markupType']);
	$markupCost=addslashes($_POST['markupCost']);

	$dateAdded=time();

	if(trim($tariffId) > 0 && $tableN == 2){
		$namevalue ='supplierId="'.$roomSupplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferNameId="'.$transferNameId.'",transferType="'.$transferType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleTypeId="'.$vehicleType.'",vehicleCost="'.$vehicleCost.'",distance="'.$distance.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",gstTax="'.$gstTaxttpt.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",currencyValue="'.$currencyValue.'",detail="'.$detail.'",quotationId="'.$quotationId.'",transferToId="'.$transferToId.'",transferFromId="'.$transferFromId.'",serviceid="'.$serviceid.'",vehicleModelId="'.$vehicleModelId.'",parkingFee="'.$_POST['parkingFee'].'",representativeEntryFee="'.$_POST['representativeEntryFee'].'",assistance="'.$_POST['assistance'].'",guideAllowance="'.$_POST['guideAllowance'].'",interStateAndToll="'.$_POST['interStateAndToll'].'",capacity="'.$capacity.'",miscellaneous="'.$_POST['miscellaneous'].'",transferCostType="'.$_POST['transferCostType'].'",serviceType="transportation"';
		$update = updatelisting('quotationTransferRateMaster',$namevalue,'id="'.$tariffId.'"'); 
	}else{
		
		$namevalue ='tariffId="'.$tariffId.'",supplierId="'.$roomSupplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",transferNameId="'.$transferNameId.'",transferType="'.$transferType.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",vehicleTypeId="'.$vehicleType.'",vehicleCost="'.$vehicleCost.'",distance="'.$distance.'",status="'.$status.'",addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",gstTax="'.$gstTaxttpt.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",currencyValue="'.$currencyValue.'",detail="'.$detail.'",quotationId="'.$quotationId.'",transferToId="'.$transferToId.'",transferFromId="'.$transferFromId.'",serviceid="'.$serviceid.'",vehicleModelId="'.$vehicleModelId.'",parkingFee="'.$_POST['parkingFee'].'",representativeEntryFee="'.$_POST['representativeEntryFee'].'",assistance="'.$_POST['assistance'].'",guideAllowance="'.$_POST['guideAllowance'].'",interStateAndToll="'.$_POST['interStateAndToll'].'",capacity="'.$capacity.'",miscellaneous="'.$_POST['miscellaneous'].'",transferCostType="'.$_POST['transferCostType'].'",serviceType="transportation"';

		$lastid = addlistinggetlastid('quotationTransferRateMaster',$namevalue);
	}  
 	?>
	<script>
	parent.loadsearchtransferfunction();
	</script>
	<?php
	exit();
}

// print_r($_REQUEST);
// echo exit;

if(trim($_REQUEST['action'])=='addFerryPriceforQuotaion' && trim($_REQUEST['fr_supplierId'])!='' && trim($_REQUEST['fr_fromDate'])!='' && trim($_REQUEST['fr_toDate'])!='' && trim($_REQUEST['fr_ferryNameId'])!='' && trim($_REQUEST['fr_currencyId'])!='' && trim($_REQUEST['fr_currencyValue'])!=''  && trim($_REQUEST['fr_quotationId'])!=''){

	$supplierId = $_REQUEST['fr_supplierId'];
	$ferryNameId = $_REQUEST['fr_ferryNameId'];
	$ferryClass = $_REQUEST['fr_ferryClass'];
	$processingfee = $_REQUEST['fr_processingfee'];
	$miscCost = $_REQUEST['fr_miscCost'];
	$gstTax = $_REQUEST['fr_gstTax'];
	$currencyId = $_REQUEST['fr_currencyId'];
	$currencyValue = $_REQUEST['fr_currencyValue'];
	$adultCost = $_REQUEST['fr_adultCost'];
	$adultPax = $_REQUEST['fr_adultPax'];
	$childCost = $_REQUEST['fr_childCost'];
	$childPax = $_REQUEST['fr_childPax'];
	$infantCost = $_REQUEST['fr_infantCost'];
	$infantPax = $_REQUEST['fr_infantPax'];
	$remark = $_REQUEST['fr_remark'];
	$markupType = $_REQUEST['markupType'];
	$markupCost = $_REQUEST['markupCost'];

	$fromDate=date("Y-m-d", strtotime($_REQUEST['fr_fromDate']));
	$toDate=date("Y-m-d", strtotime($_REQUEST['fr_toDate']));
	$ferrypickupTime=addslashes($_REQUEST['fr_ferrypickupTime']);
	$ferrydropTime=addslashes($_REQUEST['fr_ferrydropTime']);


	$ferryServiceId=$_REQUEST['fr_ferryServiceId'];
	$quotationId=$_REQUEST['fr_quotationId'];
	$rateId = $_REQUEST['fr_rateId'];
	$dateAdded=time();

	$namevalue ='rateId="'.$rateId.'",supplierId="'.$supplierId.'",serviceid="'.$ferryServiceId.'",ferryNameId="'.$ferryNameId.'",ferryClass="'.$ferryClass.'",processingfee="'.$processingfee.'",miscCost="'.$miscCost.'",gstTax="'.$gstTax.'",markupType="'.$markupType.'",markupCost="'.$markupCost.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",adultCost="'.$adultCost.'",adultPax="'.$adultPax.'",childCost="'.$childCost.'",childPax="'.$childPax.'",infantCost="'.$infantCost.'",infantPax="'.$infantPax.'",remark="'.$remark.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",pickupTime="'.$ferrypickupTime.'",dropTime="'.$ferrydropTime.'",quotationId="'.$quotationId.'",dateAdded="'.$dateAdded.'"';  
	
	// $namevalue ='pickupTime="'.$ferrypickupTime.'",dropTime="'.$ferrydropTime.'",supplierId="'.$FerrySupplierId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",serviceid="'.$ferryServiceId.'",ferryNameId="'.$ferryNameId.'",ferryClass="'.$ferryClass2.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",status=1,addBy="'.$_SESSION['userid'].'",dateAdded="'.$dateAdded.'",currencyId="'.$currencyId.'",currencyValue="'.$currencyValue.'",remark="'.$remark.'",quotationId="'.$quotationId.'",processingfee="'.$_REQUEST['processingfee2'].'",miscCost="'.$_REQUEST['miscCost2'].'",gstTax="'.$_REQUEST['gstTax2'].'"';
	if(trim($_REQUEST['fr_rateId']) > 0  && $_REQUEST['fr_tableN'] == 2){
		$update = updatelisting(_QUOTATION_FERRY_RATE_MASTER_,$namevalue,'id="'.$_REQUEST['fr_rateId'].'"'); 
	}else{
		$lastid = addlistinggetlastid(_QUOTATION_FERRY_RATE_MASTER_,$namevalue);
	} 
 	?>
	<script>
	parent.loadsearchferryfunction();
	</script>
	<?php
	exit();


}


if(trim($_REQUEST['action'])=='saveitineraryoverview'  && $_REQUEST['quotationId']!='' && $_REQUEST['editId']==''){
	$namevalue ='highlight="'.addslashes($_REQUEST['highlight']).'",overview="'.addslashes($_REQUEST['overview']).'",quotationId="'.addslashes($_REQUEST['quotationId']).'",destinationId="'.addslashes($_REQUEST['destinationId']).'"';
	addlisting('quotationOverview',$namevalue);
	$quotationId=$_REQUEST['quotationId'];
	$update = updatelisting(_QUOTATION_MASTER_,' isAddOverview="'.$_REQUEST['isAddOverview'].'"','id="'.$quotationId.'"'); 
	 ?>
	 <script>
	 //reloaditinery();
	 </script>
 <?php
} 
if(trim($_REQUEST['action'])=='saveitineraryoverview'  && $_REQUEST['quotationId']!='' && $_REQUEST['editId']!=''){
	$namevalue ='highlight="'.addslashes($_REQUEST['highlight']).'",overview="'.addslashes($_REQUEST['overview']).'",quotationId="'.addslashes($_REQUEST['quotationId']).'",destinationId="'.addslashes($_REQUEST['destinationId']).'"';
	 $where='id="'.$_REQUEST['editId'].'"';
	updatelisting('quotationOverview',$namevalue,$where);
	$quotationId=$_REQUEST['quotationId'];
	$update = updatelisting(_QUOTATION_MASTER_,' isAddOverview="'.$_REQUEST['isAddOverview'].'"','id="'.$quotationId.'"'); 
	 ?>
	 <script>
	 //reloaditinery();
	 </script>
 <?php
} 
if($_POST['action']=='sendSupplierVoucher' ){

	$supplierStatusId = $_REQUEST['supplierStatusId'];
	$serviceId = $_REQUEST['serviceId'];
	$serviceType = $_REQUEST['serviceType'];
	$module = $_REQUEST['module'];
	$quotationId = $_REQUEST['quotationId'];

	include "config/mail.php";
	$mailto=$_POST['emailsender'];
	$ccmail=$_POST['ccmail'];
	$mailsubject=($_POST['emailsubject']);
	$maildescription='';
	 
	$invoiceattach='<a style="text-decoration: none;" href="'.$fullurl.'tcpdf/examples/getpdf.php?packagename=ABCA&download=1&savetoserver=1&pageurl='.$fullurl.'loadcreatevoucher_supplier_html.php?string='.trim($supplierStatusId).'_'.trim($serviceId).'_'.trim($serviceType).'_'.trim($module).'_'.trim($quotationId).'_1"><div style="font-size: 16px; padding: 14px 60px; background-color: #45b558; color: #fff;display: inline-block;margin-bottom: 20px; text-decoration: none; border-radius: 4px;">Download Voucher</div></a>';
	 
	$maildescription = ($_POST['emaildescription']).'&nbsp;<br><br>'.$invoiceattach;
	$fromemail='';
	send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
	?>
	<script>
	parent.$('#sendmailfrm').hide();
	parent.$('#sendmailaction').show();
	parent.$('#loaderbox').hide();
	parent.$('#pageloading').hide();
	</script>
	<?php
}



if(trim($_POST['action'])=='addcompanymastersettings' && $_POST['editid']!=''){
	if(!empty($_FILES['proposalLogo']['name'])){
		$proposalLogo=time().str_replace(' ', '', $_FILES['proposalLogo']['name']);
		copy($_FILES['proposalLogo']['tmp_name'],"dirfiles/".$proposalLogo);
	} else {
		$proposalLogo=$_POST['oldproposalLogo'];
	}


	if(!empty($_FILES['changeLoginImage']['name'])){
		$changeLoginImage=time().str_replace(' ', '', $_FILES['changeLoginImage']['name']);
		copy($_FILES['changeLoginImage']['tmp_name'],"dirfiles/".$changeLoginImage);
	} else {
		$changeLoginImage=$_POST['oldchangeLoginImage'];
	}


	if(!empty($_FILES['logoupload']['name'])){
		$logoupload=time().str_replace(' ', '', $_FILES['logoupload']['name']);
		copy($_FILES['logoupload']['tmp_name'],"dirfiles/".$logoupload);
	} else {
		$logoupload=$_POST['oldlogoupload'];
	}
	$referanceId = '';
	if(trim($_POST['referanceIdType'])==0){
	$referanceId = '';
	}else{
	$referanceId = addslashes(trim($_POST['referanceId']));
	}
	$clientVoucherNoSequence = '';
	if(trim($_POST['clientVoucherType'])==0){
	$clientVoucherNoSequence = '';
	}else{
	$clientVoucherNoSequence = addslashes(trim($_POST['clientVoucherNoSequence']));
	}
	$supplierVoucherNoSequence = '';
	if(trim($_POST['supplierVoucherType'])==0){
	$supplierVoucherNoSequence = '';
	}else{
	$supplierVoucherNoSequence = addslashes(trim($_POST['supplierVoucherNoSequence']));
	}
	
	// $tourIdSequence = $_POST['tourIdSequence'];
	$tourIdSequence = ($_POST['tourIdSequence'] != 2) ? 1 : 2;
	$hotelImportFormatType = ($_POST['hotelImportFormatType'] != 2) ? 1 : 2;

	$TMS = ($_POST['TMS'] != 2) ? 1 : 2;
	
	$namevalue ='companyName="'.addslashes(trim($_POST['companyName'])).'",CINnumber="'.addslashes(trim($_POST['CINnumber'])).'",TRNnumber="'.addslashes(trim($_POST['TRNnumber'])).'",panInformation="'.addslashes(trim($_POST['panInformation'])).'",countryId="'.trim($_POST['countryId']).'",baseCurrencyId="'.trim($_POST['baseCurrencyId']).'",compcountryCode="'.trim($_POST['compcountryCode']).'",nationality="'.trim($_POST['nationality']).'",queryIdSequence="'.addslashes(trim($_POST['queryIdSequence'])).'",tourId="'.addslashes(trim($_POST['tourId'])).'",referanceIdType="'.addslashes(trim($_POST['referanceIdType'])).'",referanceId="'.$referanceId.'",clientVoucherType="'.addslashes(trim($_POST['clientVoucherType'])).'",clientVoucherNoSequence="'.$clientVoucherNoSequence.'",supplierVoucherType="'.addslashes(trim($_POST['supplierVoucherType'])).'",supplierVoucherNoSequence="'.$supplierVoucherNoSequence.'",proposalLogo="'.$proposalLogo.'",changeLoginImage="'.$changeLoginImage.'",proformaInvoiceNoSequence="'.addslashes(trim($_POST['proformaInvoiceNoSequence'])).'",taxInvoiceNoSequence="'.addslashes(trim($_POST['taxInvoiceNoSequence'])).'",logoupload="'.$logoupload.'",proformaInvoiceType="'.addslashes(trim($_POST['proformaInvoiceType'])).'",taxInvoiceType="'.addslashes(trim($_POST['taxInvoiceType'])).'",footertext="'.addslashes(trim($_POST['footertext'])).'",internationalQuery="'.addslashes(trim($_POST['international'])).'",domesticQuery="'.addslashes(trim($_POST['domestic'])).'",defaultQueryType="'.addslashes(trim($_POST['queryTypeSetDefault'])).'",tourIdSequence="'.$tourIdSequence.'",hotelImportFormatType="'.$hotelImportFormatType.'",TMS="'.$TMS.'",sameOtherSTax="'.addslashes(trim($_POST['sameOtherSTax'])).'",taxOnly="'.addslashes(trim($_POST['taxOnly'])).'"';
	$where='id="'.decode($_POST['editid']).'"';
	$update = updatelisting('companySettingsMaster',$namevalue,$where);
	//update default currency///
	if($_REQUEST['baseCurrencyId'] > 0){ 
		$where='1'; 
		$namevalue ='setDefault="0"';
		$update = updatelisting(_QUERY_CURRENCY_MASTER_,$namevalue,$where); 
		$where=' id = "'.$_REQUEST['baseCurrencyId'].'"'; 
		$namevalue ='setDefault=1';
		$update = updatelisting(_QUERY_CURRENCY_MASTER_,$namevalue,$where); 
	}
	?>
	<script>
	parent.window.location.href='setupsetting.crm?module=companymastersettings&add=yes&configuration=1&alt=2';
	</script>
	<?php
} 
if($_POST['action']=='mailsendtoclientguide'){
	include "config/mail.php";
	$fromemail='';
	$mailto = addslashes($_POST['emailid']);
	$repotBodymail = ($_POST['repotBodymail']);
	$fromDate=date('Y-m-d',strtotime($_POST['fromDate']));
	$toDate=date('Y-m-d',strtotime($_POST['toDate']));
	$assignto = addslashes($_POST['assignto']);
	$select='emailsignature';
	$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	$LoginUserDetails=mysqli_fetch_array($rs);
	$ccmail = '';
	$attfilename = '';
	$tablemedille ='';
	$subject='Guide \Porter '.date('d F Y H:i:a');
	$maildescription=$repotBodymail.'<br /><br />'.stripslashes($LoginUserDetails['emailsignature']);
	  $thead='<thead>
		<tr style="font-family:normal;text-transform:uppercase;text-align:center;">
	     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Name</th>
	     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Image</th>
	     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Service\Type </th>
	     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Email\Phone</th>
	     <!-- <th align="center" class="header">TAT&nbsp;followed</th>-->
	     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;"> Address</th>
	     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Language </th>
	     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Destination</th>
	     <th  width="100" align="center" bgcolor="#57a0a4" class="header" style="background-color:#57a0a4 !important; color:#FFFFFF;">Details </th>
			</tr>
		<thead> ';
	$strWhere='';
	if($fromDate!='' && $toDate!=''){
		$fromDate = date('Y-m-d', strtotime( $fromDate ));
		$toDate = date('Y-m-d', strtotime( $toDate ));
		 $strWhere.=' and  queryDate BETWEEN "'.$fromDate.'" and "'.$toDate.'" and deletestatus=0';
	}
	$strWhere25='';
	if($assignto!=''){
		$strWhere25 = ' and id="'.$assignto.'"';
	}else{
		$strWhere25='';
	}
	$select='*';
	$where='status=0    order by name asc';
	$rs=GetPageRecord($select,_GUIDE_MASTER_,$where);
	while($resListing=mysqli_fetch_array($rs)){
	           $select1='*';
			$where1=' 1 and checkstatus=1 order by name asc"';
			$rs1=GetPageRecord($select1,_GUIDE_MASTER_,$where1);
			$editresult=mysqli_fetch_array($rs1);
	// print_r($resListing);
		 $tablemedille.='<tr style="text-align:center;">
	   <td align="left" valign="middle">'.$editresult['name'].'</td>
	    <td align="center" valign="middle">'.$editresult['email'].'</td>
	    <td align="center" valign="middle">'.$tquery567.'</td>
	    <td align="center">'.$tquery8.'</td>
	    <td align="right">'.$suppliertotalcost_sum.'</td>
	    <td align="right" >'. $gross.'</td>
	    <td align="right" >'.$totalpax.'</td>
	    <td align="right" >'.$nonights.'</td>
	    </tr>';
	    $totalsum='<tr style="font-size: 13px; background-color:#f1f1f1; font-weight:bold;">

	    <td align="left" valign="middle"><strong>Total</strong></td>
	    <td align="center" valign="middle">'.$tqueryTotal.'</td>
	    <td align="center" valign="middle">'.$totalcreated.'</td>
	    <td align="center">'.$confirmedqueryTotl.'</td>
	    <td align="center">'.$revertedqueryTotal.'</td>
	    <td align="center">'.$canceltotal.'</td>
	    <td align="center">'.$assignedqueryTotal.'</td>
	    <td align="center">'.$sentqueryTotal.'</td> <style>/* and id in (select queryId from "._VOUCHER_MASTER_." where emailsent=1)*/</style>
	    <!--   <td align="center"></td>-->
	    </tr>';
		}
		$mailbody='<table border="1" cellpadding="4" cellspacing="0" bordercolor="#E6E6E6" class="table tablesorter gridtable sortable" id="example">'.$thead.''.$tablemedille.''.$totalsum.'</table>';
	$exeMailresult=send_template_mail($fromemail,$mailto,$subject,$mailbody);
	if($exeMailresult!=true){
		
		?>
		<script>
		alert('Mail not sent, Please check your configration');
		</script>
		<?php
	}else{
	

		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alertspopupopenClose();</script>
		<?php
	}
	exit();
}
// supplier mail sending from reservation request

if($_POST['action']=='sendsuppconfirmation' && trim($_POST['queryId'])!=''){
	if(trim($_POST['multiemails'])==''){
		
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		alert('Please enter your supplier email');
		</script>
		<?php
	}
	
	$queryId=decode($_POST['queryId']);
	$suppId=$_POST['suppId'];
	$descriptionsup=stripslashes($_POST['descriptionsup']);

	$rs1=GetPageRecord('*',_QUERYMAILS_MASTER_,'queryid='.$queryId.' order by id asc LIMIT 1');
	$editresult=mysqli_fetch_array($rs1);

	$namevalue ='queryId="'.$queryId.'",supplierId="'.$_POST['suppId'].'",supplierType="100",dateAdded="'.time().'"';
	addlistinggetlastid(_SUPPLIER_COMMUNICATION_,$namevalue);

	$namevalue='status="2"';
	updatelisting('finalQuotSupplierStatus',$namevalue,'supplierId="'.$_POST['suppId'].'" and quotationId="'.$_POST['quotationId'].'"');

	$ccmail='';
	$ccmail=$_POST['ccSupplier']; 
	$ccmail=implode(', ', $ccmail); 
	// ===============================
	$rsp1=GetPageRecord('*',_QUOTATION_MASTER_,'id="'.$_REQUEST['quotationId'].'"');
	$quotationData=mysqli_fetch_array($rsp1);
	$noOfPax = $quotationData['adult']+$quotationData['child'];
	$rsp=GetPageRecord('*',_QUERY_MASTER_,'id="'.$quotationData['queryId'].'"');
	$resultlists12=mysqli_fetch_array($rsp);
	$clientName = showClientTypeUserName($resultlists['clientType'],$resultlists['companyId']);

	// =============================================================
	$subject='Reservation Request '.$clientName." ".date('d-m-Y H:i');
	// $subject="Reservation Request ".makeQueryTourId($resultpage['id'])." | ".$clientName;
	$subject='#'.makeQueryId($resultlists12['id']).' '.$subject;
	
	$mailsubject='[SUP'.$suppId.'] ' .str_replace('#','@',$subject); 
	include "config/mail.php";
	$fromemail='';
	$mailto=getPrimaryEmail($suppId,'suppliers'); 
	//ADD EMAIL SIGNATURE
	$select='emailsignature';
	$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	$LoginUserDetails=mysqli_fetch_array($rs);
	// 	$emailsignature=stripslashes($LoginUserDetails['emailsignature']);
	//  $descriptionsup=$descriptionsup.$emailsignature;
	// 	$descriptionsup=$descriptionsup;
	$mailbody=str_replace('download/',$fullurl.'download/',$descriptionsup);
	$mailbody=str_replace('images/',$fullurl.'images/',$mailbody);
	$namevalue ='queryId="'.$queryId.'",supplierId="'.$suppId.'",directReply="1",subject="'.$mailsubject.'",detail="'.addslashes($mailbody).'",dateAdded="'.date('Y-m-d H:i:s').'",ccmail="'.$ccmail.'"';
	
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$mailbody,$ccmail);
	if($exeMailresult!=true){ 
		// email not sent then delete 
		?>
		<script> 
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alert('Mail not sent, Please check your configration');
		</script>
		<?php 
	}else{
		$adds = addlisting(_SUPPLIER_COMMUNICATION_MAIL_,$namevalue);
		?>
		<script>
		alert("Mail has been sent");
		parent.window.location.href='showpage.crm?module=query&view=yes&id=<?php echo ($_POST['queryId']); ?>&supplier=1';
		</script>
		<?php
	
	}
}

if(trim($_REQUEST['action'])=='addsupplierquote' && trim($_REQUEST['queryId2'])!='' && trim($_REQUEST['companyTypeId'])!=''){
	$QueryId=clean($_REQUEST['queryId2']);
	$companyTypeId = clean($_REQUEST['companyTypeId']);
	$supplierId = clean($_REQUEST['supplierId']);
	$ccmail=$_POST['ccSupplier'];
	include "config/mail.php";
	$optionquery='';
	$suppEmail='';
	if(isset($_POST['supplierId'])){
		foreach($_POST['supplierId'] as $k1=>$v1){

			$supplierId = $v1;
			$optionquery='';
			$suppEmail='';
			$detailsmail='';
			$mailto='';
			$mailsubject='';
			$maildescription='';
			$detailsmail = addslashes($_REQUEST['details']);
			$dateAdded=time();
			//add new explore india
			$namevalue ='queryId="'.$QueryId.'",supplierId="'.$supplierId.'",supplierType="'.$companyTypeId.'",dateAdded="'.$dateAdded.'"';
			$lastid = addlistinggetlastid(_SUPPLIER_COMMUNICATION_,$namevalue);

			$supplierEmail = getMultiPrimaryEmail($supplierId,'suppliers');
			// $select1='*';
			// $where1='queryid='.$QueryId.' order by id asc LIMIT 1';
			// $rs1=GetPageRecord($select1,_QUERYMAILS_MASTER_,$where1);
			// $editresult=mysqli_fetch_array($rs1);
			// $subject=clean($editresult['subject']);
			$fromemail='';
			$mailto=$supplierEmail;

			// if quotation is confirmed then data comes from otherwise data comes from query
			$rs=GetPageRecord('*',_QUOTATION_MASTER_,' 1 and queryId="'.$QueryId.'" and status=1');
			$querydetails=mysqli_fetch_array($rs);
			$subject='#'.makeQueryId($QueryId).' '.trim($querydetails['quotationSubject']);

			if($querydetails['id']<1){
				$rs=GetPageRecord('*',_QUERY_MASTER_,'  id='.$QueryId.'  ');
				$querydetails=mysqli_fetch_array($rs);
				$subject='#'.makeQueryId($QueryId).' '.trim($querydetails['subject']);
			}
			$cities = '';
			$cityQuery=GetPageRecord('*',_PACKAGE_QUERY_DAYS_,'  queryId='.$QueryId.' group by cityId order by srdate asc ');
			while($cityDa=mysqli_fetch_array($cityQuery)){
				$cities .= getDestination($cityDa['cityId']).',';
			}
			
			$mailsubject='[SUP'.$supplierId.'] ' .str_replace('#','@',$subject);
			$querythanksmsg='Dear Sir/Ma\'am<br><br>Greeting from <strong>'.$clientnameglobal.'</strong><br><br>Thanks for contacting us. Your query has successfully Updated. Our team will get back to you shortly.<br><br>While replying to this query, please dont change the subject line.<br><br>';
	
			if($companyTypeId==1){
				$supplierServie='Hotel';
			}
			if($companyTypeId==2){
				$supplierServie='Guide';
			}
			if($companyTypeId==3){
				$supplierServie='Activity';
			}
			if($companyTypeId==4){
				$supplierServie='Entrance';
			}
			if($companyTypeId==5){
				$supplierServie='Transfer';
			}
			if($companyTypeId==6){
				$supplierServie='Restaurant';
			}
			if($companyTypeId==7){
				$supplierServie='Airlines';
			}
			if($companyTypeId==8){
				$supplierServie='Train';
			}
			if($companyTypeId==13){
				$supplierServie='Others';
			}  
			$optionquery.="<table width='100%' border='1' cellpadding='6' cellspacing='0' bordercolor='#78909c'>
			  <tr>
				<td bgcolor='#78909c' style='color:#FFFFFF;'>Service</td>
				<td bgcolor='#78909c' style='color:#FFFFFF;'>Destinations</td>
				<td bgcolor='#78909c' style='color:#FFFFFF;'>Adult</td>
				<td bgcolor='#78909c' style='color:#FFFFFF;'>Child</td>
				<td bgcolor='#78909c' style='color:#FFFFFF;'>Infant</td>
			  </tr>
			  <tr>
				<td>".$supplierServie."</td>
				<td>".rtrim($cities,',')."</td>
				<td>".$querydetails['adult']."</td>
				<td>".$querydetails['child']."</td>
				<td>".$querydetails['infant']."</td>
			  </tr>
			</table><br><br>";
			// $optionquery.='<a href="'.$fullurl.'quotation-form.php?q='.encode($QueryId).'&t='.encode($companyTypeId).'&u='.encode($supplierId).'" style="background-color:#11b76c;cursor: pointer;border-radius:4px;color:#fff !important;     padding: 10px 20px;  font-size:16px; text-decoration:none; display:inline-block;">Submit Quotation</a><br><br>';
			// .'<br><br>'.$optionquery.'<br>'
			$detailsmail=nl2br($detailsmail).'<br><br>While replying to this query, please dont change the subject line.<br><br>';
			$select='emailsignature';
			$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
			$rs=GetPageRecord($select,_USER_MASTER_,$where);
			$LoginUserDetails=mysqli_fetch_array($rs);
			$maildescription=$detailsmail;
			$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
			if($exeMailresult!=true){ 
				// email not sent then delete 
				?>
				<script> 
				parent.$('#pageloading').hide();
				parent.$('#pageloader').hide();
				parent.alert('Mail not sent, Please check your configration');
				</script>
				<?php 
			}else{
				$dateAdded=date('Y-m-d H:i:s');
				$namevalue ='queryId="'.$QueryId.'",supplierId="'.$supplierId.'",subject="'.$mailsubject.'",detail="'.addslashes($detailsmail).'",dateAdded="'.$dateAdded.'",directReply=1,ccmail="'.$ccmail.'"';
				addlistinggetlastid(_SUPPLIER_COMMUNICATION_MAIL_,$namevalue);
				?>
				<script>
				parent.loadquerysupplier();
				parent.$('#pageloading').hide();
				parent.$('#pageloader').hide();
				parent.$('#alertnotificationsmainbox').hide();
				</script>
				<?php 
			}
		}
	}
}

// 
if(trim($_REQUEST['action'])=='sendSupplierQuotationRequest' && trim($_REQUEST['quotationId2'])!=''){

	// && trim($_REQUEST['companyTypeId'])!=''
	// $QueryId=clean($_REQUEST['quotationId2']);

	$quotationId2=clean($_REQUEST['quotationId2']);
	$quotQuery='';
	$quotQuery=GetPageRecord('*',_QUOTATION_MASTER_,'id="'.$quotationId2.'"');
	$quotationData=mysqli_fetch_array($quotQuery);
	$queryId2=clean($quotationData['queryId']);

	$companyTypeId = '100'; 
	// all type supplier/ dmc
	$supplierId = clean($_REQUEST['supplierId2']);
	$ccmail=$_POST['ccSupplier'];
	include "config/mail.php";
	
	$downloadLink=$emailsignature='';
	$supplier_description = addslashes($_REQUEST['supplier_description']);
	$supplier_description_pdf = addslashes($_REQUEST['supplier_description_pdf']);

	if(isset($_POST['supplierId2'])){
		foreach($_POST['supplierId2'] as $k1=>$v1){

			$supplierId = $v1;
			$mailto='';
			$mailsubject='';
			$maildescription='';

			$dateAdded=time();
			//add new explore india
			$namevalue ='queryId="'.$queryId2.'",supplierId="'.$supplierId.'",supplierType="'.$companyTypeId.'",dateAdded="'.$dateAdded.'"';
			$lastId = addlistinggetlastid(_SUPPLIER_COMMUNICATION_,$namevalue);

			// $select='emailsignature';
			// $where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
			// $rs=GetPageRecord($select,_USER_MASTER_,$where);
			// $LoginUserDetails=mysqli_fetch_array($rs);
			
			// // $emailsignature = '<br><br>'.stripslashes($LoginUserDetails['emailsignature']);
			// if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
			//     $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
			// }

			// if($quotationId2>0){ 
				// http://localhost/GitHub/outbound1.3/travcrm-dev/PreviewFiles/crm_proposal.php?propNum=4&id=VFZSck1VNUJQVDA9
				// $downloadLink='<a style="text-decoration: none;" href="'.$fullurl.'PreviewFiles/crm_proposal.php?propNum=4&id='.encode($quotationId2).'">View Proposal Details</a>';
			// }

			$maildescription = '<span style="background-color:yellow;">While replying to this query, please dont change the subject line.</span><br>'.nl2br($supplier_description).'<br>'.$supplier_description_pdf.'<br><br>'.$downloadLink.'<br><br>'.$emailsignature;

			$mailto = getPrimaryEmail($supplierId,'suppliers');
			$fromemail='';
			$subject='#'.makeQueryId($queryId2).' '.trim($quotationData['quotationSubject']);
			$mailsubject='[SUP'.$supplierId.'] ' .str_replace('#','@',$subject);
			// $maildescription=$supplier_description;
			$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
			if($exeMailresult!=true){ 
				// email not sent then delete 
				deleteRecord(_SUPPLIER_COMMUNICATION_,'id='.$lastId); ?>
				<script> 
				parent.alert('Mail not sent, Please check your configration');
				</script>
				<?php 
			}else{
				$dateAdded=date('Y-m-d H:i:s');
				$namevalue ='queryId="'.$queryId2.'",supplierId="'.$supplierId.'",subject="'.$mailsubject.'",detail="'.addslashes($maildescription).'",dateAdded="'.$dateAdded.'",directReply=1,ccmail="'.$ccmail.'"';
				addlistinggetlastid(_SUPPLIER_COMMUNICATION_MAIL_,$namevalue);
				?>
				<script>
	 			parent.window.location.reload();
				// parent.loadquerysupplier();
				// parent.$('#alertnotificationsmainbox').hide();
				</script>
				<?php 
			}
		}
	}else{
		?>
		<script>
		parent.alert('Please Select Supplier');
		</script>
		<?php 
	}

}

if($_POST['action']=='quotationAllocateGuide' && trim($_POST['guideQuoteId'])!=''){
  $guideQuoteId=addslashes($_POST['guideQuoteId']);
  $fromDate=addslashes($_POST['fromDate']);
  $toDate=addslashes($_POST['toDate']);
  $queryId=addslashes($_POST['queryId']);
  $quotationId=addslashes($_POST['quotationId']);
  $guideId=addslashes($_POST['guideId']);
  $selga='*';
  $wherega='guideQuoteId="'.$guideQuoteId.'"';
  $rsga=GetPageRecord($selga,'guideAllocation',$wherega);
  $countguide=mysqli_num_rows($rsga);
  $namevalue ='queryId="'.$queryId.'",guideQuoteId="'.$guideQuoteId.'",quotationId="'.$quotationId.'",name="",mobileNo="",whatsAppNo="",emailAddress="",GuideId="'.$guideId.'",fromDate="'.$fromDate.'",toDate="'.$toDate.'",allocationStatus=1';
  if($countguide>0){
  	$where='guideQuoteId="'.$guideQuoteId.'"';
    $update = updatelisting('guideAllocation',$namevalue,$where); 
  }else{
  	$lastId = addlistinggetlastid('guideAllocation',$namevalue);
  }
  $selguide='*';
  $whereg='id="'.$guideId.'"';
  $rsg=GetPageRecord($selguide,_GUIDE_MASTER_,$whereg);
  $guideDetails=mysqli_fetch_array($rsg);
	?>
	<script>
	 parent.$('#guideInfo<?php echo $guideQuoteId; ?>').html('<div><?php echo $guideDetails['name']; ?><br /><?php echo $guideDetails['phone']; ?></div>');	
	//  parent.alertspopupopenClose();
	 parent.window.location.reload();
	</script>
	<?php
}

if($_POST['action']=='addnewGuide' && trim($_POST['guideQuoteId'])!=''){
  $guideQuoteId=addslashes($_POST['guideQuoteId']);
  $fromDate=addslashes($_POST['fromDate']);
  $toDate=addslashes($_POST['toDate']);
  $queryId=addslashes($_POST['queryId']);
  $quotationId=addslashes($_POST['quotationId']);
  $name=addslashes($_POST['name']);
  $mobileNo=addslashes($_POST['mobileNo']);
  $whatsAppNo=addslashes($_POST['whatsAppNo']);
  $emailAddress=addslashes($_POST['emailAddress']);
  $selga='*';
  $wherega='guideQuoteId="'.$guideQuoteId.'"';
  $rsga=GetPageRecord($selga,'guideAllocation',$wherega);
  $countguide=mysqli_num_rows($rsga);
  $namevalue ='queryId="'.$queryId.'",guideQuoteId="'.$guideQuoteId.'",quotationId="'.$quotationId.'",name="'.$name.'",mobileNo="'.$mobileNo.'",whatsAppNo="'.$whatsAppNo.'",emailAddress="'.$emailAddress.'",GuideId="",fromDate="'.$fromDate.'",toDate="'.$toDate.'"';
  if($countguide>0){
  	$where='guideQuoteId="'.$guideQuoteId.'"';
    $update = updatelisting('guideAllocation',$namevalue,$where); 
  }else{
  	$lastId = addlistinggetlastid('guideAllocation',$namevalue);
  }
	?>
	<script>
	 parent.$('#guideInfo<?php echo $guideQuoteId; ?>').html('<div><?php echo $name; ?><br /><?php echo $mobileNo; ?></div>');	
	 parent.$('#pageloading').hide();
	 parent.$('#pageloader').hide();
	 parent.alertspopupopenClose();
	</script>
	<?php
}
if(trim($_POST['action'])=='adddepartment' && trim($_POST['department'])!='' && trim($_POST['editid'])==''){
	$department=clean($_POST['department']);
	$dateAdded=time();
	$namevalue ='department="'.$department.'",addedBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",dateAdded="'.$dateAdded.'"';
	$add = addlisting('departmentMasters',$namevalue);
	if($add=='yes'){
	$select='id';
	$where='userId="'.$loginusersuperParentId.'" order by id desc';
	$rs=GetPageRecord($select,'departmentMasters',$where);
	$departmentid=mysqli_fetch_array($rs);
	 generateLogs('userdepartment','add',$departmentid['id']);
	?>
	<script>
	parent.window.location.href='setupsetting.crm?module=userdepartment&alt=1';
	</script>
	<?php
	exit();
	}
}
if(trim($_POST['action'])=='editdepartment' && trim($_POST['department'])!='' && trim($_POST['editid'])!=''){
	$editid=clean(decode($_REQUEST['editid']));
	$department=clean($_POST['department']);
	$dateAdded=time();
	$namevalue ='department="'.$department.'",modifyBy="'.$_SESSION['userid'].'",userId="'.$loginusersuperParentId.'",modifyDate="'.$dateAdded.'"';
	$where='id="'.$editid.'" and userId="'.$loginusersuperParentId.'"';
	$update = updatelisting('departmentMasters',$namevalue,$where);
	if($update='yes'){
	 generateLogs('userdepartment','update',$editid);
	?>
	<script>
	parent.window.location.href='setupsetting.crm?module=userdepartment&alt=2';
	</script>
	<?php
	exit();
	}
}
if(trim($_REQUEST['action'])=='deletedepartment' && trim($_REQUEST['did'])!=''){
	$sql_del="update ".'departmentMasters'." set deletestatus=1  where id='".decode($_GET['did'])."' and  userId=".$loginusersuperParentId." ";
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
	generateLogs('userdepartment','delete',decode($_GET['did']));
	?>
	<script>
	setupbox('setupsetting.crm?module=userdepartment&alt=3');
	</script>
	<?php 
}
if($_POST['action']=='addtodolistaction' && trim($_POST['editId'])!=''){ 
	$editId=decode($_POST['editId']);
	$todoStatus=addslashes($_POST['todoStatus']); 
	$toDoDate=date('Y-m-d',strtotime($_POST['toDoDate']));
	$toDotime=addslashes($_POST['toDotime']); 
	$dateTime=date('Y-m-d H:i:s',strtotime($toDoDate.' '.$toDotime));
	$followupDate=date('Y-m-d H:i:s',strtotime($toDoDate.' '.$toDotime));
	if($todoStatus==1){
	 $namevalue ='finalStatus="'.$todoStatus.'"';
	}
	if($todoStatus==2){
	 $namevalue ='toDoDate="'.$toDoDate.'",toDotime="'.$toDotime.'",dateTime="'.$dateTime.'",followupDate="'.$followupDate.'"';
	} 
  	$where='id="'.$editId.'"';
    $update = updatelisting('toDoTimeLine',$namevalue,$where);  
	?>
	<script>
	parent.location.reload();
	</script>
	<?php
} 
if(trim($_POST['action'])=='addtodoforquotation'  && trim($_POST['queryId-todo'])!=''){
	$taskTitle=addslashes($_POST['taskTitle-todo']);
	$assignTo=$_POST['assignTo-todo'];
	$actionDate=date("Y-m-d", strtotime($_POST['actionDate-todo'])); 
	$actionTime = $_POST['actionTime-todo'];
	$remark=$_POST['remark-todo'];
	$type=$_POST['type-todo'];
	$statusId=1; 
	$queryId=decode($_POST['queryId-todo']); 
	$new_completionDate=date('Y-m-d H:i:s',strtotime($actionDate.' '.$actionTime));
	$namevalue ='actionDate="'.$actionDate.'",taskTitle="'.$taskTitle.'",actionTime="'.$actionTime.'",statusId="'.$statusId.'",dateAdded="'.time().'",queryId="'.$queryId.'",assignTo="'.$assignTo.'",remark="'.$remark.'",new_completionDate="'.$new_completionDate.'",type="'.$type.'"';
	$lastid = addlistinggetlastid(_CHECK_TODOLIST_MASTER_,$namevalue);
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.alertspopupopenClose();
	parent.loadtodolistfun();
	</script>
	<?php
	exit();
}
if(trim($_REQUEST['action'])=='languagelettereditor' && trim($_REQUEST['queryId'])!='' && isset($_POST['savenewlan'])){
	$letterType=$_POST['letterType'];
	$languageType=$_POST['languageType'];
	$queryId=decode($_POST['queryId']);
	$description = mysqli_real_escape_string(db(),urldecode($_POST['descname']));
	$dateAdded= time(); 
	$rs=GetPageRecord('*','letterLinkLanguageMaster','1 and queryId="'.$queryId.'" and letterId="'.$letterType.'"'); 
	$resListing=mysqli_num_rows($rs);
	if($resListing > 0){
	$where='queryId="'.$queryId.'" and letterId="'.$letterType.'"'; 	
	$namevalue ='languageId="'.$languageType.'",modifyDate="'.$dateAdded.'",modifyBy="'.$_SESSION['userid'].'",description="'.$description.'"';
	$update = updatelisting('letterLinkLanguageMaster',$namevalue,$where);
	}
	 else{
	$namevalue ='letterId="'.$letterType.'",languageId="'.$languageType.'",queryId="'.$queryId.'",dateAdded="'.$dateAdded.'",addedBy="'.$_SESSION['userid'].'",description="'.$description.'"';
	$lastid = addlistinggetlastid('letterLinkLanguageMaster',$namevalue);
	}
	?>
	<script>
		parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo $_POST['queryId'] ?>');	
	</script>
	<?php
	exit();
}

if($_POST['action']=='assignafterconfirmation' && trim($_POST['editId'])!=''){  

	$editId=decode($_POST['editId']); 
	$confirmedAssignTo=addslashes($_POST['confirmedAssignTo']); 
	$details=addslashes($_POST['details']); 
	$ccmail=addslashes($_POST['ccmails']); 
	include "config/mail.php";
	// $namevalue ='confirmedAssignTo="'.$confirmedAssignTo.'"'; 
	$namevalue ='assignTo="'.$confirmedAssignTo.'"'; 
  	$where='id="'.$editId.'"'; 
    $update = updatelisting(_QUERY_MASTER_,$namevalue,$where);   


	$rsQuery='';
	$rsQuery=GetPageRecord('*',_QUERY_MASTER_,'id='.$editId.'');
	$queryData=mysqli_fetch_array($rsQuery);

	$rs='';
	$rs=GetPageRecord('*',_USER_MASTER_,'id='.$confirmedAssignTo.'');
	$assignUserD=mysqli_fetch_array($rs);
	//.' '.$assignUserD['lastName']
	$assignUserName = ucfirst($assignUserD['firstName']);


	$fromemail='';
	$mailto=$assignUserD['email'];

	$select='emailsignature';
	$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	$LoginUserDetails=mysqli_fetch_array($rs);

	if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
	    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
	}

	$description = str_replace('{Assignee}',$assignUserName,$details).'<br><br>'.stripslashes($emailsignature);

	$mailsubject='#'.makeQueryId($queryData['id']).' - Assigned to '.trim($assignUserName);
	$maildescription=$description;

	// echo ($fromemail.','.$mailto.','.$mailsubject.','.$maildescription.','.$ccmail);
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);

	if($exeMailresult!=true){
		?>
		<script>
		parent.alert('Query Assigned Successfully, But mail not sent, Please check your configration');
 		parent.location.reload(); 
		</script>
		<?php
	}else{
		?> 
		<script> 
		parent.alert('Query Assigned Successfully');
		parent.location.reload();
		</script> 
		<?php 
	} 
	
} 
if(trim($_REQUEST['action'])=='quotationlanguagechange' && trim($_REQUEST['languageId'])!=''){
	$id=decode($_REQUEST['id']);
	$languageId=$_REQUEST['languageId'];
	
	$namevalue = 'languageId="'.$languageId.'"';
	$where='id="'.$id.'"';
	$update = updatelisting(_QUOTATION_MASTER_,$namevalue,$where);
}
if($_REQUEST['action']=='cancleServicevoucher' && $_REQUEST['quotationId']!=''){
	$namevalue = 'cancelVoucher=1';
	$where='queryId="'.$_REQUEST['queryId'].'" and quotationId="'.$_REQUEST['quotationId'].'"';
	$update = updatelisting('finalquotationItinerary',$namevalue,$where);
}
if($_REQUEST['action'] == 'changeQuotationActiveStatus' && $_REQUEST['quotationId']!=''){
	$namevalue = 'isActive="'.$_REQUEST['status'].'"';
	$where='id="'.$_REQUEST['quotationId'].'"';
	
	$update = updatelisting(_QUOTATION_MASTER_,$namevalue,$where);
	?>
	<script>
	parent.setupbox('showpage.crm?module=query&view=yes&id=<?php echo $_REQUEST['queryId'] ?>');	
	</script>
	<?php
}
?>


<?php
// started sec sales person 

if($_POST['action']=='assignafterconfirmationSales' && trim($_POST['editId'])!=''){  

	$editId=decode($_POST['editId']); 



	$confirmedAssignTo=addslashes($_POST['confirmedAssignToSales']); 

	 $namevalue ='salesPersonId="'.$confirmedAssignTo.'"'; 

  	$where='id="'.$editId.'"'; 

	// die("try it");

    $update = updatelisting('queryMaster',$namevalue,$where);   

	?> 

	<script> 

	parent.location.reload(); 

	</script> 

	
<?php 
} 
?>
<!--  Ended sec sales person -->



<?php 
if($_REQUEST['action'] == 'deletecontactperson' && $_REQUEST['contactpersonid'] !=''){
	$delwhere='id="'.$_REQUEST['contactpersonid'].'"';
	deleteRecord('suppliercontactPersonMaster',$delwhere);
} 
if($_REQUEST['action'] == 'savePackageHotelRequest'){
	$queryId = $_REQUEST['queryId'];
	$hotelId = $_REQUEST['hotelId'];
	$HotelSupplierStatus = $_REQUEST['status'];
	 
	$rs=GetPageRecord('*',_QUOTATION_HOTEL_MASTER_,'queryId="'.$queryId.'" and supplierId="'.$hotelId.'" order by id asc');
	while($hotelData=mysqli_fetch_array($rs)){
		$namevalue = 'HotelSupplierStatus="'.$HotelSupplierStatus.'"';
		$where='id='.$hotelData['id'].'';
		$update = updatelisting(_QUOTATION_HOTEL_MASTER_,$namevalue,$where);	
	}
}

if(trim($_REQUEST['action'])=='queryCancellation' && trim($_REQUEST['queryId'])!=''){
	$queryId=clean($_REQUEST['queryId']);
	$noteDetails=clean($_REQUEST['noteDetails']);
	$dateAdded=time();
	$where='id="'.$queryId.'"';
	$namevalue ='cancelNoteReason="'.$noteDetails.'",queryStatus=20,queryCancelDate="'.date('Y-m-d').'"';
	$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);
	?>
	<script>
	parent.window.location.href='showpage.crm?module=query&view=yes&id=<?php echo encode($queryId); ?>';
	</script>
	<?php
	exit();
}

if(trim($_REQUEST['action'])=='cancelSupplierVoucherList' && trim($_REQUEST['queryId'])!=''){
	$queryId=decode($_REQUEST['queryId']);

	$noteDetails=clean($_REQUEST['noteDetails']);

	$where='id="'.$queryId.'"';

	$namevalue ='cancelNoteReason="'.$noteDetails.'",queryStatus=20,queryCancelDate="'.date('Y-m-d').'"';

	$update = updatelisting(_QUERY_MASTER_,$namevalue,$where);

	$namevalue1 ='deletestatus=1';

	$where1='queryid='.$queryId.'';   

	$update1 = updatelisting(_PAYMENT_REQUEST_MASTER_,$namevalue1,$where1);  

	$namevalue2 ='deletestatus=1'; 

	$where2='queryId='.$queryId.'';   

	$update2 = updatelisting(_VOUCHER_MASTER_,$namevalue2,$where2);

	?>
	<script>
	parent.window.location.href='showpage.crm?module=query&view=yes&id=<?php echo encode($queryId); ?>&alt=3';
	</script>
	<?php
	exit();
}

if(trim($_REQUEST['action'])=='cancelfinalquotInvoice' && trim($_REQUEST['queryId'])!=''){
	$queryId=decode($_REQUEST['queryId']);

	$namevalue ='deletestatus=1'; 

	$where='queryId='.$queryId.'';   

	$update = updatelisting(_INVOICE_MASTER_,$namevalue,$where);

	?>
	<script>
	parent.window.location.href='showpage.crm?module=query&view=yes&id=<?php echo encode($queryId); ?>&alt=3';
	</script>
	<?php
	exit();
}

if($_REQUEST['action']=='saveLeadTask' && $_REQUEST['editId']!=''){
	$leadId=decode($_REQUEST['editId']);
	$subject=addslashes($_REQUEST['title']);
	$fromDate=date("Y-m-d", strtotime($_REQUEST['actionDate']));
	$assignTo=addslashes($_REQUEST['assignTo']);
	$fromTime=date('h:i A',strtotime($_REQUEST['actionTime']));
	$description=addslashes($_REQUEST['notes']);
	$followupdate=date('Y-m-d H:i:s',strtotime($fromDate.' '.$fromTime));
	$remiderDate=date('Y-m-d H:i:s',strtotime($followupdate)-($_REQUEST['reminderTime'] * 60));
	$activityType=addslashes($_REQUEST['activitytype']);
	$namevalue ='subject="'.$subject.'",fromDate="'.$fromDate.'",assignTo="'.decode($assignTo).'",starttime="'.$fromTime.'",description="'.$description.'",remiderDate="'.$remiderDate.'",followupdate="'.$followupdate.'",addedBy="'.$_SESSION['userid'].'",activityType=3,dateAdded="'.date('Y-m-d').'",leadId="'.$leadId.'"';
	$adds = addlisting(_ACTIVITY_MASTER_,$namevalue);
	?>
	<script>
	parent.alertspopupopenClose();
	$('#tasksaved').show();
	$('#taskhide').hide();
	</script>
	<?php
}
 

// add agent from query here 
if($_REQUEST['action']=='saveLeadCorporate' && $_POST['leadcompanyName']!='' && $_POST['businessType']!=2){

	
	$businessType = $_POST['businessType'];
	$companyName = $_POST['leadcompanyName'];
	$copmanyType = $_POST['copmanyType'];
	$salesPerson = $_POST['salesPerson'];
	$operationPerson = $_POST['operationPerson'];
	$marketType = $_POST['marketType'];
	$nationality = $_POST['nationality'];
	$companyCategory = $_POST['categoryid'];
	$tourType = $_POST['tourType'];
	$division = $_POST['division'];
	$contactPerson = $_POST['contactPerson'];
	$designation = $_POST['designation'];
	$countryCode = $_POST['countryCode'];
	$phonecontprson = $_POST['phone'];
	$emailcontprson = $_POST['email'];
	$addTo = $_POST['addTo'];
	$dateAdded= date('Y-m-d');
	$addedBy=$_SESSION['userid'];
	
	// agent duplicate code 
	$rsr=GetPageRecord('*','contactPersonMaster','email="'.encode($emailcontprson).'" ');
	// $editresult=mysqli_num_rows($rsr);
	if(mysqli_num_rows($rsr) > 0 ){
		// echo "This is a agent testing222";
		// exit();
        ?>
        <script>
        parent.alert('This Agent Already Exist!');
		parent.$('#pageloader').hide();
		parent.$('#pageloading').hide();
        </script> 
        <?php 
		exit();
		
    }else{

	$nameValue ='companyTypeId="'.$copmanyType.'",name="'.$companyName.'",contactPerson="'.$contactPerson.'",status="1",assignTo="'.$salesPerson.'",addedBy="'.$addedBy.'",dateAdded="'.$dateAdded.'",bussinessType="'.$businessType.'",companyCategory="'.$companyCategory.'",OpsAssignTo="'.$operationPerson.'",nationality="'.$nationality.'",tourType="'.$tourType.'",marketType="'.$marketType.'"';
	
	$add = addlistinggetlastid(_CORPORATE_MASTER_,$nameValue);

	
		$allvaluecontactperson ='contactPerson="'.$contactPerson.'",corporateId="'.$add.'",designation="'.$designation.'",phone="'.encode($phonecontprson).'",email="'.encode($emailcontprson).'",countryCode="'.$countryCode.'",primaryvalue="1",division="'.$division.'"';
		$add = addlisting('contactPersonMaster',$allvaluecontactperson);

		
	?>
		<script>
		// parent.window.location.href='showpage.crm?module=query&add=yes';
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.alertspopupopenClose();
	</script>

	<?php
	}
}
	
// Add B2C From Query 
if($_REQUEST['action']=='saveLeadCorporate' && $_POST['businessType']=='2'){

	$nationality = $_POST['nationality'];
	$marketType = $_POST['marketType'];
	$salesPerson = $_POST['salesPerson'];
	$contacttitleId = $_POST['contacttitleId'];
	$firstName = $_POST['firstName'];
	$middleName = $_POST['middleName'];
	$lastName = $_POST['lastName'];
	$gender = $_POST['gender'];
	$birthDate1 = $_POST['birthDate'];
	$countryId = $_POST['country'];
	$stateId = $_POST['loadstates'];
	$cityId = $_POST['loadcities'];
	$pinzip = $_POST['pinzip'];
	$addressInfo = $_POST['addressInfo'];
	$PhoneTypeId = $_POST['PhoneTypeId'];
	$PhoneNo = $_POST['PhoneNo'];
	$countryCode1 = $_POST['countryCode'];
	$EmailTypeId = $_POST['EmailTypeId'];
	$Email = $_POST['Email'];
	$businessType = $_POST['businessType'];
	$countryCode = $_POST['countryCode'];
	$addTo = $_POST['addTo'];
	// $dateAdded = time();
	$birthDate = date("Y-m-d",strtotime($birthDate1));
	$dateAdded= date('Y-m-d');
	$addedBy=$_SESSION['userid'];
	// B2C duplicate code 
	$rsr=GetPageRecord('*','emailMaster','email="'.$Email.'" and emailType="7"');
	// $editresult=mysqli_num_rows($rsr);
	if(mysqli_num_rows($rsr) > 0 ){
		// echo "This is a B2C testing222";
		// exit();
        ?>
        <script>
        parent.alert('This B2C Already Exist!');
		parent.$('#pageloader').hide();
		parent.$('#pageloading').hide();
        </script> 
        <?php 
		exit();
		
    }else{
	$namevalue ='contacttitleId="'.$contacttitleId.'",firstName="'.$firstName.'",middleName="'.$middleName.'",lastName="'.$lastName.'",gender="'.$gender.'",birthDate="'.$birthDate.'",marketType="'.$marketType.'",countryId="'.$countryId.'",stateId="'.$stateId.'",cityId="'.$cityId.'",pinzip="'.$pinzip.'",assignTo="'.$salesPerson.'",addressInfo="'.$addressInfo.'",addedBy="'.$addedBy.'",dateAdded="'.$dateAdded.'",pinCode="'.$pinCode.'",nationality="'.$nationality.'",tourType="'.$tourType.'",status=1,mobilePin="'.$mobilePin.'",contactType="'.$businessType.'",corporateId="'.$corporateId.'",designationName="'.$designationName.'"';
	$add = addlistinggetlastid(_CONTACT_MASTER_,$namevalue);


	$nameEmail = 'email="'.$Email.'",emailType="'.$EmailTypeId.'",primaryvalue="1",masterId="'.$add.'",sectionType="contacts",dateAdded="'.$dateAdded.'",deletestatus="0"';
	$eid = addlistinggetlastid(_EMAIL_MASTER_,$nameEmail);

	$namePhone = 'phoneNo="'.$PhoneNo.'",countryCode="'.$countryCode1.'",phoneType="'.$PhoneTypeId.'",primaryvalue="1",masterId="'.$add.'",sectionType="contacts",dateAdded="'.$dateAdded.'",EID="'.$eid.'",deletestatus="0"';

	addlisting(_PHONE_MASTER_,$namePhone);


	// $nameEmail = 'email="'.$Email.'",emailType="'.$EmailTypeId.'",phone="'.$PhoneNo.'",phoneType="'.$PhoneTypeId.'",primaryvalue="1",masterId="'.$add.'",sectionType="contacts",dateAdded="'.$dateAdded.'",deletestatus="0"';
	// addlisting('EmailandPhoneMaster',$nameEmail);

	
	
?>
	<script>
	// parent.window.location.href='showpage.crm?module=query&add=yes';
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.alertspopupopenClose();
</script>

<?php
}
	}



if($_POST['action']=='addtodosaleaction' && trim($_POST['editId'])!=''){ 
	$editId=decode($_POST['editId']);
	$type=$_POST['type'];
	$todoStatus=addslashes($_POST['todoStatus']); 
	$toDoDate=date('Y-m-d',strtotime($_POST['toDoDate']));
	$toDotime=addslashes($_POST['toDotime']); 
	// $followupDate=date('Y-m-d',strtotime($toDoDate.' '.$toDotime));
	if($todoStatus==5){
	 $namevalue ='fromDate="'.$toDoDate.'",starttime="'.$toDotime.'",status="'.$todoStatus.'"';
	}else{
		$namevalue ='status="'.$todoStatus.'"';
	}
	
  	$where='id="'.$editId.'"';

  	if($type == 'lead'){
  		$update = updatelisting('leadManageMaster',$namevalue,$where);
  	}
  	if($type == 'activity'){
  		$update = updatelisting('activityMaster',$namevalue,$where);
  	}
  	if($type == 'call'){
  		$update = updatelisting(_CALLS_MASTER_,$namevalue,$where);
  	}
  	if($type == 'meeting'){
  		$update = updatelisting(_MEETINGS_MASTER_,$namevalue,$where);
  	}
  	if($type == 'task'){
  		$update = updatelisting(_TASKS_MASTER_,$namevalue,$where);  
  	}
	?>
	<script>
	parent.location.reload();
	</script>
	<?php
}

// document master 
if($_POST['action']=='addDocumentFolder' && $_POST['folderName']!=''){
	$folderName = str_replace(' ','',$_POST['folderName']);
	$folderId=decode($_POST['folderId']);
	$dateAdded=time();
	$rs1='';
	$rs1=GetPageRecord('id,name',_DOCUMENT_FOLDER_MASTER_,'UPPER(name)="'.strtoupper($folderName).'"');
	if(mysqli_num_rows($rs1)>0){
		?>
		<script>
			alert("<?php echo ucfirst($folderName); ?> Folder already exists.");
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
	
		</script>
		<?php
		exit();
	}else{
	if($_POST['editId']!=''){
		$rs='';
		$rs=GetPageRecord('id,folderId,fpath',_DOCUMENT_FOLDER_MASTER_,' addedBy="'.$loginusersuperParentId.'" and id="'.decode($_POST['editId']).'"');
		$folderData=mysqli_fetch_array($rs);
		if($folderData['folderId']>0){
			$rs='';
			$rs=GetPageRecord('id,fpath',_DOCUMENT_FOLDER_MASTER_,' id="'.$folderData['folderId'].'"');
			$ParentfolderData=mysqli_fetch_array($rs);
			$cpath = $ParentfolderData['fpath'].'/'.$folderName;
		}else{
			$cpath = 'docFiles/'.$folderName;
		}
		$Oldpath = $folderData['fpath'];
		rename($Oldpath, $cpath);
	 
		$where='addedBy="'.$loginusersuperParentId.'" and id='.($folderData['id']).'';
		$namevalue ='name="'.$folderName.'",fpath="'.$cpath.'",dateAdded="'.time().'",addedBy="'.$loginusersuperParentId.'"';
		updatelisting(_DOCUMENT_FOLDER_MASTER_,$namevalue,$where);

	}else{

		if($folderId>0){
			$rs='';
			$rs=GetPageRecord('id,name,fpath',_DOCUMENT_FOLDER_MASTER_,' id='.$folderId.'');
			$folderData=mysqli_fetch_array($rs);
			$cpath = $folderData['fpath'].'/'.$folderName;
			createPath($cpath);
		}else{
			$cpath = 'docFiles/'.$folderName;
			createPath($cpath);
		}

		$namevalue ='name="'.$folderName.'",folderId="'.$folderId.'",fpath="'.$cpath.'",dateAdded="'.time().'",addedBy="'.$loginusersuperParentId.'"';
		addlistinggetlastid(_DOCUMENT_FOLDER_MASTER_,$namevalue);
	}
}
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.location.reload(); 
	</script>
	<?php
	exit();
}

// add files to master
if($_POST['action']=='addFilesToMaster' && $_POST['parentId']!='' && $_POST['desktopFileName']!='' && isset($_FILES['uploadDesktopfile']['name'])){

	$desktopFileName=clean($_POST['desktopFileName']);
	$parentId = $_POST['parentId']; 
	$galleryType = $_POST['galleryType']; 
	
	$ref=clean($_POST['ref']);
	$fpath = 'docFiles/Proposal_Files';
	$folderName = 'Proposal_Files';
	$rs='';
	$rs=GetPageRecord('id,name,fpath',_DOCUMENT_FOLDER_MASTER_,' fpath="'.$fpath.'" and name="'.$folderName.'"');
	if(mysqli_num_rows($rs)>0 ){
		$folderData=mysqli_fetch_array($rs); 
		$fpath = $folderData['fpath'];
		$folderId = $folderData['id'];
	}else{
		$cpath = 'docFiles';
		$cpath = 'docFiles/Proposal_Files';
		$folderName = 'Proposal_Files';
		createPath($cpath);

		$namevalue ='name="'.$folderName.'",folderId="'.$folderId.'",fpath="'.$cpath.'",dateAdded="'.time().'",addedBy="'.$loginusersuperParentId.'"';
		$folderId = addlistinggetlastid(_DOCUMENT_FOLDER_MASTER_,$namevalue);
		$rs=GetPageRecord('id,name,fpath',_DOCUMENT_FOLDER_MASTER_,' id="'.$folderId.'"');
		$folderData=mysqli_fetch_array($rs); 
		$fpath = $folderData['fpath'];
	}
	$fileSizeWH = '';
	if($_POST['fileType'] == 'IMG'){
		$fileDimension = clean($_POST['fileSize']);
		$fileSizeWH2 = '-'.$fileDimension;

		// Dimentions requirments
		$fileSizeWHArray = explode('x',$fileDimension);
		$fileSizeW = $fileSizeWHArray[0];
		$fileSizeH = $fileSizeWHArray[1];

		// Actual Dimentions 
		$image_info = getimagesize($_FILES["uploadDesktopfile"]["tmp_name"]);
		$image_width = $image_info[0];
		$image_height = $image_info[1];

		// VALIDATIONS
		if($image_width == $fileSizeW && $image_height == $fileSizeH){
			// print_r($image_info);	

			$file_name=$_FILES['uploadDesktopfile']['name'];
			$fileType = pathinfo($file_name, PATHINFO_EXTENSION);
			$newFileName = str_replace(' ','-',strtolower($desktopFileName)).'-'.time().$fileSizeWH2.'.'.$fileType;
			$filepath = $fpath.'/'.$newFileName;
			copy($_FILES['uploadDesktopfile']['tmp_name'],$filepath);
			$fileSize=$_FILES['uploadDesktopfile']['size'];

			$dateAdded=time();
			$namevalue ='name="'.$desktopFileName.'",ref="'.$ref.'",folderId="'.$folderId.'",uploadFile="'.$filepath.'",fileType="'.$fileType.'",fileSize="'.$fileSize.'",fileDimension="'.$fileDimension.'",dateAdded="'.time().'",addedBy="'.$_SESSION['userid'].'"';
			$lastId = addlistinggetlastid(_DOCUMENT_FILES_MASTER_,$namevalue);


			$namevalueg ='fileId="'.$lastId.'",parentId="'.$parentId.'",galleryType="'.$galleryType.'",deletestatus="0",addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
			addlistinggetlastid('imageGallery',$namevalueg);
			
			?>
			<script>
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
			parent.location.reload(); 
			</script>
			<?php
			exit();
		}else{
			?>
			<script>
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
			parent.alert('Invalid Size, Your Image Dimensions (<?php echo $image_width.'x'.$image_height; ?>) Pixes, Upload the right dimension file as you select above.');
			</script>
			<?php
			exit();
		}
	}else{
		// IF NOT IMAGE
		$fileType = pathinfo($_FILES['uploadDesktopfile']['name'], PATHINFO_EXTENSION);
		// $fileName2 = pathinfo($_FILES['uploadFolderfile']['name'], PATHINFO_FILENAME);
		$newFileName = str_replace(' ','-',strtolower($desktopFileName)).'-'.time().'.'.$fileType;

		$filepath = $fpath.'/'.$newFileName;
		copy($_FILES['uploadDesktopfile']['tmp_name'],$filepath);

		$fileSize=$_FILES['uploadDesktopfile']['size'];

		$dateAdded=time();
		$namevalue ='name="'.$desktopFileName.'",ref="'.$ref.'",folderId="'.$folderId.'",uploadFile="'.$filepath.'",fileType="'.$fileType.'",fileSize="'.$fileSize.'",fileDimension="'.$fileDimension.'",dateAdded="'.time().'",addedBy="'.$_SESSION['userid'].'"';
		$lastId = addlistinggetlastid(_DOCUMENT_FILES_MASTER_,$namevalue);


		$namevalueg ='fileId="'.$lastId.'",parentId="'.$parentId.'",galleryType="'.$galleryType.'",deletestatus="0",addedBy="'.$_SESSION['userid'].'",dateAdded="'.time().'"';
		addlistinggetlastid('imageGallery',$namevalueg);
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.location.reload(); 
		</script>
		<?php
		exit();
	}
	
}


if($_POST['action']=='addFolderFiles' && $_POST['folderId']!='' && $_POST['fileName']!='' && isset($_FILES['uploadFolderfile']['name'])){

	$fileName=clean($_POST['fileName']);
	$folderId = decode($_POST['folderId']); 
	$ref=clean($_POST['ref']);
	$rs='';
	$rs=GetPageRecord('id,name,fpath',_DOCUMENT_FOLDER_MASTER_,' id='.$folderId.'');
	if(mysqli_num_rows($rs)>0 && $folderId>0){
		$folderData=mysqli_fetch_array($rs); 
		$fpath = $folderData['fpath'];
	}else{
		$fpath = 'docFiles';
	}
	$fileSizeWH = '';
	if($_POST['fileType'] == 'IMG'){
		$fileDimension = clean($_POST['fileSize']);
		$fileSizeWH2 = '-'.$fileDimension;

		// Dimentions requirments
		$fileSizeWHArray = explode('x',$fileDimension);
		$fileSizeW = $fileSizeWHArray[0];
		$fileSizeH = $fileSizeWHArray[1];

		// Actual Dimentions 
		$image_info = getimagesize($_FILES["uploadFolderfile"]["tmp_name"]);
		$image_width = $image_info[0];
		$image_height = $image_info[1];

		// VALIDATIONS
		if($image_width == $fileSizeW && $image_height == $fileSizeH){
			// print_r($image_info);	

			$file_name=$_FILES['uploadFolderfile']['name'];
			$fileType = pathinfo($file_name, PATHINFO_EXTENSION);
			$newFileName = str_replace(' ','-',strtolower($fileName)).'-'.time().$fileSizeWH2.'.'.$fileType;
			$filepath = $fpath.'/'.$newFileName;
			copy($_FILES['uploadFolderfile']['tmp_name'],$filepath);
			$fileSize=$_FILES['uploadFolderfile']['size'];

			$dateAdded=time();
			$namevalue ='name="'.$fileName.'",ref="'.$ref.'",folderId="'.$folderId.'",uploadFile="'.$filepath.'",fileType="'.$fileType.'",fileSize="'.$fileSize.'",fileDimension="'.$fileDimension.'",dateAdded="'.time().'",addedBy="'.$_SESSION['userid'].'"';
			addlistinggetlastid(_DOCUMENT_FILES_MASTER_,$namevalue);
			?>
			<script>
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
			parent.location.reload(); 
			</script>
			<?php
			exit();
		}else{
			?>
			<script>
			parent.$('#pageloading').hide();
			parent.$('#pageloader').hide();
			parent.alert('Invalid Size, Your Image Dimensions (<?php echo $image_width.'x'.$image_height; ?>) Pixes, Upload the right dimension file as you select above.');
			</script>
			<?php
			exit();
		}
	}else{
		// IF NOT IMAGE
		$fileType = pathinfo($_FILES['uploadFolderfile']['name'], PATHINFO_EXTENSION);
		// $fileName2 = pathinfo($_FILES['uploadFolderfile']['name'], PATHINFO_FILENAME);
		$newFileName = str_replace(' ','-',strtolower($fileName)).'-'.time().'.'.$fileType;

		$filepath = $fpath.'/'.$newFileName;
		copy($_FILES['uploadFolderfile']['tmp_name'],$filepath);

		$fileSize=$_FILES['uploadFolderfile']['size'];

		$dateAdded=time();
		$namevalue ='name="'.$fileName.'",ref="'.$ref.'",folderId="'.$folderId.'",uploadFile="'.$filepath.'",fileType="'.$fileType.'",fileSize="'.$fileSize.'",fileDimension="'.$fileDimension.'",dateAdded="'.time().'",addedBy="'.$_SESSION['userid'].'"';
		addlistinggetlastid(_DOCUMENT_FILES_MASTER_,$namevalue);
		?>
		<script>
		parent.$('#pageloading').hide();
		parent.$('#pageloader').hide();
		parent.location.reload(); 
		</script>
		<?php
		exit();
	}
	
}

if($_POST['action']=='deleteDocumentFolder' && $_POST['editId']!=''){
	$select='id,name,fpath';
	$where='addedBy="'.$loginusersuperParentId.'" and id='.decode($_POST['editId']).'';
	$rs=GetPageRecord($select,_DOCUMENT_FOLDER_MASTER_,$where);
	$folderData=mysqli_fetch_array($rs);

	$sql_del="delete from "._DOCUMENT_FOLDER_MASTER_."  where id='".($folderData['id'])."'";
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));

	DeleteFolderAndFiles($folderData['fpath']);
	generateLogs('Document Files','delete',decode($_POST['editId']));
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.location.reload(); 
	</script>
	<?php
	exit();
}
if($_POST['action']=='deleteDocumentFile' && $_POST['editId']!=''){
	$select='id,uploadFile,folderId'; 
	$where2='addedBy="'.$loginusersuperParentId.'" and id='.decode($_POST['editId']).'';
	$rs2=GetPageRecord($select,_DOCUMENT_FILES_MASTER_,$where2);
	$filemaster=mysqli_fetch_array($rs2);

	$sql_del="delete from "._DOCUMENT_FILES_MASTER_."  where id='".($filemaster['id'])."'";
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
	DeleteFolderAndFiles($filemaster['uploadFile']);
	generateLogs('Document Files','delete',decode($_POST['editId']));
	?>
	<script>
	parent.$('#pageloading').hide();
	parent.$('#pageloader').hide();
	parent.location.reload(); 
	</script>
	<?php
	exit();
}
if($_POST['action']=='sendDocumentfile' && $_POST['sendfilename']!='' && $_POST['uploadFile']!='' && $_POST['fileicon']!=''){
	include "config/mail.php";
	$sendfilename=$_POST['sendfilename'];
	$uploadFile=$_POST['uploadFile'];
	$fileicon=$_POST['fileicon'];
	$emailsender=$_POST['emailsender'];
	$emailsubject=clean($_POST['emailsubject']);
	$emaildescription=nl2br(clean($_POST['emaildescription']));
	$fileattach='<div style="width: 300px;"><div class="documentfiledisply" style="
	    border: 1px #eaeaea solid;
	    padding: 15px;
	    margin-bottom: 10px;
	    text-align: center;
	    border-radius: 4px;
	    margin-bottom: 0px;
	"><img src="'.$fullurl.$fileicon.'" width="54" >
	<div style="margin-top:6px; font-size:15px;">'.$sendfilename.'</div>
	</div>  <a href="'.$fullurl.$uploadFile.'" target="_blank" style="text-decoration:none;"><div style="
	    text-align: center;
	    padding: 10px;
	    background-color: #8ab768;
	    border-radius: 4px;
	    color: #fff;
	    font-size: 15px;
	">Download</div></a></div>';
	$select='emailsignature';
	$where='id="'.$_SESSION['userid'].'" and email="'.$_SESSION['username'].'"';
	$rs=GetPageRecord($select,_USER_MASTER_,$where);
	$LoginUserDetails=mysqli_fetch_array($rs);

	if(preg_match('/<img(.*)src(.*)=(.*)"(.*)"/U', stripslashes($LoginUserDetails['emailsignature']), $emailsignatureSRC)){
	    $emailsignature = '<img src='.$fullurl.array_pop($emailsignatureSRC).' width="100%" height="auto" alt="signature" style="max-width:700px;"/>';
	}

	$description=$fileattach.'<br>'.$emaildescription.'<br><br>'.stripslashes($emailsignature);
	$ccmail='';
	$fromemail='';
	$mailto=$emailsender;
	$mailsubject=$emailsubject;
	$maildescription=$description;
	$exeMailresult=send_template_mail($fromemail,$mailto,$mailsubject,$maildescription,$ccmail);
	?>
	<script>
	parent.$('#sendfilefrm').hide();
	parent.$('#buttonsbox').hide();
	parent.$('#sentfilemsg').show();
	parent.$('#loaderbox').hide();
	parent.$('#pageloading').hide();
	</script>
	<?php 
}
// end document master

// delete hotel additional rate
if($_REQUEST['action']=='removeHARates' && $_REQUEST['id']!=''){
	$sql_del="delete from dmcAdditionalHotelRate  where id='".$_GET['id']."'";
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
	generateLogs('hotel additional rate','delete',$_GET['id']);
}

// delete b2c contact details
if($_REQUEST['action']=='deleteB2CContactS' && $_REQUEST['EID']!='' && $_REQUEST['PID']!=''){
	$sql_del="delete from "._EMAIL_MASTER_."  where id='".$_GET['EID']."'";
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
	generateLogs('Email Delete','delete',$_GET['EID']);

	$sql_del="delete from "._PHONE_MASTER_."  where id='".$_GET['PID']."'";
	mysqli_query(db(),$sql_del) or die(mysqli_error(db()));
	generateLogs('Phone Delete','delete',$_GET['PID']);
}


if($_REQUEST['action']=='addEdit_Expenses' && $_REQUEST['queryId']!=''){
	$quotationId= clean($_POST['quotationId']);   
	$queryId=decode($_POST['queryId']); 
	$expenseType=$_POST['expenseType']; 
	$expenseDate=$_POST['expenseDate']; 
	$exDate = date("Y-m-d",strtotime($expenseDate));
	$expenseAmount=$_POST['expenseAmount']; 
	$remarks=$_POST['expenseNarration']; 
	$paidto=$_POST['expensePaidTo']; 
	$currency=$_POST['CurrencyId']; 

	$exres = GetPageRecord('*','expenseTypeMaster','id="'.$expenseType.'"');
    $exresH = mysqli_fetch_assoc($exres);
	$headId = $exresH['expenseHeadId'];

	$namevalue = 'expenseTypeId="'.$expenseType.'",expenseDate="'.$exDate.'",expenseAmount="'.$expenseAmount.'",remarks="'.$remarks.'",paidTo="'.$paidto.'",currencyId="'.$currency.'",quotationId="'.$quotationId.'",queryId="'.$queryId.'",headId="'.$headId.'",status="1",deletestatus="0"';
	if($_REQUEST['editId']!=''){
		$where = 'id="'.$_REQUEST['editId'].'"';
		$update = updatelisting('quotationExpensesMaster',$namevalue,$where);
		?>
	<script>
		parent.alertspopupopen('action=expenseMaster&queryId=<?php echo encode($queryId); ?>','1000px','auto');
		parent.loadExpense();
		$("#pageloading").hide();
		$("#pageloader").hide();
	</script>

		<?php
	}else{
		$add = addlisting('quotationExpensesMaster',$namevalue);
	}
	
	?>
	<script>
		parent.loadExpense();
		$("#pageloading").hide();
		$("#pageloader").hide();
	</script>

		<?php

}

if($_REQUEST['action']=="addNewVisaToMaster" || $_REQUEST['action']=="addNewPassportToMaster" || $_REQUEST['action']=="addNewInsuranceToMaster" && $_REQUEST['quotationId']!=''){

	$valueAddedCostName=$_POST['valueAddedCostName']; 
	$valueAddedTypeName=$_POST['valueAddedTypeName']; 
	$valueAddedstatus=$_POST['valueAddedstatus']; 

	if($valueAddedCostName!='' || $valueAddedTypeName!=''){
	
	if($_REQUEST['action']=="addNewVisaToMaster"){
		$namevalue = 'name="'.$valueAddedCostName.'",visaType="'.$valueAddedTypeName.'",status="'.$valueAddedstatus.'",deletestatus="0"';
		
		$addName = addlisting('visaCostMaster',$namevalue);

		?>
		<script>
		parent.warningalert('Visa Added');
		parent.closeinbound();
        parent.needValueAddedServices('visaRequirementAct');
    	
		</script>
		<?php
	
	}elseif($_REQUEST['action']=="addNewPassportToMaster"){
		$namevalue = 'name="'.$valueAddedCostName.'",passportType="'.$valueAddedTypeName.'",status="'.$valueAddedstatus.'",deletestatus="0"';
		$addName = addlisting('passportCostMaster',$namevalue);

		?>
		<script>
		parent.warningalert('Passport Added');
		parent.closeinbound();
        parent.needValueAddedServices('passportRequirementAct');
    	
	</script>
		<?php

	}elseif($_REQUEST['action']=="addNewInsuranceToMaster"){
		$namevalue = 'name="'.$valueAddedCostName.'",insuranceType="'.$valueAddedTypeName.'",status="'.$valueAddedstatus.'",deletestatus="0"';
		$addName = addlisting('insuranceCostMaster',$namevalue);

		?>
		<script>
		parent.warningalert('Insurance Added');
		parent.closeinbound();
        parent.needValueAddedServices('insuranceRequirementAct');
    	
	</script>
		<?php
	}
}else{
	?>
		<script>
		alert("Please, Select Name or Type");
		exit();
    	
		</script>
		<?php
	
}

}


if($_REQUEST['action']=="addQuotationAdditionalPrice" && $_REQUEST['tableN2']>0 && $_REQUEST['quotationId2']!=''){

	$additionalNameId = $_POST['additionalNameId'];
	$costType = $_POST['costType'];
	$currencyId2 = $_POST['currencyId2'];
	$currencyValue2 = $_POST['currencyValue2'];
	$groupCost = $_POST['groupCost'];
	$adultCost = $_POST['adultCost'];
	$childCost = $_POST['childCost'];
	$infantCost = $_POST['infantCost'];
	$rateid2 = $_POST['rateid2'];


	$serviceId2 = $_POST['serviceId2'];
	$dayId2 = $_POST['dayId2'];
	$tableN2 = $_POST['tableN2'];
	$quotationId2 = $_POST['quotationId2'];
	$queryId = $_POST['queryId'];
	$cityId = $_POST['cityId'];

	$rsat=GetPageRecord('*',_EXTRA_QUOTATION_MASTER_,'id="'.$additionalNameId.'"');
	$addName = mysqli_fetch_assoc($rsat); 
	
	
	

	if($tableN2==1){
		$nameValue = 'name="'.$addName['name'].'",rateId="'.$rateid2.'",quotationId="'.$quotationId2.'",queryId="'.$queryId.'",additionalId="'.$additionalNameId.'",costType="'.$costType.'",currencyId="'.$currencyId2.'",currencyValue="'.$currencyValue2.'",groupCost="'.$groupCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",dayId="'.$dayId2.'"';

		addlisting('quotationAdditionalRateMaster',$nameValue);
	}elseif($tableN2==2){
		$nameValue = 'quotationId="'.$quotationId2.'",queryId="'.$queryId.'",additionalId="'.$additionalNameId.'",costType="'.$costType.'",currencyId="'.$currencyId2.'",currencyValue="'.$currencyValue2.'",groupCost="'.$groupCost.'",adultCost="'.$adultCost.'",childCost="'.$childCost.'",infantCost="'.$infantCost.'",dayId="'.$dayId2.'"';
		updatelisting('quotationAdditionalRateMaster',$nameValue,'id="'.$serviceId2.'"');
	}
	
	?>

	<script>
		parent.openinboundpop('action=addServiceAdditional&dayId=<?php echo $dayId2; ?>&cityId=<?php echo $cityId; ?>','900px')
	</script>
	<?php

}


?>
